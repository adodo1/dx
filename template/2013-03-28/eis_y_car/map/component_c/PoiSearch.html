<div class="route_contentWrapper_poi">
<div id="route_content" class="result_holder">
#go_back_total_result#
#tuan_guide#
<div id="screening">
#result_title#
#screening#
</div> 
<div id="txtPanel" class="mapinfo_con">
<!--wjp cmsads -->
<div id="pos1" style="display:none"></div>
#suggest_query#
#pinyin_suggest#
#satequery_suggest#
#space_poi#
#list#
#page#
#place_entrance_wd#
#no_result#
#jump_back#
#feedback#
<!--wjp cmsads -->
<div id="pos2" style="display:none"></div>
</div>
</div>
</div>
<div id="pctomoBottomId" class="pctomo_bottom"><a onclick="PcToMobile.open('POI');" class="pctomoin-img img-small" href="javascript:void(0);"></a></div>
<script>
function PoiSearch(){T.lang.Class.call(this);this.MAX_RESULT_COUNT=760;this.itemsPerPage=10;this.json=null;this.curSelA=null;this.cmdNo=45;this.points=[];this.uids=[];this.markers=[];this.infoWnds=[];this.busStopPois=[];this.stationPoints=[];this.showIconIndices=[];this.isShowAllBtn=false;this.pl_stat="";this.curKw="";this.sugKw="";this.curItemPPage=0;this.curPage=0;this.totalCount=0;this.totalPage=0;this.curSelIndex=-1;this.centerPt=null;this.centerPoi=null;this.cInfoWnd=null;this.radius=0;this.isnbSearch=false;this.ctrPoiName="未知地点";this.ctrPoiUid="";this.busPolylines=[];this.normPolylines=[];this.normPolygons=[];this.stationTips=[];this.sCityCode=0;this.sCityName="";this.reIndex=[];this.isGRequest=false;this.isOnlyShowMainRes=true;this.mainResNo=0;this.isShowAllRes=false;this.isShowJumpBack=false;this.placeRe=window.place.placeRe;this.placeConfig=window.place.placeConfig;Share.setSmSCode(0)}T.lang.inherits(PoiSearch,T.lang.Class,"PoiSearch");T.object.extend(PoiSearch.prototype,{render:function(C,J){var b=this;BShare.getMInfo=function(){var Y="",ac="more",ae=b.curKw,X=b.curSelIndex,W=b.json;if(W&&W.content&&b.displayCount&&b.displayCount!=0){var Z=W.content[X];if(Z){var l=Z.name||"",ab=Z.addr||"",r=Z.tel||"",ad=b.points[X];if(ad){ad=(ad.lng+" "+ad.lat)}switch(Z.poiType){case POI_TYPE_BUSLINE:ac="busline";break;case POI_TYPE_SUBLINE:ac="busline";break;case POI_TYPE_BUSSTOP:ac="single";l=BShare.fixName(l+"-公交车站");ab=ab?("途经公交："+T.array.unique(ab.split(";")).join("; ")):"";break;case POI_TYPE_SUBSTOP:ac="single";l=BShare.fixName(l+"-地铁站");ab=ab?("途经地铁："+T.array.unique(ab.split(";")).join("; ")):"";break;default:ac="single";l=BShare.fixName(l);r=r.replace(/,/g,", ");break}Y=[l,ab,r].join(" ")}else{Y=b.curKw+"的搜索结果 "}}return{text:Y,className:b._className,type:ac}};if(this.cinfo&&this.cinfo.poiall){this.isOnlyShowMainRes=false;Share.setPoiShowAll(1)}else{Share.setPoiShowAll(0)}window.clearClarify&&clearClarify();var O=this.json=J;if(!O||!O.result){return}if(J.place_info&&this.placeRe.test(J.place_info.d_data_type)){place.result=true;var L=this.guid;C=C.replace(/#screening#/,place.insertHtml(C,J,L))}if(O.result.debug&&window.mapDebugObjWxp){window.mapDebugObjWxp.init(O.debug_info)}if(this.json.result.type!=11){this.isGRequest=true}var G=O.result;this.curPage=G.page_num;this.totalCount=G.total;this.pagingCount=G.total;if(this.pagingCount>this.MAX_RESULT_COUNT){this.pagingCount=this.MAX_RESULT_COUNT}this.specialCount=G.spec_dispnum||0;this.displayCount=this.totalCount+this.specialCount;if(this.json.result.type!=11){setSearchResult("在当前图区内找到"+this.displayCount+"条结果")}else{setSearchResult("共找到"+this.displayCount+"条结果")}this.curItemPPage=G.count;this.curKw=G.return_query||G.wd;this.sugKw=G.wd2||"";this.totalPage=Math.ceil(this.pagingCount/this.itemsPerPage);var U=O.content;this.cmdNo=G.cmd_no;var q=G.requery;if(O.current_city){this.sCityCode=O.current_city.code;this.sCityName=O.current_city.name;this.ctype=O.current_city.type}else{this.sCityCode=modelConfig.cityCode;this.sCityName=modelConfig.cityName}this.centerCityCode=this.cinfo&&this.cinfo.oc||this.sCityCode;var z=J.center;var h=z&&z.poi&&z.poi[0];var x=h&&z.poi[0].geo;var F=h&&z.poi[0].uid;var Q=h&&z.poi[0].name;if(this.cinfo&&this.cinfo.searchByContextMenu){this.isnbSearch=true;this.centerPt=this.cinfo.centerPoint;this.radius=this.cinfo.radius;if(ModelMgr.mainModel.modelQuery.indexOf("tpl:PoiSearch")!=0){ModelMgr.mainModel.modelQuery="tpl:PoiSearch?"+ModelMgr.mainModel.modelQuery}}else{if(x){this.isnbSearch=!!z;this.centerPt=getPointByStr(parseGeo(z.poi[0].geo).points);this.radius=G.radius}}if(F&&Q){this.ctrPoiUid=z.poi[0].uid;this.ctrPoiName=z.poi[0].name}var B=this.sCityName;var k=this.cinfo.sg_search||0;var e=this.curKw?this.curKw:"";var K="";if(O.current_city.sup&1&&/团购/.test(this.curKw)){K=Special._getTuanHtml(O.current_city.cname||O.current_city.name)}C=C.replace(/#tuan_guide#/gi,K);if(!this.isnbSearch){C=C.replace(/#go_back_total_result#/gi,'<div class="go_back_clear"><span>共有'+this.displayCount+'条结果</span><a href="javascript:void(0)" onclick="addStat(STAT_SEARCH_RETURN_NEW);go(\'cur&wd='+encodeURIComponent(modelConfig.cityName)+"',{cinfo:{notChangeMapCenter : true}});\">返回</a></div>")}if(!k&&O.suggest_query){var I=O.suggest_query;var A=[];if(G.current_null==1&&!this.totalCount){A.push("<p>在<strong>"+B+"</strong>");A.push("范围内未找到相关地点，抱歉。</P>");A.push("<p class='sugg_q'><br />可能有以下相关结果，您是否要找：<br />")}else{A.push("<p class='sugg_q'>可能有以下相关结果，您是否要找：<br />")}for(var P=0,M=I.length;P<M;P++){A.push("<a href='javascript:void(0)' onclick='Instance(\""+this.guid+'").q("'+I[P].query+'", 2,"SUGG");return false;\'>');A.push(I[P].query);A.push("</a>");if(P<I.length-1){A.push("<br />")}}A.push("</p>");C=C.replace(/#suggest_query#/,A.join(""));addStat(STAT_SUGGEST_SHOW,{wd:e,city:B})}else{C=C.replace(/#suggest_query#/,"")}if(!k&&O.psrs&&O.psrs.SENum>0&&!O.suggest_query&&(O.result&&O.result.return_query==O.result.wd)){var v=[];if(G.current_null==1&&!this.totalCount){v.push("<p>在<strong>"+B+"</strong>");v.push("范围内未找到相关地点，抱歉。</P>");v.push("<p class='sugg_q'><br />可能有以下相关结果，您是否要找：<br />")}else{v.push("<p class='sugg_q'>可能有以下相关结果，您是否要找：<br />")}for(var P=0,M=O.psrs.SENum;P<M;P++){v.push(" <a href='javascript:void(0)' onclick='Instance(\""+this.guid+'").q("'+O.psrs.SEResult[P]+'",0,"PS");return false;\' >'+O.psrs.SEResult[P]+"</a>");if(P<O.psrs.SENum-1){v.push("<br />")}}v.push("</p>");C=C.replace(/#pinyin_suggest#/,v.join(""));addStat(STAT_PS_SHOW,{wd:e,city:B})}else{C=C.replace(/#pinyin_suggest#/,"")}if(G.jump_back&&(typeof G.sug_index=="undefined"||G.sug_index<0)){C=C.replace(/#jump_back#/,'<p class="j_bb">您是否要<a onclick="cnameSearch(\''+G.wd+"',"+this.cinfo.startCity.code+', 3);return false;" href="javascript:void(0)">在<b>'+this.cinfo.startCity.name+'</b>找名称中含有"<b>'+G.wd+'</b>"的地点？</a></p>');this.isShowJumpBack=true}else{C=C.replace(/#jump_back#/,"")}if(O.space_poi){C=C.replace(/#space_poi#/,"<p style='margin-bottom:10px'>您是否要<a href='javascript:void(0)' onclick='Instance(\""+this.guid+'")._showSpacePoi("'+O.space_poi.uid+'", "'+O.space_poi.name+"\");return false;'>在<b>全国</b>查看“<b>"+O.space_poi.name+"</b>”全段</a>")}else{C=C.replace(/#space_poi#/,"")}var D="";if(O.result.pattern_sign===1){if(!isSateMapSupportCity(O.current_city.code)){D="当前城市不支持卫星图"}else{if(!this.isShowJumpBack){D="<p style='margin-bottom:10px;'>您是否要<a onclick='Instance(\""+this.guid+'").sendSateSuggestQuery("'+O.result.return_query+'", "'+O.current_city.code+"\");return false;'  href='javascript:void(0)'>在"+O.current_city.name+'找名称中含有"'+O.result.return_query+'"的地点？</a></p>'}map.setMapType(BMAP_SATELLITE_MAP);maptypeCtrl&&maptypeCtrl.streetMapMgr(true)}}C=C.replace(/#satequery_suggest#/,D);changeMapAfterSearch(modelConfig.cityCode);if(G.total==0&&U&&U.length==0||G.total==0&&!U){this._addCenterPoint(z);if(this.json.result.op_gel==1&&this.json.result.res_l>0){window.GRControll.setGRequestFlg(1000);var E=new BMap.Point(this.json.result.res_x,this.json.result.res_y);var t=this;window.setTimeout(function(){map.centerAndZoom(E,t.json.result.res_l)},10)}else{if(!this.isGRequest){if(this.centerPt){setViewport([this.centerPt])}}}return this._processNoResult(G,C)}C=C.replace(/#no_result#/,"");var n=[];if(this.isnbSearch){var R="";if(Q){R='“<span class="r_kw">'+z.poi[0].name+"</span>”"}else{R="“<span class='r_kw'>"+this.ctrPoiName+"</span>”"}n.push("在"+R+"附近 ");n.push(' 查找“<span class="r_kw">'+this.curKw+"</span>” ");n.push('&nbsp;<a id="aChangeRange" class="arrowLink" href="javascript:void(0)">更改条件</a>');C=C.replace(/#result_title#/,'<p class="black">'+n.join("")+"</p>")}else{if(!this.isnbSearch&&q){n.push("未找到您所描述的精确信息，为您提供<b>"+q+"</b>的相关结果供参考。");C=C.replace(/#result_title#/,'<p class="black">'+n.join("")+"</p><br/>")}else{C=C.replace(/#result_title#/,"")}}if(this.cinfo&&this.cinfo.isClickNextPage){this.isOnlyShowMainRes=false}var a=[];var d=0;if(U[0]&&U[0].acc_flag&&U[0].acc_flag==1){this.isShowAllTipOn=true}else{this.isShowAllTipOn=false}var y=0;for(var P=0,M=G.count;P<M;P++){if(U[P].poiType!=POI_TYPE_BUSLINE&&U[P].poiType!=POI_TYPE_SUBLINE){d++;this.showIconIndices[P]=d}this._setColContent(U,P,a,d);if(this.cinfo&&this.cinfo.sms&&this.cinfo.sms==U[P].uid){sms.ready("",U[P].uid,U[P].poiType,this.sCityCode);Share.setSmSCode(U[P].uid)}if(this.isOnlyShowMainRes&&this.isShowAllTipOn&&U[P].acc_flag==0){}else{this.uids.push(U[P].uid);if(U[P].poiType==POI_TYPE_BUSLINE||U[P].poiType==POI_TYPE_SUBLINE){this.markers.push("");this.points.push("");y++;continue}var S=parseGeo(U[P].geo);if(S.type==1){this.markers.push(addSearchPoi(S.points,d-1,U[P].name,{uid:U[P].uid,ext_type:U[P].ext_type}));this.points.push(getPointByStr(S.points))}}}C=C.replace(/#list#/,'<table id="POI_TABLE_LST" cellspacing="0" cellpadding="0" class="result black">'+a.join("")+"</table>");C=C.replace(/#page#/,'<div id="result_page_c"></div>');if(!place.result&&U[0]&&((U[0].cla&&U[0].cla[0]&&U[0].cla[0][0]&&U[0].geo)||(U[0].poi_origin&&U[0].poi_origin==33))){var p=null;var w=U[0].geo;var s="";var g={nb_x:placeEntrance.execGeo(w).x,nb_y:placeEntrance.execGeo(w).y,uid:U[0].uid};if(U[0].poi_origin&&U[0].poi_origin==33){p=33;s=U[0].name}else{if(U[0].cla&&U[0].cla[0]&&U[0].cla[0][0]&&U[0].geo){p=U[0].cla[0][0]}}var u={13:true,14:true,18:true,20:true,33:true};if(u[p]){C=C.replace(/#place_entrance_wd#/,'<div id="place_tag">'+placeEntrance.insertHtml(p,this.sCityCode,g.nb_x,g.nb_y,g.uid,s)+"</div>")}else{C=C.replace(/#place_entrance_wd#/,"")}}else{C=C.replace(/#place_entrance_wd#/,"")}C=C.replace(/#feedback#/,'<div id="user_feedback" class="blueC">易格时空提醒你：结果有错误？请到<a id="mapComplaintCenter" target="_blank" onClick="addStat(STAT_TOUSU_LIST_NOR)"href="http://192.168.1.135/add">EGT地图投诉中心</a>反馈。</div>');this._addCenterPoint(z);var V=this.points;if(this.centerPt){V.push(this.centerPt)}if(!(this.cinfo&&this.cinfo._maplevel&&this.cinfo._centerPoint)&&!(this.json&&this.json.result&&this.json.result.sug_index>=0&&this.json.result.sug_index<=9)){if(!this.isGRequest){if(map.mapType==BMAP_TYPE_DIMENSIONAL){if(V&&V[0]!=""){var N=BMap.MapType[BMAP_TYPE_DIMENSIONAL].citys;var o=N[map.currentCity][1];var H=getPointsBounds(V);var f=getBitLevel(H);if(o.intersects(H)){if(f<=15){f=15}var m;for(var P=0;P<V.length;P++){var m=V[P];if(m.toString()=="Point"){break}}map.centerAndZoom(m,f)}else{maptypeCtrl.select(BMAP_NORMAL_MAP);setViewport(V,30);add3DTip();setTimeout(function(){var c=T.G("DEM_CustomTip1");remove3DTip(c)},3000)}}}else{if(y){setViewport(V.slice(y),30)}else{setViewport(V,30)}}}else{if(this.json.result.op_gel==1&&this.json.result.res_l>0){window.GRControll.setGRequestFlg(1000);var E=new BMap.Point(this.json.result.res_x,this.json.result.res_y);map.centerAndZoom(E,this.json.result.res_l)}}}return C},initialize:function(v){v=v||{};var k=v.from;window.POI_SEARCH_GUID=this.guid;if(this.isnbSearch==true){var f=this.ctrPoiName;if(f=="未知地点"||f=="当前位置"){f=this.curKw}switchTab(1,f)}var s=this,N=this.markers,O=this.json.content,w=STAT_PANEL_SELECT,b=STAT_MAP_SELECT;if(!!place.result){var d=T.G("tagBar"),e=T.G("priceBar");if(place.barState.price.display){place.showBar(e,"price")}else{place.hideBar(e,"price")}if(place.barState.tag.display){place.showBar(d,"tag")}else{place.hideBar(d,"tag")}}if(s.json.result.type!=11){w=STAT_GR_ITEM_CLICK;b=STAT_GR_MARKER_CLICK}var h=0;for(var K=0,H=N.length;K<H;K++){if(!window.isPrint){if(this.isShowAllRes){if(O[K].acc_flag==1){h++;continue}}}(function(){var i=K;var c=s.json.content[i].poiType;if(N[K]&&(N[K]._visible||N[K].isVisible())){N[K].addEventListener("click",function(){s.select(i,{statCode:b,ct:"mk"})});N[K].addEventListener("mouseover",function(){s._itemOver(T.G("item-td-"+i),i,c)});N[K].addEventListener("mouseout",function(){s._itemOut(T.G("item-td-"+i),i,c)})}var l=T.G("no"+(K+1-h));if(l){T.on(l,"mouseover",function(){s._itemOver(null,i,c)});T.on(l,"mouseout",function(){s._itemOut(null,i,c)});T.on(T.G("item-td-"+i),"click",function(){s.select(i,{statCode:w})})}})()}if(this.pagingCount>10){var u=this.sugKw?1:0;var p="&db="+this.json.result.db;if(this.isnbSearch){if(this.cinfo.centerPoint){var E=this.cinfo.centerPoint.lng;var D=this.cinfo.centerPoint.lat;var F=s.radius;var o=E-F;var R=D-F;var m=E+F;var Q=D+F;var A="("+o+","+R+";"+m+","+Q+")";var s=this;var t=new Page("result_page_c",function(n){var x="";if(s.isGRequest){x="&on_gel=1&src=7&gr=3";GRControll.openedMarker=null;var i=map.getBounds();var c=Math.min(i.minX,i.maxX);var r=Math.max(i.minX,i.maxX);var y=Math.min(i.minY,i.maxY);var l=Math.max(i.minY,i.maxY);x+="&b=("+c+","+y+";"+r+","+l+")&l="+map.zoomLevel;if(s.cinfo&&s.cinfo.centerPoint){x+="&nb_x="+s.cinfo.centerPoint.lng;x+="&nb_y="+s.cinfo.centerPoint.lat}GRControll.noRemoveTip1=true}go("tpl:PoiSearch?nb&c="+s.sCityCode+place.urlArr+"&wd="+encodeURIComponent(s.curKw)+"&pn="+(n-1)+p+"&wd2="+encodeURIComponent(s.sugKw)+"&sug="+u+x,{cinfo:{searchByContextMenu:true,centerPoint:s.cinfo.centerPoint,radius:F}})},{pageCount:s.totalPage,page:s.curPage+1,update:false})}else{var t=new Page("result_page_c",function(n){var x="";if(s.isGRequest){x="&on_gel=1&src=7&gr=3";GRControll.openedMarker=null;var i=map.getBounds();var c=Math.min(i.minX,i.maxX);var r=Math.max(i.minX,i.maxX);var y=Math.min(i.minY,i.maxY);var l=Math.max(i.minY,i.maxY);x+="&b=("+c+","+y+";"+r+","+l+")&l="+map.zoomLevel;GRControll.noRemoveTip1=true}go("nb&c="+s.centerCityCode+"&wd="+encodeURIComponent(s.curKw)+"&uid="+s.ctrPoiUid+"&r="+s.radius+"&pn="+(n-1)+p+place.urlArr+"&wd2="+encodeURIComponent(s.sugKw)+"&sug="+u+x)},{pageCount:s.totalPage,page:s.curPage+1,update:false})}}else{var t=new Page("result_page_c",function(y){var U="";if(s.isGRequest){U="&on_gel=1&src=7&gr=3";GRControll.openedMarker=null;var r=map.getBounds();var n=Math.min(r.minX,r.maxX);var i=Math.max(r.minX,r.maxX);var l=Math.min(r.minY,r.maxY);var c=Math.max(r.minY,r.maxY);U+="&b=("+n+","+l+";"+i+","+c+")&l="+map.zoomLevel;GRControll.noRemoveTip1=true}var x=s.cmdNo==45?"s":"con";var S="&addr=0";go(x+"&c="+s.sCityCode+place.urlArr+"&wd="+encodeURIComponent(s.curKw)+"&pn="+(y-1)+p+"&wd2="+encodeURIComponent(s.sugKw)+"&sug="+u+U+S,{cinfo:{isClickNextPage:true}})},{pageCount:s.totalPage,page:s.curPage+1,update:false});if(this.isShowAllTipOn&&this.isOnlyShowMainRes){T.G("result_page_c").style.display="none"}}}if(this.isnbSearch){if(T.G("crangeListI")){T.on(T.G("crangeListI"),"change",function(){if(s.ctrPoiUid){roundSearchByValue(s.curKw,s.ctrPoiUid,"crangeListI",s.centerCityCode,4,s.centerPt.lng,s.centerPt.lat)}else{rangeSearchByValue(s.curKw,s.centerPt.lng,s.centerPt.lat,"crangeListI",s.centerCityCode,4)}})}s._initializeChangeRange()}if(this.isGRequest&&GRControll.openedMarker){if(this.json.center&&this.json.center.poi&&this.json.center.poi[0]&&this.json.center.poi[0].uid==GRControll.openedMarker.uid){GRControll.openedMarker=null}else{var I=false;if(this.json&&this.json.content){for(var K=0,G=this.json.content.length;K<G;K++){var z=this.json.content[K];if(z&&z.uid&&z.uid==GRControll.openedMarker.uid){this.setMarkerOpenInUrl(K,-1,-1,{notMove:true,notZoom:true});I=true;break}}}if(!I){this.setMissingMarker()}}}if(this.cinfo){if(this.cinfo._maplevel&&this.cinfo._centerPoint){}else{if(this.cinfo._maplevel){map.zoomTo(this.cinfo._maplevel)}else{if(this.cinfo._centerPoint){map.setCenter(this.cinfo._centerPoint)}}}if(typeof this.cinfo._index!="undefined"&&s.json&&s.json.content){this.cinfo._index=decodeURIComponent(this.cinfo._index);var J=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[0]||this.cinfo._index;var q=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[1]||-1;var P=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[2]||-1;var a=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[3]||"";var C=true;if(a!=""){if(s.json&&s.json.content&&s.json.content[J]){if(a!=s.json.content[J].uid){C=false}}}if(C){this.reIndex=[J,q,P];this.setMarkerOpenInUrl(J,q,P)}}}if(this.json&&this.json.content&&this.json.result&&this.json.result.page_num==0&&this.json.result.sug_index>=0&&this.json.result.sug_index<=9){if(this.cinfo&&!this.cinfo._maplevel&&!this.cinfo._centerPoint){if(this.json.content[this.json.result.sug_index]){if(this.isGRequest){}map.zoomTo(BMap.MapType[map.mapType].zoomLevelMax-1);var M=parseGeo(this.json.content[this.json.result.sug_index].geo);var j=map.pointToPixel(getPointByStr(M.points));var B=map.pixelToPoint(new BMap.Pixel(j.x,j.y-60));if(this.isGRequest){}map.setCenter(B)}var s=this;setTimeout(function(){s.select(s.json.result.sug_index,{notZoom:true})},500);if(T.G("MapInfo")&&this.json.result.sug_index>0&&T.G("link"+this.json.result.sug_index+"_show_"+this.guid)){var L=T.G("item-td-"+this.json.result.sug_index);if(L){T.G("MapInfo").scrollTop=L.offsetTop}}}}else{if(T.G("MapInfo")){T.G("MapInfo").scrollTop=0}}if(this.json.space_poi&&T.G("user_feedback")){T.G("user_feedback").style.marginLeft="0"}if(this.json.result.type!=11){window.GRControll.setGRequestFlg(500);window.GRControll.setGRData(this.json,{cinfo:this.cinfo});if(this.cinfo&&this.cinfo._index&&this.cinfo._index.indexOf("uid,")>=0){var g=this.cinfo._index.split("uid,")[1];window.GRControll.sendInfoRequest(g)}window.clearMarkersInPoi=function(c){if(s&&s.clearMarkers){s.clearMarkers(c)}window.storeDataForSIV=null;window.resetOverlayForSiv=null;if(s&&s.changeRangePopup){s.changeRangePopup.close();s.changeRangePopup=null}setSearchResult("")};window.storeDataForSIV=function(){var c={};if(s.json){c.json=s.json}if(s.cinfo){c.cinfo={cinfo:s.cinfo}}return c};window.resetOverlayForSiv=function(){var c=s.json.result.type;if(c==38){if(s.json.center){s._addCenterPoint(s.json.center)}}}}s.poiSearchFor3D();if(map.mapType==BMAP_TYPE_DIMENSIONAL){window.poiSearchFor3D(false);modelConfig.enableMapMove=false;MapConfig.poiSearch.enableRoute=false;MapConfig.poiSearch.showCircle=false;GRControll.disabledGR=true;GRControll.clearCache();GRControll.clearGRMap()}if(s.json&&s.json.content){var O=s.json.content;if(O.length>0){addAdsContent(s.json,1)}if(O[0].poiType==POI_TYPE_SUBLINE||O[0].poiType==POI_TYPE_BUSLINE){s.select(0)}}setComplaintCenterURL(map,this,this.json);if(k!="showAllBtn"){this.customScrollPanel()}},customScrollPanel:function(){var a=5;if(T.browser.ie){a=3;if(T.browser.ie=="6"&&place.result===true){a=10}}this.scrollPanel=new baidu.ui.ScrollPanel({container:"route_content",overflow:"overflow-y",autoUpdate:false,margin:[5,a,0,0]});if(window.resizeBusContent){T.un(window,"onresize",window.resizeBusContent)}window.resizeBusContent=function(){var c=T.G("pctomoBottomId");if(c){var h=T.G("route_content");var b=c.parentNode;var f=getPosition(b);var j=getClientSize();var e=c.offsetHeight;if(place.result===true){e=0;c.style.display="none"}r_height=j.height-142-e-10;r_height=r_height>0?r_height:0;var g=T.G("adsImg7");if(g){if(r_height-32>0){r_height=r_height-32}}var i=T.G("adswd7");if(i){if(r_height-22>0){r_height=r_height-22}}h.style.height=(r_height)+"px";var d=Instance(window.POI_SEARCH_GUID);if(window.mapInfoScrollPanel){window.mapInfoScrollPanel.hide()}if(d.scrollPanel){d.scrollPanel.update({notToTop:true})}}};window.resizeBusContent();T.on(window,"onresize",window.resizeBusContent);this.scrollPanel&&this.scrollPanel.render("route_content")},clearMarkers:function(c){var a=GRControll.openedMarker;for(var b=0,d=this.markers.length;b<d;b++){if(this.markers[b]){map.removeOverlay(this.markers[b])}}this.markers.length=0;if(!c||c=="circle"){if(this.centerPt){map.removeOverlay(this.centerPt)}this.centerPt=null;if(this.centerPoi){map.removeOverlay(this.centerPoi)}this.centerPoi=null}if(this.circleLabel){map.removeOverlay(this.circleLabel)}this.circleLabel=null;if(this.circleMarker){map.removeOverlay(this.circleMarker)}this.circleMarker=null;if(this.oval){map.removeOverlay(this.oval)}this.oval=null;this.cInfoWnd=null;for(var b=0,d=this.busPolylines.length;b<d;b++){if(this.busPolylines[b]){map.removeOverlay(this.busPolylines[b])}}this.busPolylines=[];for(var b=0,d=this.busStopPois.length;b<d;b++){if(this.busStopPois[b]){map.removeOverlay(this.busStopPois[b])}}this.busStopPois=[];if(this.unListMarker){map.removeOverlay(this.unListMarker);this.unListMarker=null}if(a){GRControll.openedMarker=a}},unload:function(){var a=GRControll.openedMarker;if(this.json.result.type!=11){window.GRControll.clearCache()}this.json=null;this.curSelA=null;this.points.length=0;this.markers.length=0;this.infoWnds.length=0;this.busStopPois.length=0;this.stationPoints.length=0;this.showIconIndices.length=0;place.result=false;window.place_dateType=null;this.centerPt=null;this.centerPoi=null;this.cInfoWnd=null;this.isShowAllBtn=0;this.busPolylines.length=0;this.normPolylines.length=0;this.normPolygons.length=0;place.urlArr=null;window.storeDataForSIV=null;window.resetOverlayForSiv=null;if(this.changeRangePopup){this.changeRangePopup.close();this.changeRangePopup=null}if(this.unListMarker){map.removeOverlay(this.unListMarker);this.unListMarker=null}if(a){GRControll.openedMarker=a}if(window.poiSearchFor3D){window.poiSearchFor3D=null}if(window.mapDebugObjWxp&&window.mapDebugObjWxp.debug_info){delete window.mapDebugObjWxp.debug_info}},setMissingMarker:function(){var me=this;var ico=new BMap.Icon(A_J_MARKER_IMG,A_J_MARKER_RED_SIZE,{offset:A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:A_J_MARKER_INFOWND_OFFSET});var pt=getPoiPoint(parseGeo(GRControll.openedMarker.geo).points);var makr=new BMap.Marker(pt,{icon:ico,zIndexFixed:true,baseZIndex:2500000});map.addOverlay(makr);makr._stCode=OVERLAY_STYLE.GEN_MKR1;makr.setTitle(GRControll.openedMarker.name);me.unListMarker=makr;var pars="/?qt=inf&uid="+GRControll.openedMarker.uid+"&ie=utf-8&t="+new Date().getTime();T.Ajax.request(pars,function(res){if(!res||res.responseText==""){return}var js=eval("("+res.responseText+")");if(!js||!js.content){return}var c=js.content;var pt=getPointByStr(parseGeo(c.geo).points);if(!opts){var opts={}}opts.notMove=true;var addr=c.addr;if(c.poiType==POI_TYPE_BUSSTOP||c.poiType==POI_TYPE_SUBSTOP){addr=T.array.unique(addr.split(";")).join("; ")}var tel=c.tel;if(tel){tel=tel.replace(/,/g,", ")}var cate=me._getCateInfo(c.cla);var infoWnd=createSearchInfoWnd({title:c.name,addr:addr,tel:tel,uid:c.uid,detail:c.detail,ext_type:c.ext_type,cate:cate,poiType:c.poiType,hasDetail:(c.detail&&c.ty==GEO_TYPE_POINT||c.poiType==POI_TYPE_BUSLINE||c.poiType==POI_TYPE_SUBLINE),ext:c.ext,houseDetailUrl:myext._getHouseDetailUrl(c),cp:c.cp,cla:cate},{cityCode:me.sCityCode,x:pt.lng,y:pt.lat});if(!infoWnd){return}infoWnd.addEventListener("open",function(){GRControll.setGRequestFlg(1500);if(map.infoWindow.closeButton){T.on(map.infoWindow.closeButton,"click",function(){if(me.unListMarker){var ico1=new BMap.Icon(A_J_MARKER_IMG,A_J_MARKER_RED_SIZE,{offset:A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:A_J_MARKER_INFOWND_OFFSET});me.unListMarker.setIcon(ico1);me.unListMarker.setTop(true,1000100);GRControll.openedMarker=null}})}});infoWnd.addEventListener("close",function(){if(me.unListMarker){var ico1=new BMap.Icon(A_J_MARKER_IMG,A_J_MARKER_RED_SIZE,{offset:A_J_MARKER_RED_SIZE,imageOffset:new BMap.Size(0,-116),infoWindowOffset:A_J_MARKER_INFOWND_OFFSET});me.unListMarker.setIcon(ico1);me.unListMarker.setTop(true,1000100)}GRControll.openedMarker=null});if(map.temp.infoWin&&map.temp.infoWin.isOpen()==true){var tmpOpenedMarker=GRControll.openedMarker}openSearchInfoWnd(infoWnd,me.unListMarker,opts);if(tmpOpenedMarker){setTimeout(function(){GRControll.openedMarker=tmpOpenedMarker},500)}me.unListInfoW=infoWnd;me.unListOpt=opts;var ico2=new BMap.Icon(A_J_MARKER_IMG,A_J_MARKER_BLUE_SIZE,{offset:A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-156),infoWindowOffset:A_J_MARKER_INFOWND_OFFSET});me.unListMarker.setIcon(ico2);me.unListMarker.setTop(true,1000100);GRControll.mdMarker1&&GRControll.mdMarker1.hide();GRControll.mdMarker2&&GRControll.mdMarker2.hide()});makr.addEventListener("mouseover",function(){var ico=new BMap.Icon(A_J_MARKER_IMG,A_J_MARKER_BLUE_SIZE,{offset:A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-156),infoWindowOffset:A_J_MARKER_INFOWND_OFFSET});makr.setIcon(ico);makr.setTop(true,1000100)});makr.addEventListener("mouseout",function(){if(map.temp.infoWin&&map.temp.infoWin.isOpen()==true&&map.temp.infoWin.overlay===this){return}var ico=new BMap.Icon(A_J_MARKER_IMG,A_J_MARKER_RED_SIZE,{offset:A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:A_J_MARKER_INFOWND_OFFSET});makr.setIcon(ico);makr.setTop(false)});makr.addEventListener("click",function(){if(!me.unListInfoW||!me.unListMarker||!me.unListOpt){return}openSearchInfoWnd(me.unListInfoW,me.unListMarker,me.unListOpt)})},setMarkerOpenInUrl:function(f,g,b,d){var e=this;if(f!=-1&&f!="c"){var c=e.json.content[f]&&e.json.content[f].poiType||-1;if((c==POI_TYPE_BUSLINE||c==POI_TYPE_SUBLINE)&&b!=-1){e._processUrlReappear(c)}else{var a=true;var h=true;if(d&&d.notMove){a=true}else{if(!e.cinfo._centerPoint){a=false}}if(d&&d.notZoom){h=true}else{if(!e.cinfo._maplevel){h=false}}e.select(f,{notMove:a,notZoom:h,forReAppear:true})}}if(f=="c"&&e.cInfoWnd&&e.centerPoi){e._setTop(e.centerPoi,true);openSearchInfoWndPOI(e.cInfoWnd,e.centerPoi);this.curSelIndex="c"}if(c==POI_TYPE_BUSSTOP||c==POI_TYPE_SUBSTOP){setTimeout(function(){e._processUrlReappear(c)},300)}},_initializeChangeRange:function(){var a=this;var b=T.G("aChangeRange");T.on(b,"click",function(g){g=g||window.event;if(!a.changeRangePopup){a.changeRangePopup=new Popup({title:"周边搜索",content:a._generateMorePopupHtml(a.ctrPoiName),width:253,addDom:"wrapper",close:function(){a.changeRangePopup=null}});a.changeRangePopup.addConnectDom(b);a.changeRangePopup.render();var f=a.changeRangePopup.getDom().style;f.left="38px";f.top="33px";a.changeRangePopup.content.style.paddingLeft="6px";a.changeRangePopup.content.style.paddingBottom="8px";if(T.G("crangeKw")){T.G("crangeKw").focus();T.G("crangeKw").value=a.json&&a.json.result&&a.json.result.wd}var j=T.G("crangeBtn");T.on(j.form,"submit",function(i){if(T.G("crangeKw").value==""){T.G("crangeKw").focus()}else{if(a.ctrPoiUid){roundSearchByInput("crangeKw",a.ctrPoiUid,"crangeList",a.centerCityCode,3,a.centerPt.lng,a.centerPt.lat)}else{rangeSearchByInput("crangeKw",a.centerPt.lng,a.centerPt.lat,"crangeList",a.centerCityCode,3)}a.changeRangePopup&&a.changeRangePopup.close()}i.returnValue=false});var h=T.G("crange_cate_list");if(h){aa=h.getElementsByTagName("a");for(var d=0,c=aa.length;d<c;d++){if(a.ctrPoiUid){(function(){var e=aa[d];T.on(e,"click",function(){roundSearchByLink(e,a.ctrPoiUid,"crangeList",a.centerCityCode,2,a.centerPt.lng,a.centerPt.lat);a.changeRangePopup&&a.changeRangePopup.close()})})()}else{(function(){var e=aa[d];T.on(e,"click",function(){rangeSearchByLink(e,a.centerPt.lng,a.centerPt.lat,"crangeList",a.centerCityCode,2);a.changeRangePopup&&a.changeRangePopup.close()})})()}}}}else{a.changeRangePopup&&a.changeRangePopup.close()}g.returnValue=false})},loadData:function(k){var b=decodeURIComponent(k);if(b.indexOf("nb")>=0){if(!this.cinfo){this.cinfo={}}this.cinfo.searchByContextMenu=true;this.isnbSearch=true;var c=b.split(("&"));var a=[];for(var g=0,f=c.length;g<f;g++){if(c[g].indexOf("ar=")==0){var m=c[g].substring(4);var j=parseFloat(m.split(";")[0].split(",")[0]);var e=parseFloat(m.split(";")[0].split(",")[1]);var h=parseFloat(m.split(";")[1].split(",")[0]);var d=parseFloat(m.split(";")[1].split(",")[1]);this.cinfo.centerPoint=new BMap.Point((j+h)/2,(e+d)/2);this.centerPt=this.cinfo.centerPoint}if(c[g].indexOf("nb_x=")==0){var m=c[g].substring(5);a[0]=m}if(c[g].indexOf("nb_y=")==0){var m=c[g].substring(5);a[1]=m}}if(a[0]&&a[1]){this.centerPt=this.cinfo.centerPoint=new BMap.Point(a[0],a[1])}}return k},select:function(g,a){if(!a){var a={}}var i=this.json&&this.json.content||[];var j=this;if(g==this.curSelIndex){if(a.force!=true&&!(this.points[g]&&!map.getBounds().containsPoint(this.points[g]))){if(i[g]&&i[g].poiType!=POI_TYPE_BUSSTOP&&i[g].poiType!=POI_TYPE_SUBSTOP||!i[g]){return}}if(i[g]&&(i[g].poiType==POI_TYPE_BUSSTOP||i[g].poiType==POI_TYPE_SUBSTOP)){if(map.temp.infoWin&&j.markers[g]&&map.temp.infoWin.isOpen()==true&&map.temp.infoWin.overlay===j.markers[g]&&!(j.points[g]&&!map.getBounds().containsPoint(j.points[g]))){return}}}map.closeInfoWindow();this.hideBusInfo(this.curSelIndex);this.curStopSelIndex=-1;if(T.G("line_list_"+this.curLineSelIndex)){T.rc(T.G("line_list_"+this.curLineSelIndex),"active");this.curLineSelIndex=-1}if(!a.fromSIV){searchInViewCtrl.exit()}var h=this.curSelIndex;this.curSelIndex=g;if(this.isnbSearch&&this.centerPoi&&!this.centerPoi.isVisible()){this.centerPoi=null;this.cInfoWnd=null;this._addCenterPoint(this.json.center)}this._clearBusLine();this._clearLine();this._clearArea();if(this.isnbSearch){a.notZoom=true}if(i[g]){switch(i[g].ty){case GEO_TYPE_AREA:j._showArea(i,g);break;case GEO_TYPE_LINE:if(i[g].poiType==POI_TYPE_BUSLINE||i[g].poiType==POI_TYPE_SUBLINE){this._showBusLine(i[g].uid,!a.forReAppear,a.showBLCbk,g,1)}else{this._showLine(i,g,a)}break;case GEO_TYPE_POINT:this._showInfoWindow(i,g,a);break;default:break}}if(a&&a.statCode){setTimeout(function(){addStat(a.statCode,{n:g,uid:i[g].uid,ct:a.ct})},1000)}if(h!=g){if(j.curSelA){T.rc(j.curSelA,"focus");T.rc(j.curSelA,"focus-over")}}var b=T.G("item-td-"+g);if(b){T.ac(b,"focus");T.rc(b,"focus-over");j.curSelA=b}var e=j.markers[h];if(e){this._setTop(e,false)}var f=j.markers[g];if(f&&!(a.forReAppear&&this.reIndex[1]!=-1)){var j=this;setTimeout(function(){j._setTop(f,true)},200)}this._setShareSelIndex(this.curSelIndex);if(this.json.result.type!=11&&this.markers[g]){var d=1;if(!map.temp.infoWin||!map.temp.infoWin.isOpen()){d=50}setTimeout(function(){var c=new BMap.Icon(A_J_MARKER_NEWYEAR_IMG,A_J_MARKER_NEWYEAR_BLUE_SIZE,{offset:A_J_MARKER_NEWYEAR_BLUE_OFFSET,imageOffset:new BMap.Size(-(A_J_MARKER_BLUE_ICON_WID)*g,-A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:A_J_MARKER_NEWYEAR_INFOWND_OFFSET});j.markers[g].setIcon(c)},d);GRControll.mdMarker1&&GRControll.mdMarker1.hide();GRControll.mdMarker2&&GRControll.mdMarker2.hide()}return false},setComponentList:function(a){this.select(a)},_showInfoWindow:function(i,h,a){var k=this;if(!a){var a={}}if(a.forReAppear==true&&this.reIndex[1]!=-1&&(i[h].poiType==POI_TYPE_BUSLINE||i[h].poiType==POI_TYPE_SUBLINE||i[h].poiType==POI_TYPE_BUSSTOP||i[h].poiType==POI_TYPE_SUBSTOP)){return}var m=function(){if(!map.temp.infoWin||map.temp.infoWin&&map.temp.infoWin.isOpen()==false){return}setTimeout(function(){if(a&&a.level){if(k.isGRequest){window.GRControll.setGRequestFlg(1000)}map.zoomTo(a.level)}else{if(map.zoomLevel<15){if(k.isGRequest){window.GRControll.setGRequestFlg(1000)}map.zoomTo(15)}}},50);map.removeEventListener("moveend",arguments.callee)};if(!this.isGRequest){if(this.points[h]&&!map.getBounds().containsPoint(this.points[h])){var l=map.pointToPixel(this.points[h]);l.y=l[1]=l.y-60;map.setCenter(map.pixelToPoint(l))}}if(!a.notZoom&&!this.isGRequest){map.addEventListener("moveend",m)}var j=i[h].addr;if(i[h].poiType==POI_TYPE_BUSSTOP||i[h].poiType==POI_TYPE_SUBSTOP){j=T.array.unique(j.split(";")).join("; ")}var e=i[h].tel;var f=i[h].topic||"";var d=i[h].date||"";var g=this._getCateInfo(i[h].cla);var b=null;if(i[h].ext&&i[h].ext.src_name&&k.placeRe.test(i[h].ext.src_name)){addStat(window["STAT_PLACE_"+i[h].ext.src_name.toUpperCase()+"_LIST"])}b=createSearchInfoWnd({title:i[h].name,addr:j,tel:e,uid:i[h].uid,detail:i[h].detail,ext_type:i[h].ext_type,cate:g,poiType:i[h].poiType,hasDetail:i[h]._hasDetail,topic:f,date:d,ext:i[h].ext,houseDetailUrl:myext._getHouseDetailUrl(i[h]),cp:i[h].cp,cla:i[h].cla},{cityCode:this.sCityCode,x:k.points[h].lng,y:k.points[h].lat});if(!b){return}b._aIndex=h;(function(){var n=h;var c=function(p){var o=T.G("item-td-"+p);if(o){T.rc(o,"focus");T.rc(o,"focus-over")}k.curA=null;var r=k.markers[k.curSelIndex];if(r){var q=new BMap.Icon(A_J_MARKER_NEWYEAR_IMG,A_J_MARKER_NEWYEAR_RED_SIZE,{offset:A_J_MARKER_NEWYEAR_RED_OFFSET,imageOffset:new BMap.Size(-A_J_MARKER_RED_ICON_WID*(h-k.specialCount),0),infoWindowOffset:A_J_MARKER_NEWYEAR_INFOWND_OFFSET});r.setIcon(q);r.setTop(false)}k.curSelIndex=-1;k._setShareSelIndex(-1)};b.addEventListener("close",function(){c(n);if(k.isGRequest){GRControll.openedMarker=null}b.removeEventListener("close",arguments.callee)});b.addEventListener("open",function(){if(map.infoWindow.closeButton){T.on(map.infoWindow.closeButton,"click",function(){c(n);if(k.isGRequest){GRControll.openedMarker=null}T.un(map.infoWindow.closeButton,"click",arguments.callee)})}if(k.isGRequest){GRControll.openedMarker={uid:i[h].uid,geo:i[h].geo,name:i[h].name}}b.removeEventListener("open",arguments.callee)})})();openSearchInfoWndPOI(b,k.markers[h],a)},_showLine:function(f,a,e){if(!MapConfig.poiSearch.enableRoute){this._showInfoWindow(f,a,e);return}var b=f[a].uid;var d=this;if(!e){var e={}}go("ext&uid="+b+"&l="+(BMap.MapType[map.mapType].zoomLevelMax-1)+"&c="+d.sCityCode,function(m){if(!m||m&&!m.content){return}var k=parseGeo(m.content.geo);if(k.type==2){var r=[];if(typeof k.points=="string"){d.normPolylines.push(addRoute(k.points));var s=k.points.split(";");for(var n=0,g=s.length;n<g;n++){var c=s[n].split(",");r.push(new BMap.Point(c[0],c[1]))}}else{for(var n=0,g=k.points.length;n<g;n++){if(!k.points[n]){continue}d.normPolylines.push(addRoute(k.points[n]));var u=k.points[n].split(";");for(var h=0,q=u.length;h<q;h++){r.push(new BMap.Point(parseFloat(u[h].split(",")[0]),parseFloat(u[h].split(",")[1])))}}}if(f[a]._views){if(map.zoomLevel!=f[a]._views.level&&!e.notZoom){if(!d.isGRequest){setViewport(r,10)}}else{var o=k.bound.split(";");var p=new BMap.Bounds(o[0].split(",")[0],o[0].split(",")[1],o[1].split(",")[0],o[1].split(",")[1]);if(!map.getBounds().containsBounds(p)&&!e.notZoom){if(!d.isGRequest){setViewport(r,10)}}}e.notZoom=true;d._showInfoWindow(f,a,e)}else{if(!e.notMove&&!e.notZoom){if(!d.isGRequest){f[a]._views=map.getViewport(r,{margins:[10,10,10,10]});map.setViewport(f[a]._views)}}e.notZoom=true;d._showInfoWindow(f,a,e)}}})},_clearLine:function(){for(var b=0,a=this.normPolylines.length;b<a;b++){removeRoute(this.normPolylines[b]);this.normPolylines[b]=null}this.normPolylines.length=0},_showArea:function(d,a){if(!d[a]){return}var b=this;go("ext&uid="+d[a].uid+"&c="+this.sCityCode,function(k){if(!k||k&&!k.content){return}var e=parseGeo(k.content.geo).points;var g=[];if(typeof e=="string"){b.normPolygons.push(addArea(e,AREA_TYPE_NORM));var n=e.split(";");for(var h=0,c=n.length;h<c;h++){g.push(new BMap.Point(parseFloat(n[h].split(",")[0]),parseFloat(n[h].split(",")[1])))}}else{for(var h=0,c=e.length;h<c;h++){if(!e[h]){continue}b.normPolygons.push(addArea(e[h]),AREA_TYPE_NORM);var n=e[h].split(";");for(var f=0,m=n.length;f<m;f++){g.push(new BMap.Point(parseFloat(n[f].split(",")[0]),parseFloat(n[f].split(",")[1])))}}}if(b.isGRequest){window.GRControll.setGRequestFlg(1000)}setViewport(g)})},_clearArea:function(){for(var b=0,a=this.normPolygons.length;b<a;b++){removeArea(this.normPolygons[b]);this.normPolygons[b]=null}this.normPolygons.length=0},_setColContent:function(ae,ab,g,h){this.currentNodeDisplay="";var b=this.guid;var N=ae[ab].poiType;var z=' id="item-td-'+ab+'" onmouseover="Instance(\''+b+"')._itemOver(this, "+ab+", "+N+')" onmouseout="Instance(\''+b+"')._itemOut(this, "+ab+", "+N+')"';if(this.isOnlyShowMainRes&&ae[ab].acc_flag==0&&this.json.result.type==11&&this.isShowAllTipOn){if(this.mainResNo==0){addStat(STAT_STRONG_SHOW);g.push('<tr><td id="Tr_A_ShowAll" colSpan="2"><a href="javascript:void(0)" onclick="Instance(\''+this.guid+'\').showAllRes();return false;" style="float:right" class="map_btn"><span class="map_btn_l"><span class="map_btn_r">查看全部'+this.displayCount+'条结果</span></span></a></td></tr><tr style="display:none;" '+z+">");this.isShowAllBtn=true}else{g.push('<tr style="display:none;" '+z+">")}this.mainResNo++;this.currentNodeDisplay="none"}else{g.push("<tr "+z+">")}if(ae[ab].poiType==POI_TYPE_BUSLINE){g.push('<th><div class="bl_icon"></div></th>')}else{if(ae[ab].poiType==POI_TYPE_SUBLINE){g.push('<th><div class="sl_icon"></div></th>')}else{if(this.json.result.type==11){g.push('<th><div id="no'+h+'" class="icon" onclick="Instance(\''+this.guid+"').select("+ab+', {statCode:STAT_PANEL_SELECT})" title="在图上显示该点">');g.push("</div></th>")}else{g.push('<th><div id="no'+h+'" class="icon" onclick="Instance(\''+this.guid+"').select("+ab+', {statCode:STAT_GR_ITEM_CLICK})" title="在图上显示该点">');g.push("</div></th>")}}}g.push("<td>");if(N!=POI_TYPE_NORMAL){g.push("<div>")}g.push('<div style="overflow:hidden;clear:both;*overflow:visible;">');if(isCorrect(ae[ab])){g.push('<a href="javascript:void(0)" onclick="goCorrect(1,\''+ae[ab].uid+'\');return false;" class="correct" title="纠错"><img alt="纠错" src="'+MapConfig.smFlwCon+'./template/eis_y_car/map/image/transparent.gif" /></a>')}g.push('<a tid="poiSmSBtn_'+ab+'" href="javascript:void(0)" onclick="sms.ready(this,\''+ae[ab].uid+"',"+ae[ab].poiType+","+this.sCityCode+',\'list\');return false;" class="stml" title="免费发送到手机/汽车"><img alt="免费发送到手机/汽车" src="'+MapConfig.smFlwCon+'./template/eis_y_car/map/image/transparent.gif"></a>');if(!window.isPrint){var m=[],B=ae[ab].addr,D=ae[ab].tel&&ae[ab].tel.replace(/(,|;)/ig,", ").replace("、","<br />");if(B){if(ae[ab].poiType==POI_TYPE_BUSSTOP||ae[ab].poiType==POI_TYPE_SUBSTOP){m.push("车次:"+B+"<br/>")}else{m.push("地址:"+B+"<br/>")}}if(D){m.push("电话:"+D)}m=m.join("");var X=getPointByStr(parseGeo(ae[ab].geo).points),J=X.lng+"|"+X.lat,y={point:J,uid:ae[ab].uid,cityCode:this.sCityCode,title:ae[ab].name,content:m},q=window._gl&&window._gl.checkInFav("",{from:"poi",json:y}),A="",E="加入收藏夹",H=E;if(q!=null&&q!=-1){A="poi-fav-selected";E="取消收藏";H=E}if(N!=POI_TYPE_BUSLINE&&N!=POI_TYPE_SUBLINE){g.push('<a tid="poiFavBtn_'+ab+'"  id="poifav_'+ae[ab].uid+'" href="javascript:void(0)" onclick="addStat(STAT_FAV_LIST_BTN,{\'uid\':\''+ae[ab].uid+"'});_gl.goFav({'point':'"+J+"','uid':'"+ae[ab].uid+"','cityCode':'"+this.sCityCode+"','title':'"+T.encodeHTML(ae[ab].name)+"','content':'"+T.encodeHTML(m)+'\'});return false;" class="poi-fav '+A+'" title="'+E+'"><img class="favorite" alt="'+H+'" src="'+MapConfig.smFlwCon+'./template/eis_y_car/map/image/transparent.gif"></a>')}}if(typeof(ae[ab].ext_type)!="undefined"&&!!(ae[ab].ext_type&1)){g.push("<a href=\"javascript:void(0)\" class='inr_poi' onclick='InrMgr.open(\""+ae[ab].uid+'", {wd : "'+ae[ab].name+'", code : STAT_INR_LIST_CLICK});return false;\'  title="查看室内地图"><img alt="查看室内地图" src="'+MapConfig.smFlwCon+'./template/eis_y_car/map/image/transparent.gif"></a>')}if(this.isnbSearch&&ae[ab].dis){var s="";if(ae[ab].dis<1000){s=ae[ab].dis+"米"}else{s=(ae[ab].dis/1000).toFixed(1)+"公里"}g.push('<span class="nb_dis">'+s+"</span>")}g.push('<a id="link'+ab+"_show_"+this.guid+'" href="javascript:void(0)" >');g.push(ae[ab].name);if(N==POI_TYPE_BUSSTOP){g.push("-公交车站")}else{if(N==POI_TYPE_SUBSTOP){g.push("-地铁站")}}g.push("</a>");var f=ae[ab].ext,P=f?f.src_name:"",L=this.json.place_info;if(ae[ab].detail&&ae[ab].ty==GEO_TYPE_POINT||N==POI_TYPE_BUSLINE||N==POI_TYPE_SUBLINE){if(f&&((P=="biaozhu_data"&&f.yw_type=="1")||this.placeRe.test(P))){var e="详情";if(P=="biaozhu_data"&&f.yw_type=="1"){g.push(' - <a class="detail blueA" href="javascript:void(0)" tid="poiDetail_'+ab+'" onclick="showDetail(\''+ae[ab].uid+"', "+N+", "+this.sCityCode+", 'ISHOP_INFO');return false;\">详情»</a> <img src=\""+MapConfig.smFlwCon+'image/yw.gif" style="position:relative;top:3px"/>')}else{var ac=P.toUpperCase()+"_";g.push(' - <a class="detail blueA" tid="poiDetail_'+ab+'" href="javascript:void(0)" onclick="showDetail(\''+ae[ab].uid+"', "+N+", "+this.sCityCode+", '"+P+"','Page','List');addStat(window['STAT_' +'"+ac+"' + 'PLACE_TEXT_DETAIL']);return false;\">"+e+"»</a>")}}else{g.push(' - <a class="detail blueA" tid="poiDetail_'+ab+'" href="javascript:void(0)" onclick="showDetail(\''+ae[ab].uid+"', "+ae[ab].poiType+", "+this.sCityCode+');return false;">详情»</a>')}ae[ab]._hasDetail=true}g.push("</div>");if(f&&f.detail_info&&f.detail_info.image){var ac=P.toUpperCase()+"_",U=ae[ab].ext.detail_info.image,F="http://map.baidu.com/maps/services/thumbnails?width=54&height=40&src="+encodeURIComponent(U);g.push('<div class="hotelImg"><div class="hotelImgBox"><img src="'+U+'" onclick="showDetail(\''+ae[ab].uid+"', "+N+", "+this.sCityCode+", '"+P+"','Page_Pic','List');addStat(window['STAT_'+'"+ac+"'+'PLACE_TEXT_IMG'])\"  /></div></div>")}if(!!(this.json.result.debug==1&&this.json.debug_info&&this.json.debug_info.results&&this.json.debug_info.results.length&&window.mapDebugObjWxp&&window.mapDebugObjWxp.showPoiDebug)){g.push(window.mapDebugObjWxp.showPoiDebug(this.json.debug_info.results,ab))}if(ae[ab].addr){if(N==POI_TYPE_BUSSTOP||N==POI_TYPE_SUBSTOP){var M="途经公交车";var K="公交";if(N==POI_TYPE_SUBSTOP){M="途经地铁";K="地铁"}var I=formatBlinfo(ae[ab].blinfo);for(var Y=0,o=[],S,t={},V=I.length;Y<V;Y++){var S=ae[ab].blinfo[Y].addr;if(!t[S]){o.push((Y!=0?", ":"")+"<a href='javascript:void(0)' id='line_list_"+ab+"_"+Y+"' onclick='addStat(STAT_POI_SELSUB);");o.push('return Instance("'+this.guid+'").selectBusLine("'+I[Y].index+'", "'+I[Y].uid+'", '+ab+",event)'>"+I[Y].addr+"</a>");t[S]=true}}g.push('<p><span class="poi_bustrans">'+M+"：</span>"+o.join("")+"</p>");if(!window.isPrint){g.push("<div class='remk' id=\"remk_"+ab+'">可点击车次查看路线详情</div>')}g.push("</div>");this.curLines=ae[ab].blinfo}else{g.push('<p class="n_p_lineheight">地址：'+ae[ab].addr+"</p>");if(ae[ab].tel){g.push('<p tid="itemTel_'+ab+'" class="n_p_lineheight">电话：'+ae[ab].tel.replace(/,/g,", "))}g.push("</p>")}}else{if(ae[ab].tel){g.push('<p tid="itemTel_'+ab+'" class="n_p_lineheight">电话：'+ae[ab].tel.replace(/,/g,", ")+"</p>")}}if(f&&L&&this.placeRe.test(f.src_name)&&(f.src_name==L.d_data_type||L.d_data_type=="")&&f.detail_info){var W=f.detail_info,O,Q,ac=P.toUpperCase()+"_";if(W.overall_rating||(W.comment_num&&W.comment_num!="0")){g.push('<p class="hotel_res">');if(W.overall_rating){O=Math.round((W.overall_rating*1)*(64/5));O=isNaN(O)?0:O;if(O>0){g.push('<span tid="score_'+ab+'" class="score"><b style="width:'+O+'px">评分</b></span>')}}if(W.comment_num&&f.src_name!="hospital"){Q=isNaN(W.comment_num)?0:W.comment_num;if(Q>0){g.push('<span class="review_num"><a tid="poiComment_'+ab+'" class="review" href="javascript:void(0)" onclick="showDetail(\''+ae[ab].uid+"', "+N+", "+this.sCityCode+", '"+P+"','Page_Comm','List');addStat(window['STAT_'+'"+ac+"'+'PLACE_TEXT_COMMENT']);return false;\">"+Q+"篇评论</a></span>")}}g.push("</p>")}if(W.price||(L&&(L.d_sort_type=="health_score"&&W.hygiene_rating)||(L.d_sort_type=="taste_rating"&&W.taste_rating)||(L.d_sort_type=="service_rating"&&W.service_rating))){g.push('<p class="n_p_lineheight">');var G=this.placeConfig.basicInfoCN[ae[ab].ext.src_name];if(W.price){var C=parseFloat(W.price),k=G.price,u=G.priceUnit;if(!isNaN(C)&&C>0&&k&&u){g.push('<span tid="itemPrice_'+ab+'">'+k+"："+C+u+"&nbsp;&nbsp;</span>")}}if(L&&L.d_sort_type=="health_score"&&W.hygiene_rating){g.push('<span tid="hygiene_rating" class="hygiene_rating">'+G.hygiene_rating+"："+W.hygiene_rating+"</span>")}if(L&&L.d_sort_type=="service_rating"&&W.service_rating){g.push('<span tid="hygiene_rating" class="hygiene_rating">'+G.service_rating+"："+W.service_rating+"</span>")}if(L&&L.d_sort_type=="taste_rating"&&W.taste_rating){g.push('<span tid="hygiene_rating" class="hygiene_rating">'+G.taste_rating+"："+W.taste_rating+"</span>")}g.push("</p>")}if(this.placeRe.test(P)&&W.tag&&!W.other_movie_num){var ad=W.tag.replace(new RegExp(",","gm")," ");g.push('<p tid="itemTag_'+ab+'" class="map_tagBox">标签：'+ad+"");g.push("</p>")}if(W.premium&&Object.prototype.toString.call(W.premium)=="[object Array]"){var p=W.premium[0];discount_title=p.discount_title;if(discount_title.length>15){discount_title=discount_title.substr(0,15)+"..."}g.push(['<p class="place-preferential">',"<a onclick=\"showDetail('"+ae[ab].uid+"', "+N+", "+this.sCityCode+", '"+P+"','page_discount','List');addStat('"+STAT_PLACE_LINK_LIST_PREMIUM+"',{'uid':'"+ae[ab].uid+"',ct:'list'})\" href=\"javascript:void(0)\">","<em></em><strong>"+discount_title+"</strong>","</a></p>"].join(""))}if(W.groupon&&Object.prototype.toString.call(W.groupon)=="[object Array]"){g.push(['<p class="place-preferential groupon">',"<a onclick=\"showDetail('"+ae[ab].uid+"', "+N+", "+this.sCityCode+", '"+P+"','groupon','List');return false\" href=\"javascript:void(0)\">","<em></em><strong>"+W.groupon.length+"条团购信息</strong>","</a></p>"].join(""))}if(W.other_movie_num){g.push(['<p class="link"><span>今日上映&nbsp;'+W.other_movie_num+"部电影，</span>","<a onclick=\"showDetail('"+ae[ab].uid+"', "+N+", "+this.sCityCode+", '"+P+"','other_movie','List');return false\" href=\"javascript:void(0)\">","查看放映表&gt;&gt;","</a></p>"].join(""))}}if(!this.placeRe.test(P)){if(ae[ab].show_tag!=""&&ae[ab].show_tag&&ae[ab].show_tag.length>0&&ae[ab].tag_num!="0"){g.push('<p tid="itemTag_'+ab+'" class="map_tagBox">标签：');for(Y=0;Y<ae[ab].show_tag.length;Y++){g.push('<span class="map_tagList">'+ae[ab].show_tag[Y]+"</span>")}g.push("</p>")}}if(ae[ab].ext&&ae[ab].ext.src_name=="biaozhu_data"&&ae[ab].ext.yw_type!="0"){if(ae[ab].ext.detail_info&&ae[ab].ext.detail_info.length>1&&ae[ab].ext.detail_info[1].type&&ae[ab].ext.detail_info[1].type.length>1){var d=ae[ab].ext.detail_info[1].type[1].split("-");var x=false;for(var Y=0,Q=d.length;Y<Q;Y++){if(d[Y]=="餐饮"){x=true}}if(x){for(var Y=0,Q=ae[ab].ext.detail_info[1].custom.length;Y<Q;Y++){var r=ae[ab].ext.detail_info[1].custom[Y];if((r.t=="人均价"&&r.c!="")||(r.t=="菜系"&&r.c!="")){g.push("<p>"+r.t+"："+r.c+"</p>")}}}}var Z=[];var R="http://map.baidu.com/ishop/detail.html?newmap=1&s="+encodeURIComponent("inf&uid="+ae[ab].uid+"&c="+this.sCityCode+"&newmap=1");if(ae[ab].ext.youhui_info.length>0){if(ae[ab].ext.youhui_info[0].info!=""||ae[ab].ext.youhui_info[0].pics!=""){Z.push('<a href="'+R+'#speresult" target="_blank">优惠信息</a>')}}if(ae[ab].ext.pic_info.length>0){Z.push('<a href="'+R+'#picresult" target="_blank">图片</a>')}g.push(Z.join("&nbsp;&nbsp;"))}if(ae[ab].ext&&ae[ab].ext.title_link){var a=ae[ab].ext.title_link;for(var Y=0,V=a.length;Y<V;Y++){g.push('<a href="'+a[Y].link+'" target="_blank" onclick="nsClick(this.href, \''+ae[ab].ext.src_name+"')\">"+a[Y].title+"</a>");if(Y<V-1){g.push("&nbsp;&nbsp;")}}}if(typeof(ae[ab].ext_type)!="undefined"&&!!(ae[ab].ext_type&2)){var v=myext._getHouseDetailUrl(ae[ab]);g.push('<p><a href="javascript:void(0)" onclick ="addStat('+STAT_PLACE_HOUSE_WINGOTOBDLEJU+");window.open('"+v+'\');return false;" class="housedetail">查看房产地图&raquo;</a></p>')}g.push("</td>");g.push("</tr>");if(N==POI_TYPE_BUSLINE||N==POI_TYPE_SUBLINE){g.push('<tr style="display:'+this.currentNodeDisplay+'"><td colspan="2"><div style="padding-left:30px"><div class="poi_bus_show" id="bus_info_link_'+ab+'" ><a class="btn_bus_show" href="javascript:void(0)" onclick="addStat(STAT_POI_UNFOLD);return Instance(\''+this.guid+"').showBusInfo("+ab+')">途经车站</a></div>');g.push('<div class="poi_bus_list" id="bus_info_'+ab+'" style="display:none"></div></td></tr>');g.push("</div>")}if(ae[ab].addr){if(N==POI_TYPE_BUSSTOP||N==POI_TYPE_SUBSTOP){g.push('<tr><td colspan="2" style="padding:0"><div class="lfsPanel" id="LFS_'+ab+'"></div></td></tr>')}}if(this.isShowAllBtn==1){g.push('<tr style="height:5px;display:none"><th></th><td style="font-size:0"></td></tr>')}else{g.push('<tr style="height:5px"><th></th><td style="font-size:0"></td></tr>')}},_itemOver:function(c,b,a){if(c&&this.curSelIndex!=b){T.ac(c,"focus-over")}var e=this;var d=e.markers;if(d[b]&&d[b].isVisible()){var f=new BMap.Icon(A_J_MARKER_NEWYEAR_IMG,A_J_MARKER_NEWYEAR_BLUE_SIZE,{offset:A_J_MARKER_NEWYEAR_BLUE_OFFSET,imageOffset:new BMap.Size(-(A_J_MARKER_BLUE_ICON_WID)*(b-this.specialCount),-A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:A_J_MARKER_NEWYEAR_INFOWND_OFFSET});d[b].setIcon(f);d[b].setTop(true,1000100)}},_hotelType:function(e,i,b,a,g){var f=this,h="",j={};j[place.URL_PARAM_PREFIX+"data_type"]=e;j[place.URL_PARAM_PREFIX+"sub_type"]=i;j[place.URL_PARAM_PREFIX+"price_section"]=b;j[place.URL_PARAM_PREFIX+"sort_type"]=a;j[place.URL_PARAM_PREFIX+"sort_rule"]=g;j[place.URL_PARAM_PREFIX+"discount_section"]=place.urlParam[place.URL_PARAM_PREFIX+"discount_section"];j[place.URL_PARAM_PREFIX+"groupon_section"]=place.urlParam[place.URL_PARAM_PREFIX+"groupon_section"];h=place.getUrlParamString(j);var d=i;if(i==""){i=f.curKw;d=f.curKw}if(i.indexOf("-")>-1){var c=i.split("-");d=c[c.length-1];if(d==""){d=c[c.length-2]}}if(this.isnbSearch){if(f.ctrPoiUid){roundSearchByValue(d,f.ctrPoiUid,"crangeListI",f.centerCityCode,2,f.centerPt.lng,f.centerPt.lat,null,j)}else{rangeSearchByValue(d,f.centerPt.lng,f.centerPt.lat,"crangeListI",f.centerCityCode,null,null,null,j)}}else{go("bd&c="+f.sCityCode+"&wd="+encodeURIComponent(d)+h)}},searchByFilter:function(d){var e=this,b=place.getUrlParamString(d),a=d[place.URL_PARAM_PREFIX+"sub_type"],c=a;if(a==""){a=e.curKw;c=e.curKw}if(a.indexOf("-")>-1){var f=a.split("-");c=f[f.length-1];if(c==""){c=f[f.length-2]}}if(this.isnbSearch){if(e.ctrPoiUid){roundSearchByValue(c,e.ctrPoiUid,"crangeListI",e.centerCityCode,2,e.centerPt.lng,e.centerPt.lat,null,d)}else{rangeSearchByValue(c,e.centerPt.lng,e.centerPt.lat,"crangeListI",e.centerCityCode,null,null,null,d)}}else{go("bd&c="+e.sCityCode+"&wd="+encodeURIComponent(c)+b)}},_itemOut:function(c,b,a){if(c&&this.curSelIndex!=b){T.rc(c,"focus-over")}var e=this.markers;if(!e[b]||!e[b].isVisible()){return}if(b==this.curSelIndex){e[b].setTop(true);return}var d=this;var f=new BMap.Icon(A_J_MARKER_NEWYEAR_IMG,A_J_MARKER_NEWYEAR_RED_SIZE,{offset:A_J_MARKER_NEWYEAR_RED_OFFSET,imageOffset:new BMap.Size(-A_J_MARKER_RED_ICON_WID*(b-this.specialCount),0),infoWindowOffset:A_J_MARKER_NEWYEAR_INFOWND_OFFSET});e[b].setIcon(f);e[b].setTop(false)},_disStaLin:function(d,b,f,c,e){if(e){stopBubble(e)}var g=T.G("LFS_"+d),a=T.G("remk_"+d);a.style.display=f?"none":"block";g.style.display=f?"block":"none";g.innerHTML=c?c:"";this.scrollPanel&&this.scrollPanel.update({notToTop:true})},_getCateInfo:function(d){var c=[];for(var e=0,b=d.length;e<b;e++){c.push(d[e][1]);if(e<b-1){c.push(", ")}}return c.join("")},_generateSingleLink:function(c,a,b){if(!b){return"<a href='javascript:void(0)'>"+c+"</a>"}else{return"<a href='javascript:void(0)' class='first'>"+c+"</a>"}},_generateMorePopupHtml:function(b){var e=[];e.push("<div>");e.push("<div class='change_rs_title'>在<span class='important'>"+b+"</span>查找：</div>");e.push("<div id='crange_cate_list' class='iw_cate_list' style='float:none;margin-top:10px;'>");var d=["ATM","银行","宾馆","餐馆","公交站","超市","加油站"];var f="crangeList";for(var c=0,a=d.length;c<a;c++){if(c==0){e.push("<a href='javascript:void(0)' class='first'>"+d[c]+"</a>")}else{e.push("<a href='javascript:void(0)'>"+d[c]+"</a>")}}e.push("</div>");e.push("<div class='mt10'>");e.push("<form><span>其他：</span><input id='crangeKw' style='vertical-align:middle;width:140px;padding:0;height:24px;line-height:24px;' type='text' size='20' maxLength='100' autocomplete='off' /> <input id='crangeBtn' class='iw_bt' type='submit' value='搜索' onmouseup='this.className=&quot;iw_bt_over&quot;' onmousedown='this.className=&quot;iw_bt_down&quot;' onmouseout='this.className=&quot;iw_bt&quot;' onmouseover='this.className=&quot;iw_bt_over&quot;'/>");e.push("</form>");e.push("</div></div>");return e.join("")},showBusList:function(b){b.parentNode.style.display="none";b.parentNode.nextSibling.style.display="block";return false},hideBusList:function(b){b.parentNode.style.display="none";b.parentNode.previousSibling.style.display="block";return false},_showBusLine:function(uid,showAll,callback,i,tp){var me=this;this._clearBusLine();this._clearLine();this._clearArea();this.curBslUid=uid;if(this.bslReq){this.bslReq.abort();this.bslReq=null}this.bslReq=getXhr();this.bslReq.onreadystatechange=function(){if(me.bslReq.readyState==4&&me.bslReq.status==200){var data;try{eval("data="+me.bslReq.responseText)}catch(e){return}if(!data||data&&!data.content){return}var c=data.content[0];if(c.uid!=me.curBslUid){return}me._drawBusLine(c,showAll,i,tp);if(callback&&typeof callback=="function"){callback(data)}}};var tps="";if(tp){tps="&bsltp=1"}this.bslReq.open("get","/?qt=bsl"+tps+"&newmap=1&uid="+uid+"&c="+me.sCityCode+"&t="+new Date().getTime());this.bslReq.send(null)},_drawBusLine:function(h,d,f,m){var k=this;var b=parseGeo(h.geo);if(b&&b.type==2){k.busPolylines.push(addRoute(b.points,ROUTE_TYPE_BUS))}if(!h||h&&!h.stations){return}var g=k.curStops=h.stations;k.stationPoints=[];k.busStopPois=[];k.stationTips=[];for(var e=0,a=g.length;e<a;e++){(function(){var c=e;var i=parseGeo(g[c].geo);if(i.type==1){var j=addBusStopPoi(i.points,g[c].name);k.busStopPois.push(j);j.addEventListener("click",function(){k.selectBusStop(c,h.name,f);MapHunter.record("ma",2,{i:f,j:c})});k.stationPoints.push(getPoiPoint(i.points));if(m){if(e==0||e==a-1){k.stationTips.push(createTip(h.stations[e].name,"TipC",{point:j.getPoint()}))}}else{k.stationTips.push(createTip(h.stations[e].name,"TipC",{point:j.getPoint()}))}}})()}if(d){if(k.isGRequest){window.GRControll.setGRequestFlg(1000)}setViewport(k.stationPoints,10)}},_clearBusLine:function(){if(this.busPolylines){for(var b=0,a=this.busPolylines.length;b<a;b++){removeRoute(this.busPolylines[b]);this.busPolylines[b]=null}this.busPolylines.length=0}for(var b=0;b<this.busStopPois.length;b++){if(this.busStopPois[b]){this.busStopPois[b].remove();this.busStopPois[b]=null;map.removeOverlay(this.stationTips[b])}}this.busStopPois.length=0;this.stationPoints.lengtn=0;this.curStopSelIndex=-1;this._setShareSelIndex(this.curSelIndex)},selectBusLine:function(o,g,q,h,t){if(h&&(h.target||h.srcElement)){stopBubble(h)}var x=this,y=o.indexOf("_"),k=g.indexOf("_"),s=g,a,b,l,n,f;if(y>=0){a=o.split("_");o=a[0];l=a[1]}if(k>=0){b=g.split("_");g=b[0];n=b[1];f=b[2]}if(x.isGRequest){showDetail(g,POI_TYPE_BUSLINE,modelConfig.cityCode);return}var w=this.json.content[q];var m=this.curSelIndex;map.closeInfoWindow();this.curSelIndex=q;var u=this.curLineSelIndex;this.curLineSelIndex=q+"_"+o;this._setShareSelIndex(q);var r="";searchInViewCtrl.exit();if(!this.curActiveLineIndex){var e=T.G("line_list_"+q+"_"+o);T.ac(e,"active");this.curActiveLineIndex=q+"_"+o;this.curActiveLineGuid=s}else{var v=this.curActiveLineGuid.split("_")[0];if(v!=g&&v!=n){var p=q+"_"+((f&&l<o)?l:o);var d=T.G("line_list_"+this.curActiveLineIndex),e=T.G("line_list_"+p);T.rc(d,"active");T.ac(e,"active");this.curActiveLineIndex=p;this.curActiveLineGuid=s}}this._showBusLine(g,false,function(i){var j=[];r=i.content[0].name,lineData=i.content[0];if(m!=q){if(x.curSelA){T.rc(x.curSelA,"focus");T.rc(x.curSelA,"focus-over")}}j.push("<span title='关闭' class='c' onclick='addStat(STAT_STLINE_CLOSE);Instance(\""+x.guid+'")._disStaLin('+q+","+o+",false,false,event)'>&times;</span><dl class='lfs'><dt>"+lineData.name);if(k>=0){j.push(" <a href='javascript:void(0)' tid='routeReturn' onclick='return Instance(\""+x.guid+'").selectBusLine("'+l+"_"+o+'", "'+n+"_"+g+'_1", '+q+", event)'>返程</a>")}j.push('</dt><dd><table cellspacing="1" cellpadding="0" width="100%">');if(lineData.startTime&&lineData.endTime){j.push("<tr><th>起点站首末班时间</th><td>"+lineData.startTime+" - "+lineData.endTime+"</td></tr>")}else{if(lineData.startTime){j.push("<tr><th>起点站首班时间</th><td>"+lineData.startTime+"</td></tr>")}if(lineData.endTime){j.push("<tr><th>起点站末班时间</th><td>"+lineData.endTime+"</td></tr>")}}if(lineData.maxPrice){j.push("<tr><th>单程最高票价</th><td>"+(lineData.maxPrice/100).toFixed(2)+"元</td></tr>")}j.push("</table></dd></dl>");x._disStaLin(q,o,true,j.join(""));var c=T.G("item-td-"+q);if(c){T.ac(c,"focus");T.rc(c,"focus-over");x.curSelA=c}x._setShareSelIndex(x.curSelIndex);if(!h){if(x.isGRequest){window.GRControll.setGRequestFlg(1000)}map.setCenter(x.points[q])}if(t&&typeof t=="function"){t()}this.scrollPanel&&this.scrollPanel.update({notToTop:true})},q)},showBusInfo:function(b,d){var c=this;d=d||{};var e={force:true,showBLCbk:function(h){if(!h||h&&!h.content){return}var p=h.content[0];if(!p){return}var f=T.G("bus_info_"+b);if(!f){return}f.style.display="block";var l=T.G("bus_info_link_"+b);if(l){l.style.display="none"}var n=["<div class='bus'><table cellspacing='0' cellpadding='0' class='station'>"];var o=c.curStops=p.stations;var i=o.length;var k=c.json.content;for(var g=0;g<o.length;g++){var m=o[g];n.push("<tr id='stop_list_"+b+"_"+g+"'>");n.push("<th style='white-space:nowrap'><img src='"+MapConfig.smFlwCon+"image/blank.gif' class='list_arrow' />"+(g+1)+"</th>");n.push("<td><a href='javascript:void(0)' onclick='addStat(STAT_POI_SELSUB);return Instance(\""+c.guid+'").selectBusStop('+g+', "'+k[b].name+'", '+b+")'>"+m.name+"</a></td>");n.push("</tr>")}n.push("</table></div>");f.innerHTML='<a class="btn_bus_hide" href="javascript:void(0)" onclick="return Instance(\''+c.guid+"').hideBusInfo('"+b+"')\">点击站名查看车站位置</a>"+n.join("");this.scrollPanel&&this.scrollPanel.update({notToTop:true});if(d.sbiCbk&&typeof d.sbiCbk=="function"){d.sbiCbk()}}};for(var a in d){e[a]=d[a]}this.select(b,e)},hideBusInfo:function(c){var a=T.G("bus_info_link_"+c);if(a){a.style.display="block"}var b=T.G("bus_info_"+c);if(b){b.style.display="none"}this.scrollPanel&&this.scrollPanel.update({notToTop:true})},_processNoResult:function(a,e){var b=[];var h=this.sCityName;var d=this.json.center;var f=d&&d.poi&&d.poi[0]&&d.poi[0].name;var i=this.cinfo.sg_search||0;e=e.replace(/#list#/,"").replace(/#page#/,"").replace(/#feedback#/,"");if(!this.isnbSearch){var c="http://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(this.curKw)+"&cl=3";if(this.isGRequest){b=["<p>对不起，在<strong>当前视图区域</strong>内未找到相关地点。"]}else{if(!((this.json.suggest_query&&!!this.json.suggest_query.length)||(this.json.psrs&&!!this.json.psrs.SENum))||(this.json.suggest_query&&!!i)){b=["<p>在<strong>"+h+"</strong>"];if(this.ctype!=0){b.push("及<strong>全国</strong>范围")}b.push("内未找到相关地点，抱歉。</P>");var j=getIknowCode("想知道: "+h+" "+this.curKw+" 在哪");b.push(j)}}b.push("<div class='nr_suggest'>您还可以：","<ul><li>看看输入的文字是否有误</li>","<li>尝试更换输入文字：去掉过于冗长的部分，并用空格键将多个关键词分开</li>",'<li>在网页中查找“<a href="'+c+'">'+this.curKw+"</a>”</li>","<li>在EGT地图<a href='http://lbc.baidu.com/inf/mark/merchant?from=map' target='_blank'>添加该地点</a></li>","</ul></div>")}else{var g=[];g=["<p class='black'>在"];var c="";if(f){c="http://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(d.poi[0].name+" "+this.curKw)+"&cl=3";g.push("“<span class='nr_kw'>"+d.poi[0].name+"</span>”")}else{var c="http://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(this.curKw)+"&cl=3";g.push("“<span class='nr_kw'>未知地点</span>”")}g.push("附近 ");g.push("查找;“<span class='nr_kw'>"+this.curKw+"</span>” ");g.push("&nbsp<a id='aChangeRange' class='arrowLink' href='javascript:void(0)'>更改条件</a></p>","<hr size='1' class='nr_hr' />");e=e.replace(/#result_title#/,g.join(""));b.push("<p>未找到相关地点。</p>","<p>您可在上方",this.isGRequest?"":"<strong>更改距离</strong>或","<strong>更改条件</strong>再次尝试。</p>",f?getIknowCode("想知道: "+h+" "+d.poi[0].name+"附近哪有"+this.curKw):null,"<div class='nr_suggest'>您还可以：","<ul><li>看看输入的文字是否有误</li>");if(f){b.push('<li>在网页中查找“<a href="'+c+'">'+d.poi[0].name+" "+this.curKw+"</a>”</li>")}else{b.push('<li>在网页中查找“<a href="'+c+'">'+this.curKw+"</a>”</li>")}b.push("</ul></div>")}return e.replace(/#no_result#/,b.join(""))},_addCenterPoint:function(c){if(this.isnbSearch){this.centerPoi=addRangeSearchCenterPoi(this.centerPt,this.ctrPoiName,true);if(window.GRControll.isGRCircleShow){this.showCircleTool()}if(c&&c.poi&&c.poi[0]){var d=c.poi[0].addr,a=c.poi[0].tel;if(c.poi[0].poiType==POI_TYPE_BUSSTOP||c.poi[0].poiType==POI_TYPE_SUBSTOP){d=T.array.unique(d.split(";")).join("; ")}if(a){a=a.replace(/,/g,", ")}this.cInfoWnd=createSearchInfoWnd({title:this.ctrPoiName,addr:d,tel:a,uid:c.poi[0].uid,poiType:c.poi[0].poiType,ext:c.poi[0].ext,houseDetailUrl:myext._getHouseDetailUrl(c.poi[0]),cp:c.poi[0].cp,cla:c.poi[0].cla},{cityCode:this.centerCityCode,x:this.centerPt.lng,y:this.centerPt.lat})}else{if(this.cinfo&&this.cinfo.centerPoint){this.cInfoWnd=createSearchInfoWnd({title:this.ctrPoiName},{x:this.centerPt.lng,y:this.centerPt.lat,cityCode:this.centerCityCode})}}var b=this;if(this.centerPoi&&this.cInfoWnd){this.cInfoWnd.addEventListener("close",function(){b._setTop(this.overlay,false);b.curSelIndex=-1;b._setShareSelIndex(b.curSelIndex)});this.centerPoi.addEventListener("click",function(){if(b.curSelIndex=="c"){return}if(!b.oval){b.showCircleTool()}window.GRControll.isGRCircleShow=true;b.select(-1);var e=this;setTimeout(function(){b._setTop(e,true)},200);openSearchInfoWndPOI(b.cInfoWnd,b.centerPoi);b.curSelIndex="c";b._setShareSelIndex(b.curSelIndex)});this.centerPoi.addEventListener("mouseover",function(){b._setTop(this,true,true)});this.centerPoi.addEventListener("mouseout",function(){if(map.temp.infoWin&&map.temp.infoWin.isOpen()==true&&map.temp.infoWin.overlay===this){return}b._setTop(this,false)})}}},q:function(c,e,b){if(!c){return}if(!e){e=0}var a=this.curKw?this.curKw:"";var d=this.sCityName;if(b=="SUGG"){addStat(STAT_SUGGEST_CLICK,{wd:a,sg:c,city:d})}else{if(b=="PS"){addStat(STAT_PS_CLICK,{wd:a,sg:c,city:d})}}go("s&stp=0&wd="+encodeURIComponent(c)+"&c="+this.sCityCode+"&src="+e,{cinfo:{sg_search:1}})},selectBusStop:function(e,k,b,a){if(this.curStopSelIndex==b+"_"+e){if(!(this.stationPoints[e]&&!map.getBounds().containsPoint(this.stationPoints[e]))){return}}var j=this;var d=this.curStops;if(!d){return}var h=this.json.content;var g=j.busStopPois[e];map.closeInfoWindow();var f=this.curStopSelIndex;this.curStopSelIndex=b+"_"+e;this._setShareSelIndex(b);if(!d[e]){return}window.GRControll.isClearBeforeSend=false;go("inf&uid="+d[e].uid+"&c="+j.sCityCode+"&it="+STAT_INF_STOP,function(i){if(!i){return}var l=k;if(i.content&&i.content.addr){l=i.content.addr}l=T.array.unique(l.split(";")).join("; ");var c=createSearchInfoWnd({title:d[e].name,addr:l,uid:d[e].uid,poiType:i.content.poiType},{forBusLine:true,cityCode:j.sCityCode,x:j.stationPoints[e].lng,y:j.stationPoints[e].lat});c.addEventListener("close",function(){if(T.G("stop_list_"+j.curStopSelIndex)){T.rc(T.G("stop_list_"+j.curStopSelIndex),"selected")}j.curStopSelIndex=-1;j._setShareSelIndex(j.curSelIndex)});openSearchInfoWndPOI(c,g,a)});if(T.G("stop_list_"+f)){T.rc(T.G("stop_list_"+f),"selected")}if(T.G("stop_list_"+this.curStopSelIndex)){T.ac(T.G("stop_list_"+this.curStopSelIndex),"selected")}},_setTop:function(c,b,a){if(!c||!c.setTop){return}if(b&&!c._isTop){c._isTop=true;if(a){c.setTop(true,1000100)}else{c.setTop(true)}return}if(!b){delete c._isTop;c.setTop(false)}},_showSpacePoi:function(b,a){if(!b){return}go("tpl:SpacePoi?ext&uid="+b+"&l="+(BMap.MapType[map.mapType].zoomLevelMax-3)+"&c="+this.sCityCode+"&wd="+encodeURIComponent(a),{cinfo:{poiName:a}})},sendFeedback:function(){var a=this.curKw;if(this.isnbSearch&&this.json.center){a=this.ctrPoiName}window.open("/feedback.html?word="+encodeURIComponent(a))},_setShareSelIndex:function(d){var c=this.curLineSelIndex;var b=this.curStopSelIndex;if(typeof d=="undefined"){d=-1}if(typeof c=="undefined"){c=-1}else{c=this.curLineSelIndex+"";c=c.split("_")&&c.split("_")[1]||-1}if(typeof b=="undefined"){b=-1}else{b=this.curStopSelIndex+"";b=b.split("_")&&b.split("_")[1]||-1}var a="";if(this.isGRequest&&this.json.content&&this.json.content[d]){a="|"+this.json.content[d].uid}Share.listIndex=d+"|"+c+"|"+b+a},_processUrlReappear:function(d){if(d==-1||!this.cinfo._index){return}var a=this.reIndex[0];var b=this.reIndex[1];var f=this.reIndex[2];var e=this;if(d==POI_TYPE_BUSLINE||d==POI_TYPE_SUBLINE){if(f!=-1){setTimeout(function(){e.showBusInfo(a,{forReAppear:true,sbiCbk:function(){e.selectBusStop(f,"",a,{notMove:true,notZoom:true})}})},100)}else{setTimeout(function(){e.selectBusStop(f,"",e.curSelIndex,{notMove:true,notZoom:true})},100)}}else{if(d==POI_TYPE_BUSSTOP||d==POI_TYPE_SUBSTOP){var g=this.json.content;if(g[this.curSelIndex]&&g[this.curSelIndex].blinfo[b]&&g[this.curSelIndex].blinfo[b].uid){this.selectBusLine(b,g[this.curSelIndex].blinfo[b].uid,this.curSelIndex,true,function(){if(f!=-1){setTimeout(function(){e.selectBusStop(f,"",a,{notMove:true,notZoom:true})},100)}});if(T.G("btn_unfold_bsline_"+this.curSelIndex)){this.showBusList(T.G("btn_unfold_bsline_"+this.curSelIndex))}}}}},showCircleTool:function(){var g=this;if(!MapConfig.poiSearch.showCircle){return}if(!g.json){return}if(g.oval){map.removeOverlay(g.oval);map.removeOverlay(g.circleMarker);map.removeOverlay(g.circleLabel);g.oval=null;g.circleMarker=null;g.circleLabel=null}var b=null;if(g.json.center&&g.json.center.poi){b=getPointByStr(parseGeo(g.json.center.poi[0].geo).points)}else{b=g.cinfo.centerPoint}g.oval=new BMap.Circle(b,GRControll.GRCircleRadius,{strokeColor:"#a3b1cc",fillColor:"#4673cc",strokeOpacity:0.9,fillOpacity:0.2,strokeWeight:1});map.addOverlay(g.oval);var d={offset:A_J_MARKER_OFFSET,imageOffset:new BMap.Size(-200,0),infoWindowOffset:A_J_MARKER_INFOWND_OFFSET};var f=new BMap.Icon(MapConfig.smFlwCon+"image/bgs.gif",A_J_MARKER_RED_SIZE,d);var c={icon:f,baseZIndex:2500000};g.circleMarker=new BMap.Marker(b,c);map.addOverlay(g.circleMarker);var a=[];a.push("<div style='width:80px;font-size:12px;font-family:宋体;'>");a.push("<div style='float:right;height:17px;text-align:center;border-left:1px solid #ccc;width:15px;font-size:12px;cursor:pointer;background-color:#f9f9f9;' title='关闭' onclick='Instance(\""+this.guid+"\").hideBarCircleTool()'><img src='"+MapConfig.smFlwCon+"./template/eis_y_car/map/image/transparent.gif' style='*margin-top:5px;width:7px;height:7px;background:url("+MapConfig.smFlwCon+"image/tools_img.png) no-repeat -90px -183px;'/></div>");a.push("<div style='margin-right:20px;'>");a.push("<div tid='radiusToolBtn' style='float:right;width:24px;color:#295FCC;cursor:pointer;_padding-top:1px;' onclick='Instance(\""+this.guid+"\").showBarTool(this)'>修改</div>");a.push("<div id='radiusToolBar' style='margin:0 24px 0 2px;color:#000'>"+GRControll.GRCircleRadius+"m</div>");a.push("</div></div>");var e={offset:new BMap.Size(12,-33)};g.circleLabel=new BMap.Label("a",e);g.circleMarker.setLabel(g.circleLabel);g.circleLabel.setStyle({borderColor:"#999",zIndex:20020,height:"17px",lineHeight:"17px",padding:0});g.circleLabel.setContent(a.join(""));g.poiSearchFor3D()},poiSearchFor3D:function(){var a=this;window.poiSearchFor3D=function(b){if(!a.oval&&!a.circleMarker){return}if(!b){a.oval.hide();a.circleMarker.hide()}else{a.oval.show();a.circleMarker.show()}}},hideBarCircleTool:function(){if(this.oval){map.removeOverlay(this.oval);map.removeOverlay(this.circleMarker);map.removeOverlay(this.circleLabel);this.oval=null;this.circleMarker=null;this.circleLabel=null}window.GRControll.isGRCircleShow=false},showBarTool:function(f){var b=[];b.push("<div style='width:146px; padding: 8px 6px 10px 6px;'>");b.push("<div>");b.push("<div style='float:left;width:24px;font-size:12px;color:#6688CC;'>距离</div>");b.push("<div style='margin-left:26px;background:url("+MapConfig.smFlwCon+"image/circlebar.gif) no-repeat 0 0;width:108px;height:28px;overflow:hidden'>");b.push('<div style="height:28px">');b.push('<div id="bar_prev_'+this.guid+'" style="overflow:hidden;width:14px;height:9px;cursor:pointer;float:left;margin-top:5px" onclick="Instance(\''+this.guid+"').setBarBut('pre')\" ></div>");var a=this.OvalNumToPos(GRControll.GRCircleRadius);b.push('<div id="bar_'+this.guid+'" style="width:8px;height:17px;position:relative;background:url('+MapConfig.smFlwCon+"image/tools_menu.gif) no-repeat 0 -33px ;float:left;margin-top:0;cursor:pointer;left:"+a+'px;-moz-user-select:none;" onmouseover="this.style.backgroundPosition=\'-9px -33px\'" onmouseout="this.style.backgroundPosition=\'0 -33px\'"></div>');b.push('<div id="bar_next_'+this.guid+'" style="overflow:hidden;width:14px;height:9px;cursor:pointer;float:right;margin-top:5px" onclick="Instance(\''+this.guid+"').setBarBut('next')\"></div>");b.push("</div>");b.push("</div>");b.push("</div>");b.push("<div style='text-align:center;margin-top:8px'><input type='button' class='iw_bt' value='搜索' onmouseup='this.className=&quot;iw_bt_over&quot;' onmousedown='this.className=&quot;iw_bt_down&quot;' onmouseout='this.className=&quot;iw_bt&quot;' onmouseover='this.className=&quot;iw_bt_over&quot;' onclick='Instance(\""+this.guid+"\").closeBar()'></div>");b.push("</div>");var g=getPosition(f);var e=g.top+21;var d=g.left-36;if(T.browser.ie>5&&T.browser.ie<7){d+=3}var c=this;c.BarToolPop=new Popup({content:b.join(""),title:"查找范围修改",width:168,height:114,close:function(){c.BarToolPop=null}});c.BarToolPop.render();c.BarToolPop.getDom().style.left=d+"px";c.BarToolPop.getDom().style.top=e+"px";c.setBar()},closeBar:function(){this.BarToolPop.close()},setBar:function(){var e=this;var c=T.G("bar_"+this.guid);function b(){T.on(document,"onmousemove",d);T.on(document,"onmouseup",a)}function d(i){var f=i.clientX||i.x;var h=getPosition(T.G("bar_prev_"+e.guid)).left;var g=f-h-20;if(g<0){g=0}if(g>73){g=73}c.style.left=g+"px"}function a(){T.un(document,"onmousemove",d);T.un(document,"onmouseup",a);e.setRadiusNumber()}T.on(c,"onmousedown",b)},setBarBut:function(b){var a=T.G("bar_"+this.guid);var c=parseInt(a.style.left);b=="next"?c=(Math.floor(c/25)+1)*25:c=(Math.ceil(c/25)-1)*25;if(c<0){c=0}if(c>73){c=73}a.style.left=c+"px";this.setRadiusNumber()},setRadiusNumber:function(){var b=this;var a=this.OvalPosToNum();T.G("radiusToolBar").innerHTML=Math.floor(a)+"m";window.GRControll.GRCircleRadius=Math.floor(a);if(this.oval){this.oval.setRadius(Math.floor(a));setViewport([new BMap.Point(b.oval.getBounds().minX,b.oval.getBounds().minY),new BMap.Point(b.oval.getBounds().maxX,b.oval.getBounds().maxY)],-50);b.closeBar()}},OvalPosToNum:function(){var c=[500,1000,2000,5000];var a=T.G("bar_"+this.guid);var d=parseInt(a.style.left);if(d>=73){return 5000}if(d<=0){return 500}var e=Math.floor(d/25);e<0?e=0:e=e;var b=0;if(e>=3){b=c[3]}else{b=c[e];b+=((d%25)/25)*(c[e+1]-c[e])}return Math.floor(b)},OvalNumToPos:function(b){var d=[500,1000,2000,5000];if(b<500){return 0}if(b>=5000){return 73}var e=0;for(var c=0;c<d.length;c++){e=c;if(b>=d[c]&&d[c+1]&&b<d[c+1]){break}}var a=((b-d[e])/(d[e+1]-d[e]))*25;a+=(e*25);if(a<0){a=0}if(a>73){a=73}return a},showAllRes:function(){addStat(STAT_STRONG_ALL,{wd:this.curKw?this.curKw:""});this.isShowAllRes=true;var g=T.G("Tr_A_ShowAll").parentNode;g.parentNode.removeChild(g);var b=T.G("POI_TABLE_LST").getElementsByTagName("TR");for(var e=0,j=b.length;e<j;e++){if(b[e].style.display=="none"){b[e].style.display=""}}var d=0;var h=this.json.content;for(var e=0,a=this.json.result.count;e<a;e++){if(h[e].poiType!=POI_TYPE_BUSLINE&&h[e].poiType!=POI_TYPE_SUBLINE){d++;this.showIconIndices[e]=d}if(h[e].acc_flag==1){continue}this.uids.push(h[e].uid);if(h[e].poiType==POI_TYPE_BUSLINE||h[e].poiType==POI_TYPE_SUBLINE){this.markers.push("");this.points.push("");continue}var f=parseGeo(h[e].geo);if(f.type==1){this.markers.push(addSearchPoi(f.points,d-1,h[e].name,{uid:h[e].uid,ext_type:h[e].ext_type}));this.points.push(getPointByStr(f.points))}}this.initialize({from:"showAllBtn"});setViewport(this.points,30);T.G("result_page_c").style.display="";Share.setPoiShowAll(1);this.scrollPanel.update({notToTop:true})},sendSateSuggestQuery:function(a,d){map.setMapType(BMAP_NORMAL_MAP);var b=d||modelConfig.cityCode;go("con&contp=0&wd="+encodeURIComponent(a)+"&pn=0&c="+b+"&check_sate=0")}});
</script>
