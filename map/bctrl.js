function changeMap(b){b.addEventListener("beforesetmaptype",function(j){b.closeInfoWindow();var h="",g=BMAP_TYPE_DIMENSIONAL;var i=function(){var k=new MapDialog(b,h,j.mapType);k.show();setTimeout(function(){if(k){k.hide();k=null;if(map.mapType===g||(map.mapType===BMAP_NORMAL_MAP&&j.exMapType===g)){maptypeCtrl._reposition()}}},1200)};if(j.mapType===g){h=MapConfig.smFlwCon+"image/2dto3d.swf";i()}else{if(j.exMapType===g){h=MapConfig.smFlwCon+"image/3dto2d.swf";i()}}});b.addEventListener("zoomend",function(g){if(MapConfig["3d_city"][modelConfig.cityCode]&&map.getZoom()>=12){map.setCurrentCity(MapConfig["3d_city"][modelConfig.cityCode][0]);maptypeCtrl.show3DControl()}else{if(b.mapType!=BMAP_TYPE_DIMENSIONAL){map.currentCity="";map.cityCode=""}setMapCtrlWhenMoving(modelConfig.cityCode)}});b.addEventListener("maptypechange",function(i){var h=i.mapType,g=i.exMapType;addStat(STAT_CHANGE_MAPTYPE,{from:i.exMapType,to:i.mapType});if(h===BMAP_TYPE_DIMENSIONAL){d();if(ModelMgr.mainModel&&ModelMgr.mainModel._className=="PoiSearch"){if(window.poiSearchFor3D){window.poiSearchFor3D(false)}}if(window.busTranFor3D){window.busTranFor3D(false)}if(window.navTranFor3D){window.navTranFor3D(false)}if(window.navWalkFor3D){window.navWalkFor3D(false)}}else{if(g===BMAP_TYPE_DIMENSIONAL){a();if(ModelMgr.mainModel&&ModelMgr.mainModel._className=="PoiSearch"){GRControll.setGRData(ModelMgr.mainModel.json);if(window.poiSearchFor3D){window.poiSearchFor3D(true)}}if(window.busTranFor3D){window.busTranFor3D(true)}if(window.navTranFor3D){window.navTranFor3D(true)}if(window.navWalkFor3D){window.navWalkFor3D(true)}}}addDataCopyright();if(h===BMAP_SATELLITE_MAP){copyCtrl&&copyCtrl.addSateMapStyle();scaleCtrl&&scaleCtrl.addSateMapStyle()}else{if(g===BMAP_SATELLITE_MAP){copyCtrl&&copyCtrl.removeSateMapStyle();scaleCtrl&&scaleCtrl.removeSateMapStyle()}}});b.addEventListener("changehybirdmapmode",function(g){if(!g.isHybirdMapShow){addStat(STAT_CANCEL_HYBIRD)}});b.addEventListener("dragend",function(g){addStat(STAT_DRAG_MAP,{tn:map.mapType})});var f=T.g("measure");var c=T.g("capture");function d(){addStat(STAT_3D_SWITCH);if(c){c.style.display="none"}if(trafficCtrl&&trafficCtrl.opened){trafficCtrl.isShowed=true}else{trafficCtrl.isShowed=false}trafficCtrl&&trafficCtrl.hide();trafficCtrl&&trafficCtrl.close();if(searchInViewCtrl.sivPop){searchInViewCtrl.sivPop.hide()}searchInViewCtrl.hide();if(!overviewCtrl.isOpen()){overviewCtrl.changeView()}GRControll.disabledGR=true;GRControll.clearCache();GRControll.clearGRMap();modelConfig.enableMapMove=false;MapConfig.poiSearch.enableRoute=false;MapConfig.poiSearch.showCircle=false;var g=T.g("GR_CustomTip1");if(g){g.parentNode.removeChild(g)}}function a(){if(c){c.style.display=""}if(trafficCtrl.isShowed){trafficCtrl.open()}setTrafficBut();searchInViewCtrl.show();if(searchInViewCtrl.sivPop){searchInViewCtrl.sivPop.show()}if(overviewCtrl.isOpen()){overviewCtrl.changeView()}modelConfig.enableMapMove=true;MapConfig.poiSearch.enableRoute=true;MapConfig.poiSearch.showCircle=true;window.GRControll.disabledGR=false}if(b.mapType==BMAP_TYPE_DIMENSIONAL){d()}}function MapDialog(d,a,c){this.container=d.getContainer();this.showStatus=0;var b=this;this.map=d;this.mapType=c;d.addEventListener("resize",function(){b.resize()});this.swfurl=a;this.init()}MapDialog.prototype.init=function(){var b=document.createElement("Div");b.id="wwf_msg";b.style.display="none";b.style.width="700px";b.style.height="400px";b.style.zIndex="120000";b.style.position="absolute";baidu.swf.create({id:"flash",url:this.swfurl,width:700,height:400,wmode:"transparent"},b);this.msg=b;this.container.appendChild(b);var a=document.createElement("div");a.id="wwf_mask";a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.display="none";a.style.zIndex="10090";a.style.backgroundColor="#000000";a.style.opacity=0.4;a.style.filter="alpha(opacity=40)";a.style.width=this.container.clientWidth+"px";a.style.height=this.container.clientHeight+"px";this.mask=a;this.container.appendChild(a)};MapDialog.prototype.show=function(){this.msg.style.top=this.container.clientHeight/2-parseInt(this.msg.style.height)/2+"px";this.msg.style.left=this.container.clientWidth/2-parseInt(this.msg.style.width)/2+"px";this.mask.style.display="block";this.msg.style.display="block";this.showStatus=1};MapDialog.prototype.hide=function(){var a=this;a.map.setMapType(a.mapType);if(this.showStatus){this._zTimeLine=new BMap.Animation({fps:50,duration:500,transition:BMap.Transitions.linear,render:function(c){c=1-c;var b=30*c+10;a.mask.style.opacity=0.3*c+0.1;a.mask.style.filter="alpha(opacity="+b+")"},finish:function(){a.mask.style.display="none";a.msg.style.display="none";a.showStatus=0;a.container.removeChild(a.msg)}})}};MapDialog.prototype.resize=function(){if(this.showStatus){this.msg.style.top=this.container.clientHeight/2-parseInt(this.msg.style.height)/2+"px";this.msg.style.left=this.container.clientWidth/2-parseInt(this.msg.style.width)/2+"px";this.mask.style.width=this.container.clientWidth+"px";this.mask.style.height=this.container.clientHeight+"px"}};var FullScreenControl=function(){this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new BMap.Size(10,10)};FullScreenControl.prototype=new BMap.Control();FullScreenControl.prototype.initialize=function(d){d.fullScreenMode=false;this.elem2BHidden=[T.G("searchWrapper"),T.G("MapInfo"),T.G("shad")];this._map=d;var b=d.getContainer();var f=this._container=document.createElement("div");b.appendChild(f);var a=this;f.id="fullSc_"+this.guid;f.title="进入全屏状态";f.className="map_ctrl";f.style.width="50px";f.style.height="22px";f.style.backgroundPosition="0 -293px";f.style.zIndex="800";f.style.display="none";f.onmouseover=function(){};f.onmouseout=function(){};T.on(f,"mousedown",function(c){c=c||window.event;if(c.button==2){return}if(T.browser.ie&&c.button!=1){return}if(d.fullScreenMode==false){f.style.backgroundPosition="0px -315px";f.style.width="49px";f.style.height="22px"}else{f.style.backgroundPosition="-50px -315px";f.style.width="75px"}c.returnValue=false});f.onclick=function(){d.enableDoubleClickZoom(false);if(d.fullScreenMode==false){a.toFullSrc();driveCtrl&&driveCtrl.fullscreen(true)}else{a.returnFullSrc();driveCtrl&&driveCtrl.fullscreen(false)}_adjustMapButtons();setTimeout(function(){d.enableDoubleClickZoom(true)},300)};T.on(document,"keydown",function(c){c=window.event||c;if(c.keyCode==27&&d.fullScreenMode){setTimeout(function(){a.returnFullSrc()},100)}});return f};FullScreenControl.prototype.remove=function(){if(this._container&&this._container.parentNode){this._container.onclick=null;this._container.parentNode.removeChild(this._container);this._container=null}};FullScreenControl.prototype.toFullSrc=function(b){var a=this._map;var k=a.container;var h=this._container;var j=this;var f="";window.GRControll&&window.GRControll.setGRequestFlg(1000);if(T.G("form1").style.display!="none"){f=T.G("PoiSearch").value}for(var g=0,d=j.elem2BHidden.length;g<d;g++){j.elem2BHidden[g].style.display="none"}if(T.G("rnAd")){T.G("rnAd").style.display="none"}T.G("rcInfo").style.display="none";T.G("selCity").style.display="none";T.G("tool_container").style.right="0px";T.G("tools").style.paddingLeft="4px";T.G("tools_search").style.display="block";if(T.browser.firefox>=3.5){T.G("ToolPoiSearch").style.fontSize="11px"}T.G("ToolPoiSearch").value=f;if(window.poiSSG){window.poiSSG.cs()}if(window.busSSG1){window.busSSG1.cs()}if(window.busSSG2){window.busSSG2.cs()}if(window.driveSSG1){window.driveSSG1.cs()}if(window.driveSSG2){window.driveSSG2.cs()}if(T.G("GR_CustomTip1")){T.G("GR_CustomTip1").style.top="30px"}if(T.G("DEM_CustomTip1")){T.G("DEM_CustomTip1").parentNode.removeChild(T.G("DEM_CustomTip1"))}if(T.G("GR_CustomTip2")){T.G("GR_CustomTip2").parentNode.removeChild(T.G("GR_CustomTip2"))}k._mr=k.style.marginRight;k.style.marginRight="0";var m=getClientSize().height-25;k.style.height=(m>0?m:0)+"px";T.G("MapInfo").style.height=k.style.height;h.style.backgroundPosition="-50px -293px";h.style.width="74px";h.title="退出全屏状态";a.fullScreenMode=true;if(a.mapType=="B_DIMENSIONAL_MAP"){maptypeCtrl.setOffset(new BMap.Size(254,10));if(overviewCtrl.isOpen()){overviewCtrl.setAnchor({anchor:BMAP_ANCHOR_BOTTOM_RIGHT})}}_adjustMapButtons();addStat(STAT_FULL_SCREEN);if(T.G("userTagPanl")){T.G("userTagPanl").style.right=parseInt(T.G("userTagPanl").style.right)+24+"px"}if(b==null){historyUrl("isfullScreen=true");History.nowTpl=escape("isfullScreen=true")}};FullScreenControl.prototype.returnFullSrc=function(d){var j=this._map;var h=j.container;var k=this._container;var g=this;window.GRControll.setGRequestFlg(1000);for(var f=0,b=g.elem2BHidden.length;f<b;f++){g.elem2BHidden[f].style.display="block"}if(T.G("rnAd")&&T.trim(T.G("rnAd").innerHTML)!=""){T.G("rnAd").style.display="block"}T.G("rcInfo").style.display="";T.G("tools_search").style.display="none";T.G("tools").style.paddingLeft="8px";T.G("selCity").style.display="";T.G("tool_container").style.right=h._mr||"280px";if(T.G("GR_CustomTip1")){T.G("GR_CustomTip1").style.top="132px"}if(T.G("GR_CustomTip2")){T.G("GR_CustomTip2").parentNode.removeChild(T.G("GR_CustomTip2"))}h.style.marginRight=h._mr||"280px";h.style.marginTop="2px";h.style.height=(getClientSize().height-136+6)+"px";T.G("MapInfo").style.height=h.style.height;var a=0;if(overviewCtrl){a=overviewCtrl.getSize().height}if(j.mapType=="B_DIMENSIONAL_MAP"){maptypeCtrl.setOffset(new BMap.Size(230,10))}_adjustMapButtons();k.style.backgroundPosition="0 -293px";k.style.width="50px";k.style.height="22px";k.title="进入全屏状态";for(var f=0,b=j.temp.toolsElement.length;f<b;f++){j.temp.toolsElement[f].style.right=parseInt(j.temp.toolsElement[f].style.right)-24+"px"}if(T.G("userTagPanl")){T.G("userTagPanl").style.right=parseInt(T.G("userTagPanl").style.right)-24+"px"}j.fullScreenMode=false;if(ModelMgr&&ModelMgr.mainModel&&ModelMgr.mainModel.switchToSmallView){ModelMgr.mainModel.switchToSmallView()}addStat(STAT_EXIT_FULL_SCREEN);if(d==null){historyUrl("isfullScreen=false");History.nowTpl=escape("isfullScreen=false")}};var SearchInViewControl=function(){var a=this;a.initialize()};SearchInViewControl.prototype.initialize=function(a){this._map=a;this.isOpen=false;this.hasResult=false;this.curKw="";this.listeners=[];this.resultCount=10;this.reqObj=null;this.rightPos=13;this.heightType=-1;this.curSearchCPt=null;this.bind();this._container=T.g("tool_sehInView")};SearchInViewControl.prototype.bind=function(){var c=this._map;var b=this;var a=b._container=T.g("tool_sehInView");a.onclick=function(){if(b.isOpen==false){b.prepare()}else{if(b.isMoving){return}if(b.heightType==0){b.sivPop.setHeight(215);b.slideEffect({s_mt:0,e_mt:-182,s_h:215,e_h:33},function(){b.deletePop()});b.heightType=-1}else{if(b.heightType==1){b.sivPop.setHeight(65);b.slideEffect({s_mt:0,e_mt:-32,s_h:65,e_h:33},function(){b.deletePop()});b.heightType=-1}}}b.hasClickButton=true}};SearchInViewControl.prototype.resetClassName=function(){this._container._opened=false;T.rc(this._container,"span_focus")};SearchInViewControl.prototype.deletePop=function(){if(this.sivPop){this.sivPop.main.parentNode.removeChild(this.sivPop.main);this.sivPop=null;this.exit(true)}};SearchInViewControl.prototype.remove=function(){var a=document.getElementById("searchInView"+this.guid);if(a&&a.parentNode){a.onclick=null;a.parentNode.removeChild(a)}};SearchInViewControl.prototype._getRightPos=function(){if(T.G("MapInfo")&&!isNaN(parseInt(T.G("MapInfo").style.width))){var a=this.rightPos+parseInt(T.G("MapInfo").style.width);return(a>0?a:0)}else{return this.rightPos+280}};SearchInViewControl.prototype.setResult=function(a){this.hasResult=!!a.hasResult;this.curKw=a.kw;this.curSearchCPt=a.cpt};SearchInViewControl.prototype.checkNeed2Go=function(){var f=this._map;if(!this.curKw){return false}if(!this.curSearchCPt){return false}var d=f.pointToPixel(this.curSearchCPt);var c=f.pointToPixel(f.centerPoint);var b=Math.abs(d.x-c.x);var a=Math.abs(d.y-c.y);if(b>=0.3*f.width||a>=0.3*f.height){return true}return false};SearchInViewControl.prototype.rego=function(){var map=this._map;var b=map.getBounds();var bs="("+b.minX+","+b.minY+";"+b.maxX+","+b.maxY+")";if(this.curKw){var url=window.location.pathname+modelConfig.DATA_URL+"bd&c="+modelConfig.cityCode+"&format=1&ie=utf-8&pn=0&rn="+this.resultCount+"&wd="+encodeURIComponent(this.curKw)+"&ar="+bs+"&b="+bs+"&l="+map.zoomLevel;if(this.reqObj){this.reqObj.abort();this.reqObj=null}this.reqObj=getXhr();var me=this;this.reqObj.onreadystatechange=function(){if(me.reqObj.readyState==4&&me.reqObj.status==200){var json;try{eval("json="+me.reqObj.responseText)}catch(e){return}if(me.inViewHashCode&&json){var inViewComponent=Instance(me.inViewHashCode);if(inViewComponent){if(!inViewComponent.cinfo){inViewComponent.cinfo={}}inViewComponent.cinfo.rego=true;inViewComponent.cinfo.isPos=false;me.sivPop.content.innerHTML=inViewComponent.render(null,json);inViewComponent.initialize()}}}};this.reqObj.open("GET",url+"&t="+(new Date().getTime()),true);this.reqObj.send(null)}};SearchInViewControl.prototype.clear=function(){if(this.inViewHashCode&&Instance(this.inViewHashCode)){Instance(this.inViewHashCode).unload()}};SearchInViewControl.prototype.exit=function(f){if(this.isOpen==false){return}this.isOpen=false;var g=this._map;var d=this;if(f){if(d.sivPop){d.sivPop.close();d.sivPop=null}}else{d.deletePop()}if(d.hasResult){g.closeInfoWindow();window.GRControll.clearCache();window.GRControll.clearGRMap();Instance(d.inViewHashCode).clearMarkers();d.hasResult=false}if(!f){window.GRControll.hideGRTool()}if(Instance(d.inViewHashCode)){Instance(d.inViewHashCode).restorePreSearch()}if(d.listeners){for(var c=0,a=d.listeners.length;c<a;c++){var b=d.listeners[c];if(b.obj.removeEventListener){b.obj.removeEventListener(b.type,b.cbk)}}}if(!f){d.curKw=""}d.curSearchCPt=null;d.resetClassName()};SearchInViewControl.prototype.getResultCount=function(){return this.resultCount};SearchInViewControl.prototype.isInUse=function(){return !!this.curKw};SearchInViewControl.prototype.getPreModelName=function(){return this.preModel&&this.preModel._className};SearchInViewControl.prototype.getPreModel=function(){return this.preModel};SearchInViewControl.prototype.prepare=function(){var b=this._map;var a=this;trafficExit();if(ModelMgr.mainModel._className=="SearchInView"&&ModelMgr.mainModel.json.result.wd!=""&&this.curKw==""){this.curKw=ModelMgr.mainModel.json.result.wd}if(!a.hasClickButton){a.curKw=""}if(!a.sivPop){a.sivPop=new Popup({title:"在屏幕范围内搜索",content:(this.curKw==""?this.setSIVContent():this.getResultHTML(this.curKw)),width:271,addDom:"tool_container",closeButton:"<button id='sivCtrlCloseBtn' style='position:absolute;border:0;cursor:pointer;top:5px;right:4px;width:12px;height:12px; background:url("+MapConfig.smFlwCon+"image/sehInView.png) no-repeat -100px -40px;'></button>",clickClose:false,closeEffect:function(){if(a.heightType==0){a.sivPop.setHeight(215);a.slideEffect({s_mt:0,e_mt:-182,s_h:215,e_h:33},function(){a.deletePop()});a.heightType=-1}else{if(a.heightType==1){a.sivPop.setHeight(65);a.slideEffect({s_mt:0,e_mt:-32,s_h:65,e_h:33},function(){a.deletePop()});a.heightType=-1}}}});a.sivPop.render();a.sivPop.getDom()._anchor=1;a.sivPop.getDom()._offset={x:8,y:34};a.sivPop.getDom().style.right="125px";a.sivPop.getDom().style.top="29px";a.sivPop.getDom().style.zIndex=1;a.sivPop.content.style.paddingLeft="10px";a.sivPop.getDom().onclick=function(c){c=c||window.event;stopBubble(c)}}trafficCtrl.close();trafficCtrl.markers=null;if(window.NavTrans&&(ModelMgr.mainModel instanceof window.NavTrans)){driveCtrl.menu(false)}else{driveCtrl.hide(true)}a.sivPop.show();if(this.curKw==""){this.setPopupHeight(1)}else{this.setPopupHeight(2)}a.preModel=ModelMgr.mainModel;a.isOpen=true;this._container._opened=true;if(this._container.className.indexOf("span_focus")<0){T.ac(this._container,"span_focus")}};SearchInViewControl.prototype.setSIVContent=function(){var d={jiudian:["快捷酒店","星级酒店","旅馆","如家","7天"],canyin:["餐馆","快餐","肯德基","麦当劳","咖啡厅"],jiayou:["楼盘小区","公交车站","银行","医院","超市","ATM","停车场","加油站"],dianying:["KTV","电影院","网吧","酒吧","健身中心"]};var c='<div id="siv_main" class="blueC"><ul class="siv_list">';for(var b in d){var f=d[b];c+='<li class="'+b+'"><span></span>';for(var a=0;a<f.length;a++){c+='<a href="javascript:void(0)" onclick="searchInViewCtrl.search(this);return false;">'+f[a]+"</a>"}c+="</li>"}c+="</ul>";c+='<div class="siv_sec">';c+='<form onsubmit="searchInViewCtrl.search();return false">';c+='<input id="siv_kw" value="查找其他关键词" class="siv_txt" type="text" autocomplete="off" onfocus="searchInViewCtrl.kwFocus(this)" onblur="searchInViewCtrl.kwBlur(this)" />';c+='<input value="搜索" type="submit" class="siv_btn" id="sivSubmitBtn" onmouseover="searchInViewCtrl.btnOver(event,this)" onmouseout="searchInViewCtrl.btnOut(event,this)" onmouseup="searchInViewCtrl.btnOver(event,this)" onmousedown="searchInViewCtrl.btnDown(event,this)" />';c+="</form></div>";return c};SearchInViewControl.prototype.kwFocus=function(a){if(a.value=="查找其他关键词"){a.value="";T.ac(a,"siv_txt_hover")}};SearchInViewControl.prototype.kwBlur=function(a){if(a.value==""){a.value="查找其他关键词";T.rc(a,"siv_txt_hover")}};SearchInViewControl.prototype.search=function(j,d){var l="";var a="0";var k=0;if(j){addStat(STAT_EARCH_ViEW,{wd:1})}else{addStat(STAT_EARCH_ViEW,{wd:0})}if(!j){l=filtQuery(d||T.G("siv_kw").value);k=1;a="1"}else{l=j.innerHTML}if(l==""||l=="查找其他关键词"){T.G("siv_kw").focus();return}var g=map.getBounds();var i="("+g.minX+","+g.minY+";"+g.maxX+","+g.maxY+")";this.setResult({hasResult:false,kw:l,cpt:map.centerPoint});var c=map.getBounds();var h="&b=("+c.minX+","+c.minY+";"+c.maxX+","+c.maxY+")&l="+map.zoomLevel;GRControll.openedMarker=null;GRControll.hideGRTool();var f=this;this.setResultHTML(null,function(){go("bd&fstq=1&from=webmap&c="+modelConfig.cityCode+"&pn=0&rn="+f.resultCount+"&wd="+encodeURIComponent(l)+"&sivtp="+k+h+"&bdfrom="+a,{cinfo:{exitLargeMapMode:false}})});MapHunter.record("se",2,{wd:l,cc:modelConfig.cityCode})};SearchInViewControl.prototype.setResultHTML=function(a,c){if(this.sivPop.content){var b=this;this.setPopupHeight(0,function(){b.sivPop.content.innerHTML=b.getResultHTML(a);if(c){c()}})}};SearchInViewControl.prototype.getResultHTML=function(a){var b=a||this.curKw;return"<div  id='siv_main' style='margin-top:0px;' class='blueC'><p class='siv_resultext'>当前搜索： <span class='important'>"+T.string.subByte(this.curKw,12,"...")+"</span><a class='siv_result_change_link' href='javascript:void(0)' onclick='searchInViewCtrl.clearGo();return false;'>更改条件</a></p></div>"};SearchInViewControl.prototype.clearGo=function(){this.hasResult=false;var a=this.curKw;this.setResult({hasResult:false,kw:a,cpt:map.centerPoint,tp:0});if(this.sivPop.content){this.sivPop.content.innerHTML=this.setSIVContent();this.setPopupHeight(1)}};SearchInViewControl.prototype.setPopupHeight=function(b,f){var d=this._map;var a=215;var c=65;if(!this.sivPop){return}switch(b){case 0:this.sivPop.setHeight(215);this.slideEffect({s_mt:0,e_mt:-150,s_h:215,e_h:65},f);this.heightType=1;break;case 1:this.sivPop.setHeight(33);this.slideEffect({s_mt:-182,e_mt:0,s_h:33,e_h:215});this.heightType=0;break;case 2:this.sivPop.setHeight(33);this.slideEffect({s_mt:-32,e_mt:0,s_h:33,e_h:65});this.heightType=1;break}};SearchInViewControl.prototype.hidePopup=function(){if(this.sivPop){this.sivPop.hide()}};SearchInViewControl.prototype.showPopup=function(){if(this.sivPop){this.sivPop.show()}};SearchInViewControl.prototype.slideEffect=function(a,f){if(a.s_mt==a.e_mt||a.s_h==a.e_h){return}if(!T.G("siv_main")){return}else{var d=T.G("siv_main")}var b=this,c=0;a.s_mt<a.e_mt?c=15:c=-15;b.seTop=a.s_mt;b.seH=a.s_h;b.isMoving=true;b.seTime=setInterval(function(){if((a.s_mt<a.e_mt)?((b.seTop+c)>=a.e_mt):((b.seTop+c)<=a.e_mt)){d.style.marginTop=a.e_mt+"px";b.sivPop.setHeight(a.e_h);clearInterval(b.seTime);b.seTime=null;b.isMoving=false;if(f&&typeof(f)=="function"){f()}}else{b.seTop+=c;b.seH+=c;d.style.marginTop=b.seTop+"px";b.sivPop.setHeight(b.seH)}},20)};SearchInViewControl.prototype.btnOver=function(a,b){a=a||window.event;stopBubble(a);b.className="siv_btn siv_btn_over"};SearchInViewControl.prototype.btnOut=function(a,b){a=a||window.event;stopBubble(a);b.className="siv_btn"};SearchInViewControl.prototype.btnDown=function(b,c){b=b||window.event;stopBubble(b);var a=1;if(!T.browser.ie){a=0}if(b&&b.button!=a){return}c.className="siv_btn siv_btn_down"};SearchInViewControl.prototype.show=function(a,b){this._container.style.display="block";tools&&tools.resetWidth()};SearchInViewControl.prototype.hide=function(a,b){this._container.style.display="none";tools&&tools.resetWidth()};function CaptureControl(){this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new BMap.Size(10,10);this._opts={strokeWeight:1,strokeColor:"black",strokeStyle:"solid",opacity:0.05,fillColor:"#2319dc"};this.inUse=false;this.ctrlNeed2Hide=[maptypeCtrl,overviewCtrl,stdMapCtrl,copyCtrl,scaleCtrl];this.handlerCursors=["n-resize","e-resize","s-resize","w-resize","nw-resize","ne-resize","se-resize","sw-resize"];this._temp={};this._handlers=[];this._bindFuncs=[];this.capSizePx=[0,0];this.busStopMkrs=[];this.normMkrs=[];this.roundMkrs=[];this.destLbls=[];this.lbls=[];this.lines=[];this.areas=[]}CaptureControl.prototype=new BMap.Control();CaptureControl.prototype.initialize=function(b){this._map=b;var a=this;T.on(document,"keydown",function(c){c=c||window.event;if(c.keyCode==27){a.endCapture()}})};CaptureControl.prototype.beginCapture=function(){this._hideCtrls();if(window.driveCtrl&&driveCtrl.isVisible()){driveCtrl.hide(true);this.__driveCtrlFlag=true}trafficExit();captureCtrl._inUse=true;BMap.OperationMask.show(map);BMap.OperationMask.setCursor("url("+MapConfig.smFlwCon+"image/crosshair.cur), crosshair");this.tipsLabel=tl=new BMap.Label("按住鼠标左键拖选截图区域<br />点击右键或按ESC键退出");map.addOverlay(tl);tl.setStyles({padding:"2px",borderColor:"#555",color:"#555",background:"#ffffe1"});tl.setZIndex(9000000);tl.hide();var d=this;var f=function(h){if(h&&h.button==2){d.endCapture()}return preventDefault(h)};T.on(BMap.OperationMask.getDom(map),"mouseup",f);this._bindFuncs.push({element:BMap.OperationMask.getDom(map),type:"mouseup",handler:f});var c=function(i){i=i||window.event;var h=i.target||i.srcElement;if(h!==BMap.OperationMask.getDom(map)){tl.hide();return}tl.show();var j=BMap.OperationMask.getDrawPoint(i,false,{x:8,y:8});tl.setPoint(j)};T.on(document,"mousemove",c);this._bindFuncs.push({element:document,type:"mousemove",handler:c});var b=function(i){i=window.event||i;if(i.button!=0&&!T.browser.ie||T.browser.ie&&i.button!=1){return}if(BMap.OperationMask.getDom(map).setCapture){BMap.OperationMask.getDom(map).setCapture()}if(d.tipsLabel){d.tipsLabel.remove()}if(T.G("cap_size")){T.G("cap_size").parentNode.removeChild(T.G("cap_size"))}var h=T.G("cap_btn_container");if(h){h.parentNode.removeChild(h)}if(d._fDiv){d._fDiv.parentNode.removeChild(d._fDiv);d._fDiv=null}T.on(document,"mousemove",a);T.on(document,"mouseup",g);d._bindFuncs.push({element:document,type:"mousemove",handler:a});d._bindFuncs.push({element:document,type:"mouseup",handler:g});var i=window.event||i;d._temp.mx=i.layerX||i.offsetX||0;d._temp.my=i.layerY||i.offsetY||0;d._temp.mx=d._temp.mx;d._temp.my=d._temp.my;d._temp.ix=i.pageX||i.clientX||0;d._temp.iy=i.pageY||i.clientY||0;BMap.OperationMask.getDom(map).insertAdjacentHTML("beforeBegin",d._generateHTML());d._fDiv=BMap.OperationMask.getDom(d._map).previousSibling;d._fDiv.style.width="0";d._fDiv.style.height="0";d._fDiv.style.left=d._temp.mx+"px";d._fDiv.style.top=d._temp.my+"px";d._handlers.length=0;d._handlers.push(T.G("cap_h_t"));d._handlers.push(T.G("cap_h_r"));d._handlers.push(T.G("cap_h_b"));d._handlers.push(T.G("cap_h_l"));d._handlers.push(T.G("cap_h_tl"));d._handlers.push(T.G("cap_h_tr"));d._handlers.push(T.G("cap_h_br"));d._handlers.push(T.G("cap_h_bl"));stopBubble(i);return preventDefault(i)};var a=function(l){l=window.event||l;var j=l.pageX||l.clientX||0;var h=l.pageY||l.clientY||0;var k=j-d._temp.ix;var i=h-d._temp.iy;if(!d._fDiv){return}d._fDiv.style.width=Math.abs(k)+"px";d._fDiv.style.height=Math.abs(i)+"px";if(k>=0){d._fDiv.style.right="auto";d._fDiv.style.left=d._temp.mx+"px";if(d._temp.mx+k>map.width-9){d._fDiv.style.width=map.width-d._temp.mx-9+"px"}}else{d._fDiv.style.left="auto";d._fDiv.style.right=map.width-d._temp.mx-1+"px";if(d._temp.mx+k<5){d._fDiv.style.width=d._temp.mx-5+"px"}}if(i>=0){d._fDiv.style.bottom="auto";d._fDiv.style.top=d._temp.my+"px";if(d._temp.my+i>map.height-5){d._fDiv.style.height=map.height-d._temp.my-5+"px"}}else{d._fDiv.style.top="auto";d._fDiv.style.bottom=map.height-d._temp.my-1+"px";if(d._temp.my+i<9){d._fDiv.style.height=d._temp.my-9+"px"}}d._updateCapSize();d._updateHandlersPosition();stopBubble(l);return preventDefault(l)};var g=function(v){v=window.event||v;if(v.button!=0&&!T.browser.ie||T.browser.ie&&v.button!=1){return}T.un(document,"mousemove",a);T.un(document,"mouseup",g);T.un(BMap.OperationMask.getDom(map),"mousedown",b);if(BMap.OperationMask.getDom(map).releaseCapture){BMap.OperationMask.getDom(map).releaseCapture()}if(!d._fDiv){return}if(d._fDiv&&parseInt(d._fDiv.style.width)==0){d._fDiv.style.width="1px"}if(d._fDiv&&parseInt(d._fDiv.style.height)==0){d._fDiv.style.height="1px"}d._updateCapSize();d.capSizePx=[parseInt(d._fDiv.style.width),parseInt(d._fDiv.style.height)];d._unifyPos();var h=function(i){i=i||window.event;if(i.button==2){return}if(T.browser.ie&&i.button!=1){return}if(d._fDiv.setCapture){d._fDiv.setCapture()}T.on(document,"mousemove",s);T.on(document,"mouseup",j);h._initX=parseInt(d._fDiv.style.left);h._initY=parseInt(d._fDiv.style.top);if(isNaN(h._initX)){h._initX=map.width-parseInt(d._fDiv.style.right)-parseInt(d._fDiv.style.width)}if(isNaN(h._initY)){h._initY=map.height-parseInt(d._fDiv.style.bottom)-parseInt(d._fDiv.style.height)}h._x1=i.pageX||i.clientX||0;h._y1=i.pageY||i.clientY||0;i.returnValue=false};var s=function(B){B=B||window.event;var y=B.pageX||B.clientX||0;var l=B.pageY||B.clientY||0;var A=y-h._x1;var x=l-h._y1;if(!d._fDiv){return}if(h._initX+A>=4&&h._initX+A+parseInt(d._fDiv.style.width)+9<=map.width){d._fDiv.style.left=h._initX+A+"px"}else{if(h._initX+A<4){d._fDiv.style.left="3px"}else{d._fDiv.style.left=map.width-parseInt(d._fDiv.style.width)-9+"px"}}if(h._initY+x>=9&&h._initY+x+parseInt(d._fDiv.style.height)+4<=map.height){d._fDiv.style.top=h._initY+x+"px"}else{if(h._initY+x<9){d._fDiv.style.top="7px"}else{d._fDiv.style.top=map.height-parseInt(d._fDiv.style.height)-5+"px"}}var i=T.G("cap_size");i.style.left=parseInt(d._fDiv.style.left)+2+"px";i.style.top=parseInt(d._fDiv.style.top)-23+"px";if(parseInt(i.style.top)<0){i.style.top=parseInt(d._fDiv.style.top)+2+"px"}var z=T.G("cap_btn_container");z.style.left=parseInt(d._fDiv.style.left)+d.capSizePx[0]-173+"px";z.style.top=parseInt(d._fDiv.style.top)+d.capSizePx[1]+7+"px";if(map.height-parseInt(z.style.top)<30){z.style.top=parseInt(z.style.top)-39+"px";z.style.left=parseInt(z.style.left)-4+"px"}};var j=function(i){T.un(document,"mousemove",s);T.un(document,"mouseup",j);if(d._fDiv.releaseCapture){d._fDiv.releaseCapture()}};T.on(d._fDiv,"mousedown",h);d.cm=createContextMenu([{text:"&nbsp;取消",callback:function(){d.endCapture()},width:60},{text:"&nbsp;完成",callback:function(){d.showCapture()},width:60},{text:"&nbsp;另存为",callback:function(){d.saveCapture()},width:60}],d._fDiv,"move");T.on(d._fDiv,"contextmenu",function(i){i.cancelBubble=true});var m=function(x){x=x||window.event;if(x.button==2){return}if(T.browser.ie&&x.button!=1){return}var l=x.target||x.srcElement;m._t=x.srcElement;if(l.setCapture){l.setCapture()}var i=l.getAttribute("_ht");if(typeof i=="undefined"){return}d._curHT=i;T.on(document,"mousemove",u);T.on(document,"mouseup",q);d._bindFuncs.push({element:document,type:"mousemove",handler:u});d._bindFuncs.push({element:document,type:"mouseup",handler:q});BMap.OperationMask.show(map);BMap.OperationMask.setCursor(d.handlerCursors[i]);m._initX=x.pageX||x.clientX;m._initY=x.pageY||x.clientY;x.cancelBubble=true;x.returnValue=false};var u=function(A){A=A||window.event;var l=A.pageX||A.clientX;var i=A.pageY||A.clientY;var F=l-m._initX;var E=i-m._initY;var z=parseInt(d._fDiv.style.left);var y=parseInt(d._fDiv.style.right);var B=parseInt(d._fDiv.style.top);var x=parseInt(d._fDiv.style.bottom);var C=d._curHT*1;switch(C){case 0:d._moveFromTop(E,B,x);break;case 1:d._moveFromRight(F,z,y);break;case 2:d._moveFromBottom(E,B,x);break;case 3:d._moveFromLeft(F,z,y);break;case 4:d._moveFromTop(E,B,x);d._moveFromLeft(F,z,y);break;case 5:d._moveFromTop(E,B,x);d._moveFromRight(F,z,y);break;case 6:d._moveFromBottom(E,B,x);d._moveFromRight(F,z,y);break;case 7:d._moveFromBottom(E,B,x);d._moveFromLeft(F,z,y);break;default:break}d._updateCapSize();d._updateHandlersPosition();var D=T.G("cap_btn_container");if(D){D.style.display="none"}};var q=function(l){if(m._t&&m._t.releaseCapture){m._t.releaseCapture()}T.un(document,"mousemove",u);T.un(document,"mouseup",q);BMap.OperationMask.hide();if(parseInt(d._fDiv.style.width)==0){d._fDiv.style.width="1px"}if(parseInt(d._fDiv.style.height)==0){d._fDiv.style.height="1px"}d._updateCapSize();d.capSizePx=[parseInt(d._fDiv.style.width),parseInt(d._fDiv.style.height)];if(d._temp._fromLeftToRight){delete d._temp._fromLeftToRight}if(d._temp._fromBottomToTop){delete d._temp._fromBottomToTop}d._unifyPos();var i=T.G("cap_btn_container");if(i){i.style.display="block";i.style.left=parseInt(d._fDiv.style.left)+d.capSizePx[0]-173+"px";i.style.top=parseInt(d._fDiv.style.top)+d.capSizePx[1]+7+"px";if(map.height-parseInt(i.style.top)<30){i.style.top=parseInt(i.style.top)-39+"px";i.style.left=parseInt(i.style.left)-4+"px"}}};for(var r=0,p=d._handlers.length;r<p;r++){T.on(d._handlers[r],"mousedown",m)}BMap.OperationMask.hide();var w=parseInt(d._fDiv.style.top)+parseInt(d._fDiv.style.height)+7;var n=parseInt(d._fDiv.style.left)+parseInt(d._fDiv.style.width)-173;if(isNaN(w)){w=map.height-parseInt(d._fDiv.style.bottom)+5}if(isNaN(n)){n=map.width-parseInt(d._fDiv.style.right)-90}if(map.height-w<30){w=w-39;n=n-4}var k="<div id='cap_btn_container' style='top:"+w+"px;left:"+n+"px'><div class='cap_btn_conbg'><div><span id='cap_btn_cancel' ></span><span id='cap_btn_show' ></span><span id='cap_btn_save'></span></div></div></div>";BMap.OperationMask.getDom(map).insertAdjacentHTML("beforeBegin",k);T.on(T.G("cap_btn_save"),"mouseover",function(i){T.ac(T.G("cap_btn_save"),"hover")});T.on(T.G("cap_btn_cancel"),"mouseover",function(i){T.ac(T.G("cap_btn_cancel"),"hover")});T.on(T.G("cap_btn_show"),"mouseover",function(i){T.ac(T.G("cap_btn_show"),"hover")});T.on(T.G("cap_btn_save"),"mouseout",function(i){T.rc(T.G("cap_btn_save"),"hover")});T.on(T.G("cap_btn_cancel"),"mouseout",function(i){T.rc(T.G("cap_btn_cancel"),"hover")});T.on(T.G("cap_btn_show"),"mouseout",function(i){T.rc(T.G("cap_btn_show"),"hover")});T.on(T.G("cap_btn_save"),"click",function(i){d.saveCapture()});T.on(T.G("cap_btn_cancel"),"click",function(i){d.endCapture()});T.on(T.G("cap_btn_show"),"click",function(i){d.showCapture()});stopBubble(v);return preventDefault(v)};T.on(BMap.OperationMask.getDom(map),"mousedown",b);d._bindFuncs.push({element:BMap.OperationMask.getDom(map),type:"mousedown",handler:b})};CaptureControl.prototype._hideCtrls=function(){for(var b=0,a=this.ctrlNeed2Hide.length;b<a;b++){if(this.ctrlNeed2Hide[b]&&this.ctrlNeed2Hide[b].hide){this.ctrlNeed2Hide[b].hide()}}map.closeInfoWindow();window.searchInViewCtrl&&window.searchInViewCtrl.hidePopup()};CaptureControl.prototype._showCtrls=function(){for(var b=0,a=this.ctrlNeed2Hide.length;b<a;b++){if(this.ctrlNeed2Hide[b]&&this.ctrlNeed2Hide[b].show){this.ctrlNeed2Hide[b].show()}if(MapConfig["3d_city"][modelConfig.cityCode]&&map.getZoom()>=12){map.setCurrentCity(MapConfig["3d_city"][modelConfig.cityCode][0]);maptypeCtrl.show3DControl()}else{map.currentCity="";map.cityCode="";if(isSateMapSupportCity(modelConfig.cityCode)){maptypeCtrl.hide3DControl()}else{maptypeCtrl.hide()}}}window.searchInViewCtrl&&window.searchInViewCtrl.showPopup()};CaptureControl.prototype.endCapture=function(){for(var d=0,b=this._bindFuncs.length;d<b;d++){var c=this._bindFuncs[d];try{T.un(c.element,c.type,c.handler)}catch(g){continue}}this._bindFuncs.length=0;this._showCtrls();if(this.__driveCtrlFlag&&window.driveCtrl){this.__driveCtrlFlag=null;driveCtrl.show()}if(this.tipsLabel){this.tipsLabel.remove();this.tipsLabel=null}if(BMap.OperationMask.getDom(map).releaseCapture){BMap.OperationMask.getDom(map).releaseCapture()}BMap.OperationMask.hide();if(this.cm){destroyContextMenu(this.cm)}if(this._fDiv&&this._fDiv.parentNode){this._fDiv.parentNode.removeChild(this._fDiv);this._fDiv=null}var a=T.G("cap_size");if(a&&a.parentNode){a.parentNode.removeChild(a);a=null}var f=T.G("cap_btn_container");if(f){f.parentNode.removeChild(f);f=null}T.rc(T.g("capwrap"),"span_focus");captureCtrl._inUse=false};CaptureControl.prototype._generateHTML=function(){var a=[];a.push("<div id='cap_size' style='display:none;z-index:250'>0 x 0</div>");a.push("<div style='position:absolute;z-index:300;border:");a.push(this._opts.strokeWeight+"px "+this._opts.strokeStyle+" "+this._opts.strokeColor+";");a.push("width:0; height:0; font-size:0'>");a.push("<div class='cap_handler' id='cap_h_tl' _ht='4' style='cursor:nw-resize;top:-4px;left:-4px'></div>");a.push("<div class='cap_handler' id='cap_h_tr' _ht='5' style='cursor:ne-resize;top:-4px;right:-4px'></div>");a.push("<div class='cap_handler' id='cap_h_bl' _ht='7' style='cursor:ne-resize;bottom:-4px;left:-4px'></div>");a.push("<div class='cap_handler' id='cap_h_br' _ht='6' style='cursor:nw-resize;bottom:-4px;right:-4px'></div>");a.push("<div class='cap_handler' id='cap_h_t' _ht='0' style='cursor:n-resize;top:-4px;left:-4px'></div>");a.push("<div class='cap_handler' id='cap_h_l' _ht='3' style='cursor:w-resize;top:-4px;left:-4px'></div>");a.push("<div class='cap_handler' id='cap_h_r' _ht='1' style='cursor:e-resize;top:-4px;right:-4px'></div>");a.push("<div class='cap_handler' id='cap_h_b' _ht='2' style='cursor:s-resize;bottom:-4px;left:-4px'></div>");a.push("<div style='height:100%;width:100%;opacity:"+this._opts.opacity+";");a.push("filter:alpha(opacity="+Math.round(this._opts.opacity*100)+"); background:"+this._opts.fillColor+";cursor:move'></div>");a.push("</div>");return a.join("")};CaptureControl.prototype._updateHandlersPosition=function(){var d=parseInt(this._fDiv.style.width);var c=parseInt(this._fDiv.style.height);var a=Math.abs(d/2)-4+"px";var f=Math.abs(c/2)-4+"px";var b=d-3+"px";var g=c-3+"px";this._handlers[0].style.left=a;this._handlers[1].style.left=b;this._handlers[1].style.top=f;this._handlers[2].style.left=a;this._handlers[2].style.top=g;this._handlers[3].style.top=f;this._handlers[5].style.left=b;this._handlers[6].style.left=b;this._handlers[6].style.top=g;this._handlers[7].style.top=g};CaptureControl.prototype._updateCapSize=function(){var a=T.G("cap_size");a.style.display="block";var b=this;if(b._fDiv.style.left!="auto"){a.style.left=parseInt(b._fDiv.style.left)+2+"px"}else{a.style.left=map.width-parseInt(b._fDiv.style.right)-parseInt(b._fDiv.style.width)+"px"}if(b._fDiv.style.top!="auto"){a.style.top=parseInt(b._fDiv.style.top)-23+"px";if(parseInt(a.style.top)<0){a.style.top=parseInt(b._fDiv.style.top)+2+"px"}}else{a.style.top=map.height-parseInt(b._fDiv.style.bottom)-parseInt(b._fDiv.style.height)-25+"px";if(parseInt(a.style.top)<0){a.style.top=map.height-parseInt(b._fDiv.style.bottom)-parseInt(b._fDiv.style.height)+"px"}}a.innerHTML=parseInt(b._fDiv.style.width)+" x "+parseInt(b._fDiv.style.height)};CaptureControl.prototype._unifyPos=function(){var a=this;if(!a._fDiv){return}if(a._fDiv.style.left=="auto"&&a._fDiv.style.right!="auto"){a._fDiv.style.left=map.width-parseInt(a._fDiv.style.right)-a.capSizePx[0]-2+"px";a._fDiv.style.right="auto"}if(a._fDiv.style.top=="auto"&&a._fDiv.style.bottom!="auto"){a._fDiv.style.top=map.height-parseInt(a._fDiv.style.bottom)-a.capSizePx[1]-2+"px";a._fDiv.style.bottom="auto"}};CaptureControl.prototype._moveFromLeft=function(b,c,d){var f=this;var a=f.capSizePx[0]-b;if(a<0){f._temp._fromLeftToRight=true;if(isNaN(c)){c=map.width-d-1}if(-a+c+8<=map.width){if(!isNaN(c)){f._fDiv.style.left=c+"px"}else{f._fDiv.style.left=map.width-d-map.capSizePx[0]-2+"px"}f._fDiv.style.right="auto";f._fDiv.style.width=-a+"px"}else{f._fDiv.style.width=map.width-c-8+"px"}}else{if(isNaN(d)){if(f._temp._fromLeftToRight){d=map.width-c-1}else{d=map.width-c-f.capSizePx[0]-2}}if(map.width-d-a>=6){f._fDiv.style.left="auto";if(!isNaN(c)){if(f._temp._fromLeftToRight){f._fDiv.style.right=map.width-c-1+"px"}else{f._fDiv.style.right=map.width-c-f.capSizePx[0]-2+"px"}}f._fDiv.style.width=a+"px"}else{f._fDiv.style.width=map.width-d-4+"px"}}};CaptureControl.prototype._moveFromRight=function(b,c,d){var f=this;var a=f.capSizePx[0]+b;if(a>=0){if(isNaN(c)){c=map.width-d-1}if(a+c+12<=map.width){if(!isNaN(c)){f._fDiv.style.left=c+"px"}else{f._fDiv.style.left=map.width-d-1+"px"}f._fDiv.style.right="auto";f._fDiv.style.width=a+"px"}else{f._fDiv.style.width=map.width-c-9+"px"}}else{if(isNaN(d)){d=map.width-c-1}if(map.width-d+a>=9){f._fDiv.style.left="auto";if(!isNaN(c)){f._fDiv.style.right=map.width-c-1+"px"}f._fDiv.style.width=-a+"px"}else{f._fDiv.style.width=map.width-d-5+"px"}}};CaptureControl.prototype._moveFromTop=function(a,c,f){var d=this;var b=d.capSizePx[1]-a;if(b<0){d._temp._fromBottomToTop=true;if(isNaN(c)){c=map.height-f-1}if(-b+c+11<=map.height){if(!isNaN(c)){d._fDiv.style.top=c+"px"}else{d._fDiv.style.top=map.height-f-map.capSizePx[1]-2+"px"}d._fDiv.style.bottom="auto";d._fDiv.style.height=-b+"px"}else{d._fDiv.style.height=map.height-c-5+"px"}}else{if(isNaN(f)){if(d._temp._fromLeftToRight){f=map.height-c-1}else{f=map.height-c-d.capSizePx[1]-2}}if(map.height-f-b>=9){d._fDiv.style.top="auto";if(!isNaN(c)){if(d._temp._fromBottomToTop){d._fDiv.style.bottom=map.height-c-1+"px"}else{d._fDiv.style.bottom=map.height-c-d.capSizePx[1]-2+"px"}}d._fDiv.style.height=b+"px"}else{d._fDiv.style.height=map.height-f-9+"px"}}};CaptureControl.prototype._moveFromBottom=function(a,c,f){var d=this;var b=d.capSizePx[1]+a;if(b>=0){if(isNaN(c)){c=map.height-f-1}if(b+c+11<=map.height){if(!isNaN(c)){d._fDiv.style.top=c+"px"}else{d._fDiv.style.top=map.height-f-1+"px"}d._fDiv.style.bottom="auto";d._fDiv.style.height=b+"px"}else{d._fDiv.style.height=map.height-c-5+"px"}}else{if(isNaN(f)){f=map.height-c-1}if(map.height-f+b>=9){d._fDiv.style.top="auto";if(!isNaN(c)){d._fDiv.style.bottom=map.height-c-1+"px"}d._fDiv.style.height=-b+"px"}else{d._fDiv.style.height=map.height-f-9+"px"}}};CaptureControl.prototype.saveCapture=function(){var d=this._getReqData(1);var c=null;if(document.getElementById("capSaveF")){c=document.getElementById("capSaveF");var b=c.getElementsByTagName("input")[2];if(b){b.value=d}}else{c=document.createElement("form");c.id="capSaveF";c.name="capSaveF";c.method="post";c.action="http://snap.map.baidu.com/?newmap=1";c.target="_blank";var a=document.createElement("input");a.type="hidden";a.name="qt";a.value="save";var g=document.createElement("input");g.type="hidden";g.name="ie";g.value="utf8";var f=document.createElement("input");f.type="hidden";f.name="data";f.value=d;c.appendChild(a);c.appendChild(g);c.appendChild(f);document.body.appendChild(c)}c.submit();this.endCapture();return};CaptureControl.prototype.showCapture=function(){var nw=window.open("about:blank");var data=this._getReqData(0);var req=getXhr();req.onreadystatechange=function(){if(req.readyState==4&&req.status==200){if(req.responseText){var json=null;try{eval("json="+req.responseText)}catch(e){nw.close();captureCtrl.showErrorMsg();return}if(!json||json&&!json.content||json&&json.result&&json.result.error==1){nw.close();captureCtrl.showErrorMsg();return}var url=json.content.image_url;nw.location.href=url;nw.focus()}}else{if(req.readyState==4&&req.status!=200){captureCtrl.showErrorMsg()}}};req.open("POST","/?newmap=1");req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");req.send("qt=prev&ie=utf8&data="+encodeURIComponent(data));this.endCapture()};CaptureControl.prototype._getReqData=function(x,z){z=z||{};var v=map.width;var m=map.height;var j=v/2;var g=m/2;if(!z||(z&&!z.fullsize)){v=this.capSizePx[0];m=this.capSizePx[1];j=parseInt(this._fDiv.style.left)+1/2*v;g=parseInt(this._fDiv.style.top)+1/2*m}var q=map.pixelToPoint(new BMap.Pixel(j,g));var b=map.zoomLevel;var a=map.getOverlays();this._getAllMarkers(a);this._getAllLabels(a);this._getAllDrawings(a);var n=[];if(this.areas.length>0){n.push(this.areas.join(","))}if(this.lines.length>0){n.push(this.lines.join(","))}if(this.normMkrs.length>0){this.normMkrs.sort(function(h,c){return h.zIndex-c.zIndex});var y="";for(var k=0,f=this.normMkrs.length;k<f;k++){y=y+","+this.normMkrs[k].data}n.push(y.substring(1))}if(this.destLbls.length>0){this.destLbls.sort(function(h,c){return h.zIndex-c.zIndex});var y="";for(var k=0,f=this.destLbls.length;k<f;k++){y=y+","+this.destLbls[k].data}n.push(y.substring(1))}if(this.lbls.length>0){n.push(this.lbls.join(","))}var d=n.length>0?',"coord":['+n.join(",")+"]":"";var u=window.GRControll.getDataForSnap(),p="";if(u){p=',"c":'+u.c+',"wd":"'+u.wd+'","wd_h":"'+u.wd2+'","qt":"'+u.qt+'"'}var r='{"retype":'+x+',"src":"snap", "logo":"df:logo", "level":'+b+',"center":"'+q.lng+" "+q.lat+'","height":'+m+',"width":'+v+',"coordtype":"M","pictype":"'+this._getPicType()+'"'+d+p;if(map.mapType===BMAP_SATELLITE_MAP){r+=',"suffix" : "jpg"'}r+="}";return r};CaptureControl.prototype._getPicType=function(){var b=map.getMapType();var a=[];if(b==BMAP_SATELLITE_MAP){a.push(7);if(map._isHybirdShow){a.push(1)}}else{a.push(0)}if(window.GRControll.getDataForSnap()){a.push(6)}return a.join(",")};CaptureControl.prototype._getAllMarkers=function(f){this.normMkrs.length=0;for(var c=0,a=f.length;c<a;c++){var b=f[c];if(b.toString()=="Marker"&&b.isVisible()&&b._stCode){var g=b.zIndex||(b.getDom()&&b.getDom().style.zIndex);if(b._stCode==OVERLAY_STYLE.DRV_M_MKR&&b.siblingElement&&b.siblingElement.style.visibility=="hidden"){continue}this.normMkrs.push({data:'{"type":1,"geo":"'+b.getPoint().lng+" "+b.getPoint().lat+'","scode":"df:'+b._stCode+'"}',zIndex:g});if(b.getLabel()&&b.getLabel().isVisible()&&b.getLabel()._stCode){lbl=b.getLabel();var d=CaptureControl._getPointWithPixelOffset(lbl,new BMap.Size(3,4));this.normMkrs.push({data:'{"type":4,"geo":"'+d.lng+" "+d.lat+'","scode":"df:'+lbl._stCode+'","text":"'+formatJSONString(lbl.content)+'"}',zIndex:g})}}}return};CaptureControl.prototype._getAllLabels=function(d){this.destLbls.length=0;this.lbls.length=0;for(var b=0,a=d.length;b<a;b++){if(d[b].toString()=="Label"&&d[b].isVisible()){var f=d[b];if(f._stCode){if(f._stCode==OVERLAY_STYLE.DS_LBL||f._stCode==OVERLAY_STYLE.DE_LBL){this.destLbls.push({data:'{"type":1,"geo":"'+f.getPoint().lng+" "+f.getPoint().lat+'","scode":"df:'+f._stCode+'","text":"'+formatJSONString(f.content)+'"}',zIndex:f.zIndex})}else{var c=CaptureControl._getPointWithPixelOffset(f,new BMap.Size(3,5));this.lbls.push('{"type":4,"geo":"'+c.lng+" "+c.lat+'","scode":"df:'+f._stCode+'","text":"'+formatJSONString(f.content)+'"}')}}}}};CaptureControl.prototype._getAllDrawings=function(d){this.lines.length=0;this.areas.length=0;var h=function(p){var j=[];for(var n=0,m=p.length;n<m;n++){j.push(p[n].lng+" "+p[n].lat)}return j.join(",")};for(var c=0,a=d.length;c<a;c++){var g=d[c];if(g._stCode&&g.isVisible()){if(g.toString()=="Polyline"){this.lines.push('{"type":2,"geo":"'+h(g.getPoints())+'","scode":"df:'+g._stCode+'"}')}if(g.toString()=="PolylineMultipart"){var k=g.getPoints();for(var b=0,f=k.length;b<f;b++){this.lines.push('{"type":2,"geo":"'+h(k[b])+'","scode":"df:'+g._stCode+'"}')}}if(g.toString()=="Polygon"){this.areas.push('{"type":3,"geo":"'+h(g.getPoints())+'","scode":"df:'+g._stCode+'"}')}}}};CaptureControl.prototype.showErrorMsg=function(){alert("抱歉，截图失败。请检查您的网络连接，并稍后再试。")};CaptureControl._getPointWithPixelOffset=function(b,d){var a=d.width;var f=d.height;if(b){var c=map.pointToPixel(b.getPoint());if(b._config&&b._config.offset){c.x+=b._config.offset.width+a;c.y+=b._config.offset.height+f}else{c.x=c.x+a;c.y=c.y+f}return map.pixelToPoint(c)}};window.tTime="";var MAP_URL="http://map.baidu.com/";var TrafficControl=function(a){BMap.MapType.B_LiveTraffic_MAP={tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:modelConfig.highLevel,zoomLevelBase:18,errorUrl:MapConfig.smFlwCon+"image/blank.gif",bounds:new BMap.Bounds(-21364736,-10616832,23855104,15859712),imgExtend:"png"};BMap.MapType.B_ForecastTraffic_MAP={tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:modelConfig.highLevel,zoomLevelBase:18,errorUrl:MapConfig.smFlwCon+"image/blank.gif",bounds:new BMap.Bounds(-21364736,-10616832,23855104,15859712),imgExtend:"png"};this.c_time="";this.c_mTime="";this.s_time="";this.t_time=Math.abs(this.s_time-this.c_time);this.s_nTime=this.c_mTime+this.t_time;this.ctrlName="trafficCtrl";this.opened=false;this.anchorFixed=true;this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new BMap.Size(153,10);this.type="default";this.now="";this.timer=null;this.weeks=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];this.week=0;this.hour=0;this._opts=this._opts||{};this._opts=T.extend(this._opts,{offset:this.defaultOffset,panelOffset:new BMap.Size(this.defaultOffset.width-140,this.defaultOffset.height+20)});this._hostUrl="http://its.map.baidu.com:8002/traffic/";this._mapType="";this._serverDate=null;this.markers=[];this.city={beijing:{bound:new BMap.Bounds(12913866,4790523,12997546,4875786),point:new BMap.Point(12959415.04,4825643.77)},shanghai:{bound:new BMap.Bounds(13498186,3622031,13562092,3665660),point:new BMap.Point(13525431,3642155)},guangzhou:{bound:new BMap.Bounds(12593673,2615833,12635768,2666103),point:new BMap.Point(12612023,2630443)},shenzhen:{bound:new BMap.Bounds(12669825,2550501,12708116,2575963),point:new BMap.Point(12689847,2569003)},changzhou:{bound:new BMap.Bounds(13346437,3697277,13363737,3729174),point:new BMap.Point(13355087,3713225)},chengdu:{bound:new BMap.Bounds(11575175,3557689,11597068,3577705),point:new BMap.Point(11586121,3567697)},dalian:{bound:new BMap.Bounds(13524453,4672572,13546187,4698377),point:new BMap.Point(13535320,4685474)},chongqing:{bound:new BMap.Bounds(11846022,3408422,11868701,3438052),point:new BMap.Point(11857361,3423237)},nanjing:{bound:new BMap.Bounds(13200780,3728111,13238145,3775676),point:new BMap.Point(13219462,3751893)},nanchang:{bound:new BMap.Bounds(12889546,3297160,12916003,3326234),point:new BMap.Point(12902774,3311697)},wuhan:{bound:new BMap.Bounds(12708207,3539507,12743013,3570727),point:new BMap.Point(12725610,3555117)},ningbo:{bound:new BMap.Bounds(13500417,3407873,13570391,3520223),point:new BMap.Point(13531068,3467898)},shijiazhuang:{bound:new BMap.Bounds(12713985,4521985,12779519,4633440),point:new BMap.Point(12747452,4560506)},fuzhou:{bound:new BMap.Bounds(13238273,2949121,13323037,3014655),point:new BMap.Point(13279676,2990970)},tianjin:{bound:new BMap.Bounds(12976129,4653057,13107199,4784127),point:new BMap.Point(13047484,4713850)},hangzhou:{bound:new BMap.Bounds(13303809,3473409,13434879,3543320),point:new BMap.Point(13379516,3510650)},changsha:{bound:new BMap.Bounds(12517377,3211265,12648447,3276799),point:new BMap.Point(12571580,3259258)}};T.extend(this._opts,a||{});this.setPanelOffset(this._opts.panelOffset);this.initialize()};TrafficControl.time=3000*60;T.extend(TrafficControl.prototype,{initialize:function(){this._map=map;var a=this;this.bind(T.g("tool_tarffic"));function b(h){window.cNewTime=new Date().getTime();if(a._map){var c=a._map.getBounds();var d=null;var g=0;for(var f in a.city){if(c.containsBounds(a.city[f].bound)){g++}}for(var f in a.city){if(g<=1&&c.intersects(a.city[f].bound)!=null){d=f;break}}if(a._map.getZoom()>9){if(h.type.indexOf("zoom")>0){if(a.ishide&&a.ishide==1){a.open();a.ishide=0}}a.removeMarker()}else{if(h.type.indexOf("zoom")>0){if(a.opened==1){a.ishide=1;a.addMarker()}}a.close({type:"hide"})}}}map.addEventListener("load",function(c){b(c)});map.addEventListener("moveend",function(c){b(c)});map.addEventListener("resize",function(c){b(c)});map.addEventListener("dragend",function(c){b(c)});map.addEventListener("zoomend",function(c){b(c)});map.addEventListener("maptypechange",function(c){if(a.opened&&!!a._mapType&&map.mapType!=BMAP_PERSPECTIVE_MAP){a.addTrafficLay(a._mapType,{fromMaptypeChange:true})}});map.addEventListener("changehybirdmapmode",function(c){if(a.opened){a.addTrafficLay(a._mapType,{fromMaptypeChange:c.isHybirdMapShow})}})},bind:function(b){var a=this;T.on(b,"click",function(){a._toggle()})},setWeek:function(c,b){if(!b){addStat(TRAFFIC_EVENT_FORECAST_CHANGE)}for(var a=0;a<7;a++){T.g("week_"+this.ctrlName+"_"+a).className="";if(T.g("week_"+this.ctrlName+"_"+a)==c){this.week=a;c.className="on";T.g("font_"+this.ctrlName).innerHTML="星期"+c.innerHTML+"&nbsp;";this.setForecast();MapHunter.record("tf",1,{i:a})}}},_genHtml:function(){var b=this.ctrlName;var a=["一","二","三","四","五","六","日"];var d=['<div class="traffic_Panel" style="-moz-user-select:none" onselectstart="return false">'];d.push('<div class="traffic_title" id="title_'+b+'"><div class="tarffic_ss_con" id="title_nav'+b+'"><span class="tarffic_ss" id="tarffic_ss"  onmouseover="this.className=\'tarffic_ss_over\'" onmouseout="this.className=\'tarffic_ss\'" onclick="trafficCtrl.switchInfo(\'default\')">实时路况</span><span class="tarffic_yc" id="tarffic_yc" onmouseover="this.className=\'tarffic_yc_over\'" onmouseout="this.className=\'tarffic_yc\'" onclick="trafficCtrl.switchInfo(\'forecast\')">路况预测</span></div></div>');d.push('<div style="padding:5px;height:20px"><span id="font_'+b+'" style="float:left;color:#666">更新时间：&nbsp;</span>');d.push('<span id="time_'+b+'" style="float:left;color:#666"></span>');d.push('<span class="update" style="float:left;width:13px;height:14px;background:url('+MapConfig.smFlwCon+'image/tools_menu.gif) no-repeat -12px -18px;margin-left:5px;cursor:pointer" id="bt_'+b+'" onclick="trafficCtrl.setPanel(this)" title="更新" ></span>');d.push('<table id="forecast_'+b+'" width="233" style="font-size:12px;display:none;color:#6688ca; margin-top:5px"><tr>');d.push('<td style="width:35px">星期</td>');for(var c=0;c<7;c++){d.push('<td style="width:23px"><span style="padding:3px;cursor:pointer" id="week_'+b+"_"+c+'" onclick = "trafficCtrl.setWeek(this)">'+a[c]+"</span></td>")}d.push("</tr><tr>");d.push('<td style="height:42px;width:35px"><div style="padding-top:16px;*padding-top:18px">时间</div></td>');d.push('<td colspan="7" style="188px">');d.push('<div style="background:url('+MapConfig.smFlwCon+'image/bar.gif) no-repeat 0 10px;width:193px;height:40px;overflow:hidden">');d.push('<div><div id="timeBox_'+b+'" style="color:#6688cc;margin-left:74px;font-size:11px;overflow:hidden">12:00</div></div>');d.push('<div style="height:34px">');d.push('<div id="bar_prev_'+b+'" style="overflow:hidden;width:9px;height:9px;cursor:pointer;float:left;margin-top:5px" onclick="trafficCtrl.setBarBut(\'prev\')"></div>');d.push('<div id="bar_'+b+'" style="width:8px;height:17px;background:url('+MapConfig.smFlwCon+'image/tools_menu.gif) no-repeat 0 -33px;float:left;margin-top:0;cursor:pointer;margin-left:74px;_margin-left:42px;margin-top:0px;" onmouseover="this.style.backgroundPosition=\'-9px -33px\'" onmouseout="this.style.backgroundPosition=\'0 -33px\'"></div>');d.push('<div id="bar_next_'+b+'" style="overflow:hidden;width:11px;*width:10px;height:9px;cursor:pointer;float:right;margin-top:5px" onclick="trafficCtrl.setBarBut(\'next\')"></div>');d.push("</div></div></td></tr></table>");d.push('<div style="text-align:center;color:#9a9a9a;display:none" id="info_'+b+'">（基于历史路况统计预测 仅供参考）</div><div id="no_city_'+b+'" style="line-height:20px;padding:5px 10px;white-space:normal;color:#808080;padding-right:3px;display:none;"></div></div>');return d.join("")},_launch:function(){var a=this;this._getTime();if(a.trafficTimer){clearInterval(a.trafficTimer)}a.trafficTimer=setInterval(function(){a._getTime()},TrafficControl.time);this.setBar();this.setBarTime(12)},_getTime:function(){if(this.type!="default"){return}var b=this,a=b._hostUrl+"GetCurrentTime?callback=trafficCtrl.getTime";window.cTime=new Date().getTime();scriptRequest(a);setTimeout(function(){if(!b._serverDate){b.getTime()}},3000)},getTime:function(a){if(!a){a=new Date().getTime()}this._serverDate=a;window.tTime=a-window.cTime;if(this.opened){this.updateTime()}},setPanel:function(a){addStat(TRAFFIC_EVENT_REFRESH);if(a.className=="update"){this._getTime();return}else{if(a.className=="update2"){a.className="update1";T.g("forecast_"+this.ctrlName).style.display=T.g("info_"+this.ctrlName).style.display=T.g("no_city_"+this.ctrlName).style.display="none";this.pop.setHeight(73)}else{a.className="update2";T.g("forecast_"+this.ctrlName).style.display=T.g("info_"+this.ctrlName).style.display="";this.pop.setHeight(170)}}},switchInfo:function(f){var h=modelConfig.cityCode;var j={180:1,150:1,300:1,332:1,179:1,158:1};if(this.type==f){return}var k=T.g("title_nav"+this.ctrlName);var g=T.g("title_"+this.ctrlName);var c=T.g("font_"+this.ctrlName);var d=T.g("bt_"+this.ctrlName);var l=T.g("bt_"+this.ctrlName);var b=["查看路况预测","查看实时路况"];if(f=="forecast"){addStat(TRAFFIC_EVENT_FORECAST);this.type="forecast";d.style.display="none";var a=new Date(this.now).getDay();this.pop.setHeight(170);T.g("no_city_"+this.ctrlName).innerHTML="";T.g("forecast_"+this.ctrlName).style.display=T.g("info_"+this.ctrlName).style.display="";k.className="tarffic_yc_con";c.innerHTML=this.weeks[a]+"&nbsp;";if(this.now){var i=new Date(this.now);T.g("time_"+this.ctrlName).style.display="";T.g("time_"+this.ctrlName).innerHTML=i.getHours()+":00";this.setWeek(T.g("week_"+this.ctrlName+"_"+i.getDay()-1),true);this.week=i.getDay()-1;this.hour=i.getHours();this.setForecast()}this.setBarTime(this.hour);l.className="update2";window.trafficEvent.close()}else{this.type="default";d.style.display="";this._getTime();T.g("time_"+this.ctrlName).style.display="";T.g("time_"+this.ctrlName).innerHTML="";this.pop.setHeight(73);T.g("forecast_"+this.ctrlName).style.display=T.g("no_city_"+this.ctrlName).style.display=T.g("info_"+this.ctrlName).style.display="none";k.className="tarffic_ss_con";c.innerHTML="更新时间：&nbsp;";l.className="update";this.addTrafficLay("B_LiveTraffic_MAP");window.trafficEvent.open()}},addTrafficLay:function(c,g){var f=this;if(this.currentTrafficLay){map.removeTileLayer(this.currentTrafficLay)}f._mapType=c;window.cNewTime=new Date().getTime();var d=new BMap.Bounds(-21364736,-10616832,23855104,15859712);var b=new BMap.Copyright(d,"",c);var a=new BMap.TileLayer({mapType:c,transparentPng:true});a.zIndex=1;a.getTilesUrl=function(q,i){var k=BMap.MapType[this.mapType];if(typeof k!="object"){return null}var p=k.baseUnits*Math.pow(2,(18-i));var r=parseInt(q.lng/p);var l=parseInt(q.lat/p);var n=Math.floor(r/200);var m=Math.floor(l/200);var h="";var j=window.cNewTime+window.tTime;if(isNaN(j)==true){j=new Date().getTime()}h=f._hostUrl+"TrafficTileService?level="+i+"&x="+r+"&y="+l+"&time="+j;if(c=="B_ForecastTraffic_MAP"){t=new Date().getTime();h=f._hostUrl+"HistoryService?level="+i+"&x="+r+"&y="+l+"&day="+f.week+"&hour="+f.hour+"&t="+t}if(map.mapType===BMAP_SATELLITE_MAP){h+="&style=weixing"}if(map.mapType===BMAP_NORMAL_MAP){h+="&label=web2D&v=013"}else{if((!!g&&!!g.fromMaptypeChange)||(!g&&!!map._isHybirdShow)){h+="&label=webSate&v=013"}}h=h.replace(/-(\d+)/gi,"M$1");return h};map.addTileLayer(a);this.currentTrafficLay=a},clearTrafficLay:function(){if(this.currentTrafficLay){map.removeTileLayer(this.currentTrafficLay)}},setMarker:function(){var f=this;var d=new BMap.Icon(MapConfig.smFlwCon+"image/traffic.png",new BMap.Size(28,35),{offset:new BMap.Size(6,35)});for(var c in f.city){var a=f.city[c].point;if(f._map.config.coordType==BMAP_COORD_LNGLAT){a=BMap.Project.convertMC2LL(a)}if(!f.markers){f.markers=[]}var b=new BMap.Marker(a,{icon:d});b.cityName=c;f.markers.push(b)}},addMarker:function(){var c=this;var b=c.markers;for(var a in b){if(b[a].domElement==null){b[a].addEventListener("click",function(){var d=this.cityName||"";if(c._map){c._map.centerAndZoom(this.point,11)}c.open({cityName:d})});c._map.addOverlay(b[a]);b[a].domElement.setAttribute("type","system");b[a].siblingElement.setAttribute("type","system");b[a].domElement.title="点击查看交通路况"}b[a].show()}},removeMarker:function(){var b=this.markers;try{for(var a in b){b[a].hide();this._map.removeOverlay(b[a])}}catch(c){}},updateTime:function(c){var i=this._serverDate;var d=new Date(i);var g=new Date();var j=d.getHours()||g.getHours();var b=d.getMinutes()||g.getMinutes();var f=j<10?"0"+j:j;var a=b<10?"0"+b:b;T.g("time_"+this.ctrlName).innerHTML=f+":"+a;(d.getMinutes()<10?("0"+d.getMinutes()):d.getMinutes());if(i&&i>this.now){this.now=i;this.updateTile()}},updateTile:function(){this.addTrafficLay("B_LiveTraffic_MAP")},_getCityCode:function(a){var b=this._map.getCenter();var c=this._map.getZoom();if(this._map.config.coordType==BMAP_COORD_LNGLAT){b=BMap.Project.convertLL2MC(b)}},setBar:function(){var f=this;var c=T.g("bar_"+this.ctrlName);function b(){T.on(document,"onmousemove",d);T.on(document,"onmouseup",a)}function d(j){var g=j.clientX||j.x;var i=getPosition(T.g("bar_prev_"+f.ctrlName)).left+9;var h=g-i-4;if(h<0){h=0}if(h>165){h=165}if(T.browser.ie<=6&&T.browser.ie>0){c.style.marginLeft=(h*0.53)+"px"}else{c.style.marginLeft=h+"px"}T.g("timeBox_"+f.ctrlName).style.marginLeft=(h)+"px";f.setTimeBox()}function a(){addStat(TRAFFIC_EVENT_FORECAST_CHANGE);T.un(document,"onmousemove",d);T.un(document,"onmouseup",a);f.setForecast();MapHunter.record("tf",2,{i:f.hour})}T.on(c,"onmousedown",b)},setBarTime:function(c){if(c<0){c=0}if(c>24){c=24}this.hour=c;var b=c*(165/24);T.g("timeBox_"+this.ctrlName).style.marginLeft=b+"px";var a=T.g("bar_"+this.ctrlName);if(T.browser.ie<=6&&T.browser.ie>0){a.style.marginLeft=(b*0.53)+"px"}else{a.style.marginLeft=b+"px"}this.setTimeBox()},setTimeBox:function(){var b=modelConfig.cityCode;var d={180:1,150:1,300:1,332:1,179:1,158:1};var c=T.g("timeBox_"+this.ctrlName);var a=T.g("time_"+this.ctrlName);var f=parseInt(c.style.marginLeft);var g=Math.ceil((f-4)*24/165);this.hour=g;if(g<10){g="0"+g}a.innerHTML=c.innerHTML=g+":00"},setBarBut:function(a){var b=T.g("timeBox_"+this.ctrlName);var c=parseInt(b.style.marginLeft);var d=Math.ceil((c-4)*24/165);this.setBarTime(a=="next"?(d+1):(d-1));this.setForecast()},setForecast:function(){var a=this.hour;if(a==24){a=0}var c=[];var d=BMap.MapType.B_ForecastTraffic_MAP;var b=BMap.MapType.B_LiveTraffic_MAP;this.addTrafficLay("B_ForecastTraffic_MAP")},setPanelOffset:function(a){if(!a||a.toString()!="Size"){return}this._opts.panelOffset=new BMap.Size(a.width,a.height);if(this.pop&&this.pop.getDom()){this.pop.getDom().style.right=a.width+"px";this.pop.getDom().style.top=a.height+"px"}},open:function(f){var f=f||{};var b=f.cityName||"";if(this.opened){return}T.g("tool_tarffic")._opened=true;if(T.g("tool_tarffic").className.indexOf("span_focus")<0){T.ac(T.g("tool_tarffic"),"span_focus")}if(!window.trafficEvent){window.trafficEvent=new TrafficEvent()}window.trafficEvent.open({cityName:b});searchInViewCtrl.exit();if(window.NavTrans&&(ModelMgr.mainModel instanceof window.NavTrans)){driveCtrl.menu(false)}else{driveCtrl.hide(true)}var d=this;d.setMarker();this.opened=true;Share.setParam("tfc",1);var f={height:73,width:251,addDom:"tool_container_con",clickClose:false,isTitle:false,close:function(){d.close()}};var a=d.pop=new Popup(f);a.render();a.hide();a.content.innerHTML=d._genHtml();a.getDom().style.right="125px";a.getDom().style.top="29px";a.getDom()._anchor=d.defaultAnchor;a.getDom()._offset=d._opts.panelOffset;a.getDom().onclick=function(g){g=g||window.event;stopBubble(g)};a.show();var c=T.g("popup_close");c.onmouseup=function(){if(d.markers){mks=d.markers;for(var g in mks){mks[g].remove()}}d.markers=null};d._launch();addStat(STAT_TRAF_OPEN);if(map._isHybirdShow){addStat(TRAFFIC_EVENT_SATELLITE)}if(!ModelMgr.mainModel){return}switch(ModelMgr.mainModel._className){case"PoiSearch":addStat(TRAFFIC_EVENT_POI);break;case"BusTrans":addStat(TRAFFIC_EVENT_BUS);break;case"NavTrans":addStat(TRAFFIC_EVENT_CAR);break;case"NavWalk":addStat(TRAFFIC_EVENT_WALK);break;default:break}},close:function(b){var b=b||{};var a=b.type||"";if(!this.opened){return}this._serverDate=null;this.opened=false;Share.setParam("tfc");this.now="";this.type="default";this.pop.close();if(this.trafficTimer){clearInterval(this.trafficTimer)}this.clearTrafficLay();if(window.trafficEvent&&window.trafficEvent.opened){window.trafficEvent.close()}T.g("tool_tarffic")._opened=false;T.rc(T.g("tool_tarffic"),"span_focus")},hide:function(){T.g("tool_tarffic").style.display="none";tools&&tools.resetWidth();if(this.opened==true){this.pop.hide()}if(window.trafficEvent&&window.trafficEvent.opened){window.trafficEvent.hide()}},show:function(){if(!need2ShowTraffic()){return}T.g("tool_tarffic").style.display="";tools&&tools.resetWidth();if(this.opened==true){this.pop.show()}},_toggle:function(){if(this.opened){this.close()}else{this.open()}}});BMap.TrafficControl=TrafficControl;var TrafficEvent=function(a){T.lang.Class.call(this);this.opened=false;this.bindEvent=false;this.ishide=false;this.time="";this.markers=[];this.iconType="big";this.bigIconZoom=14;this.baseUrl="http://its.map.baidu.com:8001/showevents.php?qt=traeve_data";this.showCitys=[{code:AID["北京"],minZoom:11,ename:"beijing"},{code:AID["上海"],minZoom:11,ename:"shanghai"},{code:AID["广州"],minZoom:12,ename:"guangzhou"}];this.ctrlTimer="";this.dataTimer="";this.curCityCode="";this.curDataTime="";this.preGetDataTime="";this.data=[];this.intervalTime=5000*60;this.markers=[];this.mapEvent=null;this.initialize()};TrafficEvent.prototype=new BMap.Control();TrafficEvent.eventType=["管制","事故","施工","管制"];TrafficEvent.TIP_STAT=[TRAFFIC_EVENT_TIP_GUANZHI,TRAFFIC_EVENT_TIP_SHIGU,TRAFFIC_EVENT_TIP_SHIGONG,TRAFFIC_EVENT_TIP_GUANZHI];TrafficEvent.INFO_STAT=[TRAFFIC_EVENT_INFO_GUANZHI,TRAFFIC_EVENT_INFO_SHIGU,TRAFFIC_EVENT_INFO_SHIGONG,TRAFFIC_EVENT_INFO_GUANZHI];T.extend(TrafficEvent.prototype,{initialize:function(){var b=this;b._cityZoomConfig={};b._cityEnameConfig={};for(var a=0;a<b.showCitys.length;a++){b._cityZoomConfig[b.showCitys[a].code]=b.showCitys[a].minZoom;b._cityEnameConfig[b.showCitys[a].ename]=b.showCitys[a].code}},open:function(g){var f=this;var g=g||{};var c=g.cityName||"";if(map.getZoom()==19){return}if(!f.opened&&!f.bindEvent){f.bind()}f.opened=true;var b=[];for(var d=0;d<f.showCitys.length;d++){b.push(f.showCitys[d].code)}if(f.markers&&f.markers.length&&(map.getZoom()>=f.bigIconZoom&&f.iconType=="small")||(map.getZoom()<f.bigIconZoom&&f.iconType=="big")){for(var d=0;d<f.markers.length;d++){var a=f.markers[d];a.setIcon(f.createIcon(a.trafficEveType))}}function h(){var i=c?f._cityEnameConfig[c]:modelConfig.cityCode;if(!(i&&T.array.contains(b,String(i)))){if(f.opened&&!f.ishide){f.hide()}return true}if(map.getZoom()<f._cityZoomConfig[i]){f.hide();return true}return false}h();if(f.ctrlTimer){clearTimeout(f.ctrlTimer)}f.ctrlTimer=setTimeout(function(){if(h()){return}var k=new Date().getTime();var n=k-f.preGetDataTime;var m=c?f._cityEnameConfig[c]:modelConfig.cityCode;if(m==f.curCityCode&&n<f.intervalTime){if(f.ishide&&f.markers&&f.markers.length){for(var l=0;l<f.markers.length;l++){var j=f.markers[l];j.isVisible()==false?j.show():null}}}else{f.update({cityCode:m})}f.ishide=false},300)},bind:function(){var b=this;var a=function(c){if(!(trafficCtrl&&(trafficCtrl.opened||(trafficCtrl.ishide&&trafficCtrl.ishide==1)))){b.close();return}b.open()};b.mapEvent=a;map.addEventListener("load",a,"TrafficEvent");map.addEventListener("moveend",a,"TrafficEvent");map.addEventListener("resize",a,"TrafficEvent");map.addEventListener("dragend",a,"TrafficEvent");map.addEventListener("zoomend",a,"TrafficEvent");b.bindEvent=true},close:function(){var a=this;map.removeEventListener("load",a.mapEvent);map.removeEventListener("moveend",a.mapEvent);map.removeEventListener("resize",a.mapEvent);map.removeEventListener("dragend",a.mapEvent);map.removeEventListener("zoomend",a.mapEvent);a.hide();a.removeMarker();a.preGetDataTime="";a.curCityCode="";a.curDataTime="";a.bindEvent=false;a.opened=false},hide:function(){var c=this;for(var b=0;b<c.markers.length;b++){var a=c.markers[b];a.isVisible()?a.hide():null}c.ishide=true;if(c.ctrlTimer){clearTimeout(c.ctrlTimer)}if(c.dataTimer){clearTimeout(c.dataTimer)}},update:function(c){c=c||{};var d=c.cityCode||"";var b=this;if(b.dataTimer){clearTimeout(b.dataTimer)}var a=d||modelConfig.cityCode;b.getData(a);b.dataTimer=setTimeout(function(){b.update()},b.intervalTime)},createIcon:function(d){var g=this;var f=map.getZoom();var b=24;var h=0;var a=d==3?0:d;g.iconType="big";if(f<g.bigIconZoom){b=18;h=24;g.iconType="small"}var c=new BMap.Icon(MapConfig.smFlwCon+"image/tarffic_event_icon.png?v=1",new BMap.Size(b,b),{imageOffset:new BMap.Size(-h,-a*24),infoWindowOffset:new BMap.Size(15,0)});return c},addMarker:function(h){if(!(h&&h.length)){return}var n=this;n.removeMarker();var b=[];function u(i,w){i=i*1000;var y=new Date(i);var d="";if(w=="iw"){d+=y.getFullYear()+"年"}else{d+=y.getFullYear()+"-"}if(w=="iw"){d+=y.getMonth()+1+"月"}else{d+=y.getMonth()+1+"-"}if(w=="iw"){d+=y.getDate()+"日"}else{d+=y.getDate()+""}var x=" ";if(w==="ymd"){return d}else{if(w==="hm"){d="";x=""}}if(y.getHours()<10){d+=x+"0"+y.getHours()}else{d+=x+y.getHours()}if(y.getMinutes()<10){d+=":0"+y.getMinutes()}else{d+=":"+y.getMinutes()}return d}var a=24*60*60;for(var j=0;j<h.length;j++){var l=h[j];if(!l.geo){continue}var m=l.geo.split("|");var q=m[1];if(m[0]==2){q=q.split("|")[0]}var k=q.split(",");var s=new BMap.Point(k[0],k[1]);var p=n.createIcon(l.type);var g=new BMap.Marker(s,{icon:p,enableMassClear:false});g.trafficEveType=l.type;var r=l.starttime,f=l.endtime,v=u(l.endtime,"ymd");if(f-r<a){v="今天"+u(l.endtime,"hm")}var c=new BMap.Label(l.title+'<br/><span style="color:#676767">预计'+v+"结束</span>",{offset:new BMap.Size(13,-15)});c.setStyle({borderColor:"#acaba9",color:"#4d4a43",cursor:"pointer",padding:"1px 3px"});c.hide();g.setLabel(c);(function(){var w=g;var i='<div class="iw_poi_content" style="color:#4c4942;line-height:23px;">';if(l.starttime){i+="起始时间："+u(l.starttime,"iw")+"<br/>"}if(l.endtime){i+="预计结束时间："+u(l.endtime,"iw")+"<br/>"}if(l.des){i+='<p style="margin-top:10px;">详情：<span style="color:#666666">'+l.des+"</span></p>"}i+="</div>";var d=new BMap.InfoWindow(i,{title:'<span class="iw_poi_title" style="padding-right:10px;white-space:normal;word-wrap:break-word">'+l.title+"</span>",width:304});w.addEventListener("mouseover",function(){this.setTop(true);if(d.isOpen()){return}this.getLabel().show();if(!isNaN(this.trafficEveType)&&this.trafficEveType<TrafficEvent.TIP_STAT.length){addStat(TrafficEvent.TIP_STAT[this.trafficEveType])}var x=this});w.addEventListener("mouseout",function(){if(d.isOpen()){return}this.getLabel().hide();this.setTop(false)});w.addEventListener("click",function(){this.getLabel().hide();this.openInfoWindow(d)});w.addEventListener("infowindowopen",function(){if(!isNaN(this.trafficEveType)&&this.trafficEveType<TrafficEvent.INFO_STAT.length){addStat(TrafficEvent.INFO_STAT[this.trafficEveType])}this.setTop(true)});w.addEventListener("infowindowclose",function(){this.setTop(false)})})();map.addOverlay(g);b.push(g)}n.markers=b},removeMarker:function(){var b=this;for(var a=0;a<b.markers.length;a++){map.removeOverlay(b.markers[a])}b.markers=[]},getData:function(c){var b=this;var a=b.baseUrl;a+="&city_code="+c;if(c==b.curCityCode&&b.curDataTime!=""){a+="&time="+b.curDataTime}a+="&call_back="+b.guid;scriptRequest(a,null,"traffic_event_"+b.guid);b.preGetDataTime=new Date().getTime()},setData:function(b){if(!(b&&b.time&&b.city_code&&b.content&&b.content.length)){return}var a=this;var c=b;a.curCityCode=c.city_code;a.curDataTime=c.time;a.data=c.content;a.intervalTime=c.interval*60*1000||a.intervalTime;a.addMarker(a.data)}});BMap.TrafficEvent=TrafficEvent;var DriveControl=BMap.DriveControl=(function(n){var A=T,y=false,p=n.fmt,K=n.aeach,b=n.oeach,G=n.afind,r="DriveCtrl",x=function(Q,m){return x[E(Q,m)]},D=1,h=[{d:1,n:"road",t:"主要路段"},{d:1,n:"entry",t:"道路出入口"},{d:1,n:"poi",t:"途经地标"},{d:1,n:"toll",t:"收费站"},{d:0,n:"park",t:"终点停车场"},{d:0,n:"light",t:"红绿灯"},{d:0,n:"sapa",t:"服务区"},{d:0,n:"gas",t:"加油站"},{d:0,n:"cam",t:"摄像头"},{d:0,n:"roadtype",t:"道路类型"}],N={},v=["-158px -249px","-158px -271px"],g="drv-btn-expand",C="drv-btn-collapse",I="drv-dropdown",M="drv-dropup",w="drv-item-selected",z="drv-item-disabled",c="drv-ctrl-selectall-selected",i="drv-ctrl-lihover",B=["<button id='drvButtonId' class="+g+"></button>"],F={"true":"#3568b4","false":"#666"};HC=T.dom.hasClass,AC=T.ac,RC=T.rc,MENU_MIN_HEIGHT=50;function H(){BMap.Control.call(this);this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new BMap.Size(0,0)}H.prototype=new BMap.Control();H.ID=r;H.DEBUG=y;H.RELEASE=!y;var l=H.Stat=new Statistic(window.addStat);var k=H.Const={MENU_CLOSE_IMMEDIATELY:701,OPERATED:"operated!",MENU_CLOSE:702,CLOSE_ARROW:703,MORE_1ST:704,HIDE_1ST:705,MENU_OPEN_MANNUALLY:706,CHECK_NONDEFAULT_ITEM_1ST:707,MARKER_CLICK:708,INFOW_NEXT:709,INFOW_PREV:710,INFOW_ZOOMIN:711,INFOW_ZOOMOUT:712,INFOW_CLOSE:713};var J={collapsed:false,ANIMATE:false};J.initialize=function(m){this._map=m;this._brief=false;this.createCtrlDom();m.getContainer().appendChild(this.main);this.toggleButton=T.g("drv_toggle");this.menuEl=T.g("drv_menu");this.selectAllEl=T.g("drvSelectAllId");this.initEvents();P(this.main,this);return this.main};J.onMapResize=function(m){if(window.driveCtrl){window.driveCtrl.updateScrollbar()}};J.onMapTypeChange=function(U){var S=window.maptypeCtrl,R=S.getOffset(),W=R.height,Q=R.width;if(S.getHeight){var m=S.getHeight();W+=m+6}var V=new BMap.Size(Q,W);window.driveCtrl.setOffset(V)};J.initScrollBar=function(){if(!this.scrollPanel&&this.isAddScrollBar()){this.menuEl.style.height=this.getMenuUseableHeight()+"px";this.scrollPanel=new baidu.ui.ScrollPanel({container:this.menuEl,autoUpdate:false,overflow:"overflow-y"});this.scrollPanel.render(this.menuEl)}};J.getMenuUseableHeight=function(){var m=this.menuEl.style.height;this.menuEl.style.height="auto";var R=map.height,Q=R-this.getOffset().height;menuHeight=this.menuEl.offsetHeight,menuUseableHeight=Q-(this.getDom().offsetHeight-this.menuEl.offsetHeight);this.menuEl.style.height=m;if(menuUseableHeight<menuHeight){return menuUseableHeight<MENU_MIN_HEIGHT?MENU_MIN_HEIGHT:menuUseableHeight}else{return menuHeight}};J.isAddScrollBar=function(){var m=this.menuEl.style.height;this.menuEl.style.height="auto";var R=map.height,Q=R-this.getOffset().height;menuHeight=this.menuEl.offsetHeight,menuUseableHeight=Q-(this.getDom().offsetHeight-this.menuEl.offsetHeight);this.menuEl.style.height=m;return menuUseableHeight<menuHeight};J.updateScrollbar=function(){this.initScrollBar();if(!this.scrollPanel||this.collapsed||this._brief){return}this.menuEl.style.height=this.getMenuUseableHeight()+"px";this.scrollPanel.update()};J.autoAdjCtrlWidth=function(){if(this.collapsed){this.getDom().style.width=94+"px"}else{if(this._brief){this.getDom().style.width=125+"px"}else{this.getDom().style.width=161+"px"}}};J.createCtrlDom=function(){this.main=T.dom.create("div",{tid:"drvCtrlPanel",style:"border:1px solid #999;background-color:#fff;left:300px;top:10px;position:absolute;z-index:21;width:161px;",className:"drv-ctrl-main"});this.title=T.dom.create("div",{className:"drv-ctrl-title",style:"padding-left:7px;"});this.title.innerHTML="途经路段";this.content=T.dom.create("div",{className:"drv-ctrl-content"});this.content.innerHTML=a();this.drvButton=T.dom.create("button",{id:"drvButtonId",className:"drv-btn-class"});AC(this.drvButton,this.collapsed?C:g);this.main.appendChild(this.title);this.main.appendChild(this.content);this.main.appendChild(this.drvButton);return this.main};J.initEvents=function(){var m=this;T.on(m.drvButton,"click",function(Q){m[m.collapsed?"expand":"collapse"](m.ANIMATE);if(m.collapsed){addStat(STAT_NAV_COURSE_CLOSE)}})};J.collapse=function(){this.collapsed=true;this.content.style.display="none";AC(this.drvButton,C);RC(this.drvButton,g);this.oldStatus=this.getCheckboxStatus();this.unSelectAll();this.autoAdjCtrlWidth()};J.expand=function(){trafficCtrl.close();searchInViewCtrl.exit();this.collapsed=false;this.content.style.display="block";AC(this.drvButton,g);RC(this.drvButton,C);if(this.oldStatus&&this.oldStatus.count>0){var Q=this.oldStatus.status;for(var m in Q){if(Q[m]){this.selectItem(m)}}this.oldStatus=null}this.autoAdjCtrlWidth();this.updateScrollbar()};J.hide=function(m){BMap.Control.prototype.hide.call(this);map.removeEventListener("resize",this.onMapResize);map.removeEventListener("maptypechange",this.onMapTypeChange);if(!m){l.everytime(k.MENU_CLOSE)}};J.show=function(){BMap.Control.prototype.show.call(this);this.onMapTypeChange();map.addEventListener("resize",this.onMapResize);map.addEventListener("maptypechange",this.onMapTypeChange);addStat(STAT_NAV_COURSE_DEF)};J.menu=function(m,Q,V,U){var S=this._menu,R=this;RC(this.selectAllEl,c);if(m){if(V||this.getCheckboxStatus().count===0){if(this.isDisabled("road")){D=4}else{D=1}K(h,function(X,W){var Y=X.n;if(W<D){R.selectItem(Y)}else{R.unSelectItem(Y)}});this.oldStatus=null;R.showSelectedItem();if(this.getCheckboxStatus().count===0){R.showAllItem()}}if(!Q){l.everytime(k.MENU_OPEN_MANNUALLY)}}else{l.conditional(k.MENU_CLOSE_IMMEDIATELY,function(W){if(typeof(this.data[k.OPERATED])==="undefined"){this.send(W)}});if(!R.collapsed){R.collapse()}}};J.items=function(){var Q=this,m=0;K(h,function(W,U){var S=x(W.n,"li"),R=x(W.n,"cb"),V=Q.isChecked(W.n);if(V){m+=1}if(!Q._brief){S.style.display="block";R.style.display="block"}else{R.style.display="none";if(!V){S.style.display="none";S.style.display="block";S.style.display="none"}else{S.style.display="block"}}})};J.isMenuExpanded=function(){return this._brief};J.isPushed=function(){return !this.collapsed};J.getMenuItemInfo=function(R){for(var m=0;m<h.length;++m){var Q=h[m];if(Q.n===R){return Q}}};J.setNum=function(Q,R){x(Q,"num").innerHTML=R+"个";N[Q]=R;var m=x(Q,"li");this.disable(Q,R===0)};J.isChecked=function(m){return HC(x(m,"li"),w)};J.check=function(R,Q){var m=x(R,"li");if(Q){AC(m,w)}else{RC(m,w)}};J.isDisabled=function(m){return HC(x(m,"li"),z)};J.disable=function(R,Q){var m=x(R,"li");if(Q){RC(m,w);AC(m,z)}else{RC(m,z)}};J.getCheckboxStatus=function(){var Q=this,m={},R=0;K(h,function(V,S){var U=Q.isChecked(V.n);m[V.n]=U;if(U){R+=1}});return{count:R,status:m}};J.getItemsDisplay=function(){var m={},Q=0;K(h,function(U,S){if(S===h.length-1){return}var R=x(U.n,"li").style.display;m[U.n]=R;if(R!="none"){Q+=1}});return{count:Q,status:m}};J.showSelectedItem=function(){this._brief=true;this.autoAdjCtrlWidth();this.destroyScrollBar();if(this.getCheckboxStatus().count===0){this._brief=false;this.collapse();return}if(this.collapsed){this.expand()}this.selectAllEl.style.display="none";var m=this.toggleButton.firstChild;this.items();l.firsttime(k.MORE_1ST);RC(m,M);AC(m,I)};J.showAllItem=function(){this._brief=false;this.autoAdjCtrlWidth();if(this.collapsed){this.expand()}this.selectAllEl.style.display="block";var m=this.toggleButton.firstChild;this.items();this.updateScrollbar();l.firsttime(k.HIDE_1ST);RC(m,I);AC(m,M)};J.unSelectItem=function(m){if(this.isDisabled(m)||!this.isChecked(m)){return}this.check(m,false);this.onChecked&&this.onChecked(this,m,false);l.set(k.OPERATED,true)};J.selectItem=function(m){if(this.isDisabled(m)||this.isChecked(m)){return}this.check(m,true);this.onChecked&&this.onChecked(this,m,true);l.set(k.OPERATED,true);l.firsttime(m,function(){var Q=G(h,function(R){return R.n===m});if(Q.d<=0){this.codes[m]=true;this.send(k.CHECK_NONDEFAULT_ITEM_1ST,{type:Q.n})}})};J.selectAll=function(){var Q=this.getCheckboxStatus().status;for(var m in Q){this.selectItem(m)}};J.unSelectAll=function(){var Q=this.getCheckboxStatus().status;for(var m in Q){this.unSelectItem(m)}};J.destroyScrollBar=function(){if(this.scrollPanel){this.scrollPanel.dispose();this.menuEl.style.height="auto";this.menuEl.style.width="100%";this.toggleButton.parentNode.appendChild(this.toggleButton);this.scrollPanel=null}};A.extend(H.prototype,J);function P(R,W){var Q=W.toggleButton,S=W.menuEl,V=W.selectAllEl,U=W.content;T.on(Q,"click",function(X){W[W._brief?(RC(U,i),"showAllItem"):"showSelectedItem"]()});T.on(S,"click",function(Y){if(W._brief){RC(U,i);W.showAllItem();addStat(STAT_NAV_COURSE_BIG);return}var X=T.event.getTarget(Y),Z="";while(X&&X.nodeType===1&&X!=S&&X.tagName.toLowerCase()!=="li"){X=X.parentNode}Z=j(X.id);W[W.isChecked(Z)?"unSelectItem":"selectItem"](Z);addStat(STAT_NAV_COURSE_CHECK)});T.on(V,"click",function(Z){var Y=T.event.getTarget(Z);while(Y&&Y.nodeType===1&&Y!=V){Y=Y.parentNode}var X=HC(Y,c);X?RC(Y,c):AC(Y,c);W[X?"unSelectAll":"selectAll"]()});T.on(U,"mouseover",function(X){W._brief&&AC(U,i)});T.on(U,"mouseout",function(Y){var X=Y.relatedTarget||Y.toElement;if(!T.dom.contains(U,X)){W._brief&&RC(U,i)}});function m(Z,Y,X,aa){if(Z===Y){return aa?Z:null}while(Z&&Z.nodeType===1&&Z!==Y&&Z.tagName.toLowerCase()!==X){Z=Z.parentNode}return Z}if(T.ie===6){T.on(Q,"mouseover",function(Y){var X=T.event.getTarget(Y),Z=m(X,Q,"div",true);if(!!Z){AC(Z,i)}});T.on(Q,"mouseout",function(Y){var X=T.event.getTarget(Y),Z=m(X,Q,"div",true);if(!!Z){RC(Z,i)}});T.on(V,"mouseover",function(Y){var X=T.event.getTarget(Y),Z=m(X,V,"div",true);if(!!Z){AC(Z,i)}});T.on(V,"mouseout",function(Y){var X=T.event.getTarget(Y),Z=m(X,V,"div",true);if(!!Z){RC(Z,i)}});T.on(S,"mouseover",function(Y){var X=T.event.getTarget(Y),Z=m(X,S,"li");if(!!Z){AC(Z,i)}});T.on(S,"mouseout",function(Y){var X=T.event.getTarget(Y),Z=m(X,S,"li");if(!!Z){RC(Z,i)}})}K(h,function(ae,ab){var Z=E(ae.n,"li"),Y=E(ae.n,"cb"),aa=E(ae.n,"num"),X=E(ae.n,"txt");x[Z]=A.G(Z);x[aa]=A.G(aa);var ad=A.G(Y);x[Y]=ad;var ac=A.G(X);x[X]=ac})}function E(m,Q){return p("{0}_{1}_{2}",[m,Q,r])}function j(m){return m.split("_")[0]}function O(m){return m?"block":"none"}function L(m){return m?"visible":"hidden"}function s(m){return m?"checked":""}function d(m){return m?'checked="checked"':""}function f(m){return m}function u(m){m.style.color=F[false];m.style.cursor="default"}function q(m){m.style.color=F[true];m.style.cursor=""}function a(){var Q=['<div id="drvSelectAllId" class="drv-ctrl-selectall" style="display:block;"><span id="drvAllCb" class="drv-item-checked"></span><a href="javascript:void(0)">全部选择</a></div>'];var m=Q.concat(['<ul id="drv_menu" class="drv-ctrl-menu" style="width:100%;">']);K(h,function(S,R){var U='<li id={id} style="">{number}{checkbox}{icon}{text}{roadcolor}</li>',V={id:E(S.n,"li"),roadcolor:S.n==="roadtype"?['<div class="drv-ctrl-roadcolor"><span style="background-color:#FC5E20">其他</span>','<span style="background-color:#018607">高速</span>','<span style="background-color:#004EFF">国道</span></div>'].join(""):""};V.text=p('<a id="{0}" href="javascript:void(0)" style="{2}">{1}</a>',[E(S.n,"txt"),S.t,(S.s||"")]);V.icon='<span class="icon"></span>';V.checkbox=p('<span id="{0}" class="drv-item-checked"></span>',[E(S.n,"cb")]);V.number=S.n!=="roadtype"?p('<span id="{0}" style="float:right" class="number">0个</span>',[E(S.n,"num")]):"";m.push(p(U,V))});return m.concat(["</ul>",'<div id="drv_toggle" class="drv-toggle"><img src="'+MapConfig.smFlwCon+'image/transparent.gif" class="drv-dropup"></div>']).join("")}return H})(Helper);(function(){var o=null;var MapPoiClick=function(){this.citySpotId=null;this.poiSpotId=null;this.cacheData={};this.maxCache=8;this.cacheIds=[];this.squareSide=4;this.spotOnId="";this.mkr1=this.mkr2=null;this.label1=this.label2=null;this.spotOnUid=null;this.icType="",icType1="";this.tMkr=null;this.isOverSpot=0;this.isMoving=false;this.overSpotPoint=null;this.fetchId="";this.curTileId="";this.ic=new BMap.Icon(MapConfig.smFlwCon+"image/spotmkrs.png?v=1",new BMap.Size(18,18),{offset:new BMap.Size(9,9),imageOffset:new BMap.Size(0,0),infoWindowOffset:new BMap.Size(10,0)});this.init()};o=MapPoiClick.prototype;o.init=function(){var me=this;me.addShadowLabel();me.bind();var a=new Image();a.src=MapConfig.smFlwCon+"image/spotmkrs.png?v=1";setTimeout(function(){if(!me.urlParse()){me._bindMapRequest()}},1000);setInterval(function(){me.isMoving=false},300)};o.urlParse=function(){var param=getParam(location.href);if(param&&param.msi){var pars=param.msi.split("|");this.icType=(!!pars[1]?pars[1]:"qita");this.sendUidRequest(pars[0],{isSendStatPars:true});return true}else{return false}};o.bind=function(){this.bindMapRequest();this.bindMouseMove();this.bindSpotEvent()};o.mouseMoveEvent=function(e){var me=this;if(map.getZoom()<10){me.clearPoiCache()}else{me.clearCityCache();if(!e||!e.point){return}if(!!me.isOverSpot){me.overSpotPoint=e.point}me.isMoving=true;if(me.isOverSpot!=1){me.label1&&me.label1.hide();me.label2&&me.label2.hide();me.sdLab&&me.sdLab.hide()}var tPOI=map.getTileId(e.point,map.getZoom());if(!tPOI.row||!tPOI.column||!tPOI.level){return}me.curTileId=tPOI.level+"_"+tPOI.row+"_"+tPOI.column;var tPoiId=tPOI.level+"_"+me.m1(tPOI.row)+"_"+me.m1(tPOI.column);if(!!me.cacheData[tPoiId]){if(me.spotOnId!=me.curTileId){me._addSpot(me.curTileId)}}else{me.sendRequest({l:tPOI.level,x:me.m1(tPOI.row),y:me.m1(tPOI.column)})}}};o._addSpot=function(pId){var me=this;if(map.mapType==BMAP_SATELLITE_MAP&&!map._isHybirdShow){me.clearPoiCache();me.hideOverlays();return}var ids=pId.split("_");var nId=ids[0]+"_"+me.m1(ids[1])+"_"+me.m1(ids[2]);if(!me.cacheData[nId]){return}me.clearPoiCache();var js=!!me.cacheData[nId][pId]?me.cacheData[nId][pId]:[];me.poiSpotId=map.addSpots(js,{enableMultiResponse:false});me.spotOnId=pId;var idIndex=-1;for(var i=0,n=me.cacheIds.length;i<n;i++){if(nId==me.cacheIds[i]){idIndex=i;break}}if(idIndex>=0){me.cacheIds.splice(idIndex,1);me.cacheIds.push(nId)}};o.bindMouseMove=function(){var me=this;map.addEventListener("mousemove",function(e){me.mouseMoveEvent(e)})};o.clickSpot=function(e){if(map.getZoom()<10){for(var i=0,l=e.spots.length;i<l;i++){if(e.spots[i].n){go("cur&wd="+encodeURIComponent(e.spots[i].n)+"&ie=utf-8");break}}}else{if(this.tMkr){this.clickMkr(this.tMkr)}}};o.clickMkr=function(o1){if(map.getZoom()<10||!o1){return}var me=this;me.isOverSpot=0;if(!me.spotOnUid){return}map.temp.infoWin&&map.temp.infoWin.close();me.onMarker=o1;me.sendUidRequest(me.spotOnUid);MapHunter.record("ma",3,{uid:me.spotOnUid})};o.sendUidRequest=function(uid,opt){if(!uid){return}var me=this;var pars="/?qt=inf&uid="+uid+"&ie=utf-8&t="+new Date().getTime();T.Ajax.request(pars,function(res){if(!res||res.responseText==""){return}var js=eval("("+res.responseText+")");if(!js||!js.content){return}var c=js.content;addStat(STAT_SPOT_CLICK,{level:map.getZoom(),poiname:c.name,uid:uid,tn:map.mapType});var pt=getPointByStr(parseGeo(c.geo).points);if(!opts){var opts={}}opts.isFromMPC=true;var addr=c.addr;if(c.poiType==POI_TYPE_BUSSTOP||c.poiType==POI_TYPE_SUBSTOP){addr=T.array.unique(addr.split(";")).join("; ")}var tel=c.tel;if(tel){tel=tel.replace(/,/g,", ")}var cate=me._getCateInfo(c.cla);var infoWnd=createSearchInfoWnd({title:c.name,addr:addr,tel:tel,detail:c.detail,ext_type:c.ext_type,uid:c.uid,cate:cate,poiType:c.poiType,hasDetail:(c.detail&&c.ty==GEO_TYPE_POINT||c.poiType==POI_TYPE_BUSLINE||c.poiType==POI_TYPE_SUBLINE),ext:c.ext,houseDetailUrl:myext._getHouseDetailUrl(c),cp:c.cp,cla:c.cla,jiucuofr:"ditu"},{cityCode:me.sCityCode,x:pt.lng,y:pt.lat,isFromMPC:true});if(!infoWnd){return}infoWnd.addEventListener("open",function(){window.GRControll&&GRControll.setGRequestFlg(2000);if(infoWnd.closeButton){T.on(infoWnd.closeButton,"click",function(){if(map.temp.infoWin.overlay){map.temp.infoWin.overlay.hide()}me.onMarker=null;Share.mapSpotInf=null;T.un(infoWnd.closeButton,"click",arguments.callee)})}infoWnd.removeEventListener("open",arguments.callee)});infoWnd.addEventListener("close",function(){me.label1&&me.label1.hide();me.label2&&me.label2.hide();me.sdLab&&me.sdLab.hide();if(map.temp.infoWin.overlay){map.temp.infoWin.overlay.hide()}me.onMarker=null;Share.mapSpotInf=null;infoWnd.removeEventListener("close",arguments.callee)});if(me.onMarker){openSearchInfoWnd(infoWnd,me.onMarker,opts);if(!Share.mapSpotInf){Share.mapSpotInf=me.spotOnUid+"|"+(!!me.icType?me.icType:me.icType1)}}else{if(!me.mkr1){var point=getPointByStr(parseGeo(c.geo).points);if(!!me.icType){var tpOffset=MPC_ICON_IMGOFFSET[me.icType];me.ic.setImageOffset(new BMap.Size(tpOffset.x,tpOffset.y));var tSize=MPC_ICON_SIZE[tpOffset.s];me.ic.setSize(new BMap.Size(tSize.w,tSize.h));me.ic.setOffset(new BMap.Size(tSize.w/2,tSize.h/2))}me.mkr1=new BMap.Marker(point,{icon:me.ic,zIndexFixed:true});map.addOverlay(me.mkr1);me.mkr1.addEventListener("click",function(){Share.mapSpotInf=me.spotOnUid+"|"+(!!me.icType?me.icType:me.icType1);me.clickMkr(me.mkr1)});me.mkr1.addEventListener("mouseout",function(){me.moveOutMkr(me.mkr1)});openSearchInfoWnd(infoWnd,me.mkr1,opts)}}me.label1&&me.label1.hide();me.label2&&me.label2.hide();me.sdLab&&me.sdLab.hide()})};o.moveOverSpot=function(e){if(map.getZoom()<10){return}var spotArr=e.spots;if(!spotArr||spotArr.length<1||!(spotArr[0].tag)||spotArr[0].tag!="MAP_SPOT_INFO"){return}var me=this;var tempMarker=null,tempLabel=null,mindex=0;if(me.onMarker&&me.onMarker===me.mkr1){tempMarker=me.mkr2;tempLabel=me.label2;mindex=2}else{tempMarker=me.mkr1;tempLabel=me.label1;mindex=1}if(map.temp.infoWin&&map.temp.infoWin.isOpen()==true&&!!Share.mapSpotInf&&spotArr[0].userdata.uid==Share.mapSpotInf.split("|")[0]){return}if(!!spotArr[0].userdata.type&&MPC_ICON_IMGOFFSET[spotArr[0].userdata.type]){var tpOffset=MPC_ICON_IMGOFFSET[spotArr[0].userdata.type];me.icType1=spotArr[0].userdata.type}else{var tpOffset=MPC_ICON_IMGOFFSET.blank;me.icType1="blank"}var tSize=MPC_ICON_SIZE[tpOffset.s];me.ic.setSize(new BMap.Size(tSize.w,tSize.h));me.ic.setOffset(new BMap.Size(tSize.w/2,tSize.h/2));me.ic.setImageOffset(new BMap.Size(tpOffset.x,tpOffset.y));var tPnt=!!spotArr[0].userdata.iconpoint?spotArr[0].userdata.iconpoint:spotArr[0].pt;if(tempMarker&&tempMarker.map){tempMarker.hide();tempMarker.setPoint(tPnt);tempMarker.setIcon(me.ic);tempMarker.show();me.spotOnUid=spotArr[0].userdata.uid}else{tempMarker=new BMap.Marker(tPnt,{icon:me.ic,zIndexFixed:true,baseZIndex:3000000});me.spotOnUid=spotArr[0].userdata.uid;map.addOverlay(tempMarker);eval("me.mkr"+mindex+" = tempMarker");tempMarker.addEventListener("click",function(){me.icType=me.icType1;Share.mapSpotInf=me.spotOnUid+"|"+me.icType1;me.clickMkr(tempMarker)});tempMarker.addEventListener("mouseout",function(){me.moveOutMkr(tempMarker)})}tempMarker.setTop(true);var labSty=[{backgroundColor:"#FFFFE1",borderColor:"#8C8C8C",color:"#4D4D4D"},{backgroundColor:"#F0F7FF",borderColor:"#7AA3CC",color:"#224B73"}];me.tMkr=tempMarker;if(tempLabel&&tempLabel.map){tempLabel.hide();if(!!spotArr[0].userdata.name){me.isOverSpot=1;tempLabel.setContent(spotArr[0].userdata.name);var tPnt1=me.getLabelPoint(tPnt,1,{x:(Math.abs(spotArr[0].bd[0])+6),y:-9});tempLabel.setPoint(tPnt1);tempLabel.setStyle(labSty[1]);tempLabel.show();me.getShadowLabel({point:tPnt1,name:spotArr[0].userdata.name})}else{me.isOverSpot=2;tempLabel.setContent("点击可查看详情");tempLabel.setStyle(labSty[0]);me.timeMachine(tempLabel)}}else{if(!!spotArr[0].userdata.name){me.isOverSpot=1;var tPnt1=me.getLabelPoint(tPnt,1,{x:(Math.abs(spotArr[0].bd[0])+6),y:-9});tempLabel=new BMap.Label(spotArr[0].userdata.name,{point:tPnt1});map.addOverlay(tempLabel);eval("me.label"+mindex+" = tempLabel");tempLabel.setStyle(labSty[1]);me.getShadowLabel({point:tPnt1,name:spotArr[0].userdata.name})}else{me.isOverSpot=2;tempLabel=new BMap.Label("点击可查看详情",{point:me.getLabelPoint(e.point,0)});map.addOverlay(tempLabel);eval("me.label"+mindex+" = tempLabel");tempLabel.setStyle(labSty[0]);me.timeMachine(tempLabel)}}};o.timeMachine=function(lab){var me=this;var lab0=lab;me.timer0=setInterval(function(){if(!me.isMoving){setTimeout(function(){if(me.isOverSpot!=2){clearInterval(me.timer0);return}var tPt=me.getLabelPoint(me.overSpotPoint,0);lab0.setPoint(tPt);lab0.show();me.getShadowLabel({point:tPt,name:"点击可查看详情"});clearInterval(me.timer0)},500)}},200)};o.getLabelPoint=function(pt,no,opts){var px1=map.pointToPixel(pt);if(!!opts){var offst=opts}else{if(no==0){var offst={x:-1,y:24}}else{if(no==1){var offst={x:12,y:-9}}}}if(no==0){return map.pixelToPoint(new BMap.Pixel(px1.x+offst.x,px1.y+offst.y))}else{if(no==1){return map.pixelToPoint(new BMap.Pixel(px1.x+offst.x,px1.y+offst.y))}}};o.moveOutSpot=function(e){if(map.getZoom()<10){return}var me=this;me.isOverSpot=0;me.label1&&me.label1.hide();me.label2&&me.label2.hide();me.sdLab&&me.sdLab.hide();me.timer0&&clearInterval(me.timer0);me.tMkr=null;var tempMarker=me.mkr2;if(tempMarker&&tempMarker.map){if(!map.temp.infoWin||map.temp.infoWin.isOpen()==false||map.temp.infoWin.overlay!==tempMarker){if(me.onMarker&&me.onMarker===tempMarker){return}else{tempMarker.hide()}}}tempMarker=me.mkr1;if(tempMarker&&tempMarker.map){if(!map.temp.infoWin||map.temp.infoWin.isOpen()==false||map.temp.infoWin.overlay!==tempMarker){if(me.onMarker&&me.onMarker===tempMarker){return}else{tempMarker.hide()}}}};o.moveOutMkr=function(o1){if(map.getZoom()<10||!o1){return}var me=this;me.label1&&me.label1.hide();me.label2&&me.label2.hide();me.sdLab&&me.sdLab.hide();if(me.onMarker===o1){return}if(map.temp.infoWin&&map.temp.infoWin.isOpen()==true){if(map.temp.infoWin.overlay===o1){return}else{}}else{me.spotOnUid=""}};o.bindMapRequest=function(){var me=this;map.addEventListener("load",function(){me._bindMapRequest()});map.addEventListener("moveend",function(){me._bindMapRequest()});map.addEventListener("dragend",function(){me._bindMapRequest()});map.addEventListener("zoomend",function(){me.clearCityCache();me.clearPoiCache();if(!map.temp.infoWin||map.temp.infoWin.isOpen()!=true){me.mkr1&&me.mkr1.hide();me.mkr2&&me.mkr2.hide();me.label1&&me.label1.hide();me.label2&&me.label2.hide();me.sdLab&&me.sdLab.hide();me.isOverSpot=0;me.timer0&&clearInterval(me.timer0)}me._bindMapRequest()});map.addEventListener("resize",function(){me._bindMapRequest()})};o._bindMapRequest=function(){var me=this;if(map.getZoom()<10){me.clearPoiCache();if(!me.citySpotId){me.citySpotId=map.addSpots(clickCityData)}}};o.sendRequest=function(pId){var me=this;if(!!pId&&me.fetchId!=(pId.l+"_"+pId.x+"_"+pId.y)){me.fetchId=pId.l+"_"+pId.x+"_"+pId.y;var url=[];url.push("http://mapclick.map.baidu.com/data/");url.push(pId.x+"_"+pId.y+"_"+map.zoomLevel+"_013.js");scriptRequest(url.join(""))}};o.getPoiData=function(json){if(!json||json.length<1){return}var jj={},bol=false,me=this;for(var ii=0,nn=json.length;ii<nn;ii++){var j=[];var js=json[ii];for(var i=0,n=js.uids.length;i<n;i++){var tjs=js.uids[i];var cterX=(tjs.bound.xmax+tjs.bound.xmin)/2;var cterY=(tjs.bound.ymax+tjs.bound.ymin)/2;var px0=map.pointToPixel(new BMap.Point(tjs.bound.xmin,tjs.bound.ymin));var px1=map.pointToPixel(new BMap.Point(tjs.bound.xmax,tjs.bound.ymax));var poiBound=[(px0.x-px1.x)/2,(px1.y-px0.y)/2,(px1.x-px0.x)/2,(px0.y-px1.y)/2];j.push({pt:new BMap.Point(cterX,cterY),bd:poiBound,userdata:{name:!!tjs.name?tjs.name:"",uid:tjs.uid,type:tjs.type,iconpoint:!!tjs.icon?new BMap.Point(tjs.icon.x,tjs.icon.y):""},tag:"MAP_SPOT_INFO"})}if(!!me.curTileId&&me.curTileId==js.tileid){bol=true}jj[js.tileid]=j}var ids=json[0].tileid.split("_");var nId=ids[0]+"_"+me.m1(ids[1])+"_"+me.m1(ids[2]);me.cacheData[nId]=jj;me.cacheIds.push(nId);if(me.cacheIds.length>me.maxCache){var delId=me.cacheIds.shift();delete (me.cacheData[delId]);delete delId}bol&&me._addSpot(me.curTileId)};o.clearPoiCache=function(){var me=this;if(me.poiSpotId){map.removeSpots(me.poiSpotId);me.poiSpotId=null;me.spotOnId="";me.curTileId=""}};o.clearCityCache=function(){var me=this;if(me.citySpotId){map.removeSpots(me.citySpotId);me.citySpotId=null}};o.hideOverlays=function(){var me=this;me.mkr1&&me.mkr1.hide();me.mkr2&&me.mkr2.hide();me.label1&&me.label1.hide();me.label2&&me.label2.hide();me.sdLab&&me.sdLab.hide();me.timer0&&clearInterval(me.timer0)};o._getCateInfo=function(ar){var a=[];for(var i=0,l=ar.length;i<l;i++){a.push(ar[i][1]);if(i<l-1){a.push(", ")}}return a.join("")};o.addShadowLabel=function(){var me=this;if(!me.sdLab){me.sdLab=new BMap.Label("shadow");map.addOverlay(me.sdLab);me.sdLab.setStyle({backgroundColor:"#BEBEBE",borderColor:"#BEBEBE",color:"#BEBEBE",zIndex:-20000})}me.sdLab.hide()};o.getShadowLabel=function(opt){var me=this;return;if(!opt||!opt.point||!opt.name){me.sdLab&&me.sdLab.hide();return}var px1=map.pointToPixel(opt.point);var pt=map.pixelToPoint(new BMap.Pixel(px1.x+1,px1.y+1));me.sdLab.setContent(opt.name);me.sdLab.setPoint(pt);me.sdLab.show()};o.m1=function(m){return Math.floor(parseInt(m,10)/this.squareSide)};o.addSpotEvent=function(){var me=this,w=window;if(!w._moveOverSpot){w._moveOverSpot=function(e){me.moveOverSpot(e)}}if(!w._moveOutSpot){w._moveOutSpot=function(e){me.moveOutSpot(e)}}if(!w._clickSpot){w._clickSpot=function(e){me.clickSpot(e)}}map.addEventListener("spotmouseover",w._moveOverSpot);map.addEventListener("spotmouseout",w._moveOutSpot);map.addEventListener("spotclick",w._clickSpot)};o.removeSpotEvent=function(){var w=window;map.removeEventListener("spotmouseover",w._moveOverSpot);map.removeEventListener("spotmouseout",w._moveOutSpot);map.removeEventListener("spotclick",w._clickSpot)};o.bindSpotEvent=function(){var me=this;me.addSpotEvent();map.addEventListener("onaddhybirdmap",function(e){me.addSpotEvent()});map.addEventListener("onremovehybirdmap",function(e){me.clearPoiCache();me.hideOverlays();me.removeSpotEvent()});map.addEventListener("onmaptypechange",function(e){var type=e.mapType;if(type!=BMAP_NORMAL_MAP){me.clearPoiCache();me.hideOverlays();me.removeSpotEvent()}else{me.addSpotEvent()}})};window.MPC_Mgr=new MapPoiClick()})();var MPC_ICON_SIZE=[{w:18,h:18},{w:20,h:20},{w:26,h:16},{w:15,h:15},{w:18,h:18},{w:24,h:24},{w:16,h:16},{w:20,h:20},{w:24,h:24},{w:5,h:5},{w:24,h:14},{w:34,h:16},{w:17,h:18},{w:21,h:22},{w:21,h:21},{w:23,h:23},{w:30,h:30}],MPC_ICON_IMGOFFSET={zhudijigou:{x:-195,y:0,s:0},zhongyangjigou:{x:-213,y:0,s:0},zhongxiaoxue:{x:-231,y:0,s:0},zhongheyiyuan_1:{x:-249,y:0,s:0},zhongcan:{x:-267,y:0,s:0},zhongbiaoyanjing:{x:-285,y:0,s:0},youzheng:{x:-195,y:-18,s:0},xiyidian:{x:-213,y:-18,s:0},xinwenchuban:{x:-231,y:-18,s:0},xican:{x:-249,y:-18,s:0},xiaoxue_loupan:{x:-267,y:-18,s:0},wenhuabangong:{x:-285,y:-18,s:0},yinyueting:{x:-195,y:-36,s:0},tushuyinxiang:{x:-213,y:-36,s:0},tiyuyongpin:{x:-231,y:-36,s:0},tiyu:{x:-249,y:-36,s:0},tingchecang:{x:-267,y:-36,s:0},shoupiaochu:{x:-285,y:-36,s:0},yinghang:{x:-195,y:-54,s:0},sheyingshexiang:{x:-213,y:-54,s:0},shangwudasha:{x:-231,y:-54,s:0},shangchang:{x:-249,y:-54,s:0},sewaijigou:{x:-267,y:-54,s:0},qita:{x:-285,y:-54,s:0},yaodian_yaofang:{x:-195,y:-72,s:0},qiche:{x:-213,y:-72,s:0},meirongmeifa:{x:-231,y:-72,s:0},lingmu:{x:-249,y:-72,s:0},lianshuokuaishujiudiann:{x:-267,y:-72,s:0},keyangjigou:{x:-285,y:-72,s:0},hill:{x:-195,y:-90,s:0},jiaotang:{x:-213,y:-90,s:0},jiayouzhan:{x:-231,y:-90,s:0},jiguandanwei:{x:-249,y:-90,s:0},jiuba:{x:-267,y:-90,s:0},kafeiting:{x:-285,y:-90,s:0},guji:{x:-195,y:-108,s:0},gouwuzhongxin:{x:-213,y:-108,s:0},gongyuan:{x:-231,y:-108,s:0},gongjianfajigou:{x:-249,y:-108,s:0},gongce:{x:-266,y:-107,s:0},gewuting:{x:-285,y:-108,s:0},gaodengjiaoyu:{x:-195,y:-126,s:0},gangkou_matou:{x:-213,y:-126,s:0},fengjing:{x:-231,y:-126,s:0},fangwuzhongjie:{x:-249,y:-126,s:0},dujiachun:{x:-267,y:-126,s:0},dongwuyuan:{x:-285,y:-126,s:0},dongnanyacai:{x:-195,y:-144,s:0},dianyingyuan:{x:-213,y:-144,s:0},dianxinyingyeting:{x:-231,y:-144,s:0},dianxingongsi:{x:-249,y:-144,s:0},dianshita:{x:-267,y:-144,s:0},chongwudian:{x:-285,y:-144,s:0},chazhuo:{x:-195,y:-162,s:0},chaoshi:{x:-213,y:-162,s:0},changtuqichezhan:{x:-231,y:-162,s:0},bowuguan:{x:-249,y:-162,s:0},binguan:{x:-267,y:-162,s:0},atm:{x:-285,y:-162,s:0},blank:{x:-166,y:0,s:0},feijichang:{x:-167,y:-18,s:1},huochezhan:{x:-167,y:-40,s:1},tianam:{x:-164,y:-61,s:2},busstop_2:{x:-82,y:-289,s:12},busstop_3:{x:-124,y:-289,s:13},ditie_beijing_00:{x:-175,y:-90,s:9},ditie_beijing_0:{x:-8,y:0,s:3},ditie_beijing_1:{x:-27,y:0,s:4},ditie_beijing_2:{x:-51,y:0,s:5},ditie_shanghai_0:{x:-8,y:-23,s:3},ditie_shanghai_1:{x:-27,y:-23,s:4},ditie_shanghai_2:{x:-51,y:-23,s:5},ditie_guangzhou_0:{x:-8,y:-47,s:3},ditie_guangzhou_1:{x:-27,y:-47,s:4},ditie_guangzhou_2:{x:-51,y:-47,s:5},ditie_tianjin_0:{x:-8,y:-71,s:3},ditie_tianjin_1:{x:-27,y:-71,s:4},ditie_tianjin_2:{x:-51,y:-71,s:5},ditie_shenzhen_0:{x:-8,y:-95,s:3},ditie_shenzhen_1:{x:-27,y:-95,s:4},ditie_shenzhen_2:{x:-51,y:-95,s:5},ditie_xianggang_0:{x:-8,y:-120,s:3},ditie_xianggang_1:{x:-27,y:-120,s:4},ditie_xianggang_2:{x:-51,y:-120,s:5},ditie_nanjing_0:{x:-8,y:-142,s:3},ditie_nanjing_1:{x:-27,y:-142,s:4},ditie_nanjing_2:{x:-51,y:-142,s:5},ditie_chongqing_0:{x:-8,y:-166,s:3},ditie_chongqing_1:{x:-27,y:-166,s:4},ditie_chongqing_2:{x:-51,y:-166,s:5},ditie_wuhan_0:{x:-8,y:-191,s:3},ditie_wuhan_1:{x:-27,y:-191,s:4},ditie_wuhan_2:{x:-51,y:-191,s:5},ditie_changchun_0:{x:-8,y:-214,s:3},ditie_changchun_1:{x:-27,y:-214,s:4},ditie_changchun_2:{x:-51,y:-214,s:5},ditie_dalian_0:{x:-8,y:-238,s:3},ditie_dalian_1:{x:-27,y:-238,s:4},ditie_dalian_2:{x:-51,y:-238,s:5},ditie_chengdu_0:{x:-6,y:-316,s:14},ditie_chengdu_1:{x:-28,y:-316,s:15},ditie_chengdu_2:{x:-52,y:-316,s:16},ditie_shenyang_0:{x:-8,y:-289,s:3},ditie_shenyang_1:{x:-27,y:-289,s:4},ditie_shenyang_2:{x:-51,y:-289,s:5},trans_beijing_0:{x:-83,y:-1,s:6},trans_beijing_1:{x:-102,y:-1,s:7},trans_beijing_2:{x:-127,y:-1,s:8},trans_shanghai_0:{x:-83,y:-27,s:6},trans_shanghai_1:{x:-102,y:-27,s:7},trans_shanghai_2:{x:-127,y:-27,s:8},trans_guangzhou_0:{x:-83,y:-53,s:6},trans_guangzhou_1:{x:-102,y:-53,s:7},trans_guangzhou_2:{x:-127,y:-53,s:8},trans_tianjin_0:{x:-83,y:-79,s:6},trans_tianjin_1:{x:-102,y:-79,s:7},trans_tianjin_2:{x:-127,y:-79,s:8},trans_shenzhen_0:{x:-83,y:-105,s:6},trans_shenzhen_1:{x:-102,y:-105,s:7},trans_shenzhen_2:{x:-127,y:-105,s:8},trans_xianggang_0:{x:-83,y:-131,s:6},trans_xianggang_2:{x:-102,y:-131,s:7},trans_xianggang_3:{x:-127,y:-131,s:8},trans_nanjing_0:{x:-83,y:-157,s:6},trans_nanjing_1:{x:-102,y:-157,s:7},trans_nanjing_2:{x:-127,y:-157,s:8},trans_chongqing_0:{x:-83,y:-183,s:6},trans_chongqing_1:{x:-102,y:-183,s:7},trans_chongqing_2:{x:-127,y:-183,s:8},trans_wuhan_0:{x:-83,y:-209,s:6},trans_wuhan_1:{x:-102,y:-209,s:7},trans_wuhan_2:{x:-127,y:-209,s:8},trans_changchun_0:{x:-83,y:-235,s:6},trans_changchun_1:{x:-102,y:-235,s:7},trans_changchun_2:{x:-127,y:-235,s:8},trans_dalian_0:{x:-83,y:-261,s:6},trans_dalian_1:{x:-102,y:-261,s:7},trans_dalian_2:{x:-127,y:-261,s:8},gaosurukou:{x:-163,y:-131,s:10},gaosuchukou:{x:-163,y:-107,s:10},shoufeizhan:{x:-156,y:-153,s:11}};var cBD=[-5,-4,4,4],ct2BD=[-12,-6,12,6],ct3BD=[-18,-6,18,6],ct3BD=[-18,-6,18,6],ct4BD=[-24,-6,24,6],clickCityData=[{n:"全国",pt:new BMap.Point(11999571.22,4112219.88),bd:[-19,-9,15,9],lr:[3,3]},{n:"北京市",pt:new BMap.Point(12990903,4825899),bd:[-6,-4,5,6],lr:[4,4]},{n:"北京市",pt:new BMap.Point(12960183,4824235),bd:[-6,-6,6,6],lr:[5,9]},{n:"天津市",pt:new BMap.Point(13048294.34,4712296.83),bd:cBD,lr:[5,9]},{n:"石家庄市",pt:new BMap.Point(12747812.4,4559586.74),bd:cBD,lr:[5,9]},{n:"唐山市",pt:new BMap.Point(13156656.16,4785778.65),bd:cBD,lr:[7,9]},{n:"秦皇岛市",pt:new BMap.Point(13314894.28,4829754.58),bd:cBD,lr:[7,9]},{n:"邯郸市",pt:new BMap.Point(12746205.45,4360272.57),bd:cBD,lr:[7,9]},{n:"邢台市",pt:new BMap.Point(12747493.44,4423803.15),bd:cBD,lr:[8,9]},{n:"保定市",pt:new BMap.Point(12854312.8,4677428.01),bd:cBD,lr:[7,9]},{n:"张家口市",pt:new BMap.Point(12790084.63,4959101.33),bd:cBD,lr:[7,9]},{n:"承德市",pt:new BMap.Point(13130326.91,4981742.46),bd:cBD,lr:[7,9]},{n:"沧州市",pt:new BMap.Point(13007293.7,4596691.7),bd:cBD,lr:[7,9]},{n:"廊坊市",pt:new BMap.Point(12992581.76,4769905.8),bd:cBD,lr:[8,9]},{n:"衡水市",pt:new BMap.Point(12880175.93,4516789.37),bd:cBD,lr:[7,9]},{n:"太原市",pt:new BMap.Point(12529077.01,4535262.32),bd:cBD,lr:[5,9]},{n:"大同市",pt:new BMap.Point(12613364.27,4850167.42),bd:cBD,lr:[7,9]},{n:"阳泉市",pt:new BMap.Point(12644591.26,4533525.33),bd:cBD,lr:[8,9]},{n:"长治市",pt:new BMap.Point(12593102.2,4302896.69),bd:cBD,lr:[7,9]},{n:"晋城市",pt:new BMap.Point(12563460.95,4206462.32),bd:cBD,lr:[7,9]},{n:"朔州市",pt:new BMap.Point(12516827.83,4742810.65),bd:cBD,lr:[7,9]},{n:"晋中市",pt:new BMap.Point(12552283.26,4509774.55),bd:cBD,lr:[7,9]},{n:"运城市",pt:new BMap.Point(12358083.71,4143552.84),bd:cBD,lr:[7,9]},{n:"忻州市",pt:new BMap.Point(12550781.32,4612328.73),bd:cBD,lr:[7,9]},{n:"临汾市",pt:new BMap.Point(12414951.46,4288092.81),bd:cBD,lr:[7,9]},{n:"吕梁市",pt:new BMap.Point(12373354.26,4486213.29),bd:cBD,lr:[7,9]},{n:"呼和浩特市",pt:new BMap.Point(12439719.97,4961446.57),bd:cBD,lr:[5,9]},{n:"包头市",pt:new BMap.Point(12228323.64,4934673.82),bd:cBD,lr:[7,9]},{n:"乌海市",pt:new BMap.Point(11892430.44,4793517.95),bd:cBD,lr:[7,9]},{n:"赤峰市",pt:new BMap.Point(13235547.33,5171648.96),bd:cBD,lr:[7,9]},{n:"通辽市",pt:new BMap.Point(13611472.47,5377912.47),bd:cBD,lr:[7,9]},{n:"鄂尔多斯市",pt:new BMap.Point(12248410.02,4812809.03),bd:cBD,lr:[7,9]},{n:"呼伦贝尔市",pt:new BMap.Point(13333153.54,6279368.64),bd:cBD,lr:[7,9]},{n:"巴彦淖尔市",pt:new BMap.Point(11955257.08,4947259.83),bd:cBD,lr:[7,9]},{n:"乌兰察布市",pt:new BMap.Point(12594852.29,4984078.08),bd:cBD,lr:[7,9]},{n:"兴安盟",pt:new BMap.Point(13588865.67,5762892.65),bd:cBD,lr:[7,9]},{n:"锡林郭勒盟",pt:new BMap.Point(12919226.01,5426155.97),bd:cBD,lr:[7,9]},{n:"阿拉善盟",pt:new BMap.Point(11770533.41,4674264.08),bd:cBD,lr:[7,9]},{n:"沈阳市",pt:new BMap.Point(13740366.03,5103661.8),bd:cBD,lr:[5,9]},{n:"大连市",pt:new BMap.Point(13538973.73,4683025.5),bd:cBD,lr:[7,9]},{n:"鞍山市",pt:new BMap.Point(13692513.69,5000950.08),bd:cBD,lr:[7,9]},{n:"抚顺市",pt:new BMap.Point(13799388.03,5114977.65),bd:cBD,lr:[7,9]},{n:"本溪市",pt:new BMap.Point(13778643.21,5028229.05),bd:cBD,lr:[7,9]},{n:"丹东市",pt:new BMap.Point(13847313.38,4857753.87),bd:cBD,lr:[7,9]},{n:"锦州市",pt:new BMap.Point(13485599,4998700.1),bd:cBD,lr:[7,9]},{n:"营口市",pt:new BMap.Point(13608006.02,4936051.67),bd:cBD,lr:[7,9]},{n:"阜新市",pt:new BMap.Point(13545067.45,5136335.54),bd:cBD,lr:[7,9]},{n:"辽阳市",pt:new BMap.Point(13712416.85,5024584.95),bd:cBD,lr:[8,9]},{n:"盘锦市",pt:new BMap.Point(13589876.45,5002667.8),bd:cBD,lr:[7,9]},{n:"铁岭市",pt:new BMap.Point(13787274.79,5175928.41),bd:cBD,lr:[7,9]},{n:"朝阳市",pt:new BMap.Point(13409297.34,5069601.1),bd:cBD,lr:[7,9]},{n:"葫芦岛市",pt:new BMap.Point(13452253.78,4942439.12),bd:cBD,lr:[7,9]},{n:"长春市",pt:new BMap.Point(13951696.47,5407899.41),bd:cBD,lr:[5,9]},{n:"吉林市",pt:new BMap.Point(14088310.69,5411361.75),bd:cBD,lr:[7,9]},{n:"四平市",pt:new BMap.Point(13843448.11,5308670.02),bd:cBD,lr:[7,9]},{n:"辽源市",pt:new BMap.Point(13931790.56,5266534.49),bd:cBD,lr:[7,9]},{n:"通化市",pt:new BMap.Point(14020458.02,5092482.52),bd:cBD,lr:[7,9]},{n:"白山市",pt:new BMap.Point(14074316.42,5124029.48),bd:cBD,lr:[8,9]},{n:"松原市",pt:new BMap.Point(13896319.29,5614174.46),bd:cBD,lr:[7,9]},{n:"白城市",pt:new BMap.Point(13675219.01,5689684.01),bd:cBD,lr:[7,9]},{n:"延边朝鲜族自治州",pt:new BMap.Point(14417763.73,5266998.98),bd:cBD,lr:[7,9]},{n:"哈尔滨市",pt:new BMap.Point(14086501.36,5722186.15),bd:cBD,lr:[5,9]},{n:"齐齐哈尔市",pt:new BMap.Point(13795282.3,5969334.56),bd:cBD,lr:[7,9]},{n:"鸡西市",pt:new BMap.Point(14580807.82,5638827.82),bd:cBD,lr:[7,9]},{n:"鹤岗市",pt:new BMap.Point(14505601.55,5968656.02),bd:cBD,lr:[7,9]},{n:"双鸭山市",pt:new BMap.Point(14601427.65,5854241.34),bd:cBD,lr:[7,9]},{n:"大庆市",pt:new BMap.Point(13927324.91,5844873.47),bd:cBD,lr:[7,9]},{n:"伊春市",pt:new BMap.Point(14350402.78,6030712.32),bd:cBD,lr:[7,9]},{n:"佳木斯市",pt:new BMap.Point(14508059.86,5878973.81),bd:cBD,lr:[7,9]},{n:"七台河市",pt:new BMap.Point(14584081.67,5713695.85),bd:cBD,lr:[7,9]},{n:"牡丹江市",pt:new BMap.Point(14430063.01,5527661.89),bd:cBD,lr:[7,9]},{n:"黑河市",pt:new BMap.Point(14196243.34,6457183.7),bd:cBD,lr:[7,9]},{n:"绥化市",pt:new BMap.Point(14134937.47,5855417.31),bd:cBD,lr:[7,9]},{n:"大兴安岭地区",pt:new BMap.Point(13838935.81,6763930.17),bd:cBD,lr:[7,9]},{n:"上海市",pt:new BMap.Point(13523148.5,3641129.98),bd:cBD,lr:[5,9]},{n:"南京市",pt:new BMap.Point(13224398.22,3749110.08),bd:cBD,lr:[5,9]},{n:"无锡市",pt:new BMap.Point(13392933.01,3684625.08),bd:cBD,lr:[8,9]},{n:"徐州市",pt:new BMap.Point(13046582.92,4040227.55),bd:cBD,lr:[7,9]},{n:"常州市",pt:new BMap.Point(13356312.14,3716455.43),bd:cBD,lr:[7,9]},{n:"苏州市",pt:new BMap.Point(13424367.52,3650025.6),bd:cBD,lr:[7,9]},{n:"南通市",pt:new BMap.Point(13458671.66,3738891.76),bd:cBD,lr:[7,9]},{n:"连云港市",pt:new BMap.Point(13272588.31,4085285.7),bd:cBD,lr:[7,9]},{n:"淮安市",pt:new BMap.Point(13249614.18,3953528.85),bd:cBD,lr:[7,9]},{n:"盐城市",pt:new BMap.Point(13377215.62,3919501.88),bd:cBD,lr:[7,9]},{n:"扬州市",pt:new BMap.Point(13293917.59,3792837.54),bd:cBD,lr:[7,9]},{n:"镇江市",pt:new BMap.Point(13298749.33,3767384.26),bd:cBD,lr:[8,9]},{n:"泰州市",pt:new BMap.Point(13350640.59,3800783.56),bd:cBD,lr:[8,9]},{n:"宿迁市",pt:new BMap.Point(13167237.96,4000367.15),bd:cBD,lr:[7,9]},{n:"杭州市",pt:new BMap.Point(13380521.4,3509725.46),bd:cBD,lr:[5,9]},{n:"宁波市",pt:new BMap.Point(13531717.19,3466700.47),bd:cBD,lr:[7,9]},{n:"温州市",pt:new BMap.Point(13437056.61,3228862.38),bd:cBD,lr:[7,9]},{n:"嘉兴市",pt:new BMap.Point(13442516.01,3578433.26),bd:cBD,lr:[7,9]},{n:"湖州市",pt:new BMap.Point(13368882.17,3597591.37),bd:cBD,lr:[7,9]},{n:"绍兴市",pt:new BMap.Point(13423534.39,3483350.89),bd:cBD,lr:[7,9]},{n:"金华市",pt:new BMap.Point(13319962.71,3365440.15),bd:cBD,lr:[7,9]},{n:"衢州市",pt:new BMap.Point(13233814.51,3347380.57),bd:cBD,lr:[7,9]},{n:"舟山市",pt:new BMap.Point(13604984.13,3480848.35),bd:cBD,lr:[7,9]},{n:"台州市",pt:new BMap.Point(13517355.59,3311823.54),bd:cBD,lr:[7,9]},{n:"丽水市",pt:new BMap.Point(13350634.45,3288178.9),bd:cBD,lr:[7,9]},{n:"合肥市",pt:new BMap.Point(13050460.54,3720544.86),bd:cBD,lr:[5,9]},{n:"芜湖市",pt:new BMap.Point(13179464.98,3655185.37),bd:cBD,lr:[7,9]},{n:"蚌埠市",pt:new BMap.Point(13068493.69,3861457.33),bd:cBD,lr:[7,9]},{n:"淮南市",pt:new BMap.Point(13025559.53,3823189.84),bd:cBD,lr:[7,9]},{n:"马鞍山市",pt:new BMap.Point(13192758.45,3701721.87),bd:cBD,lr:[7,9]},{n:"淮北市",pt:new BMap.Point(13002797.48,3999425.85),bd:cBD,lr:[8,9]},{n:"铜陵市",pt:new BMap.Point(13116556.18,3603277.27),bd:cBD,lr:[8,9]},{n:"安庆市",pt:new BMap.Point(13031623.75,3550019.08),bd:cBD,lr:[7,9]},{n:"黄山市",pt:new BMap.Point(13174278.86,3446439.23),bd:cBD,lr:[7,9]},{n:"滁州市",pt:new BMap.Point(13171837.94,3780786.48),bd:cBD,lr:[7,9]},{n:"阜阳市",pt:new BMap.Point(12893215.16,3858085.78),bd:cBD,lr:[7,9]},{n:"宿州市",pt:new BMap.Point(13021231.7,3958276.71),bd:cBD,lr:[7,9]},{n:"巢湖市",pt:new BMap.Point(13123851.59,3691564.79),bd:cBD,lr:[8,9]},{n:"六安市",pt:new BMap.Point(12970198.74,3707970.37),bd:cBD,lr:[7,9]},{n:"亳州市",pt:new BMap.Point(12889497.48,3985791.77),bd:cBD,lr:[8,9]},{n:"池州市",pt:new BMap.Point(13079874.8,3567450.98),bd:cBD,lr:[8,9]},{n:"宣城市",pt:new BMap.Point(13221018.86,3603632.56),bd:cBD,lr:[7,9]},{n:"福州市",pt:new BMap.Point(13280713.93,2989935.97),bd:cBD,lr:[5,9]},{n:"厦门市",pt:new BMap.Point(13146513.06,2794855.77),bd:cBD,lr:[7,9]},{n:"莆田市",pt:new BMap.Point(13248738.85,2913804.66),bd:cBD,lr:[7,9]},{n:"三明市",pt:new BMap.Point(13096399.79,3013435.8),bd:cBD,lr:[7,9]},{n:"泉州市",pt:new BMap.Point(13201910.12,2846954.45),bd:cBD,lr:[8,9]},{n:"漳州市",pt:new BMap.Point(13097299.4,2798905.67),bd:cBD,lr:[7,9]},{n:"南平市",pt:new BMap.Point(13156351.9,3060177),bd:cBD,lr:[7,9]},{n:"龙岩市",pt:new BMap.Point(13029047.54,2870546.66),bd:cBD,lr:[7,9]},{n:"宁德市",pt:new BMap.Point(13306472.99,3063294.93),bd:cBD,lr:[7,9]},{n:"南昌市",pt:new BMap.Point(12910017.55,3308071.83),bd:cBD,lr:[5,9]},{n:"景德镇市",pt:new BMap.Point(13045488.05,3394401.41),bd:cBD,lr:[7,9]},{n:"萍乡市",pt:new BMap.Point(12675159.81,3182197.09),bd:cBD,lr:[8,9]},{n:"九江市",pt:new BMap.Point(12914084.97,3445118.73),bd:cBD,lr:[7,9]},{n:"新余市",pt:new BMap.Point(12793320.28,3206680.44),bd:cBD,lr:[8,9]},{n:"鹰潭市",pt:new BMap.Point(13032952.25,3262112.41),bd:cBD,lr:[8,9]},{n:"赣州市",pt:new BMap.Point(12795185.35,2959890.57),bd:cBD,lr:[7,9]},{n:"吉安市",pt:new BMap.Point(12801884.97,3118790.33),bd:cBD,lr:[7,9]},{n:"宜春市",pt:new BMap.Point(12736934.92,3206538.71),bd:cBD,lr:[7,9]},{n:"抚州市",pt:new BMap.Point(12953213,3222556.21),bd:cBD,lr:[7,9]},{n:"上饶市",pt:new BMap.Point(13133880.04,3285299.92),bd:cBD,lr:[7,9]},{n:"济南市",pt:new BMap.Point(13024581.37,4367507.59),bd:cBD,lr:[5,9]},{n:"青岛市",pt:new BMap.Point(13401831.29,4285182.82),bd:cBD,lr:[7,9]},{n:"淄博市",pt:new BMap.Point(13142686.3,4388052.83),bd:cBD,lr:[7,9]},{n:"枣庄市",pt:new BMap.Point(13061274.78,4114277.91),bd:cBD,lr:[7,9]},{n:"东营市",pt:new BMap.Point(13211656.35,4474393.79),bd:cBD,lr:[7,9]},{n:"烟台市",pt:new BMap.Point(13520352.99,4478575.49),bd:cBD,lr:[7,9]},{n:"潍坊市",pt:new BMap.Point(13265878.88,4373424.04),bd:cBD,lr:[7,9]},{n:"济宁市",pt:new BMap.Point(12979324.04,4196136.66),bd:cBD,lr:[7,9]},{n:"泰安市",pt:new BMap.Point(13034988.61,4303535.5),bd:cBD,lr:[7,9]},{n:"威海市",pt:new BMap.Point(13595631.29,4485000.06),bd:cBD,lr:[7,9]},{n:"日照市",pt:new BMap.Point(13307109.51,4195766.38),bd:cBD,lr:[7,9]},{n:"莱芜市",pt:new BMap.Point(13100456.67,4305551.29),bd:cBD,lr:[8,9]},{n:"临沂市",pt:new BMap.Point(13175462.45,4147217.21),bd:cBD,lr:[7,9]},{n:"德州市",pt:new BMap.Point(12947622.04,4476813.41),bd:cBD,lr:[7,9]},{n:"聊城市",pt:new BMap.Point(12912310.75,4338690.92),bd:cBD,lr:[7,9]},{n:"滨州市",pt:new BMap.Point(13134584.6,4466450.28),bd:cBD,lr:[8,9]},{n:"菏泽市",pt:new BMap.Point(12856033.48,4171820.25),bd:cBD,lr:[7,9]},{n:"郑州市",pt:new BMap.Point(12648663.61,4105852.45),bd:cBD,lr:[5,9]},{n:"开封市",pt:new BMap.Point(12725500.83,4112517.32),bd:cBD,lr:[7,9]},{n:"洛阳市",pt:new BMap.Point(12519082.39,4088441.36),bd:cBD,lr:[7,9]},{n:"平顶山市",pt:new BMap.Point(12614390.72,3969016.16),bd:cBD,lr:[7,9]},{n:"安阳市",pt:new BMap.Point(12735043.36,4289478.97),bd:cBD,lr:[7,9]},{n:"鹤壁市",pt:new BMap.Point(12711802.8,4262428.36),bd:cBD,lr:[8,9]},{n:"新乡市",pt:new BMap.Point(12683052.11,4179998.27),bd:cBD,lr:[7,9]},{n:"焦作市",pt:new BMap.Point(12606908.19,4169148.29),bd:cBD,lr:[8,9]},{n:"濮阳市",pt:new BMap.Point(12806228.38,4243123.16),bd:cBD,lr:[8,9]},{n:"许昌市",pt:new BMap.Point(12674841.33,4010264.96),bd:cBD,lr:[8,9]},{n:"漯河市",pt:new BMap.Point(12693143.11,3949716.47),bd:cBD,lr:[8,9]},{n:"三门峡市",pt:new BMap.Point(12379841.12,4110225.01),bd:cBD,lr:[7,9]},{n:"南阳市",pt:new BMap.Point(12527475.32,3871404.82),bd:cBD,lr:[7,9]},{n:"商丘市",pt:new BMap.Point(12875114.84,4065382.71),bd:cBD,lr:[7,9]},{n:"信阳市",pt:new BMap.Point(12698935.02,3757290.11),bd:cBD,lr:[7,9]},{n:"周口市",pt:new BMap.Point(12764020.8,3955188.99),bd:cBD,lr:[7,9]},{n:"驻马店市",pt:new BMap.Point(12695259.9,3870201.61),bd:cBD,lr:[7,9]},{n:"武汉市",pt:new BMap.Point(12724558.82,3558883.15),bd:cBD,lr:[5,9]},{n:"黄石市",pt:new BMap.Point(12806831.16,3508246.06),bd:cBD,lr:[8,9]},{n:"十堰市",pt:new BMap.Point(12333819.83,3826557.97),bd:cBD,lr:[7,9]},{n:"宜昌市",pt:new BMap.Point(12389264.78,3571550.15),bd:cBD,lr:[7,9]},{n:"襄樊市",pt:new BMap.Point(12485804.42,3744176.48),bd:cBD,lr:[7,9]},{n:"荆门市",pt:new BMap.Point(12490831.2,3615936.83),bd:cBD,lr:[7,9]},{n:"孝感市",pt:new BMap.Point(12681976.45,3601581.31),bd:cBD,lr:[8,9]},{n:"荆州市",pt:new BMap.Point(12495313.2,3525594.67),bd:cBD,lr:[7,9]},{n:"黄冈市",pt:new BMap.Point(12788727.31,3541014.86),bd:cBD,lr:[7,9]},{n:"咸宁市",pt:new BMap.Point(12727136.79,3462404.52),bd:cBD,lr:[7,9]},{n:"随州市",pt:new BMap.Point(12622531.73,3700874.41),bd:cBD,lr:[7,9]},{n:"恩施土家族苗族自治州",pt:new BMap.Point(12189032.67,3517579.64),bd:cBD,lr:[7,9]},{n:"仙桃市",pt:new BMap.Point(12630567.86,3529164.83),bd:cBD,lr:[9,9]},{n:"潜江市",pt:new BMap.Point(12568735.44,3534321.2),bd:cBD,lr:[9,9]},{n:"天门市",pt:new BMap.Point(12598443.93,3567930.91),bd:cBD,lr:[9,9]},{n:"神农架林区",pt:new BMap.Point(12321205.2,3707164.42),bd:cBD,lr:[9,9]},{n:"长沙市",pt:new BMap.Point(12572347.48,3258455.64),bd:cBD,lr:[5,9]},{n:"株洲市",pt:new BMap.Point(12594927.63,3207920.8),bd:cBD,lr:[7,9]},{n:"湘潭市",pt:new BMap.Point(12573615.87,3208214.06),bd:cBD,lr:[7,9]},{n:"衡阳市",pt:new BMap.Point(12532300.4,3091412.15),bd:cBD,lr:[7,9]},{n:"邵阳市",pt:new BMap.Point(12409390.43,3134535.06),bd:cBD,lr:[7,9]},{n:"岳阳市",pt:new BMap.Point(12594102,3400788.63),bd:cBD,lr:[7,9]},{n:"常德市",pt:new BMap.Point(12435079.12,3359523.26),bd:cBD,lr:[7,9]},{n:"张家界市",pt:new BMap.Point(12299442.66,3370126.24),bd:cBD,lr:[7,9]},{n:"益阳市",pt:new BMap.Point(12508177.66,3299123.14),bd:cBD,lr:[7,9]},{n:"郴州市",pt:new BMap.Point(12581582.51,2952694.08),bd:cBD,lr:[7,9]},{n:"永州市",pt:new BMap.Point(12425662.51,3032983.5),bd:cBD,lr:[7,9]},{n:"怀化市",pt:new BMap.Point(12245712.5,3174098.87),bd:cBD,lr:[7,9]},{n:"娄底市",pt:new BMap.Point(12468037.65,3191557.89),bd:cBD,lr:[8,9]},{n:"湘西土家族苗族自治州",pt:new BMap.Point(12216983.61,3268959.39),bd:cBD,lr:[7,9]},{n:"广州市",pt:new BMap.Point(12609307.83,2631271.83),bd:cBD,lr:[5,9]},{n:"韶关市",pt:new BMap.Point(12646446.31,2835068.76),bd:cBD,lr:[7,9]},{n:"深圳市",pt:new BMap.Point(12689198.96,2569212.32),bd:cBD,lr:[8,9]},{n:"汕头市",pt:new BMap.Point(12989836.15,2658196.76),bd:cBD,lr:[7,9]},{n:"佛山市",pt:new BMap.Point(12593519.42,2618810.41),bd:cBD,lr:[8,9]},{n:"江门市",pt:new BMap.Point(12589077.06,2565305.02),bd:cBD,lr:[7,9]},{n:"湛江市",pt:new BMap.Point(12286019.39,2409244.55),bd:cBD,lr:[7,9]},{n:"茂名市",pt:new BMap.Point(12348999.61,2455913.03),bd:cBD,lr:[7,9]},{n:"肇庆市",pt:new BMap.Point(12520445.64,2621563.68),bd:cBD,lr:[7,9]},{n:"惠州市",pt:new BMap.Point(12737692.87,2629228.47),bd:cBD,lr:[8,9]},{n:"梅州市",pt:new BMap.Point(12927552.25,2771587.26),bd:cBD,lr:[7,9]},{n:"汕尾市",pt:new BMap.Point(12844409.79,2590115.95),bd:cBD,lr:[7,9]},{n:"河源市",pt:new BMap.Point(12769271.56,2705584.51),bd:cBD,lr:[7,9]},{n:"阳江市",pt:new BMap.Point(12466694.44,2479195.46),bd:cBD,lr:[7,9]},{n:"清远市",pt:new BMap.Point(12586213.67,2698112.83),bd:cBD,lr:[7,9]},{n:"东莞市",pt:new BMap.Point(12663617.76,2618331.04),bd:cBD,lr:[7,9]},{n:"中山市",pt:new BMap.Point(12623653.08,2557824.08),bd:cBD,lr:[8,9]},{n:"潮州市",pt:new BMap.Point(12983266.14,2695080.32),bd:cBD,lr:[8,9]},{n:"揭阳市",pt:new BMap.Point(12955409.7,2682130.11),bd:cBD,lr:[8,9]},{n:"云浮市",pt:new BMap.Point(12473607.14,2605655.19),bd:cBD,lr:[7,9]},{n:"南宁市",pt:new BMap.Point(12063576.78,2594028.7),bd:cBD,lr:[5,9]},{n:"柳州市",pt:new BMap.Point(12180922.28,2776089.56),bd:cBD,lr:[7,9]},{n:"桂林市",pt:new BMap.Point(12278276.01,2891719.35),bd:cBD,lr:[7,9]},{n:"梧州市",pt:new BMap.Point(12388367.17,2673421.13),bd:cBD,lr:[7,9]},{n:"北海市",pt:new BMap.Point(12148034.92,2434259.23),bd:cBD,lr:[7,9]},{n:"防城港市",pt:new BMap.Point(12062758.24,2458819.91),bd:cBD,lr:[7,9]},{n:"钦州市",pt:new BMap.Point(12096184.74,2493766.85),bd:cBD,lr:[8,9]},{n:"贵港市",pt:new BMap.Point(12201118.42,2628719.18),bd:cBD,lr:[8,9]},{n:"玉林市",pt:new BMap.Point(12264309.72,2572247.58),bd:cBD,lr:[7,9]},{n:"百色市",pt:new BMap.Point(11869501.63,2724850.41),bd:cBD,lr:[7,9]},{n:"贺州市",pt:new BMap.Point(12420506.04,2785419.69),bd:cBD,lr:[7,9]},{n:"河池市",pt:new BMap.Point(12032932.45,2820780.9),bd:cBD,lr:[7,9]},{n:"来宾市",pt:new BMap.Point(12159496.06,2706113.22),bd:cBD,lr:[7,9]},{n:"崇左市",pt:new BMap.Point(11952831.16,2541092.75),bd:cBD,lr:[7,9]},{n:"海口市",pt:new BMap.Point(12283403.23,2262634.65),bd:cBD,lr:[5,9]},{n:"三亚市",pt:new BMap.Point(12191593.61,2054280.47),bd:cBD,lr:[7,9]},{n:"五指山市",pt:new BMap.Point(12192203.4,2115118.31),bd:cBD,lr:[9,9]},{n:"琼海市",pt:new BMap.Point(12298839.41,2171833.78),bd:cBD,lr:[9,9]},{n:"儋州市",pt:new BMap.Point(12199334.74,2202719.22),bd:cBD,lr:[9,9]},{n:"文昌市",pt:new BMap.Point(12334754.47,2205345.6),bd:cBD,lr:[9,9]},{n:"万宁市",pt:new BMap.Point(12289688.86,2117494.22),bd:cBD,lr:[9,9]},{n:"东方市",pt:new BMap.Point(12094938.19,2153087.07),bd:cBD,lr:[9,9]},{n:"定安县",pt:new BMap.Point(12281881.48,2223659.92),bd:cBD,lr:[9,9]},{n:"屯昌县",pt:new BMap.Point(12257508.59,2183877.5),bd:cBD,lr:[9,9]},{n:"澄迈县",pt:new BMap.Point(12246793.54,2228213.81),bd:cBD,lr:[9,9]},{n:"临高县",pt:new BMap.Point(11635683.84,3284342.89),bd:cBD,lr:[9,9]},{n:"白沙黎族自治县",pt:new BMap.Point(14272157.15,5044605.41),bd:cBD,lr:[9,9]},{n:"昌江黎族自治县",pt:new BMap.Point(14272157.15,5044605.41),bd:cBD,lr:[9,9]},{n:"乐东黎族自治县",pt:new BMap.Point(14272157.15,5044605.41),bd:cBD,lr:[9,9]},{n:"陵水黎族自治县",pt:new BMap.Point(14272157.15,5044605.41),bd:cBD,lr:[9,9]},{n:"保亭黎族苗族自治县",pt:new BMap.Point(14272157.15,5044605.41),bd:cBD,lr:[9,9]},{n:"琼中黎族苗族自治县",pt:new BMap.Point(14272157.15,5044605.41),bd:cBD,lr:[9,9]},{n:"重庆市",pt:new BMap.Point(11849846.38,3437582.53),bd:cBD,lr:[5,9]},{n:"成都市",pt:new BMap.Point(11585248.88,3567151.84),bd:cBD,lr:[5,9]},{n:"自贡市",pt:new BMap.Point(11664710.81,3398518.18),bd:cBD,lr:[8,9]},{n:"攀枝花市",pt:new BMap.Point(11323995.44,3052819.58),bd:cBD,lr:[7,9]},{n:"泸州市",pt:new BMap.Point(11738662.93,3339244.88),bd:cBD,lr:[7,9]},{n:"德阳市",pt:new BMap.Point(11622326.81,3627742.01),bd:cBD,lr:[7,9]},{n:"绵阳市",pt:new BMap.Point(11653709.54,3671830.29),bd:cBD,lr:[7,9]},{n:"广元市",pt:new BMap.Point(11783301.89,3798266.61),bd:cBD,lr:[7,9]},{n:"遂宁市",pt:new BMap.Point(11752615.68,3550145.61),bd:cBD,lr:[7,9]},{n:"内江市",pt:new BMap.Point(11695933.16,3429168.69),bd:cBD,lr:[7,9]},{n:"乐山市",pt:new BMap.Point(11551959.65,3425604.02),bd:cBD,lr:[7,9]},{n:"南充市",pt:new BMap.Point(11813039.76,3590300.79),bd:cBD,lr:[7,9]},{n:"眉山市",pt:new BMap.Point(11561215.96,3492381.09),bd:cBD,lr:[8,9]},{n:"宜宾市",pt:new BMap.Point(11649686.4,3324145.29),bd:cBD,lr:[7,9]},{n:"广安市",pt:new BMap.Point(11871206.28,3541167.9),bd:cBD,lr:[7,9]},{n:"达州市",pt:new BMap.Point(11964624.16,3639026.15),bd:cBD,lr:[7,9]},{n:"雅安市",pt:new BMap.Point(11468234.33,3480224.33),bd:cBD,lr:[7,9]},{n:"巴中市",pt:new BMap.Point(11883640.69,3723597.18),bd:cBD,lr:[7,9]},{n:"资阳市",pt:new BMap.Point(11648045.68,3499522.66),bd:cBD,lr:[8,9]},{n:"阿坝藏族羌族自治州",pt:new BMap.Point(11380507.4,3728228.76),bd:cBD,lr:[7,9]},{n:"甘孜藏族自治州",pt:new BMap.Point(11351325.58,3489245.11),bd:cBD,lr:[7,9]},{n:"凉山彝族自治州",pt:new BMap.Point(11385246.65,3214579.77),bd:cBD,lr:[7,9]},{n:"贵阳市",pt:new BMap.Point(11870519.66,3060500.8),bd:cBD,lr:[5,9]},{n:"六盘水市",pt:new BMap.Point(11670589.44,3054081.9),bd:cBD,lr:[7,9]},{n:"遵义市",pt:new BMap.Point(11903921.55,3195127.87),bd:cBD,lr:[7,9]},{n:"安顺市",pt:new BMap.Point(11794868.99,3012140.6),bd:cBD,lr:[7,9]},{n:"铜仁地区",pt:new BMap.Point(12152507.78,3190837.66),bd:cBD,lr:[7,9]},{n:"黔西南布依族苗族自治州",pt:new BMap.Point(11679001.08,2869017.96),bd:cBD,lr:[7,9]},{n:"毕节地区",pt:new BMap.Point(11721031.41,3142281.31),bd:cBD,lr:[7,9]},{n:"黔东南苗族侗族自治州",pt:new BMap.Point(12020550.46,3053190.16),bd:cBD,lr:[7,9]},{n:"黔南布依族苗族自治州",pt:new BMap.Point(11970164.71,3012312.19),bd:cBD,lr:[7,9]},{n:"昆明市",pt:new BMap.Point(11435436.7,2863224.69),bd:cBD,lr:[5,9]},{n:"曲靖市",pt:new BMap.Point(11555382.53,2918266.01),bd:cBD,lr:[7,9]},{n:"玉溪市",pt:new BMap.Point(11416286.45,2779261.88),bd:cBD,lr:[7,9]},{n:"保山市",pt:new BMap.Point(11039628.37,2872619.83),bd:cBD,lr:[7,9]},{n:"昭通市",pt:new BMap.Point(11546391.16,3146685.98),bd:cBD,lr:[7,9]},{n:"丽江市",pt:new BMap.Point(11158367.61,3089380.29),bd:cBD,lr:[7,9]},{n:"临沧市",pt:new BMap.Point(11141635.22,2721813.79),bd:cBD,lr:[7,9]},{n:"楚雄彝族自治州",pt:new BMap.Point(11302890.47,2863837.49),bd:cBD,lr:[7,9]},{n:"红河哈尼族彝族自治州",pt:new BMap.Point(11380507.4,3740772.75),bd:cBD,lr:[7,9]},{n:"文山壮族苗族自治州",pt:new BMap.Point(11606070.41,2660260.24),bd:cBD,lr:[7,9]},{n:"普洱市",pt:new BMap.Point(11240810.51,2589692.16),bd:cBD,lr:[8,9]},{n:"西双版纳傣族自治州",pt:new BMap.Point(11221584.75,2496986.94),bd:cBD,lr:[7,9]},{n:"大理白族自治州",pt:new BMap.Point(11162593.44,2932487.29),bd:cBD,lr:[7,9]},{n:"德宏傣族景颇族自治州",pt:new BMap.Point(10975263.62,2789037.62),bd:cBD,lr:[7,9]},{n:"怒江傈僳族自治州",pt:new BMap.Point(11005077.24,2963098.98),bd:cBD,lr:[7,9]},{n:"迪庆藏族自治州",pt:new BMap.Point(11099724.07,3206846.47),bd:cBD,lr:[7,9]},{n:"拉萨市",pt:new BMap.Point(10143520,3437204.04),bd:cBD,lr:[5,9]},{n:"昌都地区",pt:new BMap.Point(10818609.6,3629569.73),bd:cBD,lr:[7,9]},{n:"山南地区",pt:new BMap.Point(10217255.03,3384053.82),bd:cBD,lr:[7,9]},{n:"日喀则地区",pt:new BMap.Point(9895060.53,3389319.88),bd:cBD,lr:[7,9]},{n:"那曲地区",pt:new BMap.Point(10248989.14,3672743.64),bd:cBD,lr:[7,9]},{n:"阿里地区",pt:new BMap.Point(9033914.88,3534099.27),bd:cBD,lr:[7,9]},{n:"林芝地区",pt:new BMap.Point(10504953.82,3440916.27),bd:cBD,lr:[7,9]},{n:"西安市",pt:new BMap.Point(12126852.48,4041048.13),bd:cBD,lr:[5,9]},{n:"铜川市",pt:new BMap.Point(12128561.49,4126022.53),bd:cBD,lr:[7,9]},{n:"宝鸡市",pt:new BMap.Point(11927681.36,4054988.15),bd:cBD,lr:[7,9]},{n:"咸阳市",pt:new BMap.Point(12102356.68,4049604.29),bd:cBD,lr:[8,9]},{n:"渭南市",pt:new BMap.Point(12191495.18,4072416.28),bd:cBD,lr:[7,9]},{n:"延安市",pt:new BMap.Point(12189211.44,4356570.08),bd:cBD,lr:[7,9]},{n:"汉中市",pt:new BMap.Point(11914639.81,3881566.87),bd:cBD,lr:[7,9]},{n:"榆林市",pt:new BMap.Point(12216464.44,4593874.99),bd:cBD,lr:[7,9]},{n:"安康市",pt:new BMap.Point(12137752.12,3831579.1),bd:cBD,lr:[7,9]},{n:"商洛市",pt:new BMap.Point(12238758.85,3988163.54),bd:cBD,lr:[7,9]},{n:"兰州市",pt:new BMap.Point(11559160.65,4284481.62),bd:cBD,lr:[5,9]},{n:"嘉峪关市",pt:new BMap.Point(10942391.53,4806166.82),bd:cBD,lr:[8,9]},{n:"金昌市",pt:new BMap.Point(11376333.55,4627477.91),bd:cBD,lr:[7,9]},{n:"白银市",pt:new BMap.Point(11593403,4350996.94),bd:cBD,lr:[7,9]},{n:"天水市",pt:new BMap.Point(11770106.49,4083646.7),bd:cBD,lr:[7,9]},{n:"武威市",pt:new BMap.Point(11426447.1,4544105.57),bd:cBD,lr:[7,9]},{n:"张掖市",pt:new BMap.Point(11182855.71,4684858.01),bd:cBD,lr:[7,9]},{n:"平凉市",pt:new BMap.Point(11874734.04,4213583.82),bd:cBD,lr:[7,9]},{n:"酒泉市",pt:new BMap.Point(10965135.56,4801282.37),bd:cBD,lr:[7,9]},{n:"庆阳市",pt:new BMap.Point(11982494.48,4240364.21),bd:cBD,lr:[7,9]},{n:"定西市",pt:new BMap.Point(11647778.93,4218809.12),bd:cBD,lr:[7,9]},{n:"陇南市",pt:new BMap.Point(11680753.14,3925419.77),bd:cBD,lr:[7,9]},{n:"临夏回族自治州",pt:new BMap.Point(11490235.88,4221664.83),bd:cBD,lr:[7,9]},{n:"甘南藏族自治州",pt:new BMap.Point(11456970.69,4137705.18),bd:cBD,lr:[7,9]},{n:"西宁市",pt:new BMap.Point(11330424.55,4360836.12),bd:cBD,lr:[5,9]},{n:"海东地区",pt:new BMap.Point(11367724.54,4345818.22),bd:cBD,lr:[7,9]},{n:"海北藏族自治州",pt:new BMap.Point(11233079.71,4407698.25),bd:cBD,lr:[7,9]},{n:"黄南藏族自治州",pt:new BMap.Point(11367018.69,4210804.21),bd:cBD,lr:[7,9]},{n:"海南藏族自治州",pt:new BMap.Point(11201876.52,4315364.9),bd:cBD,lr:[7,9]},{n:"果洛藏族自治州",pt:new BMap.Point(11160063.36,4068657.46),bd:cBD,lr:[7,9]},{n:"玉树藏族自治州",pt:new BMap.Point(10800746.97,3875570.18),bd:cBD,lr:[7,9]},{n:"海西蒙古族藏族自治州",pt:new BMap.Point(10816936.01,4468024.21),bd:cBD,lr:[7,9]},{n:"银川市",pt:new BMap.Point(11832898.83,4616373.5),bd:cBD,lr:[5,9]},{n:"石嘴山市",pt:new BMap.Point(11841711.18,4698078.16),bd:cBD,lr:[7,9]},{n:"吴忠市",pt:new BMap.Point(11822829.87,4553415.21),bd:cBD,lr:[7,9]},{n:"固原市",pt:new BMap.Point(11827731.54,4278231.51),bd:cBD,lr:[8,9]},{n:"中卫市",pt:new BMap.Point(11708737.7,4485946.9),bd:cBD,lr:[7,9]},{n:"乌鲁木齐市",pt:new BMap.Point(9753667.88,5409369.63),bd:cBD,lr:[5,9]},{n:"克拉玛依市",pt:new BMap.Point(9450655.5,5683311.14),bd:cBD,lr:[7,9]},{n:"吐鲁番地区",pt:new BMap.Point(9929119.54,5277242.75),bd:cBD,lr:[7,9]},{n:"哈密地区",pt:new BMap.Point(10410950.95,5256019.72),bd:cBD,lr:[7,9]},{n:"昌吉回族自治州",pt:new BMap.Point(9719944.71,5438088.99),bd:cBD,lr:[7,9]},{n:"博尔塔拉蒙古自治州",pt:new BMap.Point(9137172.41,5576651.41),bd:cBD,lr:[7,9]},{n:"巴音郭楞蒙古自治州",pt:new BMap.Point(9590451.71,5097890.07),bd:cBD,lr:[7,9]},{n:"阿克苏地区",pt:new BMap.Point(8935351.95,5009761.4),bd:cBD,lr:[7,9]},{n:"喀什地区",pt:new BMap.Point(8459954.24,4762722.83),bd:cBD,lr:[7,9]},{n:"和田地区",pt:new BMap.Point(8898707.07,4429816.8),bd:cBD,lr:[7,9]},{n:"伊犁哈萨克自治州",pt:new BMap.Point(9054161.44,5423973.33),bd:cBD,lr:[7,9]},{n:"塔城地区",pt:new BMap.Point(9238596.44,5870707.55),bd:cBD,lr:[7,9]},{n:"阿勒泰地区",pt:new BMap.Point(9812358.95,6050881.84),bd:cBD,lr:[7,9]},{n:"石河子市",pt:new BMap.Point(9583272.07,5483579.8),bd:cBD,lr:[9,9]},{n:"阿拉尔市",pt:new BMap.Point(9049687.77,4918103.23),bd:cBD,lr:[9,9]},{n:"图木舒克市",pt:new BMap.Point(8802730.81,4819584.88),bd:cBD,lr:[9,9]},{n:"五家渠市",pt:new BMap.Point(9746120.75,5462086.91),bd:cBD,lr:[9,9]},{n:"香港特别行政区",pt:new BMap.Point(12714333.69,2538103.92),bd:cBD,lr:[5,9]},{n:"澳门特别行政区",pt:new BMap.Point(12642583.48,2514883.38),bd:cBD,lr:[5,9]}];(function(){var b=function(f){return document.createElement(f)};var c=function(j){if(!j){return[]}if(j&&j.length=="undefiend"){return[j]}var h=[];for(var g=0,f=j.length;g<f;g++){h.push(j[g])}return h};var d=function(){var g=c(arguments),h=g.shift(),f=g.shift();return function(){return f.apply(h,g.concat(c(arguments)))}};function a(f){this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new BMap.Size(10,61);this._zIndex=2001;this._delay=null;this._status=0;f=f?f:{};this._config={enableHighAccuracy:f.enableHighAccuracy?true:false,timeout:f.timeout?parseInt(f.timeout,10):5000,accuracy:f.accuracy?parseInt(f.accuracy,10):1000,tipout:f.tipout?parseInt(f.tipout,10):2000};changeNavCtrlForGeoLoc()}a.prototype=new BMap.Control();a.prototype.initialize=function(i){var k=this;var h=this.elGeoLoc=b("div"),j=this.elBtnUninit=b("div"),g=this.elBtnLoading=b("div"),f=this.elGeoTip=b("span");j.className="BMap_geoBtn BMap_geoBtn_nit";j.title="显示当前我的位置";j.style.zIndex=2001;g.className="BMap_geoBtn BMap_geoBtn_ing";g.style.zIndex=2000;h.className="BMap_geoLoc";f.className="BMap_geoLoc_Tip";f.innerHTML="抱歉，定位失败";h.appendChild(g);h.appendChild(j);if(window.stdMapCtrl){stdMapCtrl.addEventListener("domready",function(){stdMapCtrl.getDom().appendChild(h);stdMapCtrl.removeEventListener("domready",arguments.callee)});i.getContainer().appendChild(f);h.onmouseover=function(){window.stdMapCtrl._hideLevelHint()}}else{return}this._build();return h};a.prototype._build=function(){var j=this;var h={enableHighAccuracy:this._config.enableHighAccuracy,timeout:this._config.timeout};var g=function(k){j.success.call(j,k)};var i=function(k){j.error.call(j,k)};var f=function(){switch(j._status){case 0:navigator.geolocation.getCurrentPosition(g,i,h);j._reset(j.elBtnLoading,2);break;case -1:case 1:map.removeOverlay(j._geoMark);map.removeOverlay(j._geoOval);j._geoMark.dispose();j._geoOval.dispose();j._reset(j.elBtnUninit,0);break;default:return}};T.on(j.elGeoLoc,"click",f)};a.prototype.success=function(f){window.GRControll.setGRequestFlg(2000);var l=f.coords.accuracy;if(l<=this._config.accuracy){var j=map.lnglatToMercator(f.coords.longitude+0.0065,f.coords.latitude+0.006);var k=new BMap.Point(j[0],j[1]);var m=this._geoMark=addRangeSearchCenterPoi(k,"当前位置",true,3500000);m.domElement.setAttribute("type","system");m.siblingElement.setAttribute("type","system");var i=this._geoOval=new BMap.Circle(k,l.toString(),{strokeColor:"#4970DE",fillColor:"#4673cc",strokeWeight:1,strokeOpacity:0.3,fillOpacity:0.3});map.addOverlay(i);i.addEventListener("domready",function(){i.getDom().setAttribute("type","system")});var h;MC.addCallback(function(){h=createSearchInfoWnd({title:"当前位置",poiType:0},{x:k.lng,y:k.lat,tabIndex:0,statCode:"",geoloc:true});MC.removeCallback(arguments.callee)});var g=map.getViewport(i.getPoints());map.centerAndZoom(g.center,g.zoom-1);this._markHandle=function(n){openSearchInfoWnd(h,m)};m.addEventListener("click",this._markHandle);this._reset(this.elBtnUninit,1)}else{this.error()}};a.prototype.error=function(f){this._reset(this.elBtnUninit,-1);this._bindHandle=d(this,this._regain);this._delay=setTimeout(this._bindHandle,this._config.tipout);T.on(map.getContainer(),"mousedown",this._bindHandle);map.addEventListener("zoomstart",this._bindHandle)};a.prototype._regain=function(){this._reset(this.elBtnUninit,0);T.un(map.getContainer(),"mousedown",this._bindHandle);map.removeEventListener("zoomstart",this._bindHandle);if(this._delay){window.clearTimeout(this._delay);this._delay=null}};a.prototype._reset=function(g,f){g.style.zIndex=this._zIndex=(++this._zIndex);this._status=f;if(g.className!="BMap_geoBtn BMap_geoBtn_ing"){g.style.backgroundPosition=f==0?"0 0":f==1?"0 -18px":"0 -36px";g.title=f==0?"显示当前我的位置":f==1?"取消定位":""}if(f==-1&&this.elGeoTip.style.display!="block"){this.elGeoTip.style.display="block"}else{if(f==2||f==1||f==0){this.elGeoTip.style.display="none"}}};window.GeoLocControl=a})();function MgrSign(){T.lang.Class.call(this);_gl.oSign=this;this.tabDom=null;this.tabIndex=null;this.followInfo={point:"点击左键标记位置，右键或Esc退出",polyline:"",remark:"可点击想要标记的位置"};this.temp={signType:null,event:{}};return""}T.inherits(MgrSign,T.lang.Class);T.extend(MgrSign.prototype,{render:function(b,a){var c=this;closeMeasure();endCaptureMap();if(_sign.userTagPanl){if(_sign.userTagPanl.isVisible()){c.exituserSign()}else{_sign.userTagPanl.show();c.refreshTab();T.ac(T.g("signwrap"),"span_focus")}return}if(!_sign.userTagPanl){_sign.userTagPanl=this._creUserTagPanl();map.addControl(_sign.userTagPanl);_sign.userTagPanl.contDom.style.right=(map.width-119)/2+"px";_sign.userTagPanl.contDom._offset.width=(map.width-119)/2;c.refreshTab();T.ac(T.g("signwrap"),"span_focus");var d=function(){_sign.userTagPanl.contDom.style.right=(map.width-119)/2+"px";_sign.userTagPanl.contDom._offset.width=(map.width-119)/2};map.addEventListener("resize",d);c.temp.event.map=[{obj:map,type:"resize",fun:d}];return}},initialize:function(){},_creUserTagPanl:function(){var b=this;var a=function(){this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new BMap.Size(318,10)};a.prototype=new BMap.Control();a.prototype.initialize=function(){this.contDom=document.createElement("div");this.contDom.className="userTagPanl";this.contDom.id="userTagPanl";var c='<div class="cont" id="userSignPanel">';c+='<div class="bg">';c+="<div>";c+='<b title="标记地点" userTagPanl="1" class="userTagPanlP" onclick="Instance(\''+b.guid+"').tab(0);return false;\" onmouseover=\"Instance('"+b.guid+"').tabOver(this,0);\" onmouseout=\"Instance('"+b.guid+"').tabOut(this,0);\"></b>";c+='<b title="手绘路线" userTagPanl="2" class="userTagPanlL" onclick="Instance(\''+b.guid+"').tab(1);return false;\" onmouseover=\"Instance('"+b.guid+"').tabOver(this,1);\" onmouseout=\"Instance('"+b.guid+"').tabOut(this,1);\"></b>";c+='<b title="文字备注" userTagPanl="3" class="userTagPanlF" onclick="Instance(\''+b.guid+"').tab(2);return false;\" onmouseover=\"Instance('"+b.guid+"').tabOver(this,2);\" onmouseout=\"Instance('"+b.guid+"').tabOut(this,2);\"></b>";c+='<b title="关闭" onclick="Instance(\''+b.guid+'\').exituserSign();return false;" class="closeBtn"></b>';c+="</div></div></div>";this.contDom.innerHTML=c;this.contDom._anchor=BMAP_ANCHOR_TOP_RIGHT;this.contDom._offset=new BMap.Size(318,10);map.getContainer().appendChild(this.contDom);b.tabDom=this.contDom;return this.contDom};a.prototype.getrightpx=function(){var c=map.getSize().width;var d=(c-135)/2;d=(d<228)?228:d;return d};a.prototype.setZindex=function(c){this.contDom.style.zIndex=c};return new a()},tab:function(c,d){var b=this;var a=b.tabDom.getElementsByTagName("b");if(c==b.tabIndex){b.exitMask();return false}else{b.tabIndex!=null&&a[b.tabIndex]?T.rc(a[b.tabIndex],"hover"):null;b.tabIndex=c;T.ac(a[b.tabIndex],"hover")}switch(b.tabIndex){case 0:b.openPoint();break;case 1:b.openPolyline();break;case 2:b.openRemark();break}},tabOver:function(c,b){var a=this;if(b==a.tabIndex){return}T.ac(c,"hover")},tabOut:function(c,b){var a=this;if(b==a.tabIndex){return}T.rc(c,"hover")},refreshTab:function(){this.tab(0)},resetTab:function(){var b=this;var a=b.tabDom.getElementsByTagName("b");if(b.tabIndex!=null&&a[b.tabIndex]){T.rc(a[b.tabIndex],"hover")}b.tabIndex=null},openPoint:function(){var c=this;addStat(STAT_SIGN_POI);c.exitFun();c.temp.signType="Point";if(_gl.config.iw.toal>=_gl.config.iw.lagerT){_gl.showTipInfo("您最多可创建"+_gl.config.iw.lagerT+"个标记点","J_TagPInfo","userTagPanl","point");c.exitFun();return}var a=c.initMask("transparent.cur,default,curLab",this.openPointFun);var b=function(h){var g=new Date().getTime();if(c.openPoint.lastTime&&c.openPoint.lastTime>0){if((g-c.openPoint.lastTime)<500){return}}c.openPoint.lastTime=g;var d=_gl.createMark("",h);var f=_gl.config.iw.index-1;_gl.openInfoWnd(d,f,{type:"new"});_gl.exitCurLab();c.exitFollowTip();BMap.OperationMask.setCursor(map.getDefaultCursor());setTimeout(function(){c.exitMask()},150)};T.on(a,"click",b);if(c.temp.event.point&&c.temp.event.point.push){c.temp.event.point.push({obj:a,type:"click",fun:b})}else{c.temp.event.point=[{obj:a,type:"click",fun:b}]}c.showFollowTip("point")},exitPoint:function(){var c=this;if(c.temp.event.point&&c.temp.event.point.length>0){for(var a=0;a<c.temp.event.point.length;a++){var b=c.temp.event.point[a];T.un(b.obj,b.type,b.fun);c.temp.signType=null}c.temp.event.point=[]}},openPolyline:function(){var a=this;addStat(STAT_SIGN_LINE);map.closeInfoWindow();a.exitFun();this.showFollowTip("polyline");BMap.OperationMask.show(map);_gl.addLine();a.temp.signType="Polyline"},stopLine:function(){var a=new BMap.Marker(e.point,{icon:_gl.LINECLOSEICON,enableMassClear:false});map.addOverlay(a)},exitPolyline:function(){var a=this;if(_gl.temp.plObj){_gl.temp.plObj.close()}a.temp.signType=null},openRemark:function(){var c=this;addStat(STAT_SIGN_REMARK);c.exitFun();c.temp.signType="Remark";var c=this;if(_gl.config.lb.toal>=_gl.config.lb.lagerT){_gl.showTipInfo("您最多可创建"+_gl.config.lb.lagerT+"个文字备注","J_TagPInfo","userTagPanl","remark");c.exitFun();return}var a=c.initMask(" ,text");var b=function(f){var d=new Date().getTime();if(c.openRemark.lastTime&&c.openRemark.lastTime>0){if((d-c.openRemark.lastTime)<500){return}}c.openRemark.lastTime=d;_gl.createLabel({},f);c.exitFollowTip();BMap.OperationMask.setCursor(map.getDefaultCursor());setTimeout(function(){c.exitMask()},150)};T.on(a,"click",b);c.temp.event.remark=[{obj:a,type:"click",fun:b}];c.showFollowTip("remark")},exitRemark:function(){var b=this;if(b.temp.event.remark){var a=b.temp.event.remark[0];T.un(a.obj,a.type,a.fun);b.temp.signType=null}},initMask:function(g){map.closeInfoWindow();var d=this;var h=g.split(",")[0];var f=g.split(",")[1];var i=g.split(",")[2]||"";var a=MapConfig.smFlwCon+"image/"+h;if(T.browser.chrome||T.browser.safari||T.browser.opera){a=""}_sign.userTagPanl.setZindex(20000);BMap.OperationMask.show(map);var j=BMap.OperationMask.getDom(map);BMap.OperationMask.setCursor("url('"+a+"'),"+f);if(i){_gl.showCurLab()}var c=function(k){if(k.button==2){d.exitMask()}};var b=function(k){if(k.keyCode==27){d.exitMask()}};T.on(j,"mouseup",c);T.on(document,"keydown",b);d.temp.event.mask=[{obj:j,type:"mouseup",fun:c},{obj:document,type:"keydown",fun:b}];return j},exitMaskFun:function(){var c=this;if(c.temp.event.mask&&c.temp.event.mask.length>0){for(var a=0;a<c.temp.event.mask.length;a++){var b=c.temp.event.mask[a];T.un(b.obj,b.type,b.fun)}c.temp.event.mask=[]}},hideMask:function(){var a=BMap.OperationMask.getDom(map);BMap.OperationMask.hide(map);a.style.cursor="pointer"},exituserSign:function(){var c=this;T.rc(T.g("signwrap"),"span_focus");_sign.userTagPanl.hide();c.exitMask();if(c.temp.event.map&&c.temp.event.map.length>0){for(var a=0;a<c.temp.event.map.length;a++){var b=c.temp.event.map[a];map.removeEventListener(b.type,b.fun)}c.temp.event.map=[]}},showFollowTip:function(b){var c=this;c.followShow=false;if(c.followInfo[b]){var a;if(!c.followTitle){a=c.followTitle=new BMap.Label(c.followInfo[b],{offset:new BMap.Size(0,0)})}a=c.followTitle;a.setOffset(new BMap.Size(8,14));if(b=="point"){a.setOffset(new BMap.Size(5,5))}a.setStyles({color:"#333",borderColor:"#ff0103"});a.setContent(c.followInfo[b]);map.addOverlay(a);a.hide();c.followShow=true;var d=function(g){if(!c.followShow){return}g=window.event||g;var h=g.target||g.srcElement;if(h!=BMap.OperationMask.getDom(map)){a.hide();return}a.show();var f=BMap.OperationMask.getDrawPoint(g,true);a.setPoint(f);c.followShow=true};T.on(document,"mousemove",d);c.temp.event.followTip=[{obj:document,type:"mousemove",fun:d}]}},exitFollowTip:function(){var b=this;if(b.temp.event.followTip&&b.temp.event.followTip.length>0){var a=b.temp.event.followTip[0];b.followTitle.hide();T.un(a.obj,a.type,a.fun);b.temp.event.followTip=[]}},exitFun:function(){var a=this;if(a.temp.signType){a["exit"+a.temp.signType]()}try{a.exitFollowTip();a.exitMaskFun();_gl.exitCurLab()}catch(b){}},exitMask:function(){var a=this;a.hideMask();a.resetTab();a.exitFun()}});function MapSign(){T.lang.Class.call(this);_gl=this;this._USERSHARE=1;this.oFav=null;this.checkFlash=0;this.ls=null;this.oSign=null;this.userTagPanl=null;this.temp={iw:{_iw:null,title:"",content:"",mkhsCode:null,guid:null,index:0,marker:null,edit:0,list:{}},cur:{label:null,index:13},icon:null,plObj:null,event:{}};this.infav={};this.isShowPoiLab=0;this.poiMarker={};this.config={iw:{index:0,title:"我的标记",content:"我的备注",cityCode:1,fav:0,save:0,show:0,toal:0,lagerT:50},pl:{toal:0,lagerT:50},lb:{label:{},toal:0,index:0,lagerT:20},cur:{11:{_w:12,w:21,h:21,l:0,t:0,x:6,y:21},12:{_w:12,w:21,h:21,l:23,t:0,x:6,y:21},13:{_w:12,w:21,h:21,l:46,t:0,x:6,y:21},14:{_w:12,w:21,h:21,l:69,t:0,x:6,y:21},15:{_w:12,w:21,h:21,l:92,t:0,x:6,y:21},16:{_w:12,w:21,h:21,l:115,t:0,x:6,y:21},21:{_w:19,w:23,h:25,l:0,t:21,x:9,y:25},22:{_w:19,w:23,h:25,l:23,t:21,x:9,y:25},23:{_w:19,w:23,h:25,l:46,t:21,x:9,y:25},24:{_w:19,w:23,h:25,l:69,t:21,x:9,y:25},25:{_w:19,w:23,h:25,l:92,t:21,x:9,y:25},26:{_w:19,w:23,h:25,l:115,t:21,x:9,y:25},31:{_w:17,w:21,h:21,l:0,t:46,x:1,y:21},32:{_w:17,w:21,h:21,l:23,t:46,x:1,y:21},33:{_w:17,w:21,h:21,l:46,t:46,x:1,y:21},34:{_w:17,w:21,h:21,l:69,t:46,x:1,y:21},35:{_w:17,w:21,h:21,l:92,t:46,x:1,y:21},36:{_w:17,w:21,h:21,l:115,t:46,x:1,y:21},41:{_w:25,w:25,h:25,l:0,t:67,x:12,y:25},42:{_w:25,w:25,h:25,l:25,t:67,x:12,y:25},43:{_w:24,w:24,h:25,l:50,t:67,x:12,y:25},44:{_w:25,w:25,h:25,l:75,t:67,x:12,y:25},45:{_w:25,w:25,h:25,l:100,t:67,x:12,y:25},46:{_w:19,w:19,h:25,l:125,t:67,x:9,y:25}}};this.favTime="";this.favArr=[];this.favCloudData=[];this.LINEICON=new BMap.Icon("http://api.map.baidu.com/images/mapctrls.png",new BMap.Size(11,11),{imageOffset:new BMap.Size(-26,-313)});this.LINECLOSEICON=new BMap.Icon("http://api.map.baidu.com/images/mapctrls.gif",new BMap.Size(12,12),{imageOffset:new BMap.Size(0,-14)});this.lineId=0;this.curLineId=0;this.lineMarker={};this.lineArr={};this.textInfo={1:"您最多可输入15个字",2:"请输入文字",3:"黄反",4:"您最多可输入100个字",5:"您最多可输入50个字"}}T.lang.inherits(MapSign,T.lang.Class,"MapSign");T.object.extend(MapSign.prototype,{render:function(){var a=function(){UserMgr.init()};try{_gl.connectFlash(a)}catch(b){UserMgr.init()}_gl.loadCloudData();if(this.cinfo&&this.cinfo.arg){_sign.fun(this.cinfo.arg)}return""},initialize:function(){},openFav:function(){addStat(STAT_SIGN_FAV);closeOtherOps();if(_gl.oFav){_gl.oFav.render()}else{go("tpl:Fav",{dom:"a"})}},connectFlash:function(c){var b;if(_gl.checkFlash){b=c()}else{if(!document.getElementById("J_fav_my")){beforeEndHTML(document.body,'<div style="witdh:0;height:0;overflow:hidden" id="J_fav_my"></div>')}_gl.ls=new T.localStorage({contentID:"J_fav_my",flashID:"fsign"});_gl.ls.render({callBack:function(){_gl.checkFlash=1;var d=baidu.swf.getMovie("fsign").read;if(d==undefined){var a=window.setInterval(function(){d=baidu.swf.getMovie("fsign").read;if(d!=undefined){window.clearInterval(a);b=c()}},50)}else{b=c()}}})}return b},signMap:function(){addStat(STAT_SIGN_SIGN);if(_gl.oSign){_gl.oSign.render()}else{if(window.MgrSign&&!window.mgrsignCtrl){window.mgrsignCtrl=new window.MgrSign();window.mgrsignCtrl.render()}}},filtXss:function(a){var a=a||"";return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},deFiltXss:function(a){var a=a||"";return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")},getDeXssNum:function(b){var a=/&amp;|&lt;|&gt;|&quot;|&#39;/g;return b.match(a).length},checkTextInfo:function(a,b){if(a==1||a==2||a==4||a==5){b.innerHTML=_gl.textInfo[a];T.rc(b,"hide");return}return 1},createMark:function(json,e,opt){var poi,title,lbTitle,content,cityCode,fav,iconImg,show,cur,uid;var index=_gl.config.iw.index;if(!opt){var e=e||window.event;poi=BMap.OperationMask.getDrawPoint(e,true);title=_gl.config.iw.title;lbTitle="";content=_gl.config.iw.content;cityCode=_gl.config.iw.cityCode;fav=_gl.config.iw.fav;save=_gl.config.iw.save;show=_gl.config.iw.show;cur=_gl.temp.cur.index;uid=_gl.config.iw.uid}else{poi=new BMap.Point(json.point.split("|")[0],json.point.split("|")[1]);lbTitle=title=json.title;content=(opt&&opt.from=="share")?_sign.deCodeShare(json.content):json.content;cityCode=json.cityCode;save=1;show=json.show;cur=json.cur;uid=json.uid;_gl.temp.cur.index=cur;fav=0;if(opt&&opt.from=="share"){fav=opt.isInFav}else{if(opt&&opt.from=="fav"){fav=1}}}var curInfo=_gl.config.cur[cur];iconImg=_gl.createIcon();var cityAjaxFun=function(index){var cityAjax=new T.Ajax();var x,y;if(typeof index!="undefined"){var point=_sign.mapSign.pointInfo.list[index].point;x=point.split("|")[0];y=point.split("|")[1]}else{x=poi.lng;y=poi.lat}var index=typeof index!="undefined"?index:_gl.config.iw.index;cityAjax.onsuccess=function(xhr){eval(xhr.responseText);var o_cityCode=_sign.mapSign.pointInfo.list[index].cityCode;var n_cityCode=_mapCenter.current_city.code;if(o_cityCode==n_cityCode){return}else{_sign.mapSign.pointInfo.list[index].cityCode=_mapCenter.current_city.code;if(o_cityCode!=1&&o_cityCode!=n_cityCode){map.closeInfoWindow()}}};cityAjax.request("?newmap=1&qt=cen&b="+x+","+y+";"+x+","+y+"&l=12&t="+new Date())};if(!opt){cityAjaxFun()}var secPt=new BMap.Marker(poi,{enableMassClear:false,icon:iconImg});secPt.addEventListener("click",function(){_gl.openInfoWnd(this,index,{type:"marker"})});secPt.addEventListener("mouseover",function(){this.setTop(true,270000000)});secPt.addEventListener("mouseout",function(){this.setTop(true,260000000)});if(!opt){secPt.addEventListener("dragend",function(){var p=this.getPoint().lng+"|"+this.getPoint().lat;if(_sign.mapSign.pointInfo.list[index].point!=p){_sign.mapSign.pointInfo.list[index].point=p;cityAjaxFun(index)}});secPt.enableDragging(true)}var label=new BMap.Label(lbTitle,{offset:new BMap.Size(curInfo._w-curInfo.x+3,-20)});secPt.setLabel(label);if(!_gl.isShowPoiLab){label.hide()}label.addEventListener("mouseover",function(){_gl.poiMarker[index].setTop(true,270000000)});label.addEventListener("mouseout",function(){_gl.poiMarker[index].setTop(true,260000000)});label.addEventListener("click",function(){_gl.openInfoWnd(_gl.poiMarker[index],index,{type:"marker"})});map.addOverlay(secPt);label.setStyle({borderColor:"#808080",color:"#333",cursor:"pointer",padding:"1px 2px"});if(!opt){secPt.setTitle("可移动改变位置")}if(!_sign.mapSign.pointInfo.list[index]){_sign.mapSign.pointInfo.list[index]={point:poi.lng+"|"+poi.lat,title:title,content:content,cityCode:cityCode,fav:fav,save:save,show:show,cur:cur,uid:uid};_gl.poiMarker[index]=secPt}_gl.temp.iw.index=index;_gl.temp.iw.pre=index;_gl.temp.iw.marker=secPt;_gl.config.iw.index++;_gl.config.iw.toal++;return secPt},createInfoWnd:function(d,c,f){var b=d.index;var a=createSearchInfoWnd(d,c);a.addEventListener("open",function(){var i=_gl.temp.iw.index;var g=_gl.temp.iw.marker;var h=new BMap.Label("",{offset:new BMap.Size(5,-10)});_gl.poiMarker[i].iwOpen=true;if(f.type=="new"&&!g.editInfo){if(T.browser.opera){setTimeout(function(){_gl.editInfoWnd(f)},120)}else{_gl.editInfoWnd(f)}}_gl.poiMarker[i].getLabel().hide();_gl.temp.cur.index=_sign.mapSign.pointInfo.list[i].cur;_gl.temp.iw.mkhsCode=_gl.poiMarker[i].hashCode;_gl.temp.iw.pre=i});a.addEventListener("close",function(){var i=_gl.temp.iw.pre;var g=_sign.mapSign.pointInfo.list[i];_gl.temp.iw.mkhsCode=null;if(g.save!=1){var m=T.trim(T.G("us_infoWnd_title").value);var j=T.trim(T.G("us_infoWnd_content").value);_gl.temp.iw.list[i]={title:m,content:j}}g.show=0;if(_gl.temp.iw.edit!=1){var h=_gl.poiMarker[i].getLabel();var l=_gl.temp.cur.index;var k=_gl.config.cur[l];h.setContent(g.title);h.getDom().title=g.title;h.setStyle({left:(k._w-k.x+3)+"px"});h.show()}else{_gl.temp.iw.edit=0}_gl.temp.iw.guid=null});_gl.temp.iw._iw=a;return a},openInfoWnd:function(f,g,a){if(_gl.temp.iw.mkhsCode==f.hashCode){return}var a=a||{};var k=_sign.mapSign.pointInfo.list[g];k.show=1;var j=k.point.split("|")[0];var i=k.point.split("|")[1];var b=function(){var l=_gl.createInfoWnd({userSign:1,title:k.title,content:k.content,index:g,fav:k.fav},{cityCode:k.cityCode,x:j,y:i},a);return l};var c=b();var h=function(){_gl.temp.iw.index=g;_gl.temp.iw.marker=f;openSearchInfoWndPOI(c,f,a);if(k.save!=1){if(T.browser.opera){setTimeout(function(){_gl.editInfoWnd(a)},120)}else{_gl.editInfoWnd(a)}}};if(a&&a.type=="new"){setTimeout(function(){c=b();h()},80)}else{h()}var d=_gl.favCloudData[_gl.checkInFav(g)];if(d){_gl.temp.iw._dataid=d.id||""}},editInfoWnd:function(p){var j=_gl.temp.iw.index;var d=_gl.temp.iw.marker;var q=_sign.mapSign.pointInfo.list[j];var n,k,b,a,m,l,i;var c=map.getInfoWindow();if((p.type=="new"&&d.editInfo)||!c){return}if(p.type=="button"||p.type=="new"){n=q.title;k=_gl.deTransformArea(q.content)}else{n=_gl.temp.iw.list[j].title||_gl.config.iw.title;k=_gl.temp.iw.list[j].content||_gl.config.iw.content}if(q.save==0){b="保存";a="删除";i="添加标记";m="btnSignSave";l="btnSignDelete"}else{b="确定";a="取消";i="修改标记";m="btnSignSure";l="btnSignCancel"}var s=_gl.config.iw.title;var g=_gl.config.iw.content;var r;var h=function(){r=['<div id="selectPhoto" class="hide"></div>','<div class="userSignIwBox" id="J_userSignIwBox">','<div class="userSignIw">','<div style="z-index:100;height:25px;"><span style="float:left;margin:3px 5px 0 0;">名称</span><input type="text" style="color:#8C8C8C;float:left;width:248px;height:15px;padding:3px 3px;font:12px/1.5 tahoma,arial,宋体;line-height:18px;border:#b5b5b5 solid 1px;" name="title" value="'+n+'" onfocus="_gl.focus(this,\''+s+"','','JuserSignTiptitle')\" onblur=\"_gl.blur(this,'"+s+'\',\'\')" id="us_infoWnd_title" /><div class="userSignTip hide" id="JuserSignTiptitle"></div></div>','<div class="userTagCont"><span style="float:left;margin:3px 5px 0 0;">备注</span><textarea style="border:#b5b5b5 solid 1px;color:#8C8C8C;float:left;font:12px/1.5 tahoma,arial,宋体;height:64px;overflow-y:auto;padding:3px;width:248px" name="content" onfocus="_gl.focus(this,\''+g+"','','JuserSignTipContent')\" onblur=\"_gl.blur(this,'"+g+'\',\'\')" id="us_infoWnd_content" value="'+k+'"></textarea><div class="userSignTip hide" id="JuserSignTipContent"></div></div>','<div style="overflow:hidden;clear:both;height:0;"></div>','<div style="text-align:right;margin:5px -1px 15px 0;*margin:3px -1px 18px 0;"><input type="button" value="'+b+'" id="'+m+'" style="cursor:pointer;margin-right:5px;" onclick="_gl.submitInfoWnd(this,'+j+')" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'" class="iw_bt" /><input type="button" value="'+a+'" id="'+l+'" style="cursor:pointer" onclick="_gl.cancelSubmit()" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'" class="iw_bt" /></div>',"</div>",'<div class="sign_photoBox" onclick="_gl.selectPhoto(this)" title="更换标记样式"><img src="'+MapConfig.smFlwCon+'image/transparent.gif" id="sign_photo" class="sp_s sp_'+q.cur+'" /><span>更换</span></div>','<div style="overflow:hidden;height:0;clear:both"></div>',"</div>"].join("");if(c){d.editInfo=true;c._iw_title=i;c.setTitle('<p class="iw_poi_title">'+i+"</p>");T.G("userSignEdit").innerHTML='<div style="width:100%;background:#fff;">'+r+"</div>";T.G("userSignEdit").style.display="block";T.G("userSignContent").style.display="none";T.G("userSignCtrl").style.display="none";T.G("iw_poi_inter").style.display="none";T.G("us_infoWnd_content").value=k;_gl.temp.iw._iw.redraw()}};h();if(p.type=="button"){q.save=2}},deletePoint:function(){var b=_gl.temp.iw.index;var a=_gl.temp.iw.marker;map.removeOverlay(a);_gl.config.iw.toal--;delete _sign.mapSign.pointInfo.list[b];delete _gl.poiMarker[b];this.hideMapInfo()},iwIputChg:function(d,c){var b=_gl.temp.iw.index;var a=_sign.mapSign.pointInfo.list[b];a[d]=c.value},focus:function(d,a,b,c){if(!b){b=""}d.style.color="#000";(d.value!=a)?null:d.value=b;var c=document.getElementById(c);c.innerHTML="";T.ac(c,"hide")},blur:function(c,a,b){c.style.color="#8c8c8c";(c.value==b||c.value.length<=0)?c.value=a:null},hiddenForm:function(c){_gl.temp.iw.edit=1;T.G("userSignEdit").style.display="none";T.G("userSignCtrl").style.display="";T.G("userSignContent").style.display="";T.G("iw_poi_inter").style.display="";T.G("userSignContent").style.height="auto";var b=T.G("userSignContent").offsetHeight;T.G("userSignContent").style.height=b+"px";var a=_gl.temp.iw;a.marker.closeInfoWindow();_gl.openInfoWnd(a.marker,a.index,c)},submitInfoWnd:function(f,g){var i=T.trim(T.G("us_infoWnd_title").value);var h=T.trim(T.G("us_infoWnd_content").value);var j=_sign.mapSign.pointInfo.list[g];var k=function(l){var n=_gl.checkInfoInput(i,30,T.G("JuserSignTiptitle"));var u=T.trim(i);var p=_gl.filtXss(u);var m=false;if(!n){return 1}var q=T.trim(h);var r=_gl.filtXss(q);var v=_gl.checkInfoInput(h,200,T.G("JuserSignTipContent"));if(!v){return 1}_gl.temp.iw._iw.setTitle('<p class="iw_poi_title" title="'+p+'">'+p+"</p>");var s=_gl.transformArea(r);j.title=p;j.content=s;j.save=1;T.G("userSignContent").innerHTML=s;_gl.hiddenForm(l)};if(j.fav!=1){k()}else{var c=_gl.checkInFav(g),d=_gl.temp.iw._dataid;if(k({favId:c})){return}var a=_sign.mapSign.pointInfo.list[g];var b={cityCode:a.cityCode,content:a.content,point:a.point,title:a.title,fav:1,cur:a.cur};this.updateToFav(b,{index:c,id:d})}},cancelSubmit:function(){var b=_gl.temp.iw.index;var a=_sign.mapSign.pointInfo.list[b];if(_sign.mapSign.pointInfo.list[b].save==0){_gl.deletePoint();_gl.config.iw.toal--}else{a.save=1;_gl.hiddenForm()}},createIcon:function(){var a=_gl.temp.cur.index;var c=_gl.config.cur[a];var b=new BMap.Icon(MapConfig.smFlwCon+"image/us_mk_icon.png",new BMap.Size(c.w,c.h),{offset:new BMap.Size(c.x,c.y),imageOffset:new BMap.Size(-c.l,-c.t),infoWindowOffset:new BMap.Size(c._w-2,1)});_gl.temp.icon=b;return b},showCurLab:function(){var d=this;var b;if(!_gl.temp.cur.label){b=_gl.temp.cur.label=new BMap.Marker(map.getCenter(),new BMap.Icon(MapConfig.smFlwCon+"image/us_cursor.gif"));b.setTop(true,280000000)}b=_gl.temp.cur.label;var a=_gl.temp.cur.index;var g=_gl.config.cur[a];if(!b.isVisible()){map.addOverlay(b)}var c=_gl.createIcon();b.setIcon(c);b.hide();var f=function(i){i=window.event||i;var j=i.target||i.srcElement;if(j!=BMap.OperationMask.getDom(map)){b.hide();return}b.show();var h=BMap.OperationMask.getDrawPoint(i,true);b.setPoint(h)};T.on(document,"mousemove",f);if(d.temp.event.showCurLab&&d.temp.event.showCurLab.push){d.temp.event.showCurLab.push({obj:document,type:"mousemove",fun:f})}else{d.temp.event.showCurLab=[{obj:document,type:"mousemove",fun:f}]}},exitCurLab:function(){var c=this;if(c.temp.event.showCurLab&&c.temp.event.showCurLab.length>0){_gl.temp.cur.label.hide();for(var a=0;a<c.temp.event.showCurLab.length;a++){var b=c.temp.event.showCurLab[a];T.un(b.obj,b.type,b.fun)}c.temp.event.showCurLab=[]}},setCurLab:function(c){var b=_gl.temp.iw.index;var a=_sign.mapSign.pointInfo.list[b];if(a.fav==1){}else{var g=_gl.checkInFav(b);if(g==-1){}else{_gl.favArr[g].cur=c;_gl.updateFav()}}a.cur=_gl.temp.cur.index=c;var f=_gl.config.cur[c];var d=_gl.createIcon();_gl.temp.iw.marker.setIcon(d)},getPhotoHtml:function(h){var d=[];for(var g=1;g<=3;g++){var c=[];for(var f=1;f<=6;f++){var k=g.toString()+f.toString();if(k==h){c.push('<a href="javascript:void(0);" onclick="_gl.goEdit('+k+');return false" class="on"><img src="'+MapConfig.smFlwCon+'image/transparent.gif"  class="sp_s sp_'+k+'" /></a>')}else{c.push('<a href="javascript:void(0);" onclick="_gl.goEdit('+k+');return false"><img src="'+MapConfig.smFlwCon+'image/transparent.gif"  class="sp_s sp_'+k+'" /></a>')}}d.push("<li>"+c.join("")+"</li>")}return"<ul>"+d.join("")+'</ul><div class="goEdit"><input type="button" class="iw_bt" onmouseup="this.className=\'iw_bt_over\'" onmousedown="this.className=\'iw_bt_down\'" onmouseout="this.className=\'iw_bt\'" onmouseover="this.className=\'iw_bt_over\'"  onclick="_gl.goEdit()" style="cursor: pointer; margin-right: 33px;" value="返回"></div>'},goEdit:function(b){var a=map.getInfoWindow();a.setTitle('<p class="iw_poi_title">'+a._iw_title+"</p>");T.ac(T.G("selectPhoto"),"hide");T.rc(T.G("J_userSignIwBox"),"hide");if(b){T.G("sign_photo").className="sp_s sp_"+b;_gl.setCurLab(b)}},selectPhoto:function(a){addStat(STAT_SIGN_IMG);T.rc(T.G("selectPhoto"),"hide");T.ac(T.G("J_userSignIwBox"),"hide");var b=a.getElementsByTagName("img")[0].className.split("sp_s sp_")[1];map.getInfoWindow().setTitle('<p class="iw_poi_title">更换标记样式</p>');T.G("selectPhoto").innerHTML=_gl.getPhotoHtml(b)},showTipInfo:function(g,d,c,b){var c=c||"favBtn";var d=d||"J_favInfo";var b=b||"";var f="";var a=function(){T.rc(T.G(d),"hide");_gl.favTime=setTimeout(function(){T.ac(T.G(d),"hide")},2000)};if(!document.getElementById(d)){if(T.browser.ie==6){beforeEndHTML(T.G(c),'<div id="'+d+'_width" style="position:absolute;top:-1000px;"><div class="jct"><div class="j"></div></div><div class="jext">'+g+"</div></div>");f='style="width:'+T.g(d+"_width").clientWidth+'px"'}beforeEndHTML(T.G(c),'<div id="'+d+'" class="'+b+'" '+f+'><div class="jct"><div class="j"></div></div><div class="jext">'+g+"</div></div>");a()}else{document.getElementById(d).innerHTML='<div class="jct"><div class="j"></div></div><div class="jext">'+g+"</div>";document.getElementById(d).className=b;a()}},goFav:function(a){if(a){a.cur=_gl.temp.cur.index}addStat(STAT_SIGN_POIFAV);SyncMgr.checkFav(_gl.goFavFun,this,a)},loadFavData:function(){var a=this;setTimeout(function(){a.connectFlash(a.getFavArr)},0)},loadCloudData:function(c,b,f){var d=this,a=Array.prototype.slice.call(arguments,2);setTimeout(function(){SyncMgr.download(function(g){_gl.favCloudData=d.processCloudData(g.content.data);c&&c.apply(b||window,a)})},0)},processCloudData:function(c){var f=[];for(var b=0,a=c.length;b<a;b++){if(!c[b].data){continue}f.push(c[b])}return f},getFavArr:function(){try{var a=_gl.ls.getValue("sign","list")}catch(b){return}if(a==undefined){_gl.favArr=[]}else{_gl.favArr=a}},goFavFun:function(g){var i=this,c=0,f,a,j,l=function(){var s="已从收藏夹中删除";var n=j&&T.g("poifav_"+j);if(!c){if(n){T.ac(n,"poi-fav-selected");n.title="取消收藏"}var p=T.G("JiwFav");if(p){T.rc(p,"fav");T.ac(p,"has_fav");p.title="取消收藏"}s="成功添加到收藏夹"}_gl.showTipInfo(s)};if(g){var q=g.title;var k=g.content;j=g.uid;var m=g.cityCode;var r=g.point;var b={cityCode:m,content:k,point:r,title:q,fav:1,cur:g.cur,uid:j};var d=_gl.checkInFav("",{from:"poi",json:b});if(d==-1){_gl.addFav(b,l,this)}else{c=1;_gl.deleteFavByIndex(d,l,this)}}else{var h=_gl.temp.iw.index;f=_gl.temp.iw.marker;a=_sign.mapSign.pointInfo.list[h];j=a.uid;var b={cityCode:a.cityCode,content:a.content,point:a.point,title:a.title,fav:1,cur:a.cur,uid:j};var d=_gl.checkInFav("",{from:"nomal",json:b});if(d==-1){a.fav=1;f.getDom().removeAttribute("title");f.enableDragging(false);_gl.addFav(b,l,this)}else{c=1;_gl.deleteFavByIndex(d,l,this)}}},showFavPoi:function(c,i){if(i&&i.stat){addStat(STAT_SIGN_FAVPOI);i.openWindow=1}var f=getParam(location.href);if(f&&f.mapShareId){var h=_gl.checkInStorage(c,{type:"share"})}else{var h=_gl.checkInStorage(c)}if(h==-1){var d=SyncMgr.converToOriginal(_gl.favCloudData[c].data);var b=_gl.createMark(d,"",{from:"fav"});b.setTop(true,270000000);h=_gl.temp.iw.index}else{var d=_sign.mapSign.pointInfo.list[h];_sign.mapSign.pointInfo.list[h].fav=1;var b=_gl.poiMarker[h];b.setTop(true,270000000);_gl.temp.iw.index=h}b.show();if(i&&!i.openWindow){return false}_gl.openInfoWnd(b,h);var a=d.point.split("|")[0];var g=d.point.split("|")[1];map.setCenter(new BMap.Point(a,g));return b},searchPoiSign:function(b){b.cur=11;var a=_gl.createMark(b,"",{from:"poi"});var c=_gl.temp.iw.index;_gl.openInfoWnd(a,c);a.setTop(true,270000000)},changeFavPoiFun:function(a){var b=getParam(location.href);if(b&&b.mapShareId){var c=_gl.checkInStorage(a,{type:"share"})}else{var c=_gl.checkInStorage(a)}},poiHidAndSho:function(b,a){if(b=="hide"){_gl.poiHide(a)}else{if(b=="show"){_gl.showFavPoi(a,{stat:1})}}},updateFav:function(){_gl.ls.setValue("sign","list",_gl.favArr)},checkCurText:function(c,b){if(c==""){return 2}var a=T.string.getByteLength(c);if(a>b){if(b==30){return 1}if(b==200){return 4}if(b==100){return 5}}return 10},charStr:function(b,c){var a=T.string.subByte(b,c,"...");return _gl.filtXss(a)},checkInfoInput:function(g,f,d){var a=_gl.checkCurText(g,f);var b=_gl.checkTextInfo(a,d);if(b){return 1}else{return 0}},transformArea:function(a){var d=new RegExp("\n","g");var b=new RegExp(" ","g");var c=a.replace(d,"<br/>").replace(b,"&nbsp;");return c},deTransformArea:function(a){var d=new RegExp("<br/>","g");var b=new RegExp("&nbsp;","g");var c=a.replace(d,"\n").replace(b," ");return c},clearFav:function(){var a=function(){_gl.ls.setValue("sign","list",[]);_gl.clearFavInfo();var b=_gl.favArr.length;while(b--){_gl.deleteFavByIndex(b)}};_gl.connectFlash(a)},clearFavBySync:function(){try{_gl.ls.setValue("sign","list",[]);_gl.favArr.length=0}catch(a){}},clearFavInfo:function(){try{var a=[];if(mapPass.userState.isOnline==0){a.push('<div class="fav_tip_box"><p>收藏内容可同步到云端，电脑、手机、平板随时都能查看啦！现在就<a  href="https://passport.baidu.com/v2/?login&tpl=ma" id="loginFav" onclick="UserMgr.login();addStat(STAT_FAV_LOGIN_CLICK);return false">登录</a>试试看~<br /><span style="color:#999">(目前收藏夹同步仅支持百度手机地图Android3.0版本)</span></p></div>')}else{a.push('<div class="fav_tip_box"><p>您还没有收藏呢。</p><p>现在收藏内容可同步保存到云端，电脑、手机、平板随时都能查看哟！<br /><span style="color:#999">(目前收藏夹同步仅支持百度手机地图Android3.0版本)</span></p></div>')}a.push('<div class="fav_helpBg01"><div>点击小星星收藏地点,自动保存云端！<a href="javascript:void(0);" onclick="PcToMobile.open(\'FAV\');">百度手机地图</a>还能收藏路线噢~</div></div>');a.push('<div class="fav_helpBg02"><div>登录后，不论电脑还是手机，随时随地查看收藏，毫无鸭梨！</div></div>');BoxContainer.setTitle("收藏夹");BoxContainer.setContent(a.join(""))}catch(b){}},showAllPoi:function(){var c=[];_gl.isShowPoiLab=1;for(var d=0;d<_gl.favArr.length;d++){var g=_gl.favArr[d];var b=g.point.split("|")[0];var h=g.point.split("|")[1];_gl.showFavPoi(d,{openWindow:0});var f=new BMap.Point(b,h);c.push(f)}_gl.isShowPoiLab=0;setViewport(c);_gl.showAllPoi.isGoing=true},hideAllPoi:function(){for(var a=0;a<_gl.favArr.length;a++){_gl.poiHide(a)}},poiHide:function(a){var b=function(){var d=_gl.checkInStorage(a);if(d==-1){}else{var c=_gl.poiMarker[d];map.removeOverlay(c);delete _sign.mapSign.pointInfo.list[d];delete _gl.poiMarker[d]}};_gl.connectFlash(b)},deleteFavByIndex:function(b,f,d){var i=this,c,g=_gl.favCloudData[b],h=g.id,a=Array.prototype.slice.call(arguments,3);if(!h){return}c=g.data.uid;g.action=2;SyncMgr.upload(g,function(k){addStat(STAT_FAV_DELPOI);var l=T.G("JiwFav");if(l){T.rc(l,"has_fav");T.ac(l,"fav");l.title="加入收藏夹"}var j=c&&T.g("poifav_"+c);if(j){T.rc(j,"poi-fav-selected");j.title="加入收藏夹"}_gl.favCloudData.splice(b,1);if(_gl.oFav){_gl.oFav.goPage(_gl.oFav.currentPageIndex)}f&&f.apply(d,a)})},addFav:function(f,c,b){var f=SyncMgr.converToGe(f),d={action:0,data:f,type:0},a=Array.prototype.slice.call(arguments,3);SyncMgr.upload(d,function(g){addStat(STAT_FAV_ADDPOI);d.id=g.content.data[0].id;_gl.favCloudData.unshift(d);if(_gl.oFav){_gl.oFav.goPage()}c&&c.apply(b,a)})},updateToFav:function(c,b){if(!c){return}b=b||{};var f="",a=false,c=SyncMgr.converToGe(c);if(typeof(b.index)!="undefined"&&_gl.favCloudData[b.index]){f=_gl.favCloudData[b.index].id;a=true}else{if(b.id){f=b.id}}var d={id:f,data:c,action:SYNC_ACTION_UPDATE,type:SYNC_DATA_TYPE_POI};SyncMgr.upload(d,function(g){_gl.showTipInfo("修改成功");if(a){_gl.favCloudData[b.index].data=c;if(_gl.oFav){_gl.oFav.goPage()}}var h=T.G("JiwFav");if(h){T.rc(h,"fav");T.ac(h,"has_fav");h.title="取消收藏"}})},checkInStorage:function(a,g){var f=_sign.mapSign.pointInfo.list;if(g&&g.type=="poi"){for(var b in f){var c=f[b];if(f[b].point==g.ob.point&&f[b].title==g.ob.title&&f[b].content==g.ob.content){return b}}return -1}if(g&&g.type=="share"){for(var b in f){var c=f[b],d=SyncMgr.converToOriginal(_gl.favCloudData[a].data);if(f[b].point==d.point&&f[b].title==d.title&&f[b].content==d.content){return b}}return -1}for(var b in f){var c=f[b],d=SyncMgr.converToOriginal(_gl.favCloudData[a].data);if(f[b].fav==1&&f[b].point==d.point&&f[b].title==d.title&&f[b].content==d.content){return b}}return -1},checkInFav:function(a,f){if(f&&f.from=="share"){var c=f.json;for(var b=0;b<_gl.favCloudData.length;b++){var d=SyncMgr.converToOriginal(_gl.favCloudData[b].data);if(d.point==c.point&&d.title==c.title&&d.content==_sign.deCodeShare(c.content)){return b}}return -1}if(f&&(f.from=="poi"||f.from=="nomal")){var c=f.json;if(c.content){c.content=c.content.replace(/&nbsp;/g," ")}for(var b=0;b<_gl.favCloudData.length;b++){var d=SyncMgr.converToOriginal(_gl.favCloudData[b].data);if(d.point==c.point&&d.title==c.title&&d.content==c.content){return b}}return -1}for(var b=0;b<_gl.favCloudData.length;b++){var d=SyncMgr.converToOriginal(_gl.favCloudData[b].data);if(d.point==_sign.mapSign.pointInfo.list[a].point&&d.title==_sign.mapSign.pointInfo.list[a].title&&d.content==_sign.mapSign.pointInfo.list[a].content){return b}}return -1},showSharePoI:function(a){_gl.sharePointArr=a;var b=function(){var f=-1;_gl.isShowPoiLab=1;for(var g in _gl.sharePointArr){var d=_gl.sharePointArr[g];if(d.show==1){f=g;continue}_gl.getFavArr();var h=_gl.checkInFav("",{from:"share",json:d});if(h==-1){var c=_gl.createMark(d,"",{from:"share",isInFav:0})}else{var c=_gl.createMark(d,"",{from:"share",isInFav:1})}c.show()}_gl.isShowPoiLab=0;if(f!=-1){var d=_gl.sharePointArr[f];_gl.getFavArr();var h=_gl.checkInFav("",{from:"share",json:d});if(h==-1){var c=_gl.createMark(d,"",{from:"share",isInFav:0})}else{var c=_gl.createMark(d,"",{from:"share",isInFav:1})}_gl.openInfoWnd(c,_gl.temp.iw.index)}};_gl.connectFlash(b)},showSharePolyline:function(a){for(var b in a){_gl.addLine(a[b],{from:"share"})}},showShareRemark:function(a){for(var b in a){_gl.createLabel(a[b])}},getSignLink:function(str,callback,type){var s=function(){var rq=new T.Ajax();rq.method="POST";rq.data=["type="+type,"act=create_share","json="+encodeURIComponent(str),"t="+new Date().getTime(),"userid="+_gl.ls.getValue("userID","id")].join("&");rq.request("userflag/share.php");rq.onsuccess=function(json){eval("var o ="+json.responseText);callback(o)}};_gl.connectFlash(s)},createLabel:function(r,g){var l=this;var m=r&&r.point||0;var d,h,a,q;var g=g||window.event;if(m){q=new BMap.Point(r.point.split("|")[0],r.point.split("|")[1]);d=r.content;h=_sign.deCodeShare(r.content);a=_gl.deTransformArea(_gl.deFiltXss(r.content))}else{q=BMap.OperationMask.getDrawPoint(g,true);d="";h="";a=""}var f=_gl.config.lb.index;var k=m?"us_edit":"us_submit";var p=m?"编辑备注":"完成编辑";var j=m?1:0;var i=m?"":"none";var b=m?"none":"";var n=new BMap.Label("",{offset:new BMap.Size(3,-7),point:q,enableMassClear:false});var c='<div style="width:125px;overflow:hidden;font-size:12px;line-height:16px;" class="usLbContent" id="usLb'+n.hashCode+f+'">';c+='<textarea style="border:0;width:125px;height:72px;font-size:12px;overflow-y:auto;display:'+b+'" id="usLbTe'+n.hashCode+f+'">'+a+"</textarea>";c+='<div style="width:122px;padding:1px 2px;background:#fff;display:'+i+';overflow:visible;word-wrap:break-word;white-space:-moz-pre-wrap;" id="usLbDiv'+n.hashCode+f+'">'+h+"</div>";c+='<div style="position:absolute;width:45px;height:22px;padding-left:2px;overflow:hidden;bottom:-1px;right:-47px;-right:-48px;cursor:default"><div style="width:66px;float:left;height:78px;background:url('+MapConfig.smFlwCon+'image/us_sign_tex.png) no-repeat 0 0;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=image/us_sign_tex.png);_background:none;">';c+='<style type="text/css">';c+=".us_remark_but{display:block;position:absolute;top:0;left:2px;z-index:9999;}";c+=".us_remark_but img{width:19px;height:20px;margin:1px;background:url("+MapConfig.smFlwCon+"image/us_sign_tex.png) no-repeat 0 -33px;cursor:pointer;}";c+=".us_remark_but .us_submit{background-position:0 -33px}";c+=".us_remark_but .us_submit_on{background-position:0 -58px}";c+=".us_remark_but .us_delete{background-position:-23px -33px}";c+=".us_remark_but .us_delete_on{background-position:-23px -58px}";c+=".us_remark_but .us_edit{background-position:-46px -33px}";c+=".us_remark_but .us_edit_on{background-position:-46px -58px}";c+="</style>";c+='<b class="us_remark_but">';c+='<img class="'+k+'" title="'+p+'" src="'+MapConfig.smFlwCon+'image/transparent.gif" onclick="_gl.subRemark(this,'+f+',event)" onmouseover="this.className=this.className + \'_on\'" onmouseout="this.className=this.className.split(\'_on\')[0]"/>';c+='<img class="us_delete" title="删除" src="'+MapConfig.smFlwCon+'image/transparent.gif" onclick="_gl.delRemark('+f+',event)" onmouseover="this.className=\'us_delete_on\'" onmouseout="this.className=\'us_delete\'" />';c+="</b>";c+="</div></div>";c+='<div class="hide" style="position:absolute;bottom:-26px;left:-1px;width:123px;height:20px;background:none repeat scroll 0 0 #FFFECD;border:1px solid #DFB35C;color:#CC0003;line-height:18px;padding:2px;" id="usLbMess'+n.hashCode+f+'"></div>';c+="</div>";n.addEventListener("domready",function(){this.getDom().removeAttribute("unselectable");this.getDom().setAttribute("unselectable","off");this.getDom().innerHTML=c;var u=T.G("usLbTe"+this.hashCode+f);var s=T.G("usLbMess"+n.hashCode+f);if(!m){}T.on(u,"focus",function(){T.ac(s,"hide")});T.on(u,"click",function(v){v.cancelBubble=true});T.on(u,"dblclick",function(v){v.cancelBubble=true});T.on(u,"mousemove",function(v){v.cancelBubble=true});T.on(u,"mousedown",function(v){v.cancelBubble=true});T.on(u,"keydown",function(v){v.cancelBubble=true});T.on(u,"mousewheel",function(v){v.cancelBubble=true});T.on(u,"selectstart",function(v){v.cancelBubble=true});if(window.addEventListener){u.addEventListener("DOMMouseScroll",function(v){if(!v){return}v.cancelBubble=true},false)}});map.addOverlay(n);n.setStyle({whiteSpace:"normal",border:"1px solid #999",MozUserSelect:""});_sign.mapSign.remarkInfo.list[_gl.config.lb.index]={point:q.lng+"|"+q.lat,content:h,type:j};_gl.config.lb.label[_gl.config.lb.index]={label:n};_gl.config.lb.index++;_gl.config.lb.toal++;n.addEventListener("mouseover",function(){this.getDom().style.zIndex="100"});n.addEventListener("mouseout",function(){this.getDom().style.zIndex="80"})},subRemark:function(d,f,h){var h=window.event||h;stopBubble(h);preventDefault(h);var l=this;var j=_gl.config.lb.label[f].label;var m=j.hashCode;var c=T.G("usLb"+m+f);var b=T.G("usLbTe"+m+f);var k=b.value;var p=T.G("usLbDiv"+m+f);var a=T.G("usLbMess"+m+f);if(_sign.mapSign.remarkInfo.list[f].type!=1){b.blur();var g=k;k=T.trim(k);k=_gl.filtXss(k);k=_gl.transformArea(k);var n=_gl.checkInfoInput(g,100,a);if(!n){return}b.style.display="none";j.getDom().style.MozUserSelect="none";p.innerHTML=k;p.style.display="block";d.className="us_edit";d.title="编辑备注";_sign.mapSign.remarkInfo.list[f].type=1;_sign.mapSign.remarkInfo.list[f].content=k}else{b.style.display="";j.getDom().style.MozUserSelect="";b.focus();b.value=b.value;_gl.fixTextareaFocusCursorPosition(b);p.style.display="none";d.className="us_submit";d.title="完成编辑";_sign.mapSign.remarkInfo.list[f].type=2}},fixTextareaFocusCursorPosition:function(a){if(T.browser.chrome||T.browser.safari){a.select();window.getSelection().collapseToEnd()}},delRemark:function(b,d){var d=window.event||d;stopBubble(d);preventDefault(d);var c=this;var a=_gl.config.lb.label[b].label;map.removeOverlay(a);delete _sign.mapSign.remarkInfo.list[b];_gl.config.lb.toal--;this.hideMapInfo()},addLine:function(q,l){if(_gl.config.pl.toal>=_gl.config.pl.lagerT){_gl.showTipInfo("您最多可创建"+_gl.config.pl.lagerT+"个手绘路线","J_TagPInfo","userTagPanl","polyline");_gl.oSign.exitMask();return}var a=[];var z=[];var d=1;var g={};var A=0;var j;var p={};var r={};var v=0;var y=this;var x=function(i){if(d){g=new BMap.Label('<span class="BMap_diso"><span class="BMap_disi">起点</span></span>',{point:i.point,enableMassClear:false});g.setStyle({border:0,background:"none"});map.addOverlay(g);g.setOffset(new BMap.Size(8,-5));d=0}else{A+=map.getDistance(_gl.getPoint(a[a.length-1]),i.point)}var f=new BMap.Marker(i.point,{icon:_gl.LINEICON,enableMassClear:false});z.push(f);a.push(i.point.lng+"|"+i.point.lat);map.addOverlay(f)};var b=function(){for(var s=0,f=_gl.lineMarker[j];s<f.length;s++){map.removeOverlay(f[s]);delete _gl.lineMarker[j]}delete _sign.mapSign.polylineInfo.list[j];delete _gl.lineArr[j];map.removeOverlay(p);map.removeOverlay(r);map.removeOverlay(g);if(l&&l.from=="share"){map.removeOverlay(m)}else{m.clear()}_gl.config.pl.toal--;_gl.hideMapInfo()};var n=function(){if(!a.length){return}j=_gl.lineId;_sign.mapSign.polylineInfo.list[_gl.lineId]=a;_gl.config.pl.toal++;_gl.lineMarker[_gl.lineId]=z;var f=parseFloat(a[a.length-1].split("|")[0])-parseFloat(a[a.length-2].split("|")[0]);var C=parseFloat(a[a.length-1].split("|")[1])-parseFloat(a[a.length-2].split("|")[1]);var B=_gl.getPoint(a[a.length-1]);p=new BMap.Marker(B,{icon:_gl.LINECLOSEICON,enableMassClear:false});map.addOverlay(p);if(f>=0){p.setOffset(new BMap.Size(14,0))}else{p.setOffset(new BMap.Size(-14,0))}if(A>=1000){var s=parseInt(parseFloat(A/1000*10))/10;var i="公里"}else{var s=parseInt(A);var i="米"}r=new BMap.Label('<span style="color:#FF6319;font-weight:bold">'+s+"</span>"+i,{point:B,enableMassClear:false});r.setStyle({padding:"2px"});if(C>=0){r.setOffset(new BMap.Size(-5,-35))}else{r.setOffset(new BMap.Size(-5,11))}map.addOverlay(r);p.addEventListener("click",function(){b()});_gl.lineArr[j]=p};if(l&&l.from=="share"){for(var u=0;u<q.length;u++){var c={};c.point=_gl.getPoint(q[u]);x(c)}n();var h=[];for(var u=0;u<a.length;u++){h.push(_gl.getPoint(a[u]))}var m=new BMap.Polyline(h,{strokeColor:"#FD8045",strokeWeight:3,strokeOpacity:1,enableMassClear:false});map.addOverlay(m);_gl.lineId++;_gl.config.pl.toal++}else{var m=new BMap.PolylineTItem(map,{showResult:false,enableMassClear:false,cursor:"url("+MapConfig.smFlwCon+"image/circle.cur),default"});y.temp.plObj=m;var k=function(B){T.un(document,"keydown",k);_gl.oSign.resetTab();B=window.event||B;if(B.keyCode==27){for(var s=0,f=z;s<f.length;s++){map.removeOverlay(f[s])}map.removeOverlay(g);v=1}};var w=function(){if(z.length==1){map.removeOverlay(z[0]);map.removeOverlay(g);_gl.oSign.resetTab();_sign.userTagPanl.setZindex(20000);_gl.lineId++;return}n();setTimeout(function(){if(_gl.oSign.temp.signType=="Point"||_gl.oSign.temp.signType=="Remark"){return}_gl.oSign.resetTab()},1);_sign.userTagPanl.setZindex(20000);_gl.lineId++};m.addEventListener("drawend",function(f){T.un(document,"keydown",k);if(v){return}w()});m.open();m.setLineColor("#FD8045");m.setLineStroke(3);T.on(document,"keydown",k);m.addEventListener("addpoint",function(f){x(f)})}},getPoint:function(a){return new BMap.Point(a.split("|")[0],a.split("|")[1])},parseAllShare:function(a){_gl.showSharePoI(a.pointInfo.list);_gl.showSharePolyline(a.polylineInfo.list);_gl.showShareRemark(a.remarkInfo.list);T.G("declare").style.display="inline";T.G("declare").innerHTML="以下地图包含网友标记的内容"},hideMapInfo:function(){if(_sign.isNull(_sign.mapSign.pointInfo.list)&&_sign.isNull(_sign.mapSign.polylineInfo.list)&&_sign.isNull(_sign.mapSign.remarkInfo.list)&&(T.G("declare").style.display=="inline"||T.G("declare").style.display=="block")){_sign.hideMapInfo()}},btnOver:function(a){a.className="favBtnOver"},btnOut:function(a){a.className=""},btnDown:function(a){a.className="favBtnDown"},btnUp:function(a){a.className="favBtnOver"},smallBtnOver:function(a){a.className="smallFavBtnOver"},smallBtnOut:function(a){a.className=""},smallBtnDown:function(a){a.className="smallFavBtnDown"},smallBtnUp:function(a){a.className="smallFavBtnOver"},getFavDataById:function(f){var c=_gl.favCloudData,b;for(var d=0,a=c.length;d<a;d++){b=c[d];if(b.id==f){return b}}return null},getOriginalFavDataById:function(a){return SyncMgr.converToOriginal(this.getFavDataById(a).data)},delFavDataById:function(f){var c=_gl.favCloudData,b;for(var d=0,a=c.length;d<a;d++){b=c[d];if(b.id==f){c.splice(d,1);b.action=2;return b}}return null},checkInFavById:function(f){var c=_gl.favCloudData,b;for(var d=0,a=c.length;d<a;d++){b=c[d];if(b.id==f){return true}}return false},getPageBeforeIndex:function(b){var a=this.oFav.currentPageIndex;if(a==1){return b}return(a-1)*this.oFav.pageSize+b}});function bindMapControls(){if(!overviewCtrl){return}overviewCtrl.addEventListener("viewchanging",function(){var a=parseInt(T.g("MapHolder").style.height);a=a<0?0:a;if(T.g("shad_v")){T.g("shad_v").style.height=a+"px"}});overviewCtrl.addEventListener("viewchanged",function(){var a=parseInt(T.g("MapHolder").style.height);a=a<0?0:a;if(T.g("shad_v")){T.g("shad_v").style.height=a+"px"}if(this.isOpen==true){addStat(STAT_OVM_OPEN)}});overviewCtrl.addEventListener("hide",function(){var a=parseInt(T.g("MapHolder").style.height);a=a<0?0:a;if(T.g("shad_v")){T.g("shad_v").style.height=a+"px"}});overviewCtrl.addEventListener("show",function(){var a=parseInt(T.g("MapHolder").style.height);a=a<0?0:a;if(T.g("shad_v")){T.g("shad_v").style.height=a+"px"}})}function initCtrls(){var a=window;if(a.SearchInViewControl&&!a.searchInViewCtrl){a.searchInViewCtrl=new SearchInViewControl()}if(DriveControl&&!a.driveCtrl){a.driveCtrl=new DriveControl();map.addControl(a.driveCtrl);a.driveCtrl.hide(true)}if(a.TrafficControl&&!a.trafficCtrl){a.trafficCtrl=new TrafficControl();setTrafficBut()}map.addEventListener("maptypechange",function(){setTimeout(_adjustMapButtons,50)});if(!isPrint){window.captureCtrl=new CaptureControl()}if(a.captureCtrl&&T.G("capwrap")&&T.G("capwrap").innerHTML==""){T.G("capwrap").innerHTML='<a href="javascript:void(0)" id="capture" onclick="captureMap();return false">截图</a>'}if(_sign.GOSIGN){a._gl=new MapSign();a._gl.render();_sign.addLink()}bindMapControls()};
