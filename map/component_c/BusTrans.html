<!--wjp cmsads -->
<div id="pos7" style="display:none;"></div>
<div id="route_top" class="route_top">
   <div id="taxiCost" class="MapInfo_taxiCost">
    <span id="taxiText" onclick="Instance('#guid#').getTaxi(this);addStat(STAT_TAXI_BUS_TOP)">打车费用<span id="taxiJG"></span></span> <span style="color:#999999">(按驾车的最短路程计算)</span>
  </div> 

    <div id="route_type" class="bus_strategySel" style="#route_type_width#">
      <div class="strategySel_r">
           <div id="strategySel" style="width:279px">
               <span class="leftBorLine"></span>
               <div class="noSel" id="type0">较快捷</div>
               <div class="noSel" id="type2"><span class="lineBg">少换乘</span></div>
               <div class="noSel" id="type3"><span class="lineBg">少步行</span></div>
			   #type4html#
               <span class="rightBorLine"></span>
           </div>
       </div>
    </div>

    <div id="walk_tips" class="walk_tips">起点与终点距离较近，您可#onlywalk#。</div>
</div>
<div class="route_contentWrapper">
    <div id="route_content" class="result_holder">
      <div class="special">      
        <ul id="route_list" class="route">#routeScheme#</ul>        
      </div>
      <div id="route_page"></div>
      <div id="route_tips" class="route_tips">百度提醒您：以上行车线路仅供参考，如有问题请到<a id="mapComplaintCenter" target="_blank" onClick="addStat(STAT_TOUSU_LIST_BT)" href="http://tousu.baidu.com/map/add">百度地图投诉中心</a>反馈。</div>
      <!--wjp cmsads -->
      <div id="pos8" style="display:none"></div>
    </div>
</div>
<div id="route_total" class="route_bottom"><p class="rp">查看：<a tid="routeReturn" href="javascript:void(0)" onclick="Instance('#guid#').returnBus();return false;">返程</a>&nbsp;|&nbsp;<a href="javascript:void(0)" onclick="Instance('#guid#').navigate()">驾车</a>&nbsp;#walkInfo#</p>  <p class="lp"><a href="javascript:void(0)" tid="reChoice" onclick="Instance('#guid#').backAddr()">重选起终点</a></p></div>

<script>
function BusTrans(){T.lang.Class.call(this);this.json=null;this.schemes=[];this.routePoints=[];this.sWalkPoints=[];this.eWalkPoints=[];this.tWalkPoints=[];this.transPoints=[];this.routeBound=[];this.sWalkBound=[];this.tWalkBound=[];this.eWalkBound=[];this.transWins=[];this.switchLines=[];this.changeHtmls=[];this.schemeNames=[];this.mapZoomLevel=1;this.stopUids=[];this.stopPts=[];this.busType=[];this.clickIndex=[];this.schemeIndex=-1;this.routeIndex=[];this.sTransPoints=[];this.zoneStaTips=[];this.zoneBusStopPois=[];this.para=[];this.geoloaded=[];this.page=1;this.pagecap=5;this.loaded=false;this.state=[];this.unfold=0;this.expend=60;this.rindex=-1;this.tindex=-1;this.windex=-1;this.lineType=[[0,2,3,4,5,6,7,9,10,11],[1,12,13,14],[8]];this.isSubway=false;this.isOperated=false;this.dirType=["北","东北","东","东南","南","西南","西","西北"];this.strategy=0;this.enableDragging=true;this.walkMkrs=[];Share.setSmSCode(0);this.changeTS="<tr class=\"#className#\" onclick=\"addStat(STAT_BUS_STEP); Instance('#guid#').highRoute(event,#tIndex#,#rIndex#,this)\" onmouseover=\"Instance('#guid#').trOver(event,this)\" onmouseout=\"Instance('#guid#').trOut(event,this)\">          <th><div class=\"#typeClass#\">&nbsp;</div></th>          <td>          <div class='tf'><a class='cs' onclick=\"Instance('#guid#').highZoneSta(event, '#lineUid#','#stUid#','#edUid#',#tIndex#,#rIndex#,this);return false;\" href='javascript:void(0)'>#viaStops#站</a></div><p>乘坐&nbsp;<span class='kl'>#lineName#</span>#changLines#,&nbsp;在&nbsp;<a class='ks' href='javascript:void(0)' onclick=\"addStat(STAT_BUS_STKEY); Instance('#guid#').clickStop(event,#tIndex#,#cIndex#)\">#getOffName#</a>&nbsp;下车#getOffExit#</p></td>          </tr>";this.walkTS="<tr class=\"#className#\" onclick=\"addStat(STAT_BUS_STEP); Instance('#guid#').highWalk(event,#tIndex#,#wIndex#,#wType#,this);Instance('#guid#').WalkContent(this,#tIndex#,#wType#,#wIndex#,#wInfo#)\" onmouseover=\"Instance('#guid#').trOver(event,this)\" onmouseout=\"Instance('#guid#').trOut(event,this)\" >          <th><div class=\"step\"></div></th>          <td><div class='tf'>#walkDistance#</div>步行至&nbsp;<span>#walkName#</span></td>        </tr>";this.turtype=["","直走","向右前方转","右转","向右后方转","向后转","向左后方转","左转","向左前方转","左转穿过马路继续向前","右转穿过马路继续向前","左转穿过马路往回走","右转穿过马路往回走","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向","经#WalkType#穿过马路并往回走","经#WalkType#穿过马路并继续向前","到路口斜对面并继续向前","到路口斜对面，向左前方转","到路口斜对面，左转","到路口斜对面，向左后方转","到路口斜对面，向右前方转","到路口斜对面，右转","到路口斜对面，向右后方转","到路口斜对面，直走","继续向前","向左前方转过#WalkType#","左转过#WalkType#","向左后方转过#WalkType#","向右前方转过#WalkType#","右转过#WalkType#","向右后方转过#WalkType#","直走过#WalkType#","继续向前"];this.turtype1=["","直走","向右前方转","右转","向右后方转","向后转","向左后方转","左转","向左前方转"];this.rettype=["","从起点出发","到达目的地","途经点","走"];this.roadtype=["","环岛","无属性道路","主路","高速连接路","交叉点内路段","连接道路","停车场内部道路","服务区内部道路","桥","步行街","辅路","匝道","全封闭道路","未定义交通区域","POI连接路","隧道","步行道","公交专用道","提前右转道","广场内部道路","公园内部道路"];this.worktype=["","人行道","天桥","地下通道","人行通道","直梯","扶梯","阶梯","斜坡","索道"];this.scrollPanel=new baidu.ui.ScrollPanel({container:"route_content",overflow:"overflow-y",autoUpdate:false})}T.lang.inherits(BusTrans,T.lang.Class,"BusTrans");T.object.extend(BusTrans.prototype,{render:function(g,m){var k=this;BShare.getMInfo=function(){var r="";if(k.total&&k.total!=0){var u=k.s_query,v=k.e_query,t=k.schemeIndex,w=k.schemeNames,r=BShare.fixName(u+"到"+v)+" "+w[t].join("，换")}return{text:r,className:k._className}};if(mapInfoScrollPanel){mapInfoScrollPanel.hide()}if(this.cinfo&&this.cinfo.isPos==true){if(this.cinfo.destFlag==0){window.conType=0;window.conPoint=this.cinfo.point}else{window.conType=1;window.conPoint=this.cinfo.point}this.setContext();return}if(!m){return}this.json=m;var q=m.result;if(q.type==22){var b=this.modelQuery;b=b.replace("sn=0","sn=1");b=b.replace("en=0","en=1");go(b);return}this.error=q.error;var f=q.time;this.total=q.total;this.start=q.start;this.end=q.end;this.db=q.db;var h=this.start.wd.length;var e=this.end.wd.length;this.startName=h>10?this.start.wd.substring(0,10)+"...":this.start.wd;this.endName=e>10?this.end.wd.substring(0,10)+"...":this.end.wd;this.s_query=q.s_query?q.s_query:this.start.wd;this.e_query=q.e_query?q.e_query:this.end.wd;this.startPoint=this.start.pt;this.endPoint=this.end.pt;this.sBus=this.start.bus_stop;this.eBus=this.end.bus_stop;this.suid=this.start.uid;this.euid=this.end.uid;this.strategy=q.sy;if(!window.cxtBusPoints){window.cxtBusPoints=[]}var p=this.start.pt.split(",");var c=new BMap.Point(p[0],p[1]);window.cxtBusPoints[0]={p:c,n:this.startName,t:0};var p=this.end.pt.split(",");var o=new BMap.Point(p[0],p[1]);window.cxtBusPoints[1]={p:o,n:this.endName,t:1};this.cn=modelConfig.cityName;this.currentCity=modelConfig.cityCode;this.curCity=m.current_city;if(this.error==1){addStat(STAT_WALK_COUNT_LINK);var a=["<div class='result_holder'><div class='special' style='width:100%'>","<div class='route_total'><p class='lp'>查看：<a tid='routeReturn' href='javascript:void(0)' onclick=\"Instance('"+this.guid+"').returnBus();return false;\">返程</a>&nbsp;|&nbsp;<a href='javascript:void(0)' onclick=\"Instance('"+this.guid+'\').navigate()">驾车</a>&nbsp;|&nbsp;<a href="javascript:void(0)" onclick="Instance(\''+this.guid+"').navWalk()\">步行</a></p>  <p class='rp'><a href='javascript:void(0)' tid='reChoice'  onclick=\"Instance('"+this.guid+"').backAddr()\">重选起终点</a></p></div>","<div class='nr_p' style='padding:5px 5px 5px 10px'><div style='padding-left:5px;height:25px;line-height:25px;background:#FFF3CB'>起点与终点距离较近，您可<a href=\"javascript:void(0)\" onclick=\"Instance('"+this.guid+"').navWalk();return false;\">步行前往</a>。</div></div></div>","<div id='route_tips' class='route_tips' style='padding: 0 10px'>百度提醒您：以上方案仅供参考，如有问题请到<a id='mapComplaintCenter' target='_blank' onClick='addStat(STAT_TOUSU_NEAR)' href='http://tousu.baidu.com/map/add'>百度地图投诉中心</a>反馈。</div>","</div>"];return a.join("")}var n="";if(this.start.wd=="未知路段"||this.end.wd=="未知路段"){}else{n=getIknowCode("想知道: "+this.cn+" 从"+this.start.wd+"到"+this.end.wd+"怎么坐公交")}if(!this.total||this.total==0){var a=["<div class='result_holder' style='padding:10px'>","<p>在<strong>"+this.cn+"</strong>未能计算出从“<span class='nr_kw'>"+this.start.wd+"</span>”到“<span class='nr_kw'>"+this.end.wd+"</span>”公交路线，抱歉。</P>",n,"<p style='padding-left:3px;margin:10px 0;height:25px;line-height:25px;background:#FFF3CB'>您可尝试查看<a href='javascript:void(0)' onclick=\"Instance('"+this.guid+"').navigate();return false;\">驾车路线</a>。</p>","<div class='nr_suggest'>您还可以：","<ul><li>看看地图当前城市是否有误，尝试更换城市</li>","<li>您可在地图上移动起点、终点，再次尝试</li>","<li>您可更换关键词再次尝试</li>","</ul></div>","<br/>","<div id='route_tips' class='route_tips'>百度提醒您：以上方案仅供参考，如有问题请到<a id='mapComplaintCenter' target='_blank' onClick='addStat(STAT_TOUSU_LIST_BT)' href='http://tousu.baidu.com/map/add'>百度地图投诉中心</a>反馈。</div>","</div>"];return a.join("")}this.schemes[this.page-1]=m.content;this.totalPage=Math.ceil(this.total/this.pagecap);if(this.cinfo._index){this.state=this.cinfo._index.split(",");this.page=parseInt(this.state[2]);this.cinfo._index=null}setSearchResult("共找到"+this.total+"条结果");var l=this.makeScheme(this.page);var d=parseFloat(BMap.Project.getDistanceByMC(c,o));if(d<1500){g=g.replace(/#walkInfo#/gi,'|&nbsp;<a href="javascript:void(0)" onclick="Instance(\''+this.guid+"').navWalk();return false;\">步行</a>");g=g.replace(/#onlywalk#/gi,'<a href="javascript:void(0)" onclick="Instance(\''+this.guid+"').navWalk();return false;\">步行前往</a>");addStat(STAT_WALK_COUNT_LINK)}else{g=g.replace(/#walkInfo#/gi,"")}g=g.replace(/#routeScheme#/gi,l);this.mapZoomLevel=map.zoomLevel;if(this.json.current_city&&this.json.current_city.sup_subway==1||this.json.result.sy==4){g=g.replace(/#type4html#/,'<div class="noSel" id="type4"><span class="lineBg">不坐地铁</span></div>')}else{g=g.replace(/#route_type_width#/,"width:209px")}g=g.replace(/#route_type_width#/,"");g=g.replace(/#type4html#/,"");return g},initialize:function(){window.YXMBusHash=this.guid;var d=this;BoxContainer.showSpecial({type:"subway"});d.navQueryString="nav&navtp=0&c="+d.currentCity+"&sy=0&drag=0&sc="+d.currentCity+"&&st=1&ec="+d.currentCity+"&et=1&sn=1$$"+d.suid+"$$"+d.startPoint+"$$"+encodeURIComponent(d.start.wd)+"$$$$$$&en=1$$"+d.euid+"$$"+d.endPoint+"$$"+encodeURIComponent(d.end.wd)+"$$$$$$&sq="+encodeURIComponent(d.s_query)+"&eq="+encodeURIComponent(d.e_query);if(this.error!=0||!this.total||this.total==0){var d=this;window.startPoi=addDestPoi(window.cxtBusPoints[0].p,"",DEST_START);window.startPoi.addEventListener("ondragstart",function(g){d.dragStart(g)});window.startPoi.addEventListener("ondraging",function(g){d.draging(g)});window.startPoi.addEventListener("ondragend",function(g){d.dragEnd(g,0)});window.startPoi.enableDragging(true);window.startPoi._sc=d.curCity.code;window.endPoi=addDestPoi(window.cxtBusPoints[1].p,"",DEST_END);window.endPoi.addEventListener("ondragstart",function(g){d.dragStart(g)});window.endPoi.addEventListener("ondraging",function(g){d.draging(g)});window.endPoi.addEventListener("ondragend",function(g){d.dragEnd(g,1)});window.endPoi.enableDragging(true);window.endPoi._ec=d.curCity.code;return}if(this.startPoint&&this.endPoint){var f=this.startPoint.split(",");var e=new BMap.Point(f[0],f[1]);var f=this.endPoint.split(",");var a=new BMap.Point(f[0],f[1]);var b=parseFloat(BMap.Project.getDistanceByMC(e,a));if(T.G("walk_tips")){if(b<1000){T.G("walk_tips").style.display="block"}else{T.G("walk_tips").style.display="none"}}}if(this.totalPage<=1){T.G("route_page").style.display="none"}this._binder();this.busTranFor3D();if(map.mapType==BMAP_TYPE_DIMENSIONAL){window.busTranFor3D(false)}function c(){d.isOperated=true}map.addEventListener("dragend",c);map.addEventListener("zoomend",c);if(this.cinfo&&this.cinfo.sms=="bt"){sms.ready("","bt");Share.setSmSCode("bt")}addAdsContent(d.json,4);setComplaintCenterURL(map,d);this.scrollPanel&&this.scrollPanel.render("route_content");T.on(window,"onresize",function(){var g=Instance(window.YXMBusHash);if(g.scrollPanel){g.scrollPanel.update()}})},load:function(){if(this.json.current_city&&this.json.current_city.sup_subway==1&&this.isSubway||this.json.result.sy==4){if(T.G("type5")){T.G("type5").style.display=T.G("label5").style.display=""}}if(this.json.taxi){var a=this.json.taxi.detail[0].totalPrice;if(T.G("taxiJG")){T.G("taxiJG").innerHTML=": "+a+"元"}}else{if(T.G("taxiCost")){T.G("taxiCost").style.display="none"}}window.resizeBusContent&&window.resizeBusContent()},unload:function(){window.cxtBusPoints=null;window.startPoi=null;window.endPoi=null;this.scrollPanel=null;T.un(window,"onresize");BoxContainer.hiddenSpecial()},setContext:function(){var c="";var b=window.conPoint;if(b){c=b.lng+","+b.lat;go("sd&pt="+c+"&r=5000",d)}var a=this;function d(p){var m=p.content;var q=p.result;if(!m){if(window.conType==0){map.removeOverlay(window.startPoi);window.startPoi=null}else{map.removeOverlay(window.endPoi);window.endPoi=null}return}if(m){var e=m.name||"未知路段";var h=q.code||modelConfig.cityCode;if(!window.cxtBusPoints){window.cxtBusPoints=[]}var o=a.strategy?a.strategy:0;var g=map.temp.infoWin;if(window.conType==0){window.cxtBusPoints[0]={p:b,n:e};if(!window.startPoi){window.startPoi=addDestPoi(window.cxtBusPoints[0].p,"",DEST_START);window.startPoi.addEventListener("ondragstart",function(r){a.dragStart(r)});window.startPoi.addEventListener("ondraging",function(r){a.draging(r)});window.startPoi.addEventListener("ondragend",function(r){a.dragEnd(r,0)});window.startPoi.enableDragging(true)}else{window.startPoi.setPoint(window.cxtBusPoints[0].p)}window.startPoi._sc=h;function l(){var t=window.startPoi.point;var r=window.endPoi.point;var u=window.startPoi._sc;var s=window.endPoi._ec;if(u!=s){addStat(STAT_CBT_RightMenu)}go("bt&c="+h+"&sc="+u+"&ec="+s+"&sn=1$$$$"+t.lng+","+t.lat+"$$"+encodeURIComponent(window.cxtBusPoints[0].n)+"$$$$$$&en=1$$$$"+r.lng+","+r.lat+"$$"+encodeURIComponent(window.cxtBusPoints[1].n)+"$$$$$$&rn="+a.pagecap)}if(window.startPoi&&window.endPoi){l()}else{if(g&&g.isOpen()&&g._ext&&g._ext.name!="未知地点"){window.endPoi=addDestPoi(g.getPoint(),"",DEST_END);window.endPoi.addEventListener("ondragstart",function(r){a.dragStart(r)});window.endPoi.addEventListener("ondraging",function(r){a.draging(r)});window.endPoi.addEventListener("ondragend",function(r){a.dragEnd(r,1)});window.endPoi.enableDragging(true);if(a.curCity&&a.curCity.code){window.endPoi._ec=a.curCity.code}else{window.endPoi._ec=h}window.cxtBusPoints[1]={p:g.getPoint(),n:g._ext.name||"未知地点",t:1};if(window.startPoi&&window.endPoi){l()}}}m=null;function k(t){var s=t.target.getPoint();var r=createSearchInfoWnd({title:e},{x:s.lng,y:s.lat,isMenu:true});openSearchInfoWnd(r,t.target);r.addEventListener("open",function(){switchInfoWndTab(1,"iw_esn")})}window.startPoi.addEventListener("click",k);window.startPoi.addEventListener("ondraging",function(r){this.closeInfoWindow();window.startPoi.removeEventListener("click",k)});return}if(window.conType==1){window.cxtBusPoints[1]={p:b,n:e};if(!window.endPoi){window.endPoi=addDestPoi(window.cxtBusPoints[1].p,"",DEST_END);window.endPoi.addEventListener("ondragstart",function(r){a.dragStart(r)});window.endPoi.addEventListener("ondraging",function(r){a.draging(r)});window.endPoi.addEventListener("ondragend",function(r){a.dragEnd(r,1)});window.endPoi.enableDragging(true)}else{window.endPoi.setPoint(window.cxtBusPoints[1].p)}window.endPoi._ec=h;function n(){var t=window.startPoi.point;var r=window.endPoi.point;var u=window.startPoi._sc;var s=window.endPoi._ec;if(u!=s){addStat(STAT_CBT_RightMenu)}go("bt&c="+h+"&sc="+u+"&ec="+s+"&sn=1$$$$"+t.lng+","+t.lat+"$$"+encodeURIComponent(window.cxtBusPoints[0].n)+"$$$$$$&en=1$$$$"+r.lng+","+r.lat+"$$"+encodeURIComponent(window.cxtBusPoints[1].n)+"$$$$$$&rn="+a.pagecap)}if(window.startPoi&&window.endPoi){n()}else{if(g&&g.isOpen()&&g._ext&&g._ext.name!="未知地点"){window.startPoi=addDestPoi(g.getPoint(),"",DEST_START);window.startPoi.addEventListener("ondragstart",function(r){a.dragStart(r)});window.startPoi.addEventListener("ondraging",function(r){a.draging(r)});window.startPoi.addEventListener("ondragend",function(r){a.dragEnd(r,0)});window.startPoi.enableDragging(true);if(a.curCity&&a.curCity.code){window.startPoi._sc=a.curCity.code}else{window.startPoi._sc=h}window.cxtBusPoints[0]={p:g.getPoint(),n:g._ext.name||"未知地点",t:0};if(window.startPoi&&window.endPoi){n()}}}m=null;function f(t){var s=t.target.getPoint();var r=createSearchInfoWnd({title:e},{x:s.lng,y:s.lat,isMenu:true});openSearchInfoWnd(r,t.target);r.addEventListener("open",function(){switchInfoWndTab(0,"iw_ssn")})}window.endPoi.addEventListener("click",f);window.endPoi.addEventListener("ondraging",function(r){this.closeInfoWindow();window.endPoi.removeEventListener("click",f)});return}}}},_binder:function(){if(this.total){this.makePage()}if(this.state[0]&&this.state[1]){this.open(parseInt(this.state[0]),parseInt(this.state[1]))}else{this.open(0,1)}var c=this;function b(l){var k=T.G("destTable_"+c.guid);var n=k.rows.length;var m=k.insertRow(n);var h=document.createElement("th");h.innerHTML="&nbsp;";h.className="no2";m.appendChild(h);var g=m.cells.length;var f=m.insertCell(m.cells.length);f.innerHTML='<input type="text" class="ipt" value="">';var d=m.insertCell(m.cells.length);d.className="modify";d.innerHTML='<a href="#">X</a>';d.onclick=function(o){k.deleteRow(this.parentNode.rowIndex)}}function a(h){if(!T.g("strategySel")){return}var d=T.g("strategySel");if(d){var g=d.getElementsByTagName("div");for(var f=0;f<g.length;f++){var e=g[f];if(h==e.id.charAt(4)){e.className="sel";e.checked=1}e.style.cursor="pointer";e.onclick=function(m){T.g("type"+c.strategy)?T.g("type"+c.strategy).className="noSel":null;c.strategy=this.id.charAt(4);this.className="sel";this.checked=1;var k=c.sBus==1?0:1;var l=c.eBus==1?0:1;if(navigator.cookieEnabled){T.cookie.set("Map_busTranType",c.strategy,{expires:new Date(new Date().getTime()+(365*24*60*60*1000))})}if(c.strategy=="4"&&!c.isSubway){return}else{go("bt&c="+c.currentCity+"&"+c.getStrategy(c.strategy)+"&sn="+k+"$$"+c.suid+"$$"+c.startPoint+"$$"+encodeURIComponent(c.start.wd)+"$$$$$$&en="+l+"$$"+c.euid+"$$"+c.endPoint+"$$"+encodeURIComponent(c.end.wd)+"$$$$$$&sq="+encodeURIComponent(c.s_query)+"&eq="+encodeURIComponent(c.e_query)+"&rn="+c.pagecap)}};e.onmouseover=function(p){var k=this,o=k.getElementsByTagName("span"),m=T.g("strategySel").getElementsByTagName("span"),q=0,n=k.id.charAt(4);for(var l=0;l<m.length;l++){if(m[l]==o[0]){q=l}}if(n==c.strategy){T.g("route_type").className="bus_strategySel bus_strategySel_on";if(n==0){m[0].className="leftBorLine leftBorLine_active_on"}else{if(n==3){m[m.length-1].className="rightBorLine rightBorLine_active_on"}}}else{k.className="noSel noSel_on";if(n==0){m[0].className="leftBorLine leftBorLine_on"}else{if(n==3){m[m.length-1].className="rightBorLine rightBorLine_on"}}}if(o[0]){o[0].className="lineBg lineBg_on"}if(((q+2)<m.length)&&m[q+1]){m[q+1].className="lineBg lineBg_on"}};e.onmouseout=function(q){var m=this,p=m.getElementsByTagName("span"),n=T.g("strategySel").getElementsByTagName("span"),r=0,o=m.id.charAt(4);for(var l=0;l<n.length;l++){if(n[l]==p[0]){r=l}}if(o==c.strategy){T.g("route_type").className="bus_strategySel";if(o==0){n[0].className="leftBorLine"}else{if(o==3){n[n.length-1].className="rightBorLine"}}}else{m.className="noSel";if(o==0){n[0].className="leftBorLine"}else{if(o==3){n[n.length-1].className="rightBorLine"}}}if(p[0]){p[0].className="lineBg"}if(((r+2)<n.length)&&n[r+1]){n[r+1].className="lineBg"}}}}}if(window.resizeBusContent&&window.clearTempRoute){T.un(window,"onresize",window.resizeBusContent)}window.resizeBusContent=function(){var e=T.G("route_top"),h=T.G("route_total");if(e){var f=T.G("route_content");var d=e.parentNode;var m=getPosition(d);var g=getClientSize();r_height=g.height-156-e.offsetHeight-(h?(h.offsetHeight):0)-10;r_height=r_height>0?r_height:0;var k=T.G("adsImg7");if(k){if(r_height-32>0){r_height=r_height-32}}var l=T.G("adswd7");if(l){if(r_height-22>0){r_height=r_height-22}}f.style.height=(r_height)+"px";d.scrollTop=scrollbottom=0}};window.clearTempRoute=function(h){var k=h||window.event;var g=T.G("route_list");if(!g){return}if(c.removeTempLine){c.removeTempLine()}var d=g.getElementsByTagName("li");for(var f=0;f<d.length;f++){if((c.schemeIndex%c.pagecap)!=f){d[f].className=""}}};window.resizeBusContent();a(c.strategy);T.on(window,"onresize",window.resizeBusContent)},makeScheme:function(f){this.loaded=false;this.page=f?f:1;var h=(this.page-1)*this.pagecap;var b=(this.page*this.pagecap);b=b<this.total?b:this.total;var a=[];for(var d=h,c=d;++c,d<b;d++){a.push("<li onclick=\"Instance('"+this.guid+"').open("+d+',1,event,1)" onMouseOver="Instance(\''+this.guid+"').mover("+d+',this,event)" onMouseMove="Instance(\''+this.guid+"').move()\" onMouseOut=\"Instance('"+this.guid+"').mout("+d+',this,event)"  >');a.push("<span class='uf_btn' id=\"span_"+d+'" onclick="Instance(\''+this.guid+"').open("+d+',1,event,2)"></span>');a.push('<div class="top">');a.push("<p>"+c+"</p>");a.push("</div>");a.push('<div id="scheme_'+d+'" class="con" >');this.routeIndex[d]=[0,0];var g=this.fill(d,0,0);a.push(g);a.push("</div>");a.push('<div class="bottom"><p></p></div>');a.push("</li>")}var e=a.join("");if(T.G("route_list")){T.G("route_list").innerHTML=e}addStat(STAT_BUS_PAGE);return e},makePage:function(){var a=this;var b=new Page("route_page",function(f){var h=(f-1)*a.pagecap;a.routePoints=[];a.sWalkPoints=[];a.eWalkPoints=[];a.tWalkPoints=[];a.transPoints=[];a.sTransPoints=[];a.routeBound=[];a.sWalkBound=[];a.tWalkBound=[];a.eWalkBound=[];if(!a.schemes[f-1]){var c=a.sBus==1?0:1;var e=a.eBus==1?0:1;var d="bt&c="+a.currentCity+"&"+a.getStrategy(a.strategy)+"&sn="+c+"$$"+a.suid+"$$"+a.startPoint+"$$"+encodeURIComponent(a.start.wd)+"$$$$$$&en="+e+"$$"+a.euid+"$$"+a.endPoint+"$$"+encodeURIComponent(a.end.wd)+"$$$$$$&sq="+encodeURIComponent(a.s_query)+"&eq="+encodeURIComponent(a.e_query)+"&bpn="+f+"&brn="+a.pagecap;go(d,g)}else{a.makeScheme(f);a.open(h,1)}function g(k){if(k){a.schemes[f-1]=k.content}a.makeScheme(f);a.open(h,1)}},{pageCount:a.totalPage,page:a.page})},fill:function(O,K,R){var aB=this;var ao=this.schemes[this.page-1][O-(this.page-1)*this.pagecap];if(!this.routeIndex[O]){this.routeIndex[O]=[0,0]}this.routeIndex[O]=[K,R];var a=this.routeIndex[O];var S=0;var Q=0;var F=0;var u=0;var ac="";var aw=a[0];var C=ao.lines;var I=C[aw];var f=ao.stops[aw];if(!ao.stops[0].length){f=ao.stops}var ar=f.length;var ap=I.length;if(!this.routePoints[O]){this.routePoints[O]=[]}if(!this.sWalkPoints[O]){this.sWalkPoints[O]=[]}if(!this.eWalkPoints[O]){this.eWalkPoints[O]=[]}if(!this.tWalkPoints[O]){this.tWalkPoints[O]=[]}if(!this.transPoints[O]){this.transPoints[O]=[]}if(!this.sTransPoints[O]){this.sTransPoints[O]=[]}if(!this.routeBound[O]){this.routeBound[O]=[]}if(!this.sWalkBound[O]){this.sWalkBound[O]=[]}if(!this.tWalkBound[O]){this.tWalkBound[O]=[]}if(!this.eWalkBound[O]){this.eWalkBound[O]=[]}this.transWins[O]=[];this.switchLines[O]=[];if(!this.changeHtmls[O]){this.changeHtmls[O]=[]}if(!this.schemeNames[O]||this.clickIndex[O]==undefined){this.schemeNames[O]=[]}if(!this.stopUids[O]){this.stopUids[O]=[]}if(!this.stopPts[O]){this.stopPts[O]=[]}var b=[];var Y=0;var ad=0;if(!this.busType[O]){this.busType[O]=[]}for(var V=0;V<ap;V++){var s=[];var J=I[V];if(typeof(J)=="object"){Y++;var w;var aj;if(J.name.indexOf("\u5730\u94c1")>-1&&J.name.indexOf("\u53f7\u7ebf")>-1){aj=J.name.indexOf("环(")>-1?J.name.substr(0,J.name.indexOf("环("))+"环)":J.name;aj=aj.indexOf("环")>-1?aj:aj.replace(/\(.*?-(.*?)\)/,"($1")+"方向)";w=J.name.indexOf("(")>-1?J.name.substr(0,J.name.indexOf("(")):J.name}else{aj=J.name.indexOf("(")>-1?J.name.substr(0,J.name.indexOf("(")):J.name;if(isInteger(aj)){aj+="路"}w=aj}var aE=J.type||0;if(aE==1){this.isSubway=true}this.busType[O].push({t:aE,n:aj});var c=J.uid;S+=J.distance;if(this.clickIndex[O]==undefined){this.schemeNames[O].push(w)}else{if(this.clickIndex[O]==V){this.schemeNames[O].splice(this.clickIndex[O],1,w)}}var W=parse2Geo(J.geo);this.routeBound[O].push(W.bound);this.routePoints[O].push(W.points);if(this.clickIndex[O]==undefined&&!this.para[O]){this.stopUids[O].push(J.st_uid);this.stopUids[O].push(J.ed_uid)}var au=a[1];var al=[];for(var U=0;U<C.length;U++){var an=C[U][V];var aG;if(an.name.indexOf("\u5730\u94c1")>-1&&an.name.indexOf("\u53f7\u7ebf")>-1){aG=an.name.indexOf("环(")>-1?an.name.substr(0,an.name.indexOf("环("))+"环)":an.name;aG=aG.indexOf("环")>-1?aG:aG.replace(/\(.*?-(.*?)\)/,"($1")+"方向)"}else{aG=an.name.indexOf("(")>-1?an.name.substr(0,an.name.indexOf("(")):an.name;if(isInteger(aj)){aG+="路"}}var aC=an.uid;if(U!=aw&&c!=aC){if(al.toString().indexOf(aC)==-1){al.push(aC);var aM=ao.stops[U];var M=aM[V].getOn;var P=aM[V+1].getOff;var ax,ah="";if(M.geo&&P.geo){var ax=parse2Geo(M.geo).points;var ah=parse2Geo(P.geo).points}s.push(' <a href="javascript:void(0)" onclick="Instance(\''+this.guid+"').show("+O+","+U+","+V+",'"+an.st_uid+"','"+an.ed_uid+"','"+ax+"','"+ah+"',event);return false;\" onmouseover=\"Instance('"+this.guid+"').select("+O+","+U+","+V+')" onmouseout="Instance(\''+this.guid+"').unselect("+O+","+U+","+V+')">'+aG+"</a>")}}}var ab=this.changeTS.replace(/#guid#/gi,this.guid);if(this.state[3]){if(parseInt(this.state[0])==O&&parseInt(this.state[3])==V){ab=ab.replace(/#className#/gi,"sel")}else{ab=ab.replace(/#className#/gi,"")}}else{ab=ab.replace(/#className#/gi,"")}var aN=this.returnLType(aE);var ak="bybus";if(aN==0){ak="bybus"}else{if(aN==1){ak="bysub"}else{if(aN==2){ak="byship"}}}ab=ab.replace(/#typeClass#/gi,ak);ab=ab.replace(/#tIndex#/gi,O);ab=ab.replace(/#rIndex#/gi,V);ab=ab.replace(/#lineName#/gi,aj);var Q=(J.time/60).toFixed(1);ab=ab.replace(/#transTime#/gi,Q);if(V==0){var q=f[V].getOn;var L=parse2Geo(q.geo).points;var G=this.spliceSN(q.name);ab=ab.replace(/#getOnName#/gi,G);ab=ab.replace(/#sIndex#/gi,V+1)}else{if(V<=ap-6&&V!=0){var q=f[V].getOn;var L=parse2Geo(q.geo).points;var G=this.spliceSN(q.name);ab=ab.replace(/#getOnName#/gi,G);ab=ab.replace(/#sIndex#/gi,2*V+1)}}var av="";if(V>0&&V<=ap-6){var k=f[V];var Z=k.getOff;var aI=k.getOn;var B=k.walk;var am=parse2Geo(Z.geo).points;var L=parse2Geo(aI.geo).points;if(aI.name!=Z.name||B&&B.distance>=25){av=this.walkTS.replace(/#guid#/gi,this.guid);av=av.replace(/#tIndex#/gi,O);av=av.replace(/#wIndex#/gi,ad);av=av.replace(/#wType#/gi,1);if(this.state[4]&&this.state[5]){if(parseInt(this.state[0])==O&&parseInt(this.state[4])==ad&&parseInt(this.state[5])==1){av=av.replace(/#className#/gi,"sel")}else{av=av.replace(/#className#/gi,"")}}else{av=av.replace(/#className#/gi,"")}var v=B.distance;if(v<10){v=10+"米"}else{if(v>10&&v<=1000){v=(v/10).toFixed(0)*10+"米"}else{if(v>1000){v=(v/1000).toFixed(1)+"公里"}}}if(this.busType[O][V-1].t==1&&this.busType[O][V].t==1){av=av.replace(/到达/gi,"换乘");av=av.replace(/步行至/gi,"站内换乘");av=av.replace(/#walkName#/gi,aj);av=av.replace(/#wInfo#/gi,"{inSubway:1}");av=av.replace(/#walkDistance#/gi,v)}else{av=av.replace(/#wInfo#/gi,"{}");var aK=B.ename?("<span>("+T.trim(B.ename)+")</span>"):"";var G="<span class='ks' onclick=\"addStat(STAT_BUS_STKEY);Instance('"+this.guid+"').clickStop(event,"+O+","+(2*V+1)+')">'+G+"</span>";av=av.replace(/#walkName#/gi,G);av=av.replace(/#walkDistance#/gi,'<a class="cs">'+v+"</a>")}var af=(B.time/60).toFixed(1);av=av.replace(/#walkTime#/gi,af);b.push(av)}if(B){ad++}}if(V==ap-6){var aq=this.spliceSN(f[ar-1].getOff.name);ab=ab.replace(/#getOffName#/gi,aq);ab=ab.replace(/#cIndex#/gi,2*(ar-1))}else{if(V>=0){var aq=this.spliceSN(f[V+1].getOff.name),aF=f[V+1],h=aF.walk,z="";if(h&&h.distance>0){z=(h.sname?("<span>("+T.trim(h.sname)+")</span>"):"")}ab=ab.replace(/#getOffName#/gi,aq);ab=ab.replace(/#getOffExit#/gi,z);ab=ab.replace(/#cIndex#/gi,2*(V+1))}}ab=ab.replace(/#viaStops#/gi,J.station_num);ab=ab.replace(/#lineUid#/gi,J.uid);ab=ab.replace(/#stUid#/gi,J.st_uid);ab=ab.replace(/#edUid#/gi,J.ed_uid);var v=(J.distance/1000).toFixed(1);ab=ab.replace(/#viaDistance#/gi,v);var ay=s.join(",");this.switchLines[O].push(ay);if(ay){ab=ab.replace(/#changLines#/gi,'<span class="also_t">(或'+ay+")</span>")}else{ab=ab.replace(/#changLines#/gi,"")}if(this.clickIndex[O]==V){this.changeHtmls[O][V]=ab}else{if(this.clickIndex[O]==undefined){this.changeHtmls[O].push(ab)}}b.push(this.changeHtmls[O][V])}}for(var V=0;V<ar;V++){var az=f[V];var P=az.getOff;var M=az.getOn;var ah=parse2Geo(P.geo);var ax=parse2Geo(M.geo);var aL=az.walk;S+=aL.distance;if(V==0){var G=this.spliceSN(M.name);if(this.clickIndex[O]==undefined&&!this.geoloaded[O]){this.transPoints[O].push([ah.points,P.name,-1]);this.transPoints[O].push([ax.points,G,this.busType[O][V].t])}else{this.transPoints[O][2*V]=[ah.points,P.name,-1];this.transPoints[O][2*V+1]=[ax.points,G,this.busType[O][V].t]}if(aL&&aL.geo&&aL.distance>0){var m=parse2Geo(aL.geo);try{m.points+=(";"+this.transPoints[O][1][0])}catch(aa){}this.sWalkPoints[O].push(m.points);this.sWalkBound[O].push(m.bound)}if(this.clickIndex[O]==undefined&&!this.para[O]){this.stopPts[O].push(ah.points);this.stopPts[O].push(ax.points)}var aA=null;if(az&&az.getOn&&az.getOn.uid!=""&&this.json.result.start.uid!=""&&this.json.result.start.bus_stop=="1"){aA=az.getOn.uid}else{if(this.json.result.start&&this.json.result.start.uid&&this.json.result.start.uid!=""){aA=this.json.result.start.uid}}this.transWins[O].push(createTransInfoWnd({title:this.start.wd,curIndex:2*V,total:ar*2,obj:this,nextInfo:"到"+G,nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk,transUid:aA}));var aq=this.spliceSN(f[1].getOff.name);this.transWins[O].push(createTransInfoWnd({title:G+"上车",content:D(O,V),curIndex:2*V+1,total:ar*2,obj:this,nextInfo:"到"+aq+"下车",nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}))}if(V>0&&V<ar-1){var aq=this.spliceSN(P.name);var G=this.spliceSN(M.name);if(this.clickIndex[O]==undefined&&!this.geoloaded[O]){this.transPoints[O].push([ah.points,aq,this.busType[O][V-1].t]);this.transPoints[O].push([ax.points,G,this.busType[O][V].t])}else{this.transPoints[O][2*V]=[ah.points,aq,this.busType[O][V-1].t];this.transPoints[O][2*V+1]=[ax.points,G,this.busType[O][V].t]}if(aL&&aL.geo&&aL.distance>=0){var m=parse2Geo(aL.geo);try{m.points=this.transPoints[O][2*V][0]+";"+m.points+";"+this.transPoints[O][2*V+1][0]}catch(aa){}this.tWalkPoints[O].push(m.points);this.tWalkBound[O].push(m.bound)}if(this.clickIndex[O]==undefined&&!this.para[O]){this.stopPts[O].push(ah.points);this.stopPts[O].push(ax.points)}var p="到"+G+"上车";if(this.busType[O][V-1].t==1&&this.busType[O][V].t==1){p="换乘"+this.busType[O][V].n}this.transWins[O].push(createTransInfoWnd({title:aq+"下车",content:D(O,V-1,"down"),curIndex:2*V,total:ar*2,obj:this,nextInfo:p,nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}));var aq=this.spliceSN(f[V+1].getOff.name);this.transWins[O].push(createTransInfoWnd({title:G+"上车",content:D(O,V),curIndex:2*V+1,total:ar*2,obj:this,nextInfo:"到"+aq+"下车",nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}))}if(V==ar-1){var aq=this.spliceSN(P.name);if(this.clickIndex[O]==undefined&&!this.geoloaded[O]){this.transPoints[O].push([ah.points,aq,this.busType[O][V-1].t]);this.transPoints[O].push([ax.points,M.name,-1])}if(aL&&aL.geo&&aL.distance>0){var m=parse2Geo(aL.geo);try{var aD=this.transPoints[O];m.points=aD[aD.length-2][0]+";"+m.points}catch(aa){}this.eWalkPoints[O].push(m.points);this.eWalkBound[O].push(m.bound)}if(this.clickIndex[O]==undefined&&!this.para[O]){this.stopPts[O].push(ah.points);this.stopPts[O].push(ax.points)}this.transWins[O].push(createTransInfoWnd({title:aq+"下车",content:D(O,V-1,"down"),curIndex:2*V,total:ar*2,obj:this,nextInfo:"到达"+this.end.wd,nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}));var N;if(az&&az.getOff&&az.getOff.uid!=""&&this.json.result.end.uid!=""&&this.json.result.end.bus_stop=="1"){N=az.getOff.uid}else{if(this.json.result.end&&this.json.result.end.uid&&this.json.result.end.uid!=""){N=this.json.result.end.uid}}this.transWins[O].push(createTransInfoWnd({title:this.end.wd,curIndex:2*V+1,total:ar*2,obj:this,nextInfo:"",nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk,transUid:N}))}}function D(l,e){var g=[];if(arguments[2]=="down"){g.push("<dl tid='iwLineBox' class='lfs'><dt>"+I[e].name+"</dt>")}else{g.push("<dl tid='iwLineBox' class='lfs'><dt>乘坐"+I[e].name+"</dt>")}g.push('<dd><table cellspacing="1" cellpadding="0" width="100%">');if(I[e].startTime){g.push("<tr><th>起点站首末班时间</th><td>"+I[e].startTime+" - "+I[e].endTime+"</td></tr>")}if(I[e].zonePrice&&I[e].zonePrice!=0){g.push("<tr><th>地铁全程票价</th><td>"+(I[e].zonePrice/100).toFixed(2)+"元</td></tr>")}else{if(aB.returnLType(I[e].type)!=1&&I[e].totalPrice){g.push("<tr><th>单程最高票价</th><td>"+(I[e].totalPrice/100).toFixed(2)+"元</td></tr>")}}g.push("</table></dd>");if(arguments[2]!="down"){if(aB.switchLines[l][e]!=""){g.push("<dd class='op'>也可乘坐:"+aB.switchLines[l][e]+"</dd>")}}g.push("</dl>");return g.join("")}Q=I[Y+1];F=I[Y+2];totaldis=I[Y+3];totaltime=I[Y+4];ac=this.schemeNames[O].join("&nbsp;<span class='rarr'>→</span>&nbsp;");var o=[];var at=S<1000?S+"米":(S/1000).toFixed(1)+"公里";o.push('<p id="blInfo_'+O+'" class="way">'+ac+'<span id="blDis_'+O+"\" class='km'> 全程约"+formatTime(Q,"bustime")+" / "+at+"</span></p>");if(this.db==1){o.push('<p class="debug"><br/>db:[distance:'+S+",time:"+Q+",price:"+F+",<br/>walk_distance:"+totaldis+",walk_time:"+totaltime+"]</p>")}if(this.clickIndex[O]==undefined){o.push('<div class="info" id="route_'+(O)+'">')}else{o.push('<div class="info" style="display:block" id="route_'+(O)+'">')}o.push('<h3 class="no1 arr" onclick="Instance(\''+this.guid+"').clickStop(event,"+O+',0)"><span><strong id="startInfo_'+O+'">'+this.startName+"</strong></span></h3>");o.push('<table id="trans_'+O+'" cellspacing="0" cellpadding="0">');var A=f[0],X=A.walk;if(X&&X.distance>0){var aJ='<a class="cs">'+this.formatDis(X.distance)+"</a>";var ae=(X.time/60).toFixed(1);var E=X.ename?("<span>("+T.trim(X.ename)+")</span>"):"";var G="<span class='ks' onclick=\"addStat(STAT_BUS_STKEY);Instance('"+this.guid+"').clickStop(event,"+O+',1)">'+this.spliceSN(A.getOn.name)+"</span>";var ai=this.walkTS.replace(/#guid#/gi,this.guid);ai=ai.replace(/#tIndex#/gi,O);ai=ai.replace(/#wIndex#/gi,0);ai=ai.replace(/#wType#/gi,0);ai=ai.replace(/#walkName#/gi,G);ai=ai.replace(/#walkDistance#/gi,aJ);ai=ai.replace(/#walkTime#/gi,ae);ai=ai.replace(/#wInfo#/gi,"{}");if(this.state[4]&&this.state[5]){if(parseInt(this.state[0])==O&&parseInt(this.state[4])==0&&parseInt(this.state[5])==0){ai=ai.replace(/#className#/gi,"sel")}else{ai=ai.replace(/#className#/gi,"")}}else{ai=ai.replace(/#className#/gi,"")}o.push(ai)}o.push(b.join(""));var aF=f[ar-1],h=aF.walk;if(h&&h.distance>0){var H='<a class="cs">'+this.formatDis(h.distance)+"</a>";var aH=(h.time/60).toFixed(1);var y=this.walkTS.replace(/#guid#/gi,this.guid);y=y.replace(/#tIndex#/gi,O);y=y.replace(/#wIndex#/gi,0);y=y.replace(/#wType#/gi,2);y=y.replace(/#walkName#/gi,this.endName);y=y.replace(/#walkDistance#/gi,H);y=y.replace(/#walkTime#/gi,aH);y=y.replace(/#wInfo#/gi,"{}");if(this.state[4]&&this.state[5]){if(parseInt(this.state[0])==O&&parseInt(this.state[4])==0&&parseInt(this.state[5])==2){y=y.replace(/#className#/gi,"sel")}else{y=y.replace(/#className#/gi,"")}}else{y=y.replace(/#className#/gi,"")}o.push(y)}o.push("</table>");o.push('<span id="endSpan"><h3 class="no2" onclick="Instance(\''+this.guid+"').clickStop(event,"+O+","+(2*ar-1)+')"><span><strong id="endInfo_'+O+'">'+this.endName+"</strong></span> </h3></span>");o.push('<div class="stmc">');o.push('<div class="busPrintButton" tid=\'busPrintBtn_'+O+"' onclick='return printMap(this.getElementsByTagName(\"a\")[0]);'><img src=\""+MapConfig.smFlwCon+'image/transparent.gif" alt="打印" /><a href="javascript:void(0)"  title="打印" target=\'Print\'>打印</a></div>');o.push("<div tid='busSmSBtn_"+O+"' onclick='sms.ready(this,\"bt\")'><img src=\""+MapConfig.smFlwCon+'image/transparent.gif" alt="发送到手机" /><a href="javascript:void(0)" onclick="return false" title="发送到手机" >发送到手机</a></div>');var x=this.guid+"_favbtn_"+O;o.push('<div class="afav" id=\''+x+"' tid='busFavBtn_"+O+"' onclick=\"Instance('"+this.guid+'\').addToFav(this, event)"\' title="加入收藏夹"><img src="'+MapConfig.smFlwCon+'image/transparent.gif" /><a href="javascript:void(0)" >收藏</a></div>');var ag=new Date(),d="#3D6DCC";if((ag-Date.parse("04/26/2012"))>=0&&(ag-Date.parse("05/04/2012"))<=0){d="#E60000"}o.push('<div style="float:left;"><a style="color:'+d+'" onclick="PcToMobile.open(\'BUS\')" href="javascript:void(0)">下载手机地图</a></div>');o.push("</div>");o.push("</div>");this.para[O]=true;return o.join("")},open:function(h,b,g,d){var g=g||window.event;if(g){stopBubble(g)}searchInViewCtrl.exit();var f=this;if(!f.routeIndex[h]){f.routeIndex[h]=[0,0]}if(f.schemeIndex!=h){f.schemeIndex=h;f.addPoiRoute(h,f.routeIndex[h][0],f.routeIndex[h][1]);if(f.state[0]&&f.state[3]){f.highRoute(null,parseInt(f.state[0]),parseInt(f.state[3]),null);f.state[3]=null}if(f.state[4]&&f.state[5]){f.highWalk(null,parseInt(f.state[0]),parseInt(f.state[4]),parseInt(f.state[5]),null);f.state[4]=null;f.state[5]=null}}else{f.addPoiRoute(h,f.routeIndex[h][0],f.routeIndex[h][1])}try{f.addWalkIcon(f.json.content[f.schemeIndex].stops[0])}catch(g){}c(h,b,g,d);function a(e,k){if(e.currentStyle){return e.currentStyle[k]}else{if(window.getComputedStyle){k=k.replace(/([A-Z])/g,"-$1");k=k.toLowerCase();return window.getComputedStyle(e,"").getPropertyValue(k)}}return null}function c(m,x,u,y){var o=T.G("trans_"+m);if(o&&f.loaded==true){for(var r=0;r<o.rows.length;r++){o.rows[r].className="";f.rindex=-1;f.tindex=-1;f.windex=-1}}var l=(f.page-1)*f.pagecap;var q=(f.page*f.pagecap);q=q<f.total?q:f.total;for(var r=l;r<q;r++){var k=T.G("route_"+r);var v=T.G("span_"+r);var w=v.parentNode;if(m==l&&f.loaded==false){T.ac(w,"on");T.ac(w,"active");k.style.display="block";if(T.G("route_content")){T.G("route_content").scrollTop=0}f.loaded=true}if(m==r&&x==1){if(y&&y!=1){var p=a(k,"display");if(p!="none"){v.className="uf_btn";k.style.display="none";T.rc(w,"active");addStat(STAT_BUS_THUMB,{n:m});f.unfold=0;if(T.G("scheme_"+r)){T.G("scheme_"+r).style.marginBottom=""}}else{v.className="f_btn";k.style.display="block";T.ac(w,"active");if(f.loaded==true){addStat(STAT_BUS_UNFOLD,{n:m})}else{f.loaded=true}f.unfold=1;if(T.G("scheme_"+r)){T.G("scheme_"+r).style.marginBottom="0"}}}else{v.className="f_btn";k.style.display="block";T.ac(w,"active");f.unfold=1;addStat(STAT_BUS_UNFOLD,{n:m});if(T.G("scheme_"+r)){T.G("scheme_"+r).style.marginBottom="0"}}T.ac(w,"on")}else{if(m==r&&x==0){T.ac(w,"on")}else{v.className="uf_btn";k.style.display="none";w.className="";if(T.G("scheme_"+r)){T.G("scheme_"+r).style.marginBottom=""}}}}Share.listIndex=m+","+f.unfold+","+f.page}this.hideWalkContent();this.scrollPanel&&this.scrollPanel.update();SchemeFaver.isRepeat.call(this,{pathtype:1,dom:T.G(this.guid+"_favbtn_"+h)})},removePoi:function(){if(this.transPois){for(var a=0;a<this.transPois.length;a++){map.removeOverlay(this.transPois[a])}this.transPois=null}},removeTip:function(){if(this.zoneStaTips){for(var b=0,a=this.zoneStaTips.length;b<a;b++){map.removeOverlay(this.zoneStaTips[b])}for(var b=0;b<this.zoneBusStopPois.length;b++){if(this.zoneBusStopPois[b]){this.zoneBusStopPois[b].remove();this.zoneBusStopPois[b]=null}}}},removeLine:function(){if(this.routeLines){for(var a=0;a<this.routeLines.length;a++){removeRoute(this.routeLines[a])}this.routeLines=null}if(this.sWalkLines){for(var a=0;a<this.sWalkLines.length;a++){removeRoute(this.sWalkLines[a])}this.sWalkLines=null}if(this.tWalkLines){for(var a=0;a<this.tWalkLines.length;a++){removeRoute(this.tWalkLines[a])}this.tWalkLines=null}if(this.eWalkLines){for(var a=0;a<this.eWalkLines.length;a++){removeRoute(this.eWalkLines[a])}this.eWalkLines=null}if(this.highLine){removeRoute(this.highLine)}},addPoi:function(t,m,u){var v=this.schemes[this.page-1][t-(this.page-1)*this.pagecap];var C=this,e=new BMap.Size(7,-40);var b=C.transPoints[t];if(!b){return}var D=b.length;for(var y=0,x=0;y<D;y++){var k;if(y==0){k=addDestPoi(b[y][0],"拖动以更改路线",DEST_START);k.addEventListener("ondragstart",function(l){C.dragStart(l)});k.addEventListener("ondraging",function(l){C.draging(l)});k.addEventListener("ondragend",function(l){C.dragEnd(l,0)});if(map.mapType!=BMAP_TYPE_DIMENSIONAL){k.enableDragging(true)}window.startPoi=k;window.startPoi._sc=C.curCity.code}else{if(y==D-1){k=addDestPoi(b[y][0],"拖动以更改路线",DEST_END);k.addEventListener("ondragstart",function(l){C.dragStart(l)});k.addEventListener("ondraging",function(l){C.draging(l)});k.addEventListener("ondragend",function(l){C.dragEnd(l,1)});if(map.mapType!=BMAP_TYPE_DIMENSIONAL){k.enableDragging(true)}window.endPoi=k;window.endPoi._ec=C.curCity.code}else{if(y>0&&y<D-1){var z=C.returnLType(b[y][2]);var d=0;if(z==0){d=TRANS_TYPE_BUS}else{if(z==1){d=TRANS_TYPE_SUB}else{if(z==2){d=TRANS_TYPE_BUS}}}k=addTransPoi(b[y][0].toString(),d,b[y][1]);var c=C.transWins[t][y];k.addEventListener("click",C.getClickMarker(c,k,y));if(y%2!=0){var w=v.lines[m][x++];if(typeof w!=="object"){return}var s=w.name,f=s.indexOf("("),s=(f>=0?s.substring(0,f):s);s+=(!/\D+/.test(s))?"路":"";var B=w.time;C.zoneStaTips.push(createTip("乘坐"+s+"<span>约"+formatTime(B)+"</span>","TipC2",{point:k.getPoint(),offset:new BMap.Size(8,-57),style:{background:"url("+MapConfig.smFlwCon+"image/tip2.gif) 0 0 no-repeat",color:"#000",height:"48px",border:"0",padding:"0 0 0 4px"}}));this.sTransPoints[t].push(k.getPoint())}}}}if(k){var h=y;var o=b[h].toString();var c=C.transWins[t][h];if(c){if(C.cinfo._popIndex==h){C.getClickMarker(c,k,C.cinfo._popIndex)();C.cinfo._popIndex=null}}if(!C.transPois){C.transPois=[]}C.transPois.push(k)}}if(C.transPois){var A=C.transWins[t][0];var q=C.transPois[0];window.openSWin=function(){C.getClickMarker(A,q,0)()};q.addEventListener("click",window.openSWin);var a=C.transWins[t][D-1];var g=C.transPois[D-1];window.openEWin=function(){C.getClickMarker(a,g,D-1)()};g.addEventListener("click",window.openEWin)}},dragStart:function(a){this.dateStart=new Date().getTime()},draging:function(a){this.dateEnd=new Date().getTime();var b=this.dateEnd-this.dateStart;if(b>10&&this.transPois){this.transPois[0].removeEventListener("click",window.openSWin);this.transPois[this.transPois.length-1].removeEventListener("click",window.openEWin)}},dragEnd:function(h,a){var g=h.target;if(g){var f=g.point;if(f){var d=f.lng+","+f.lat;go("sd&pt="+d+"&r=5000",c);MapHunter.record("rt",1,{pt:f,t:a})}var b=this}function c(r){var o=r.content;var q=r.result.code;if(o){var e=o.name||"未知路段";var p,n;if(a==0){window.cxtBusPoints[0]={p:f,n:e,t:0};p=q;n=b.curCity.code}else{window.cxtBusPoints[1]={p:f,n:e,t:1};n=q;p=b.curCity.code}if(window.cxtBusPoints[0]&&window.cxtBusPoints[1]){var l=window.cxtBusPoints[0].p.lng+","+window.cxtBusPoints[0].p.lat;var s=window.cxtBusPoints[1].p.lng+","+window.cxtBusPoints[1].p.lat;go("bt&c="+modelConfig.cityCode+"&sc="+p+"&ec="+n+"&"+b.getStrategy(b.strategy)+"&sn=1$$$$"+l+"$$"+encodeURIComponent(window.cxtBusPoints[0].n)+"$$$$$$&en=1$$$$"+s+"$$"+encodeURIComponent(window.cxtBusPoints[1].n)+"$$$$$$&rn="+b.pagecap)}else{if(a==0){function m(v){var u=v.target.getPoint();var t=createSearchInfoWnd({title:e},{x:u.lng,y:u.lat,isMenu:true});openSearchInfoWnd(t,v.target);switchInfoWndTab(1,"iw_esn")}window.startPoi.addEventListener("click",m);window.startPoi.addEventListener("ondraging",function(t){this.closeInfoWindow();window.startPoi.removeEventListener("click",m)})}else{function k(v){var u=v.target.getPoint();var t=createSearchInfoWnd({title:e},{x:u.lng,y:u.lat,isMenu:true});openSearchInfoWnd(t,v.target);switchInfoWndTab(0,"iw_ssn")}window.endPoi.addEventListener("click",k);window.endPoi.addEventListener("ondraging",function(t){this.closeInfoWindow();window.endPoi.removeEventListener("click",k)})}}}else{if(b.transPois){var l=getPointByStr(b.startPoint);b.transPois[0].setPoint(l);var s=getPointByStr(b.endPoint);b.transPois[b.transPois.length-1].setPoint(s)}}}},addRoute:function(d,a,f){var e=this.routePoints[d];if(!e){return}for(var h=0;h<e.length;h++){var c=addRoute(e[h].toString(),ROUTE_TYPE_BUS);if(!this.routeLines){this.routeLines=[]}this.routeLines.push(c)}var g=this.sWalkPoints[d];for(var h=0;h<g.length;h++){var k=addRoute(g[h].toString(),ROUTE_TYPE_WALK);if(!this.sWalkLines){this.sWalkLines=[]}this.sWalkLines.push(k)}var b=this.tWalkPoints[d];for(var h=0;h<b.length;h++){var k=addRoute(b[h].toString(),ROUTE_TYPE_WALK);if(!this.tWalkLines){this.tWalkLines=[]}this.tWalkLines.push(k)}var m=this.eWalkPoints[d];for(var h=0;h<m.length;h++){var k=addRoute(m[h].toString(),ROUTE_TYPE_WALK);if(!this.eWalkLines){this.eWalkLines=[]}this.eWalkLines.push(k)}},addTempRoute:function(d,a,f){var e=this.routePoints[d];if(!e){return}this.tempLineIndex=d;for(var h=0;h<e.length;h++){var c=addRoute(e[h].toString(),ROUTE_TYPE_TEMP_BUS);if(!this.tempRouteLines){this.tempRouteLines=[]}this.tempRouteLines.push(c)}var g=this.sWalkPoints[d];for(var h=0;h<g.length;h++){var k=addRoute(g[h].toString(),ROUTE_TYPE_TEMP_WALK);if(!this.sTempWalkLines){this.sTempWalkLines=[]}this.sTempWalkLines.push(k)}var b=this.tWalkPoints[d];for(var h=0;h<b.length;h++){var k=addRoute(b[h].toString(),ROUTE_TYPE_TEMP_WALK);if(!this.tTempWalkLines){this.tTempWalkLines=[]}this.tTempWalkLines.push(k)}var m=this.eWalkPoints[d];for(var h=0;h<m.length;h++){var k=addRoute(m[h].toString(),ROUTE_TYPE_TEMP_WALK);if(!this.eTempWalkLines){this.eTempWalkLines=[]}this.eTempWalkLines.push(k)}},removeTempLine:function(){if(this.tempRouteLines){for(var a=0;a<this.tempRouteLines.length;a++){removeRoute(this.tempRouteLines[a])}this.tempRouteLines=null}if(this.sTempWalkLines){for(var a=0;a<this.sTempWalkLines.length;a++){removeRoute(this.sTempWalkLines[a])}this.sTempWalkLines=null}if(this.tTempWalkLines){for(var a=0;a<this.tTempWalkLines.length;a++){removeRoute(this.tTempWalkLines[a])}this.tTempWalkLines=null}if(this.eTempWalkLines){for(var a=0;a<this.eTempWalkLines.length;a++){removeRoute(this.eTempWalkLines[a])}this.eTempWalkLines=null}},addPoiRoute:function(d,a,e){map.closeInfoWindow();this.removeLine();this.removePoi();this.removeTip();this.addRoute(d,a,e);this.addPoi(d,a,e);var f;if(this.routeBound[d]){f=this.routeBound[d].concat(this.sWalkBound[d],this.tWalkBound[d],this.eWalkBound[d])}var k=getBPoints(f);if(this.cinfo._maplevel&&this.cinfo._centerPoint){map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel);this.cinfo._centerPoint=null;this.cinfo._maplevel=null}else{if(k){if(map.mapType==BMAP_TYPE_DIMENSIONAL){var c=BMap.MapType[BMAP_TYPE_DIMENSIONAL].citys;var g=c[map.currentCity][1];var h=getPointsBounds(k);var b=getBitLevel(h);if(g.intersects(h)){if(b<=15){b=15}map.centerAndZoom(window.startPoi.getPoint(),b)}else{maptypeCtrl.select(BMAP_TYPE_NORMAL);setViewport(k,this.expend);add3DTip();setTimeout(function(){var l=T.G("DEM_CustomTip1");remove3DTip(l)},3000)}}else{setViewport(k,this.expend)}this.mapZoomLevel=map.zoomLevel}}},getClickMarker:function(a,b,c){return function(){Share.popIndex=c;transInfoWindow(b,a)}},close:function(a,b){},show:function(q,p,s,m,h,d,o,w){var w=w||window.event;var y=this;stopBubble(w);if(y.redRoute){unSelectRoute(y.redRoute)}y.clickIndex[q]=s;y.routeIndex[q]=[p,s];y.stopUids[q][2*s]=m;y.stopUids[q][2*s+1]=h;y.stopPts[q][2*s+1]=d;y.stopPts[q][2*s+2]=o;var f=y.schemes[y.page-1][q-(y.page-1)*y.pagecap].stops[p];var k=f[0].getOff;var z=f[f.length-1].getOn;var v=y.stopPts[q][0]=parse2Geo(k.geo).points;var a=y.stopPts[q][y.stopPts[q].length-1]=parse2Geo(z.geo).points;y.routePoints[q]=[];y.sWalkPoints[q]=[];y.tWalkPoints[q]=[];y.eWalkPoints[q]=[];y.routeBound[q]=[];y.sWalkBound[q]=[];y.tWalkBound[q]=[];y.eWalkBound[q]=[];var g=y.routePoints[q];if(!g||g.length==0){var c="blg&blgtp=0&c="+y.currentCity+"&sn="+v+"&en="+a+"&uids=["+y.stopUids[q].join(",")+"]";go(c,x)}else{y.schemeIndex=q;T.G("scheme_"+q).innerHTML=y.fill(q,p,s);for(var t=0,u=y.transPoints[q].length;t<u;t++){y.transPoints[q][t][0]=y.stopPts[q][t]}y.addPoiRoute(q,p,s);var b=T.G("route_"+q);b.style.display=b.style.display=="block"?"none":"block"}function x(H){var D=H.content;if(D){if(!y.routeBound[q]){y.boundBound[q]=[]}var I=D.line;var l=y.schemes[y.page-1][q-(y.page-1)*y.pagecap];if(I){var F=l.lines[p];for(var r=0;r<I.length;r++){var A=I[r];F[r].geo=A.geo}}var E=D.walk;if(E.length>0){var G=l.stops[p];for(var n=0;n<E.length;n++){G[n].walk.distance=E[n].dis;G[n].walk.geo=E[n].geo}}y.schemeIndex=q;T.G("scheme_"+q).innerHTML=y.fill(q,p,s);for(var r=0,B=y.transPoints[q].length;r<B;r++){y.transPoints[q][r][0]=y.stopPts[q][r]}y.addPoiRoute(q,p,s)}try{y.addWalkIcon1(E)}catch(C){}}},select:function(c,b,a){},unselect:function(c,b,a){if(this.highLine){removeRoute(this.highLine)}},mover:function(g,f,d){var c=this,d=d||window.event;if(!c.routeIndex[g]){c.routeIndex[g]=[0,0]}if(window._clearTempLineTimer){clearTimeout(window._clearTempLineTimer)}if(c.schemeIndex==g||c.tempLineIndex==g){return}else{c.removeTempLine();if(window._addTempLineTimer){clearTimeout(window._addTempLineTimer)}window._addTempLineTimer=setTimeout(function(){c.addTempRoute(g,c.routeIndex[g][0],c.routeIndex[g][1])},100);var a=f.parentNode.getElementsByTagName("li");for(var b=0;b<a.length;b++){if(b==(g%c.pagecap)){T.ac(a[b],"on")}else{if((c.schemeIndex%c.pagecap)!=b){T.rc(a[b],"on")}}}}},mout:function(f,d,b){var b=b||window.event,a=this,c=b.srcElement||b.target;if(window._addTempLineTimer){clearTimeout(window._addTempLineTimer)}window._clearTempLineTimer=setTimeout(function(){a.removeTempLine();var e=d.parentNode.getElementsByTagName("li");for(var g=0;g<e.length;g++){if((a.schemeIndex%a.pagecap)!=g){e[g].className=""}}a.tempLineIndex=null;window.clearTempRoute()},10)},move:function(){if(window._clearTempLineTimer){clearTimeout(window._clearTempLineTimer)}},trOver:function(b,a){},trOut:function(b,a){},cancelClick:function(b,a){var a=a||window.event;stopBubble(a)},setValue:function(e){var c=T.G("destTable_"+this.guid);var d=c.rows[e];var b=d.cells[1];var a=d.cells[2];a.innerHTML='<input type="submit" value="确定" onclick="Instance(\''+this.guid+"').submit("+e+')" class="btn">';b.innerHTML='<input id="dest_#guid#_2" type="text"  class="ipt" value="'+b.innerHTML+'">';b.firstChild.focus()},submit:function(a){var g=T.G("destTable_"+this.guid);var f=g.rows[a];var h=f.cells[1].childNodes[0];f.cells[1].innerHTML=h.value;f.cells[2].className="modify";f.cells[2].innerHTML='<a href="javascript:void(0)" onclick="Instance(\''+this.guid+"').setValue("+a+');return false;">修改</a>';var k=g.rows.length;var c=[];for(var b=0;b<k;b++){var e=g.rows[b].cells[1].childNodes[0];if(e){var d=parseInt(e.nodeType);if(d==1){c.push(e.value)}if(d==3){c.push(e.nodeValue)}}}if(!c[0]||!c[1]){return}if(c[0]!=this.startName||c[1]!=this.endName){go("bt&c="+this.currentCity+"&"+this.getStrategy(this.strategy)+"&sn=2$$$$$$"+encodeURIComponent(c[0])+"$$$$$$&en=2$$$$$$"+encodeURIComponent(c[1])+"$$$$$$")}},round:function(a,c){var b=1;for(;c>0;b*=10,c--){}for(;c<0;b/=10,c){}return Math.round(a*b)/b},nextTransCbk:function(d,b){var a=b.transWins[b.schemeIndex][d];var c=b.transPois[d];transInfoWindow(c,a)},zoomTransCbk:function(c,b){var a=BMap.MapType[map.mapType].zoomLevelMax;if(c==0){map.zoomTo(a)}else{if(b.mapZoomLevel!=map.zoomLevel){map.zoomTo(b.mapZoomLevel)}else{map.zoomTo(a-3)}}},highRoute:function(h,k,f,g){this.hideWalkContent();map.closeInfoWindow();this.removeTip();var h=h||window.event;if(h){stopBubble(h)}var b=[this.routeBound[k][f]];var d=getBPoints(b);if(this.cinfo._maplevel&&this.cinfo._centerPoint){map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel);this.cinfo._centerPoint=null;this.cinfo._maplevel=null}else{if(d){setViewport(d,this.expend);this.mapZoomLevel=map.zoomLevel}}if(g){var a=g.parentNode.getElementsByTagName("tr");for(var c=0;c<a.length;c++){if(a[c]==g){a[c].className="sel"}else{a[c].className=""}}}if(this.redRoute){unSelectRoute(this.redRoute)}if(this.routeLines){this.redRoute=this.routeLines[f];selectRoute(this.redRoute)}this.tindex=-1;this.windex=-1;this.rindex=f;Share.listIndex=k+","+this.unfold+","+this.page+","+this.rindex},WalkContent:function(o,r,s,h,u){var y=this;var a=o.parentNode.parentNode.id;var v="";var p="";var t="";var l="";var q=this.schemes[this.page-1][r-(this.page-1)*this.pagecap];var e=q.stops[this.routeIndex[r][0]];var x=q.lines[this.routeIndex[r][0]];var f="";u=u||{};function g(C,A,n){C=C.split(",");A=A.split(",");n=n.split(",");var w=A[0]-C[0];var D=A[1]-C[1];var m=n[0]-A[0];var B=n[1]-A[1];var E=(w*m+D*B)/(Math.sqrt((w*w+m*m)*(D*D+B*B)));return E}function d(n,m){if(x[n].type==0){var C=parse2Geo(e[m].walk.geo).points.split(";");var D=parse2Geo(x[n].geo).points.split(";");D=D[D.length-2];var B=C[0];var A=C[1];var w=g(D,B,A);if(!(Math.abs(w)<0.9)){if(w>0){f="下车<span>继续向前</span>，"}else{f="下车<span>往回</span>，"}}}}function c(m){if(m<10){m=10}else{if(m>10&&m<=1000){m=(m/10).toFixed(0)*10}else{if(m>1000){m=(m/1000).toFixed(1)*1000}}}return m}var b=0;var z=1;function k(A,w){var m=parse2Geo(e[A].walk.geo).points;m=m.split(";");if(w==0){m=m[0]}else{if(w==1){m=m[m.length-1]}}return m}if(s==0){v=y.startPoint;p=parse2Geo(e[0].getOn.geo).points;if(e[0].walk.ename){p=k(0,1)}t=y.start.wd;l=e[0].getOn.name;b=c(e[0].walk.distance);z=2}else{if(s==1&&!u.inSubway){v=parse2Geo(e[h+1].getOff.geo).points;if(e[h+1].walk.sname){v=k(h+1,0)}d(h,h+1);p=parse2Geo(e[h+1].getOn.geo).points;if(e[h+1].walk.ename){p=k(h+1,1)}t=e[h+1].getOff.name;l=e[h+1].getOn.name;b=c(e[h+1].walk.distance);if(e[h+1].walk.sname!=""){z=1}else{if(e[h+1].walk.ename!=""){z=2}}}else{if(s==2){z=1;v=parse2Geo(e[e.length-1].getOff.geo).points;if(e[e.length-1].walk.sname){v=k(e.length-1,0)}d(e.length-2,e.length-1);p=y.endPoint;t=e[e.length-1].getOff.name;l=y.end.wd;b=c(e[e.length-1].walk.distance)}else{y.hideWalkContent();return}}}if(this.WalkContent.openId&&this.WalkContent.openId!="tr_"+r+"_"+s+"_"+h){this.hideWalkContent()}if(!T.G("tr_"+r+"_"+s+"_"+h)){go("walk&version=2.0&walktp=1&c="+y.currentCity+"&wdrag=0&sc="+y.currentCity+"&ec="+y.currentCity+"&"+y.getStrategy(y.strategy)+"&en=1$$$$"+p+"$$"+encodeURIComponent(l)+"$$$$$$&sn=1$$$$"+v+"$$"+encodeURIComponent(t)+"$$$$$$&sq="+encodeURIComponent(t)+"&eq="+encodeURIComponent(l)+"&region="+s,function(U){var V=U.content.kps;rss=U.content.rss;var H=[""];if(V&&rss){H.push('<table id="table_info" width="100%" border="0" cellspacing="0" cellpadding="0">');var A=V.length;var D=0;var K=0;for(var P=0;P<A;P++){var E=V[P].rt;var L=parseInt(rss[P].d);var Q=0;if(L<=10){Q=10}else{Q=L<1000?(L/10).toFixed(0)*10:(L/1000).toFixed(1)*1000}if(P>0&&P<A-1){K+=Q}}for(var P=0;P<A;P++){var E=V[P].rt;var L=parseInt(rss[P].d);var w="";var I=1;var O=b-K;if(z==1){I=1}else{if(z==2){I=A-2}}if(P==I&&O>0){L+=O}if(L<=10){w=10+"米"}else{w=L<1000?(L/10).toFixed(0)*10+"米":(L/1000).toFixed(1)+"公里"}if(P==0){H.push("<tr>");H.push("<th>"+(D+1)+".</th>");if(s==0){H.push("<td>从<span>起点</span>向<span>"+y.turtype[V[0].tt]+"</span>出发，"+f)}else{H.push("<td>"+f)}}else{if(P==1){var J=y.getPreRoadStr(rss[P],(P>0)?rss[P-1]:null);var n=T.trim(rss[P+1].n);J=J==""?y.roadtype[rss[P].t]:J;n=n==""?y.roadtype[rss[P+1].t]:n;var W="进入";var N=rss[P+1].t;if(N==9||N==12){W="上"}else{if(N==0||N>=22||(rss[P].n==rss[P+1].n&&N!=1)){W="";n=""}}if(V[P].tt==9||V[P].tt==10||V[P].tt==11||V[P].tt==12){W="";n=""}var G=y.getTurStr(V[P].tt,rss[P].wt,V[P].extt);var m=(rss[P].t==20||rss[P].t==21)?"<span>离开"+rss[P].n+"</span>，":"";var B=rss[P].t>=22?"":y.rettype[V[P].rt]+w;H.push(J+B+"，"+m+"<span>"+G+"</span>"+W+"<span>"+n+"</span>");if(V[P+1].rt==3){var E=V[P+1].rt;var S=y.rettype[E];H.push("到达<span>"+S+"</span>")}if(A>3){H.push("</td></tr>")}D++}else{if(P==A-2){var J=y.getPreRoadStr(rss[P],(P>0)?rss[P-1]:null);J=J==""?"<td>"+y.roadtype[rss[P].t]:"<td>"+J;H.push("<tr>");H.push("<th>"+(D+1)+".</th>");var m="";var G=y.getTurStr(V[P].tt,rss[P].wt,V[P].extt);var B=rss[P].t>=22?"":y.rettype[V[P].rt]+w;H.push(J+B+m+G);var R=parse2Geo(rss[P].g);D++}else{if(P==A-1&&E==2){var C=y.spliceSN(l);if(s==2){C="终点"}if(A>3){H.push("，到达<strong>"+C+"</strong></td>")}else{if(A==3&&rss[1].wt!=0){H.push("，")}H.push("到达<strong>"+C+"</strong></td>")}H.push("</tr>")}else{if(P<A-2){if(E!=3){var J=y.getPreRoadStr(rss[P],(P>0)?rss[P-1]:null);var n=rss[P+1].n;J=J==""?y.roadtype[rss[P].t]:J;n=n==""?y.roadtype[rss[P+1].t]:n;J=T.trim(J);n=T.trim(n);var E=V[P+1].rt;var W="进入";var N=rss[P+1].t;if(N==9||N==12){W="上"}else{if(N==0||N>=22||(rss[P].n==rss[P+1].n&&N!=1)){W="";n=""}}H.push("<tr>");H.push("<th>"+(D+1)+".</th>");if(V[P].tt==9||V[P].tt==10||V[P].tt==11||V[P].tt==12){W="";n=""}if(E==3){var S=y.rettype[E];H.push("<td>"+J+y.rettype[V[P].rt]+w+"，到达<span>"+y.spliceSN(S)+"</span></td>")}else{var G=y.getTurStr(V[P].tt,rss[P].wt,V[P].extt);var m=(rss[P].t==20||rss[P].t==21)?"<span>离开"+rss[P].n+"</span>，":"";var B=rss[P].t>=22?"":y.rettype[V[P].rt]+w;H.push("<td>"+J+B+"，"+m+"<span>"+G+"</span>"+W+"<span>"+n+"</span></td>")}H.push("</tr>");D++}}}}}}}H.push("</table>")}var M=document.createElement("tr");M.id="tr_"+r+"_"+s+"_"+h;var F=document.createElement("td");M.className="sel";F.innerHTML="<div class='walk_div'>"+H.join("")+"</div><span onclick='Instance(\""+y.guid+"\").hideWalkContent(\"bt\")' class='closeWalkInfo'>收起</span>";F.setAttribute("colSpan","2");F.onclick=function(X){stopBubble(X)};M.appendChild(F);T.dom.insertAfter(M,o);o.className="sel_td";y.scrollPanel.update()});addStat(STAT_BUS_WALK_NAV_OPEN)}else{if(this.WalkContent.openId!="tr_"+r+"_"+s+"_"+h&&T.G("tr_"+r+"_"+s+"_"+h).style.display=="none"){o.className="sel_td";T.G("tr_"+r+"_"+s+"_"+h).style.display="";T.G("tr_"+r+"_"+s+"_"+h).className="sel";o.style.cursor="default";addStat(STAT_BUS_WALK_NAV_OPEN);y.scrollPanel.update()}else{addStat(STAT_BUS_WALK_NAV_CLOSE);y.hideWalkContent("self");y.scrollPanel.update();return}}this.WalkContent.openId="tr_"+r+"_"+s+"_"+h;this.WalkContent.navDom=o},hideWalkContent:function(a){if(this.WalkContent.openId&&T.G(this.WalkContent.openId)&&this.WalkContent.navDom){T.G(this.WalkContent.openId).style.display="none";if(a=="self"||a=="bt"){this.WalkContent.navDom.className="sel";this.WalkContent.navDom.style.cursor="pointer";if(a=="bt"){addStat(STAT_BUS_WALK_NAV_CLOSE_BY_BT)}}else{this.WalkContent.navDom.className=""}this.WalkContent.openId="";this.WalkContent.navDom=""}this.scrollPanel&&this.scrollPanel.update()},getTurStr:function(d,b,c){var a="";if(b>0){var e=c>0?((d==21||d==22)?"<span>"+this.turtype1[c]+"</span>，":"<span>"+this.turtype1[c]+"过"+this.worktype[b]+"</span>，"):"<span>过"+this.worktype[b]+"</span>，";if(d>0&&d<13){a=e+this.turtype[d]}else{if(d>=21){a=e+this.turtype[d].replace(/#WalkType#/gi,"<span>"+this.worktype[b]+"</span>")}else{a="<span>"+this.turtype1[c]+"过"+this.worktype[b]+"</span>";if(d!=0){a+="，"}}}}else{a=this.turtype[d].replace(/#WalkType#/gi,"<span>"+this.worktype[b]+"</span>")}return a},getPreRoadStr:function(e,c){var d=(c&&e.n==c.n)?"继续":"";var b=e.n==""?this.roadtype[e.t]:e.n=="过街天桥"?"天桥":e.n;var a=e.t>=22?"过":"沿";return e.d==0?(e.wt==0?(b==""?"":"至<span>"+b+"</span>"):"过<span>"+this.worktype[e.wt]+"</span>至<span>"+b+"</span>"):(this.roadtype[e.t]==""?"":d+a+"<span>"+b+"</span>")},highWalk:function(h,b,a,l,c){map.closeInfoWindow();this.removeTip();var h=h||window.event;if(h){stopBubble(h)}if(c){var g=c.parentNode.getElementsByTagName("tr");for(var d=0;d<g.length;d++){if(g[d]==c){g[d].className="sel"}else{g[d].className=""}}}if(this.redRoute){unSelectRoute(this.redRoute);this.redRoute=null}l=parseInt(l);var f=[];switch(l){case 0:if(this.sWalkLines[a]){this.redRoute=this.sWalkLines[a];f.push(this.sWalkBound[b][a])}break;case 1:if(this.tWalkLines[a]){this.redRoute=this.tWalkLines[a];f.push(this.tWalkBound[b][a])}break;case 2:if(this.eWalkLines&&this.eWalkLines[a]){this.redRoute=this.eWalkLines[a];f.push(this.eWalkBound[b][a])}break}var k=getBPoints(f);if(this.cinfo._maplevel&&this.cinfo._centerPoint){map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel);this.cinfo._centerPoint=null;this.cinfo._maplevel=null}else{if(k){setViewport(k,this.expend);this.mapZoomLevel=map.zoomLevel}}selectRoute(this.redRoute);this.rindex=-1;this.tindex=l;this.windex=a;Share.listIndex=b+","+this.unfold+","+this.page+","+this.rindex+","+this.windex+","+this.tindex},highZoneSta:function(g,f,d,m,c,a,h){addStat(STAT_BUS_STCOUNT);map.closeInfoWindow();this.removeTip();var l=this;var b=this.schemes[this.page-1][c-(this.page-1)*this.pagecap];var p=b.stops[0][a+1].getOff;var o=parse2Geo(p.geo).points;var k="bsl&newmap=1&c="+this.currentCity+"&uid="+f+"&suid="+d+"&euid="+m+"&ie=utf-8&t="+new Date().getTime();go(k,function(r){var s=r.content[0];var q=s.stations;l.zoneStaPoints=[];l.zoneBusStopPois=[];l.zoneStaTips=[];for(var n=0,e=q.length;n<e;n++){(function(){var t=n,u=parseGeo(q[t].geo);if(u.type==1){var v=addBusStopPoi(u.points,q[t].name);l.zoneBusStopPois.push(v);l.zoneStaPoints.push(getPoiPoint(u.points));l.zoneStaTips.push(createTip(s.stations[n].name,"TipC",{point:getPointByStr(u.points)}))}})()}l.zoneStaPoints.push(o);l.zoneStaTips.push(createTip(p.name,"TipC",{point:getPointByStr(o)}))})},clickStop:function(f,b,c){stopBubble(f);if(this.transPois){var g=this.transPois[c];var a=this.transWins[b][c];var d=g.getPoint();transInfoWindow(g,a,{ccode:this.currentCity});if(this.isOperated){if(!isInBounds(d)){map.setCenter(d)}}else{map.centerAndZoom(d,18)}}},returnBus:function(){addStat(STAT_BUS_RETURN);var a=this.sBus==1?0:1;var c=this.eBus==1?0:1;var b=this;if(b.cinfo&&b.cinfo.isSingle==true){if(b.cinfo.t==0){b.cinfo.t=1}else{b.cinfo.t=0}}go("bt&bttp=0&c="+this.currentCity+"&"+b.getStrategy(b.strategy)+"&sn="+c+"$$"+this.euid+"$$"+this.endPoint+"$$"+encodeURIComponent(this.end.wd)+"$$$$$$&en="+a+"$$"+this.suid+"$$"+this.startPoint+"$$"+encodeURIComponent(this.start.wd)+"$$$$$$&sq="+encodeURIComponent(this.e_query)+"&eq="+encodeURIComponent(this.s_query),{cinfo:b.cinfo})},backAddr:function(){addStat(STAT_BUS_ANEW);var a=this;if(a.cinfo&&a.cinfo.isSingle==true){go(a.cinfo.q+"&src=4",{cinfo:a.cinfo})}else{go("bt&c="+this.currentCity+"&sn=2$$"+this.suid+"$$"+this.startPoint+"$$"+encodeURIComponent(this.s_query)+"$$$$$$&en=2$$"+this.euid+"$$"+this.endPoint+"$$"+encodeURIComponent(this.e_query)+"$$$$$$&src=4")}addStat(STAT_BUS_RESEL_ADDR)},navigate:function(){var a=this;if(a.cinfo&&a.cinfo.isSingle==true){a.cinfo.q=a.cinfo.q.replace(/^bse&/,"nse&")}switchTab._ByClickTab=false;go(a.navQueryString,{cinfo:a.cinfo})},navWalk:function(){var a=this;if(a.cinfo&&a.cinfo.isSingle==true){a.cinfo.q=a.cinfo.q.replace(/^bse&/,"nse&")}go("walk&version=2.0&walktp=1&c="+a.currentCity+"&wdrag=0&sc="+a.currentCity+"&ec="+a.currentCity+"&"+a.getStrategy(a.strategy)+"&en=1$$$$"+a.endPoint+"$$"+encodeURIComponent(a.end.wd)+"$$$$$$&sn=1$$$$"+a.startPoint+"$$"+encodeURIComponent(a.start.wd)+"$$$$$$&sq="+encodeURIComponent(a.s_query)+"&eq="+encodeURIComponent(a.e_query),{cinfo:a.cinfo})},returnLType:function(d){var b=this.lineType.length;for(i=0;i<b;i++){var a=this.lineType[i];for(j=0;j<a.length;j++){var c=a[j];if(c==d){return i}}}},getStrategy:function(a){if(a==4){return"sy=4&f="+getSearchTranType.busSub}else{return"sy="+a}},spliceSN:function(a){var b=a.substring(a.length-1);return(b=="站")?a:(a+"站")},formatDis:function(a){if(a<10){a=10+"米"}else{if(a>10&&a<=1000){a=(a/10).toFixed(0)*10+"米"}else{if(a>1000){a=(a/1000).toFixed(1)+"公里"}}}return a},getTaxi:function(c){addStat(STAT_BUS_TAXI);var a=this,b=a.navQueryString;if(a.cinfo&&a.cinfo.isSingle==true){a.cinfo.q=a.cinfo.q.replace(/^bse&/,"nse&")}if(b.indexOf("&sy=0")>=0){b=b.replace("&sy=0","&sy=1")}openTaxi(c,{data:this.json.taxi,from:"sd"})},busTranFor3D:function(){var a=this;window.busTranFor3D=function(b){if(window.startPoi){if(b){window.startPoi.enableDragging()}else{window.startPoi.disableDragging()}window.startPoi.setTitle("")}if(window.endPoi){if(b){window.endPoi.enableDragging()}else{window.endPoi.disableDragging()}window.endPoi.setTitle("")}}},addWalkIcon:function(d){for(var b=0,f=this.walkMkrs.length;b<f;b++){map.removeOverlay(this.walkMkrs[b])}this.walkMkrs=[];for(var b=0,f=d.length;b<f;b++){if(!d[b].walk||!d[b].walk.wfi){continue}var a=d[b].walk.wfi.split("|");for(var c=1,e=a.length;c<e;c++){this._addWalkIcon(a[c])}}},addWalkIcon1:function(b){for(var c=0,f=this.walkMkrs.length;c<f;c++){map.removeOverlay(this.walkMkrs[c])}this.walkMkrs=[];for(var c=0,f=b.length;c<f;c++){if(!b[c].wfi){continue}var a=b[c].wfi.split("|");for(var d=1,e=a.length;d<e;d++){this._addWalkIcon(a[d])}}},_addWalkIcon:function(k){var g=k.split("$");var l=getPoiPoint(parse2Geo(g[1]).points);var e=[{wd:"非步行设施"},{wd:"人行道"},{wd:"天桥",img:[0,-20],w:18},{wd:"地下通道",img:[0,0],w:18},{wd:"人行通道"},{wd:"直梯"},{wd:"扶梯"},{wd:"阶梯"},{wd:"斜坡"},{wd:"索道"},{wd:"广场",img:[0,-40],w:18}];var b=e[g[0]*1];if(!b||!b.img){return}var f=new BMap.Icon(MapConfig.smFlwCon+"image/walkflag.png",new BMap.Size(b.w,b.w),{offset:new BMap.Size(b.w/2,b.w/2),imageOffset:new BMap.Size(b.img[0],b.img[1])});var d=new BMap.Marker(l,{icon:f});map.addOverlay(d);this.walkMkrs.push(d);if(map.getZoom()<16){d.hide()}else{d.show()}function c(){if(map.getZoom()<16){if(T.browser.ie>=8){setTimeout(function(){d&&d.hide()},100)}else{d&&d.hide()}}else{d&&d.show()}}map.addEventListener("zoomend",c);d.addEventListener("remove",function(){map.removeEventListener("zoomend",c)});var h=new BMap.Label(b.wd);map.addOverlay(h);h.setStyle({backgroundColor:"#EEFFED",borderColor:"#6D8760",color:"#4D6B37",lineHeight:"16px",paddingTop:"0px",paddingBottom:"0px"});h.setPoint(l);h.setOffset(new BMap.Size(b.w*1/2+2,0-b.w*1/2));h.hide();var a=false;d.addEventListener("onmouseover",function(){a=true;setTimeout(function(){if(!a){return}h.show()},500)});d.addEventListener("onmouseout",function(){h.hide();a=false})},addToFav:function(b,a){var c=this;addStat(STAT_BUS_FAV_CLICK);stopBubble(window.event||a);SyncMgr.checkFav(function(){SchemeFaver.toClound.call(c,{pathtype:1,dom:b})},this)}});
</script>
